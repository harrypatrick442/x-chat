/*
 Alessandro Piana 2015
 @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js */
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(c){var a=0;return function(){return a<c.length?{done:!1,value:c[a++]}:{done:!0}}};$jscomp.arrayIterator=function(c){return{next:$jscomp.arrayIteratorImpl(c)}};$jscomp.makeIterator=function(c){var a="undefined"!=typeof Symbol&&Symbol.iterator&&c[Symbol.iterator];return a?a.call(c):$jscomp.arrayIterator(c)};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,a,b){c!=Array.prototype&&c!=Object.prototype&&(c[a]=b.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(c,a,b,e){if(a){b=$jscomp.global;c=c.split(".");for(e=0;e<c.length-1;e++){var f=c[e];f in b||(b[f]={});b=b[f]}c=c[c.length-1];e=b[c];a=a(e);a!=e&&null!=a&&$jscomp.defineProperty(b,c,{configurable:!0,writable:!0,value:a})}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(c,a){this.$jscomp$symbol$id_=c;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:a})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function c(b){if(this instanceof c)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(b||"")+"_"+a++,b)}var a=0;return c}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.iterator;c||(c=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[c]&&$jscomp.defineProperty(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.asyncIterator;c||(c=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(c){$jscomp.initSymbolIterator();c={next:c};c[$jscomp.global.Symbol.iterator]=function(){return this};return c};
$jscomp.iteratorFromArray=function(c,a){$jscomp.initSymbolIterator();c instanceof String&&(c+="");var b=0,e={next:function(){if(b<c.length){var f=b++;return{value:a(f,c[f]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};$jscomp.polyfill("Array.prototype.entries",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(a,b){return[a,b]})}},"es6","es3");
$jscomp.polyfill("Array.prototype.values",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(a,b){return b})}},"es8","es3");$jscomp.polyfill("Array.prototype.keys",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
(function(c,a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(c)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(c.substr(0,
4)))window.location=a})(navigator.userAgent||navigator.vendor||window.opera,"m.index.html");(function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(c,a){var b=this.length>>>0;a=Number(a)||0;a=0>a?Math.ceil(a):Math.floor(a);for(0>a&&(a+=b);a<b;a++)if(a in this&&this[a]===c)return a;return-1})})();
Function.prototype.bind||(Function.prototype.bind=function(c){var a=this,b=Array.prototype.slice.call(arguments,1);if("function"!==typeof a)throw new TypeError("Function.prototype.bind - context must be a valid function");return function(){return a.apply(c,b.concat(Array.prototype.slice.call(arguments)))}});
!window.addEventListener&&function(c,a,b,e,f,h,k){c[e]=a[e]=b[e]=function(a,b){var c=this;k.unshift([c,a,b,function(a){a.currentTarget=c;a.preventDefault=function(){a.returnValue=!1};a.stopPropagation=function(){a.cancelBubble=!0};a.target=a.srcElement||c;b.call(c,a)}]);this.attachEvent("on"+a,k[0][3])};c[f]=a[f]=b[f]=function(a,b){for(var c=0,e;e=k[c];++c)if(e[0]==this&&e[1]==a&&e[2]==b)return this.detachEvent("on"+a,k.splice(c,1)[0][3])};c[h]=a[h]=b[h]=function(a){return this.fireEvent("on"+a.type,
a)}}(Window.prototype,HTMLDocument.prototype,Element.prototype,"addEventListener","removeEventListener","dispatchEvent",[]);
"document"in self&&("classList"in document.createElement("_")&&(!document.createElementNS||"classList"in document.createElementNS("http://www.w3.org/2000/svg","g"))||!function(c){if("Element"in c){c=c.Element.prototype;var a=Object,b=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},e=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},f=function(a,b){this.name=a;this.code=DOMException[a];this.message=b},h=function(a,
b){if(""===b)throw new f("SYNTAX_ERR","The token must not be empty.");if(/\s/.test(b))throw new f("INVALID_CHARACTER_ERR","The token must not contain space characters.");return e.call(a,b)},k=function(a){var c=b.call(a.getAttribute("class")||"");c=c?c.split(/\s+/):[];for(var e=0,f=c.length;f>e;e++)this.push(c[e]);this._updateClassName=function(){a.setAttribute("class",this.toString())}},g=k.prototype=[],m=function(){return new k(this)};if(f.prototype=Error.prototype,g.item=function(a){return this[a]||
null},g.contains=function(a){return~h(this,a+"")},g.add=function(){var a=arguments,b=0,c=a.length,e=!1;do{var f=a[b]+"";~h(this,f)||(this.push(f),e=!0)}while(++b<c);e&&this._updateClassName()},g.remove=function(){var a,b=arguments,c=0,e=b.length,f=!1;do{var g=b[c]+"";for(a=h(this,g);~a;)this.splice(a,1),f=!0,a=h(this,g)}while(++c<e);f&&this._updateClassName()},g.toggle=function(a,b){var c=this.contains(a),e=c?!0!==b&&"remove":!1!==b&&"add";return e&&this[e](a),!0===b||!1===b?b:!c},g.replace=function(a,
b){a=h(a+"");~a&&(this.splice(a,1,b),this._updateClassName())},g.toString=function(){return this.join(" ")},a.defineProperty){g={get:m,enumerable:!0,configurable:!0};try{a.defineProperty(c,"classList",g)}catch(l){void 0!==l.number&&-2146823252!==l.number||(g.enumerable=!1,a.defineProperty(c,"classList",g))}}else a.prototype.__defineGetter__&&c.__defineGetter__("classList",m)}}(self),function(){var c=document.createElement("_");if(c.classList.add("c1","c2"),!c.classList.contains("c2")){var a=function(a){var b=
DOMTokenList.prototype[a];DOMTokenList.prototype[a]=function(a){var c,e=arguments.length;for(c=0;e>c;c++)a=arguments[c],b.call(this,a)}};a("add");a("remove")}if(c.classList.toggle("c3",!1),c.classList.contains("c3")){var b=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(a,c){return 1 in arguments&&!this.contains(a)==!c?c:b.call(this,a)}}"replace"in document.createElement("_").classList||(DOMTokenList.prototype.replace=function(a,b){var c=this.toString().split(" ");a=c.indexOf(a+
"");~a&&(c=c.slice(a),this.remove.apply(this,c),this.add(b),this.add.apply(this,c.slice(1)))});c=null}());
(function(c){function a(a){for(var b="",c=0;c<(a||5);c++)b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return b}function b(a){return{timestamp:(new Date).getTime(),isTrusted:!0,target:null,currentTarget:null,data:a,bubbles:!1,cancelable:!1,defaultPrevented:!1,lastEventId:"",origin:c.location.origin}}function e(b){if(!c.localStorage)throw new "localStorage not available";b="polyBC_"+b;var e=null===h;this.channelId=b;k=k||a();h=h||{};h[b]=h[b]||
[];h[b].push(this);this.name=b+"::::"+a()+(new Date).getTime();e&&(console.log(c),console.log(c.addEventListener),c.addEventListener("storage",f.bind(this),!1));return this}function f(a){var b=a.key,e=a.newValue,f=!e;a=null;if(-1<b.indexOf("eomBCmessage_")&&!f){try{a=JSON.parse(e)}catch(w){throw new "Message conversion has resulted in an error.";}if(a.tabId!==k&&a.channelId&&h&&h[a.channelId]){e=h[a.channelId];for(var g in e)if(!e[g].closed&&e[g].onmessage)e[g].onmessage(a.message);c.localStorage.removeItem(b)}}}
var h=null,k=null;e.prototype.onmessage=function(a){};e.prototype.postMessage=function(e){if(h){if(this.closed)throw new "This BroadcastChannel is closed.";e=b(e);var f=h[this.channelId]||[];for(g in f)if(!f[g].closed&&f[g].name!==this.name&&f[g].onmessage)f[g].onmessage(e);var g={channelId:this.channelId,bcId:this.name,tabId:k,message:e};try{var n=JSON.stringify(g),p="eomBCmessage_"+a()+"_"+this.channelId;c.localStorage.setItem(p,n)}catch(w){throw new "Message conversion has resulted in an error.";
}setTimeout(function(){c.localStorage.removeItem(p)},1E3)}};e.prototype.close=function(){this.closed=!0;var a=h[this.channelId].indexOf(this);-1<a&&h[this.channelId].splice(a,1);h[this.channelId].length||delete h[this.channelId];a:{a=h;for(b in a)if(a.hasOwnProperty(b)){var b=!1;break a}b=!0}b&&c.removeEventListener("storage",f.bind(this))};c.BroadcastChannel=c.BroadcastChannel||e})(window);String.prototype.splice=function(c,a,b){return this.slice(0,c)+b+this.slice(c+Math.abs(a))};
function getWebsocketUrl(c){var a=window.location;var b="https:"===a.protocol?"wss:":"ws:";b+="//"+a.host;return b+("/"+c)}function each(c,a){for(var b=0;b<c.length;b++)a(c[b])}var When={NOW:"now",SECONDS:"seconds",MINUTES:"minutes",NEVER:"never"},VideoOfferRejectedReasons={PM_NOT_OPEN:1,DECLINED:2,ERRORs:3};
function StopWatch(){var c=this,a=0,b,e=!1;this.getMilliseconds=function(){var c=a;e&&(c+=Date().getTime()-b);return c};this.getSeconds=function(){return c.getMilliseconds/1E3};this.start=function(){e||(e=!0,b=(new Date).getTime())};this.stop=function(){e&&(e=!1,a+=(new Date).getTime()-b,b=0)};this.reset=function(){e=!1;b=a=0}}
var E=new function(){function c(b,c){b=a(b);b.type=c;return b}function a(a){a=document.createElement(a);a.addEventListener||(a.addEventListener=a.attachEvent);return a}this.DIV=function(){return a("div")};this.IMG=function(){return a("img")};this.CANVAS=function(){return a("canvas")};this.TABLE=function(){return a("table")};this.TR=function(){return a("tr")};this.TD=function(){return a("td")};this.TH=function(){return a("th")};this.H3=function(){return a("h3")};this.H2=function(){return a("h2")};
this.H1=function(){return a("h1")};this.VIDEO=function(){return a("video")};this.CHECKBOX=function(){return c("input","checkbox")};this.TEXT=function(){return c("input","text")};this.PASSWORD=function(){return c("input","password")};this.TEXTAREA=function(){return a("textarea")};this.SPAN=function(){return a("span")};this.SELECT=function(){return a("select")};this.OPTION=function(){return a("option")};this.TABLE=function(){return a("table")};this.COLGROUP=function(){return a("colgroup")};this.COL=
function(){return a("col")};this.BUTTON=function(){return a("button")};this.A=function(){return a("a")};this.LABEL=function(){return a("label")};this.FILE=function(){return c("input","file")}},Dimension=function(){function c(a){return Error("The string 2"+a+'" is an invalid dimension')}var a=function(a,e){console.log(e);this.isDimension=!0;(function(b,h){if(!h){h=b.indexOf("%");if(0<h){h=b.substr(0,h);if(0>=h.length)throw c(b);b={value:parseInt(h),unit:"%"}}else{h=b.indexOf("px");console.log(h);if(0>=
h)throw c(b);h=b.substr(0,h);if(0>=h.length)throw c(b);b={value:parseInt(h),unit:"px"}}console.log(b);a=b.value;e=b.unit}})(a,e);this.getValue=function(){return a};this.getUnit=function(){return e}};a.PX="px";a.PERCENT="%";a.px;a.pixels=function(b){return new a(b,"px")};a.percent=function(b){return new a(b,"%")};return a}(),moment;
(function(c,a){"object"===typeof exports&&"undefined"!==typeof module?module.exports=a():"function"===typeof define&&define.amd?define(a):c.moment=a()})(this,function(){function c(){return jc.apply(null,arguments)}function a(d){return d instanceof Array||"[object Array]"===Object.prototype.toString.call(d)}function b(d){return null!=d&&"[object Object]"===Object.prototype.toString.call(d)}function e(d){return void 0===d}function f(d){return"number"===typeof d||"[object Number]"===Object.prototype.toString.call(d)}
function h(d){return d instanceof Date||"[object Date]"===Object.prototype.toString.call(d)}function k(d,x){var a=[],b;for(b=0;b<d.length;++b)a.push(x(d[b],b));return a}function g(d,x){return Object.prototype.hasOwnProperty.call(d,x)}function m(d,x){for(var a in x)g(x,a)&&(d[a]=x[a]);g(x,"toString")&&(d.toString=x.toString);g(x,"valueOf")&&(d.valueOf=x.valueOf);return d}function l(d,x,a,b){return vb(d,x,a,b,!0).utc()}function n(d){null==d._pf&&(d._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,
charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null,rfc2822:!1,weekdayMismatch:!1});return d._pf}function p(d){if(null==d._isValid){var a=n(d),b=kc.call(a.parsedDateParts,function(d){return null!=d});b=!isNaN(d._d.getTime())&&0>a.overflow&&!a.empty&&!a.invalidMonth&&!a.invalidWeekday&&!a.weekdayMismatch&&!a.nullInput&&!a.invalidFormat&&!a.userInvalidated&&(!a.meridiem||a.meridiem&&b);d._strict&&(b=b&&0===a.charsLeftOver&&0===a.unusedTokens.length&&
void 0===a.bigHour);if(null!=Object.isFrozen&&Object.isFrozen(d))return b;d._isValid=b}return d._isValid}function w(d){var a=l(NaN);null!=d?m(n(a),d):n(a).userInvalidated=!0;return a}function q(d,a){var x;e(a._isAMomentObject)||(d._isAMomentObject=a._isAMomentObject);e(a._i)||(d._i=a._i);e(a._f)||(d._f=a._f);e(a._l)||(d._l=a._l);e(a._strict)||(d._strict=a._strict);e(a._tzm)||(d._tzm=a._tzm);e(a._isUTC)||(d._isUTC=a._isUTC);e(a._offset)||(d._offset=a._offset);e(a._pf)||(d._pf=n(a));e(a._locale)||(d._locale=
a._locale);if(0<Za.length)for(x=0;x<Za.length;x++){var b=Za[x];var c=a[b];e(c)||(d[b]=c)}return d}function t(d){q(this,d);this._d=new Date(null!=d._d?d._d.getTime():NaN);this.isValid()||(this._d=new Date(NaN));!1===$a&&($a=!0,c.updateOffset(this),$a=!1)}function r(d){return d instanceof t||null!=d&&null!=d._isAMomentObject}function v(d){return 0>d?Math.ceil(d)||0:Math.floor(d)}function u(d){d=+d;var a=0;0!==d&&isFinite(d)&&(a=v(d));return a}function z(d,a,b){var x=Math.min(d.length,a.length),c=Math.abs(d.length-
a.length),e=0,f;for(f=0;f<x;f++)(b&&d[f]!==a[f]||!b&&u(d[f])!==u(a[f]))&&e++;return e+c}function K(d){!1===c.suppressDeprecationWarnings&&"undefined"!==typeof console&&console.warn&&console.warn("Deprecation warning: "+d)}function B(d,a){var x=!0;return m(function(){null!=c.deprecationHandler&&c.deprecationHandler(null,d);if(x){for(var b=[],e,f=0;f<arguments.length;f++){e="";if("object"===typeof arguments[f]){e+="\n["+f+"] ";for(var g in arguments[0])e+=g+": "+arguments[0][g]+", ";e=e.slice(0,-2)}else e=
arguments[f];b.push(e)}K(d+"\nArguments: "+Array.prototype.slice.call(b).join("")+"\n"+Error().stack);x=!1}return a.apply(this,arguments)},a)}function J(d,a){null!=c.deprecationHandler&&c.deprecationHandler(d,a);wb[d]||(K(a),wb[d]=!0)}function D(d){return d instanceof Function||"[object Function]"===Object.prototype.toString.call(d)}function I(d,a){var x=m({},d),c;for(c in a)g(a,c)&&(b(d[c])&&b(a[c])?(x[c]={},m(x[c],d[c]),m(x[c],a[c])):null!=a[c]?x[c]=a[c]:delete x[c]);for(c in d)g(d,c)&&!g(a,c)&&
b(d[c])&&(x[c]=m({},x[c]));return x}function F(d){null!=d&&this.set(d)}function H(d,a){var x=d.toLowerCase();Ea[x]=Ea[x+"s"]=Ea[a]=d}function C(d){return"string"===typeof d?Ea[d]||Ea[d.toLowerCase()]:void 0}function U(d){var a={},b,c;for(c in d)g(d,c)&&(b=C(c))&&(a[b]=d[c]);return a}function ia(d){var a=[],b;for(b in d)a.push({unit:b,priority:V[b]});a.sort(function(d,a){return d.priority-a.priority});return a}function L(d,a,b){var x=""+Math.abs(d);return(0<=d?b?"+":"":"-")+Math.pow(10,Math.max(0,
a-x.length)).toString().substr(1)+x}function G(d,a,b,c){var x=c;"string"===typeof c&&(x=function(){return this[c]()});d&&(za[d]=x);a&&(za[a[0]]=function(){return L(x.apply(this,arguments),a[1],a[2])});b&&(za[b]=function(){return this.localeData().ordinal(x.apply(this,arguments),d)})}function la(d){return d.match(/\[[\s\S]/)?d.replace(/^\[|\]$/g,""):d.replace(/\\/g,"")}function ba(d){var a=d.match(xb),b;var c=0;for(b=a.length;c<b;c++)a[c]=za[a[c]]?za[a[c]]:la(a[c]);return function(x){var c="",e;for(e=
0;e<b;e++)c+=D(a[e])?a[e].call(x,d):a[e];return c}}function W(d,a){if(!d.isValid())return d.localeData().invalidDate();a=aa(a,d.localeData());ab[a]=ab[a]||ba(a);return ab[a](d)}function aa(d,a){function x(d){return a.longDateFormat(d)||d}var b=5;for(La.lastIndex=0;0<=b&&La.test(d);)d=d.replace(La,x),La.lastIndex=0,--b;return d}function A(d,a,b){bb[d]=D(a)?a:function(d,x){return d&&b?b:a}}function cb(d,a){return g(bb,d)?bb[d](a._strict,a._locale):new RegExp(X(d))}function X(d){return ca(d.replace("\\",
"").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(d,a,b,c,e){return a||b||c||e}))}function ca(d){return d.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function N(d,a){var x,b=a;"string"===typeof d&&(d=[d]);f(a)&&(b=function(d,x){x[a]=u(d)});for(x=0;x<d.length;x++)db[d[x]]=b}function ma(d,a){N(d,function(d,x,b,c){b._w=b._w||{};a(d,b._w,b,c)})}function da(d){return 0===d%4&&0!==d%100||0===d%400}function na(d,a){return function(x){return null!=x?(yb(this,d,x),c.updateOffset(this,a),this):Y(this,
d)}}function Y(d,a){return d.isValid()?d._d["get"+(d._isUTC?"UTC":"")+a]():NaN}function yb(d,a,b){if(d.isValid()&&!isNaN(b))if("FullYear"===a&&da(d.year())&&1===d.month()&&29===d.date())d._d["set"+(d._isUTC?"UTC":"")+a](b,d.month(),Ma(b,d.month()));else d._d["set"+(d._isUTC?"UTC":"")+a](b)}function Ma(d,a){if(isNaN(d)||isNaN(a))return NaN;var x=(a%12+12)%12;return 1===x?da(d+(a-x)/12)?29:28:31-x%7%2}function zb(d,a){if(!d.isValid())return d;if("string"===typeof a)if(/^\d+$/.test(a))a=u(a);else if(a=
d.localeData().monthsParse(a),!f(a))return d;var x=Math.min(d.date(),Ma(d.year(),a));d._d["set"+(d._isUTC?"UTC":"")+"Month"](a,x);return d}function Ab(d){return null!=d?(zb(this,d),c.updateOffset(this,!0),this):Y(this,"Month")}function Bb(){function d(d,a){return a.length-d.length}var a=[],b=[],c=[],e;for(e=0;12>e;e++){var f=l([2E3,e]);a.push(this.monthsShort(f,""));b.push(this.months(f,""));c.push(this.months(f,""));c.push(this.monthsShort(f,""))}a.sort(d);b.sort(d);c.sort(d);for(e=0;12>e;e++)a[e]=
ca(a[e]),b[e]=ca(b[e]);for(e=0;24>e;e++)c[e]=ca(c[e]);this._monthsShortRegex=this._monthsRegex=new RegExp("^("+c.join("|")+")","i");this._monthsStrictRegex=new RegExp("^("+b.join("|")+")","i");this._monthsShortStrictRegex=new RegExp("^("+a.join("|")+")","i")}function lc(d,a,b,c,e,f,g){100>d&&0<=d?(a=new Date(d+400,a,b,c,e,f,g),isFinite(a.getFullYear())&&a.setFullYear(d)):a=new Date(d,a,b,c,e,f,g);return a}function Fa(d){if(100>d&&0<=d){var a=Array.prototype.slice.call(arguments);a[0]=d+400;a=new Date(Date.UTC.apply(null,
a));isFinite(a.getUTCFullYear())&&a.setUTCFullYear(d)}else a=new Date(Date.UTC.apply(null,arguments));return a}function Na(d,a,b){b=7+a-b;return-((7+Fa(d,0,b).getUTCDay()-a)%7)+b-1}function Cb(d,a,b,c,e){b=(7+b-c)%7;c=Na(d,c,e);c=1+7*(a-1)+b+c;0>=c?(a=d-1,d=(da(a)?366:365)+c):c>(da(d)?366:365)?(a=d+1,d=c-(da(d)?366:365)):(a=d,d=c);return{year:a,dayOfYear:d}}function Ga(d,a,b){var x=Na(d.year(),a,b);x=Math.floor((d.dayOfYear()-x-1)/7)+1;1>x?(d=d.year()-1,a=x+va(d,a,b)):x>va(d.year(),a,b)?(a=x-va(d.year(),
a,b),d=d.year()+1):(d=d.year(),a=x);return{week:a,year:d}}function va(d,a,b){var x=Na(d,a,b);a=Na(d+1,a,b);return((da(d)?366:365)-x+a)/7}function eb(d,a){return d.slice(a,7).concat(d.slice(0,a))}function mc(d,a,b){var c;d=d.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],c=0;7>c;++c){var x=l([2E3,1]).day(c);this._minWeekdaysParse[c]=this.weekdaysMin(x,"").toLocaleLowerCase();this._shortWeekdaysParse[c]=this.weekdaysShort(x,
"").toLocaleLowerCase();this._weekdaysParse[c]=this.weekdays(x,"").toLocaleLowerCase()}if(b)a="dddd"===a?R.call(this._weekdaysParse,d):"ddd"===a?R.call(this._shortWeekdaysParse,d):R.call(this._minWeekdaysParse,d);else if("dddd"===a){a=R.call(this._weekdaysParse,d);if(-1!==a)return a;a=R.call(this._shortWeekdaysParse,d);if(-1!==a)return a;a=R.call(this._minWeekdaysParse,d)}else if("ddd"===a){a=R.call(this._shortWeekdaysParse,d);if(-1!==a)return a;a=R.call(this._weekdaysParse,d);if(-1!==a)return a;
a=R.call(this._minWeekdaysParse,d)}else{a=R.call(this._minWeekdaysParse,d);if(-1!==a)return a;a=R.call(this._weekdaysParse,d);if(-1!==a)return a;a=R.call(this._shortWeekdaysParse,d)}return-1!==a?a:null}function fb(){function d(d,a){return a.length-d.length}var a=[],b=[],c=[],e=[],f;for(f=0;7>f;f++){var g=l([2E3,1]).day(f);var h=this.weekdaysMin(g,"");var k=this.weekdaysShort(g,"");g=this.weekdays(g,"");a.push(h);b.push(k);c.push(g);e.push(h);e.push(k);e.push(g)}a.sort(d);b.sort(d);c.sort(d);e.sort(d);
for(f=0;7>f;f++)b[f]=ca(b[f]),c[f]=ca(c[f]),e[f]=ca(e[f]);this._weekdaysMinRegex=this._weekdaysShortRegex=this._weekdaysRegex=new RegExp("^("+e.join("|")+")","i");this._weekdaysStrictRegex=new RegExp("^("+c.join("|")+")","i");this._weekdaysShortStrictRegex=new RegExp("^("+b.join("|")+")","i");this._weekdaysMinStrictRegex=new RegExp("^("+a.join("|")+")","i")}function gb(){return this.hours()%12||12}function Db(d,a){G(d,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),a)})}
function Eb(d,a){return a._meridiemParse}function Fb(d){return d?d.toLowerCase().replace("_","-"):d}function Oa(d){var a=null;if(!S[d]&&"undefined"!==typeof module&&module&&module.exports)try{a=Ha._abbr;var b=window.require;b("./locale/"+d);Aa(a)}catch(dd){}return S[d]}function Aa(d,a){d&&((a=e(a)?sa(d):hb(d,a))?Ha=a:"undefined"!==typeof console&&console.warn&&console.warn("Locale "+d+" not found. Did you forget to load it?"));return Ha._abbr}function hb(d,a){if(null!==a){var b=Gb;a.abbr=d;if(null!=
S[d])J("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),b=S[d]._config;else if(null!=a.parentLocale)if(null!=S[a.parentLocale])b=S[a.parentLocale]._config;else if(b=Oa(a.parentLocale),null!=b)b=b._config;else return Ia[a.parentLocale]||(Ia[a.parentLocale]=[]),Ia[a.parentLocale].push({name:d,
config:a}),null;S[d]=new F(I(b,a));Ia[d]&&Ia[d].forEach(function(d){hb(d.name,d.config)});Aa(d);return S[d]}delete S[d];return null}function sa(d){var b;d&&d._locale&&d._locale._abbr&&(d=d._locale._abbr);if(!d)return Ha;if(!a(d)){if(b=Oa(d))return b;d=[d]}a:{b=0;for(var c,e,f,g;b<d.length;){g=Fb(d[b]).split("-");c=g.length;for(e=(e=Fb(d[b+1]))?e.split("-"):null;0<c;){if(f=Oa(g.slice(0,c).join("-"))){d=f;break a}if(e&&e.length>=c&&z(g,e,!0)>=c-1)break;c--}b++}d=Ha}return d}function ib(d){var a;(a=
d._a)&&-2===n(d).overflow&&(a=0>a[oa]||11<a[oa]?oa:1>a[ja]||a[ja]>Ma(a[ea],a[oa])?ja:0>a[T]||24<a[T]||24===a[T]&&(0!==a[fa]||0!==a[pa]||0!==a[wa])?T:0>a[fa]||59<a[fa]?fa:0>a[pa]||59<a[pa]?pa:0>a[wa]||999<a[wa]?wa:-1,n(d)._overflowDayOfYear&&(a<ea||a>ja)&&(a=ja),n(d)._overflowWeeks&&-1===a&&(a=nc),n(d)._overflowWeekday&&-1===a&&(a=oc),n(d).overflow=a);return d}function Ba(d,a,b){return null!=d?d:null!=a?a:b}function jb(d){var a=[];if(!d._d){var b=new Date(c.now());b=d._useUTC?[b.getUTCFullYear(),b.getUTCMonth(),
b.getUTCDate()]:[b.getFullYear(),b.getMonth(),b.getDate()];if(d._w&&null==d._a[ja]&&null==d._a[oa]){var e=d._w;if(null!=e.GG||null!=e.W||null!=e.E){var f=1;var g=4;var h=Ba(e.GG,d._a[ea],Ga(P(),1,4).year);var l=Ba(e.W,1);var k=Ba(e.E,1);if(1>k||7<k)var m=!0}else if(f=d._locale._week.dow,g=d._locale._week.doy,l=Ga(P(),f,g),h=Ba(e.gg,d._a[ea],l.year),l=Ba(e.w,l.week),null!=e.d){if(k=e.d,0>k||6<k)m=!0}else if(null!=e.e){if(k=e.e+f,0>e.e||6<e.e)m=!0}else k=f;1>l||l>va(h,f,g)?n(d)._overflowWeeks=!0:null!=
m?n(d)._overflowWeekday=!0:(m=Cb(h,l,k,f,g),d._a[ea]=m.year,d._dayOfYear=m.dayOfYear)}if(null!=d._dayOfYear){m=Ba(d._a[ea],b[ea]);if(d._dayOfYear>(da(m)?366:365)||0===d._dayOfYear)n(d)._overflowDayOfYear=!0;m=Fa(m,0,d._dayOfYear);d._a[oa]=m.getUTCMonth();d._a[ja]=m.getUTCDate()}for(m=0;3>m&&null==d._a[m];++m)d._a[m]=a[m]=b[m];for(;7>m;m++)d._a[m]=a[m]=null==d._a[m]?2===m?1:0:d._a[m];24===d._a[T]&&0===d._a[fa]&&0===d._a[pa]&&0===d._a[wa]&&(d._nextDay=!0,d._a[T]=0);d._d=(d._useUTC?Fa:lc).apply(null,
a);a=d._useUTC?d._d.getUTCDay():d._d.getDay();null!=d._tzm&&d._d.setUTCMinutes(d._d.getUTCMinutes()-d._tzm);d._nextDay&&(d._a[T]=24);d._w&&"undefined"!==typeof d._w.d&&d._w.d!==a&&(n(d).weekdayMismatch=!0)}}function Hb(d){var a;var b=d._i;var c=pc.exec(b)||qc.exec(b);if(c){n(d).iso=!0;b=0;for(a=Pa.length;b<a;b++)if(Pa[b][1].exec(c[1])){var e=Pa[b][0];var f=!1!==Pa[b][2];break}if(null==e)d._isValid=!1;else{if(c[3]){b=0;for(a=kb.length;b<a;b++)if(kb[b][1].exec(c[3])){var g=(c[2]||" ")+kb[b][0];break}if(null==
g){d._isValid=!1;return}}if(f||null==g){if(c[4])if(rc.exec(c[4]))var h="Z";else{d._isValid=!1;return}d._f=e+(g||"")+(h||"");lb(d)}else d._isValid=!1}}else d._isValid=!1}function Ib(d){var a=sc.exec(d._i.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,""));if(a){var b=a[3],c=a[2],e=a[5],f=a[6],g=a[7],h=parseInt(a[4],10);b=[49>=h?2E3+h:999>=h?1900+h:h,Jb.indexOf(b),parseInt(c,10),parseInt(e,10),parseInt(f,10)];g&&b.push(parseInt(g,10));a:{if(g=a[1])if(g=
Kb.indexOf(g),c=(new Date(b[0],b[1],b[2])).getDay(),g!==c){n(d).weekdayMismatch=!0;g=d._isValid=!1;break a}g=!0}g&&(d._a=b,(g=a[8])?a=tc[g]:a[9]?a=0:(a=parseInt(a[10],10),g=a%100,a=(a-g)/100*60+g),d._tzm=a,d._d=Fa.apply(null,d._a),d._d.setUTCMinutes(d._d.getUTCMinutes()-d._tzm),n(d).rfc2822=!0)}else d._isValid=!1}function uc(d){var a=vc.exec(d._i);null!==a?d._d=new Date(+a[1]):(Hb(d),!1===d._isValid&&(delete d._isValid,Ib(d),!1===d._isValid&&(delete d._isValid,c.createFromInputFallback(d))))}function lb(d){if(d._f===
c.ISO_8601)Hb(d);else if(d._f===c.RFC_2822)Ib(d);else{d._a=[];n(d).empty=!0;var a=""+d._i,b,e,f=a.length,h=0;var l=aa(d._f,d._locale).match(xb)||[];for(b=0;b<l.length;b++){var k=l[b];if(e=(a.match(cb(k,d))||[])[0]){var m=a.substr(0,a.indexOf(e));0<m.length&&n(d).unusedInput.push(m);a=a.slice(a.indexOf(e)+e.length);h+=e.length}if(za[k]){if(e?n(d).empty=!1:n(d).unusedTokens.push(k),m=d,null!=e&&g(db,k))db[k](e,m._a,m,k)}else d._strict&&!e&&n(d).unusedTokens.push(k)}n(d).charsLeftOver=f-h;0<a.length&&
n(d).unusedInput.push(a);12>=d._a[T]&&!0===n(d).bigHour&&0<d._a[T]&&(n(d).bigHour=void 0);n(d).parsedDateParts=d._a.slice(0);n(d).meridiem=d._meridiem;a=d._a;b=T;f=d._locale;l=d._a[T];h=d._meridiem;null!=h&&(null!=f.meridiemHour?l=f.meridiemHour(l,h):null!=f.isPM&&((f=f.isPM(h))&&12>l&&(l+=12),f||12!==l||(l=0)));a[b]=l;jb(d);ib(d)}}function wc(d){if(!d._d){var a=U(d._i);d._a=k([a.year,a.month,a.day||a.date,a.hour,a.minute,a.second,a.millisecond],function(d){return d&&parseInt(d,10)});jb(d)}}function Lb(d){var b=
d._i,c=d._f;d._locale=d._locale||sa(d._l);if(null===b||void 0===c&&""===b)return w({nullInput:!0});"string"===typeof b&&(d._i=b=d._locale.preparse(b));if(r(b))return new t(ib(b));if(h(b))d._d=b;else if(a(c))if(0===d._f.length)n(d).invalidFormat=!0,d._d=new Date(NaN);else{for(b=0;b<d._f.length;b++){c=0;var e=q({},d);null!=d._useUTC&&(e._useUTC=d._useUTC);e._f=d._f[b];lb(e);if(p(e)&&(c+=n(e).charsLeftOver,c+=10*n(e).unusedTokens.length,n(e).score=c,null==f||c<f)){var f=c;var g=e}}m(d,g||e)}else c?lb(d):
xc(d);p(d)||(d._d=null);return d}function xc(d){var g=d._i;e(g)?d._d=new Date(c.now()):h(g)?d._d=new Date(g.valueOf()):"string"===typeof g?uc(d):a(g)?(d._a=k(g.slice(0),function(d){return parseInt(d,10)}),jb(d)):b(g)?wc(d):f(g)?d._d=new Date(g):c.createFromInputFallback(d)}function vb(d,c,e,f,g){var x={};if(!0===e||!1===e)f=e,e=void 0;var h;if(h=b(d))a:if(h=d,Object.getOwnPropertyNames)h=0===Object.getOwnPropertyNames(h).length;else{for(var l in h)if(h.hasOwnProperty(l)){h=!1;break a}h=!0}if(h||a(d)&&
0===d.length)d=void 0;x._isAMomentObject=!0;x._useUTC=x._isUTC=g;x._l=e;x._i=d;x._f=c;x._strict=f;d=new t(ib(Lb(x)));d._nextDay&&(d.add(1,"d"),d._nextDay=void 0);return d}function P(d,a,b,c){return vb(d,a,b,c,!1)}function Mb(d,b){var c;1===b.length&&a(b[0])&&(b=b[0]);if(!b.length)return P();var e=b[0];for(c=1;c<b.length;++c)if(!b[c].isValid()||b[c][d](e))e=b[c];return e}function Qa(d){var a=U(d);d=a.year||0;var b=a.quarter||0,c=a.month||0,e=a.week||a.isoWeek||0,f=a.day||0,g=a.hour||0,h=a.minute||
0,l=a.second||0,k=a.millisecond||0;a:{for(var m in a)if(-1===R.call(Ja,m)||null!=a[m]&&isNaN(a[m])){a=!1;break a}m=!1;for(var n=0;n<Ja.length;++n)if(a[Ja[n]]){if(m){a=!1;break a}parseFloat(a[Ja[n]])!==u(a[Ja[n]])&&(m=!0)}a=!0}this._isValid=a;this._milliseconds=+k+1E3*l+6E4*h+36E5*g;this._days=+f+7*e;this._months=+c+3*b+12*d;this._data={};this._locale=sa();this._bubble()}function mb(d){return d instanceof Qa}function nb(d){return 0>d?-1*Math.round(-1*d):Math.round(d)}function Nb(d,a){G(d,0,0,function(){var d=
this.utcOffset(),b="+";0>d&&(d=-d,b="-");return b+L(~~(d/60),2)+a+L(~~d%60,2)})}function ob(d,a){d=(a||"").match(d);if(null===d)return null;d=((d[d.length-1]||[])+"").match(yc)||["-",0,0];a=+(60*d[1])+u(d[2]);return 0===a?0:"+"===d[0]?a:-a}function pb(d,a){return a._isUTC?(a=a.clone(),d=(r(d)||h(d)?d.valueOf():P(d).valueOf())-a.valueOf(),a._d.setTime(a._d.valueOf()+d),c.updateOffset(a,!1),a):P(d).local()}function Ob(){return this.isValid()?this._isUTC&&0===this._offset:!1}function ha(a,b){var d=a;
mb(a)?d={ms:a._milliseconds,d:a._days,M:a._months}:f(a)?(d={},b?d[b]=a:d.milliseconds=a):(b=zc.exec(a))?(d="-"===b[1]?-1:1,d={y:0,d:u(b[ja])*d,h:u(b[T])*d,m:u(b[fa])*d,s:u(b[pa])*d,ms:u(nb(1E3*b[wa]))*d}):(b=Ac.exec(a))?(d="-"===b[1]?-1:1,d={y:xa(b[2],d),M:xa(b[3],d),w:xa(b[4],d),d:xa(b[5],d),h:xa(b[6],d),m:xa(b[7],d),s:xa(b[8],d)}):null==d?d={}:"object"===typeof d&&("from"in d||"to"in d)&&(b=P(d.from),d=P(d.to),b.isValid()&&d.isValid()?(d=pb(d,b),b.isBefore(d)?d=Pb(b,d):(d=Pb(d,b),d.milliseconds=
-d.milliseconds,d.months=-d.months),b=d):b={milliseconds:0,months:0},d={},d.ms=b.milliseconds,d.M=b.months);d=new Qa(d);mb(a)&&g(a,"_locale")&&(d._locale=a._locale);return d}function xa(d,a){d=d&&parseFloat(d.replace(",","."));return(isNaN(d)?0:d)*a}function Pb(d,a){var b={};b.months=a.month()-d.month()+12*(a.year()-d.year());d.clone().add(b.months,"M").isAfter(a)&&--b.months;b.milliseconds=+a-+d.clone().add(b.months,"M");return b}function Qb(d,a){return function(b,c){if(null!==c&&!isNaN(+c)){J(a,
"moment()."+a+"(period, number) is deprecated. Please use moment()."+a+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info.");var e=b;b=c;c=e}b=ha("string"===typeof b?+b:b,c);Rb(this,b,d);return this}}function Rb(d,a,b,e){var f=a._milliseconds,g=nb(a._days);a=nb(a._months);d.isValid()&&(e=null==e?!0:e,a&&zb(d,Y(d,"Month")+a*b),g&&yb(d,"Date",Y(d,"Date")+g*b),f&&d._d.setTime(d._d.valueOf()+f*b),e&&c.updateOffset(d,g||a))}function qb(a,b){var d=12*(b.year()-
a.year())+(b.month()-a.month()),c=a.clone().add(d,"months");0>b-c?(a=a.clone().add(d-1,"months"),b=(b-c)/(c-a)):(a=a.clone().add(d+1,"months"),b=(b-c)/(a-c));return-(d+b)||0}function Sb(a){if(void 0===a)return this._locale._abbr;a=sa(a);null!=a&&(this._locale=a);return this}function Tb(){return this._locale}function Ca(a,b){return(a%b+b)%b}function Ub(a,b,c){return 100>a&&0<=a?new Date(a+400,b,c)-Vb:(new Date(a,b,c)).valueOf()}function Wb(a,b,c){return 100>a&&0<=a?Date.UTC(a+400,b,c)-Vb:Date.UTC(a,
b,c)}function Ra(a,b){G(0,[a,a.length],0,b)}function Xb(a,b,c,e,f){if(null==a)return Ga(this,e,f).year;var d=va(a,e,f);b>d&&(b=d);a=Cb(a,b,c,e,f);a=Fa(a.year,0,a.dayOfYear);this.year(a.getUTCFullYear());this.month(a.getUTCMonth());this.date(a.getUTCDate());return this}function Bc(a,b){b[wa]=u(1E3*("0."+a))}function Yb(a){return a}function Sa(a,b,c,e){var d=sa();b=l().set(e,b);return d[c](b,a)}function Zb(a,b,c){f(a)&&(b=a,a=void 0);a=a||"";if(null!=b)return Sa(a,b,c,"month");var d=[];for(b=0;12>b;b++)d[b]=
Sa(a,b,c,"month");return d}function rb(a,b,c,e){"boolean"!==typeof a&&(c=b=a,a=!1);f(b)&&(c=b,b=void 0);b=b||"";var d=sa();a=a?d._week.dow:0;if(null!=c)return Sa(b,(c+a)%7,e,"day");d=[];for(c=0;7>c;c++)d[c]=Sa(b,(c+a)%7,e,"day");return d}function $b(a,b,c,e){b=ha(b,c);a._milliseconds+=e*b._milliseconds;a._days+=e*b._days;a._months+=e*b._months;return a._bubble()}function ac(a){return 0>a?Math.floor(a):Math.ceil(a)}function qa(a){return function(){return this.as(a)}}function ya(a){return function(){return this.isValid()?
this._data[a]:NaN}}function Cc(a,b,c,e,f){return f.relativeTime(b||1,!!c,a,e)}function Da(a){return(0<a)-(0>a)||+a}function Ta(){if(!this.isValid())return this.localeData().invalidDate();var a=sb(this._milliseconds)/1E3,b=sb(this._days),c=sb(this._months);var e=v(a/60);var f=v(e/60);a%=60;e%=60;var g=v(c/12);c%=12;a=a?a.toFixed(3).replace(/\.?0+$/,""):"";var h=this.asSeconds();if(!h)return"P0D";var l=0>h?"-":"",k=Da(this._months)!==Da(h)?"-":"",m=Da(this._days)!==Da(h)?"-":"";h=Da(this._milliseconds)!==
Da(h)?"-":"";return l+"P"+(g?k+g+"Y":"")+(c?k+c+"M":"")+(b?m+b+"D":"")+(f||e||a?"T":"")+(f?h+f+"H":"")+(e?h+e+"M":"")+(a?h+a+"S":"")}var kc=Array.prototype.some?Array.prototype.some:function(a){for(var d=Object(this),b=d.length>>>0,c=0;c<b;c++)if(c in d&&a.call(this,d[c],c,d))return!0;return!1};var Za=c.momentProperties=[],$a=!1,wb={};c.suppressDeprecationWarnings=!1;c.deprecationHandler=null;var Dc=Object.keys?Object.keys:function(a){var d,b=[];for(d in a)g(a,d)&&b.push(d);return b};var Ea={},V=
{},xb=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,La=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,ab={},za={},bc=/\d/,Z=/\d\d/,cc=/\d{3}/,tb=/\d{4}/,Ua=/[+-]?\d{6}/,Q=/\d\d?/,dc=/\d\d\d\d?/,ec=/\d\d\d\d\d\d?/,Va=/\d{1,3}/,ub=/\d{1,4}/,Wa=/[+-]?\d{1,6}/,Ec=/\d+/,Xa=/[+-]?\d+/,Fc=/Z|[+-]\d\d:?\d\d/gi,Ya=/Z|[+-]\d\d(?::?\d\d)?/gi,Ka=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,
bb={},db={},ea=0,oa=1,ja=2,T=3,fa=4,pa=5,wa=6,nc=7,oc=8;G("Y",0,0,function(){var a=this.year();return 9999>=a?""+a:"+"+a});G(0,["YY",2],0,function(){return this.year()%100});G(0,["YYYY",4],0,"year");G(0,["YYYYY",5],0,"year");G(0,["YYYYYY",6,!0],0,"year");H("year","y");V.year=1;A("Y",Xa);A("YY",Q,Z);A("YYYY",ub,tb);A("YYYYY",Wa,Ua);A("YYYYYY",Wa,Ua);N(["YYYYY","YYYYYY"],ea);N("YYYY",function(a,b){b[ea]=2===a.length?c.parseTwoDigitYear(a):u(a)});N("YY",function(a,b){b[ea]=c.parseTwoDigitYear(a)});N("Y",
function(a,b){b[ea]=parseInt(a,10)});c.parseTwoDigitYear=function(a){return u(a)+(68<u(a)?1900:2E3)};var fc=na("FullYear",!0);var R=Array.prototype.indexOf?Array.prototype.indexOf:function(a){var d;for(d=0;d<this.length;++d)if(this[d]===a)return d;return-1};G("M",["MM",2],"Mo",function(){return this.month()+1});G("MMM",0,0,function(a){return this.localeData().monthsShort(this,a)});G("MMMM",0,0,function(a){return this.localeData().months(this,a)});H("month","M");V.month=8;A("M",Q);A("MM",Q,Z);A("MMM",
function(a,b){return b.monthsShortRegex(a)});A("MMMM",function(a,b){return b.monthsRegex(a)});N(["M","MM"],function(a,b){b[oa]=u(a)-1});N(["MMM","MMMM"],function(a,b,c,e){e=c._locale.monthsParse(a,e,c._strict);null!=e?b[oa]=e:n(c).invalidMonth=a});var gc=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,Jb="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");G("w",["ww",2],"wo","week");G("W",["WW",2],"Wo","isoWeek");H("week","w");H("isoWeek","W");V.week=5;V.isoWeek=5;A("w",Q);A("ww",Q,Z);A("W",Q);A("WW",Q,
Z);ma(["w","ww","W","WW"],function(a,b,c,e){b[e.substr(0,1)]=u(a)});G("d",0,"do","day");G("dd",0,0,function(a){return this.localeData().weekdaysMin(this,a)});G("ddd",0,0,function(a){return this.localeData().weekdaysShort(this,a)});G("dddd",0,0,function(a){return this.localeData().weekdays(this,a)});G("e",0,0,"weekday");G("E",0,0,"isoWeekday");H("day","d");H("weekday","e");H("isoWeekday","E");V.day=11;V.weekday=11;V.isoWeekday=11;A("d",Q);A("e",Q);A("E",Q);A("dd",function(a,b){return b.weekdaysMinRegex(a)});
A("ddd",function(a,b){return b.weekdaysShortRegex(a)});A("dddd",function(a,b){return b.weekdaysRegex(a)});ma(["dd","ddd","dddd"],function(a,b,c,e){e=c._locale.weekdaysParse(a,e,c._strict);null!=e?b.d=e:n(c).invalidWeekday=a});ma(["d","e","E"],function(a,b,c,e){b[e]=u(a)});var Kb="Sun Mon Tue Wed Thu Fri Sat".split(" ");G("H",["HH",2],0,"hour");G("h",["hh",2],0,gb);G("k",["kk",2],0,function(){return this.hours()||24});G("hmm",0,0,function(){return""+gb.apply(this)+L(this.minutes(),2)});G("hmmss",0,
0,function(){return""+gb.apply(this)+L(this.minutes(),2)+L(this.seconds(),2)});G("Hmm",0,0,function(){return""+this.hours()+L(this.minutes(),2)});G("Hmmss",0,0,function(){return""+this.hours()+L(this.minutes(),2)+L(this.seconds(),2)});Db("a",!0);Db("A",!1);H("hour","h");V.hour=13;A("a",Eb);A("A",Eb);A("H",Q);A("h",Q);A("k",Q);A("HH",Q,Z);A("hh",Q,Z);A("kk",Q,Z);A("hmm",dc);A("hmmss",ec);A("Hmm",dc);A("Hmmss",ec);N(["H","HH"],T);N(["k","kk"],function(a,b,c){a=u(a);b[T]=24===a?0:a});N(["a","A"],function(a,
b,c){c._isPm=c._locale.isPM(a);c._meridiem=a});N(["h","hh"],function(a,b,c){b[T]=u(a);n(c).bigHour=!0});N("hmm",function(a,b,c){var d=a.length-2;b[T]=u(a.substr(0,d));b[fa]=u(a.substr(d));n(c).bigHour=!0});N("hmmss",function(a,b,c){var d=a.length-4,e=a.length-2;b[T]=u(a.substr(0,d));b[fa]=u(a.substr(d,2));b[pa]=u(a.substr(e));n(c).bigHour=!0});N("Hmm",function(a,b,c){c=a.length-2;b[T]=u(a.substr(0,c));b[fa]=u(a.substr(c))});N("Hmmss",function(a,b,c){c=a.length-4;var d=a.length-2;b[T]=u(a.substr(0,
c));b[fa]=u(a.substr(c,2));b[pa]=u(a.substr(d))});var Gc=na("Hours",!0),Gb={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",
ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:"January February March April May June July August September October November December".split(" "),monthsShort:Jb,week:{dow:0,doy:6},weekdays:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),weekdaysMin:"Su Mo Tu We Th Fr Sa".split(" "),weekdaysShort:Kb,meridiemParse:/[ap]\.?m?\.?/i},S={},Ia={},Ha,pc=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,
qc=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,rc=/Z|[+-]\d\d(?::?\d\d)?/,Pa=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],kb=
[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],vc=/^\/?Date\((\-?\d+)/i,sc=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,tc={UT:0,GMT:0,EDT:-240,
EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};c.createFromInputFallback=B("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged and will be removed in an upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(a){a._d=new Date(a._i+(a._useUTC?" UTC":""))});c.ISO_8601=function(){};
c.RFC_2822=function(){};var Hc=B("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var a=P.apply(null,arguments);return this.isValid()&&a.isValid()?a<this?this:a:w()}),Ic=B("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var a=P.apply(null,arguments);return this.isValid()&&a.isValid()?a>this?this:a:w()}),Ja="year quarter month week day hour minute second millisecond".split(" ");
Nb("Z",":");Nb("ZZ","");A("Z",Ya);A("ZZ",Ya);N(["Z","ZZ"],function(a,b,c){c._useUTC=!0;c._tzm=ob(Ya,a)});var yc=/([\+\-]|\d\d)/gi;c.updateOffset=function(){};var zc=/^(\-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,Ac=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;ha.fn=Qa.prototype;ha.invalid=function(){return ha(NaN)};var Jc=Qb(1,"add"),Kc=Qb(-1,"subtract");c.defaultFormat=
"YYYY-MM-DDTHH:mm:ssZ";c.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var hc=B("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(a){return void 0===a?this.localeData():this.locale(a)}),Vb=126227808E5;G(0,["gg",2],0,function(){return this.weekYear()%100});G(0,["GG",2],0,function(){return this.isoWeekYear()%100});Ra("gggg","weekYear");Ra("ggggg","weekYear");Ra("GGGG","isoWeekYear");Ra("GGGGG","isoWeekYear");
H("weekYear","gg");H("isoWeekYear","GG");V.weekYear=1;V.isoWeekYear=1;A("G",Xa);A("g",Xa);A("GG",Q,Z);A("gg",Q,Z);A("GGGG",ub,tb);A("gggg",ub,tb);A("GGGGG",Wa,Ua);A("ggggg",Wa,Ua);ma(["gggg","ggggg","GGGG","GGGGG"],function(a,b,c,e){b[e.substr(0,2)]=u(a)});ma(["gg","GG"],function(a,b,e,f){b[f]=c.parseTwoDigitYear(a)});G("Q",0,"Qo","quarter");H("quarter","Q");V.quarter=7;A("Q",bc);N("Q",function(a,b){b[oa]=3*(u(a)-1)});G("D",["DD",2],"Do","date");H("date","D");V.date=9;A("D",Q);A("DD",Q,Z);A("Do",
function(a,b){return a?b._dayOfMonthOrdinalParse||b._ordinalParse:b._dayOfMonthOrdinalParseLenient});N(["D","DD"],ja);N("Do",function(a,b){b[ja]=u(a.match(Q)[0])});var ic=na("Date",!0);G("DDD",["DDDD",3],"DDDo","dayOfYear");H("dayOfYear","DDD");V.dayOfYear=4;A("DDD",Va);A("DDDD",cc);N(["DDD","DDDD"],function(a,b,c){c._dayOfYear=u(a)});G("m",["mm",2],0,"minute");H("minute","m");V.minute=14;A("m",Q);A("mm",Q,Z);N(["m","mm"],fa);var Lc=na("Minutes",!1);G("s",["ss",2],0,"second");H("second","s");V.second=
15;A("s",Q);A("ss",Q,Z);N(["s","ss"],pa);var Mc=na("Seconds",!1);G("S",0,0,function(){return~~(this.millisecond()/100)});G(0,["SS",2],0,function(){return~~(this.millisecond()/10)});G(0,["SSS",3],0,"millisecond");G(0,["SSSS",4],0,function(){return 10*this.millisecond()});G(0,["SSSSS",5],0,function(){return 100*this.millisecond()});G(0,["SSSSSS",6],0,function(){return 1E3*this.millisecond()});G(0,["SSSSSSS",7],0,function(){return 1E4*this.millisecond()});G(0,["SSSSSSSS",8],0,function(){return 1E5*this.millisecond()});
G(0,["SSSSSSSSS",9],0,function(){return 1E6*this.millisecond()});H("millisecond","ms");V.millisecond=16;A("S",Va,bc);A("SS",Va,Z);A("SSS",Va,cc);var ta;for(ta="SSSS";9>=ta.length;ta+="S")A(ta,Ec);for(ta="S";9>=ta.length;ta+="S")N(ta,Bc);var Nc=na("Milliseconds",!1);G("z",0,0,"zoneAbbr");G("zz",0,0,"zoneName");var y=t.prototype;y.add=Jc;y.calendar=function(a,b){a=a||P();var d=pb(a,this).startOf("day");d=c.calendarFormat(this,d)||"sameElse";b=b&&(D(b[d])?b[d].call(this,a):b[d]);return this.format(b||
this.localeData().calendar(d,this,P(a)))};y.clone=function(){return new t(this)};y.diff=function(a,b,c){if(!this.isValid())return NaN;a=pb(a,this);if(!a.isValid())return NaN;var d=6E4*(a.utcOffset()-this.utcOffset());b=C(b);switch(b){case "year":b=qb(this,a)/12;break;case "month":b=qb(this,a);break;case "quarter":b=qb(this,a)/3;break;case "second":b=(this-a)/1E3;break;case "minute":b=(this-a)/6E4;break;case "hour":b=(this-a)/36E5;break;case "day":b=(this-a-d)/864E5;break;case "week":b=(this-a-d)/
6048E5;break;default:b=this-a}return c?b:v(b)};y.endOf=function(a){a=C(a);if(void 0===a||"millisecond"===a||!this.isValid())return this;var b=this._isUTC?Wb:Ub;switch(a){case "year":var d=b(this.year()+1,0,1)-1;break;case "quarter":d=b(this.year(),this.month()-this.month()%3+3,1)-1;break;case "month":d=b(this.year(),this.month()+1,1)-1;break;case "week":d=b(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case "isoWeek":d=b(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+
7)-1;break;case "day":case "date":d=b(this.year(),this.month(),this.date()+1)-1;break;case "hour":d=this._d.valueOf();d+=36E5-Ca(d+(this._isUTC?0:6E4*this.utcOffset()),36E5)-1;break;case "minute":d=this._d.valueOf();d+=6E4-Ca(d,6E4)-1;break;case "second":d=this._d.valueOf(),d+=1E3-Ca(d,1E3)-1}this._d.setTime(d);c.updateOffset(this,!0);return this};y.format=function(a){a||(a=this.isUtc()?c.defaultFormatUtc:c.defaultFormat);a=W(this,a);return this.localeData().postformat(a)};y.from=function(a,b){return this.isValid()&&
(r(a)&&a.isValid()||P(a).isValid())?ha({to:this,from:a}).locale(this.locale()).humanize(!b):this.localeData().invalidDate()};y.fromNow=function(a){return this.from(P(),a)};y.to=function(a,b){return this.isValid()&&(r(a)&&a.isValid()||P(a).isValid())?ha({from:this,to:a}).locale(this.locale()).humanize(!b):this.localeData().invalidDate()};y.toNow=function(a){return this.to(P(),a)};y.get=function(a){a=C(a);return D(this[a])?this[a]():this};y.invalidAt=function(){return n(this).overflow};y.isAfter=function(a,
b){a=r(a)?a:P(a);if(!this.isValid()||!a.isValid())return!1;b=C(b)||"millisecond";return"millisecond"===b?this.valueOf()>a.valueOf():a.valueOf()<this.clone().startOf(b).valueOf()};y.isBefore=function(a,b){a=r(a)?a:P(a);if(!this.isValid()||!a.isValid())return!1;b=C(b)||"millisecond";return"millisecond"===b?this.valueOf()<a.valueOf():this.clone().endOf(b).valueOf()<a.valueOf()};y.isBetween=function(a,b,c,e){a=r(a)?a:P(a);b=r(b)?b:P(b);if(!(this.isValid()&&a.isValid()&&b.isValid()))return!1;e=e||"()";
return("("===e[0]?this.isAfter(a,c):!this.isBefore(a,c))&&(")"===e[1]?this.isBefore(b,c):!this.isAfter(b,c))};y.isSame=function(a,b){a=r(a)?a:P(a);if(!this.isValid()||!a.isValid())return!1;b=C(b)||"millisecond";if("millisecond"===b)return this.valueOf()===a.valueOf();a=a.valueOf();return this.clone().startOf(b).valueOf()<=a&&a<=this.clone().endOf(b).valueOf()};y.isSameOrAfter=function(a,b){return this.isSame(a,b)||this.isAfter(a,b)};y.isSameOrBefore=function(a,b){return this.isSame(a,b)||this.isBefore(a,
b)};y.isValid=function(){return p(this)};y.lang=hc;y.locale=Sb;y.localeData=Tb;y.max=Ic;y.min=Hc;y.parsingFlags=function(){return m({},n(this))};y.set=function(a,b){if("object"===typeof a){a=U(a);b=ia(a);for(var d=0;d<b.length;d++)this[b[d].unit](a[b[d].unit])}else if(a=C(a),D(this[a]))return this[a](b);return this};y.startOf=function(a){a=C(a);if(void 0===a||"millisecond"===a||!this.isValid())return this;var b=this._isUTC?Wb:Ub;switch(a){case "year":var d=b(this.year(),0,1);break;case "quarter":d=
b(this.year(),this.month()-this.month()%3,1);break;case "month":d=b(this.year(),this.month(),1);break;case "week":d=b(this.year(),this.month(),this.date()-this.weekday());break;case "isoWeek":d=b(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case "day":case "date":d=b(this.year(),this.month(),this.date());break;case "hour":d=this._d.valueOf();d-=Ca(d+(this._isUTC?0:6E4*this.utcOffset()),36E5);break;case "minute":d=this._d.valueOf();d-=Ca(d,6E4);break;case "second":d=this._d.valueOf(),
d-=Ca(d,1E3)}this._d.setTime(d);c.updateOffset(this,!0);return this};y.subtract=Kc;y.toArray=function(){return[this.year(),this.month(),this.date(),this.hour(),this.minute(),this.second(),this.millisecond()]};y.toObject=function(){return{years:this.year(),months:this.month(),date:this.date(),hours:this.hours(),minutes:this.minutes(),seconds:this.seconds(),milliseconds:this.milliseconds()}};y.toDate=function(){return new Date(this.valueOf())};y.toISOString=function(a){if(!this.isValid())return null;
var b=(a=!0!==a)?this.clone().utc():this;return 0>b.year()||9999<b.year()?W(b,a?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):D(Date.prototype.toISOString)?a?this.toDate().toISOString():(new Date(this.valueOf()+6E4*this.utcOffset())).toISOString().replace("Z",W(b,"Z")):W(b,a?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")};y.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var a="moment",b="";this.isLocal()||(a=0===this.utcOffset()?"moment.utc":
"moment.parseZone",b="Z");a="["+a+'("]';var c=0<=this.year()&&9999>=this.year()?"YYYY":"YYYYYY";return this.format(a+c+"-MM-DD[T]HH:mm:ss.SSS"+(b+'[")]'))};y.toJSON=function(){return this.isValid()?this.toISOString():null};y.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")};y.unix=function(){return Math.floor(this.valueOf()/1E3)};y.valueOf=function(){return this._d.valueOf()-6E4*(this._offset||0)};y.creationData=function(){return{input:this._i,format:this._f,
locale:this._locale,isUTC:this._isUTC,strict:this._strict}};y.year=fc;y.isLeapYear=function(){return da(this.year())};y.weekYear=function(a){return Xb.call(this,a,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)};y.isoWeekYear=function(a){return Xb.call(this,a,this.isoWeek(),this.isoWeekday(),1,4)};y.quarter=y.quarters=function(a){return null==a?Math.ceil((this.month()+1)/3):this.month(3*(a-1)+this.month()%3)};y.month=Ab;y.daysInMonth=function(){return Ma(this.year(),
this.month())};y.week=y.weeks=function(a){var b=this.localeData().week(this);return null==a?b:this.add(7*(a-b),"d")};y.isoWeek=y.isoWeeks=function(a){var b=Ga(this,1,4).week;return null==a?b:this.add(7*(a-b),"d")};y.weeksInYear=function(){var a=this.localeData()._week;return va(this.year(),a.dow,a.doy)};y.isoWeeksInYear=function(){return va(this.year(),1,4)};y.date=ic;y.day=y.days=function(a){if(!this.isValid())return null!=a?this:NaN;var b=this._isUTC?this._d.getUTCDay():this._d.getDay();if(null!=
a){var d=this.localeData();"string"===typeof a&&(isNaN(a)?(a=d.weekdaysParse(a),a="number"===typeof a?a:null):a=parseInt(a,10));return this.add(a-b,"d")}return b};y.weekday=function(a){if(!this.isValid())return null!=a?this:NaN;var b=(this.day()+7-this.localeData()._week.dow)%7;return null==a?b:this.add(a-b,"d")};y.isoWeekday=function(a){if(!this.isValid())return null!=a?this:NaN;if(null!=a){var b=this.localeData();a="string"===typeof a?b.weekdaysParse(a)%7||7:isNaN(a)?null:a;return this.day(this.day()%
7?a:a-7)}return this.day()||7};y.dayOfYear=function(a){var b=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864E5)+1;return null==a?b:this.add(a-b,"d")};y.hour=y.hours=Gc;y.minute=y.minutes=Lc;y.second=y.seconds=Mc;y.millisecond=y.milliseconds=Nc;y.utcOffset=function(a,b,e){var d=this._offset||0,f;if(!this.isValid())return null!=a?this:NaN;if(null!=a){if("string"===typeof a){if(a=ob(Ya,a),null===a)return this}else 16>Math.abs(a)&&!e&&(a*=60);!this._isUTC&&b&&(f=15*-Math.round(this._d.getTimezoneOffset()/
15));this._offset=a;this._isUTC=!0;null!=f&&this.add(f,"m");d!==a&&(!b||this._changeInProgress?Rb(this,ha(a-d,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,c.updateOffset(this,!0),this._changeInProgress=null));return this}return this._isUTC?d:15*-Math.round(this._d.getTimezoneOffset()/15)};y.utc=function(a){return this.utcOffset(0,a)};y.local=function(a){this._isUTC&&(this.utcOffset(0,a),this._isUTC=!1,a&&this.subtract(15*-Math.round(this._d.getTimezoneOffset()/15),"m"));return this};
y.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"===typeof this._i){var a=ob(Fc,this._i);null!=a?this.utcOffset(a):this.utcOffset(0,!0)}return this};y.hasAlignedHourOffset=function(a){if(!this.isValid())return!1;a=a?P(a).utcOffset():0;return 0===(this.utcOffset()-a)%60};y.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()};y.isLocal=function(){return this.isValid()?!this._isUTC:!1};
y.isUtcOffset=function(){return this.isValid()?this._isUTC:!1};y.isUtc=Ob;y.isUTC=Ob;y.zoneAbbr=function(){return this._isUTC?"UTC":""};y.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""};y.dates=B("dates accessor is deprecated. Use date instead.",ic);y.months=B("months accessor is deprecated. Use month instead",Ab);y.years=B("years accessor is deprecated. Use year instead",fc);y.zone=B("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",
function(a,b){return null!=a?("string"!==typeof a&&(a=-a),this.utcOffset(a,b),this):-this.utcOffset()});y.isDSTShifted=B("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",function(){if(!e(this._isDSTShifted))return this._isDSTShifted;var a={};q(a,this);a=Lb(a);if(a._a){var b=a._isUTC?l(a._a):P(a._a);this._isDSTShifted=this.isValid()&&0<z(a._a,b.toArray())}else this._isDSTShifted=!1;return this._isDSTShifted});var O=F.prototype;O.calendar=function(a,
b,c){a=this._calendar[a]||this._calendar.sameElse;return D(a)?a.call(b,c):a};O.longDateFormat=function(a){var b=this._longDateFormat[a],d=this._longDateFormat[a.toUpperCase()];if(b||!d)return b;this._longDateFormat[a]=d.replace(/MMMM|MM|DD|dddd/g,function(a){return a.slice(1)});return this._longDateFormat[a]};O.invalidDate=function(){return this._invalidDate};O.ordinal=function(a){return this._ordinal.replace("%d",a)};O.preparse=Yb;O.postformat=Yb;O.relativeTime=function(a,b,c,e){var d=this._relativeTime[c];
return D(d)?d(a,b,c,e):d.replace(/%d/i,a)};O.pastFuture=function(a,b){a=this._relativeTime[0<a?"future":"past"];return D(a)?a(b):a.replace(/%s/i,b)};O.set=function(a){var b;for(b in a){var d=a[b];D(d)?this[b]=d:this["_"+b]=d}this._config=a;this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)};O.months=function(b,c){return b?a(this._months)?this._months[b.month()]:this._months[(this._months.isFormat||gc).test(c)?"format":
"standalone"][b.month()]:a(this._months)?this._months:this._months.standalone};O.monthsShort=function(b,c){return b?a(this._monthsShort)?this._monthsShort[b.month()]:this._monthsShort[gc.test(c)?"format":"standalone"][b.month()]:a(this._monthsShort)?this._monthsShort:this._monthsShort.standalone};O.monthsParse=function(a,b,c){var d;if(this._monthsParseExact){a:{a=a.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],d=0;12>d;++d){var e=
l([2E3,d]);this._shortMonthsParse[d]=this.monthsShort(e,"").toLocaleLowerCase();this._longMonthsParse[d]=this.months(e,"").toLocaleLowerCase()}if(c)b="MMM"===b?R.call(this._shortMonthsParse,a):R.call(this._longMonthsParse,a);else if("MMM"===b){b=R.call(this._shortMonthsParse,a);if(-1!==b)break a;b=R.call(this._longMonthsParse,a)}else{b=R.call(this._longMonthsParse,a);if(-1!==b)break a;b=R.call(this._shortMonthsParse,a)}b=-1!==b?b:null}return b}this._monthsParse||(this._monthsParse=[],this._longMonthsParse=
[],this._shortMonthsParse=[]);for(d=0;12>d;d++)if(e=l([2E3,d]),c&&!this._longMonthsParse[d]&&(this._longMonthsParse[d]=new RegExp("^"+this.months(e,"").replace(".","")+"$","i"),this._shortMonthsParse[d]=new RegExp("^"+this.monthsShort(e,"").replace(".","")+"$","i")),c||this._monthsParse[d]||(e="^"+this.months(e,"")+"|^"+this.monthsShort(e,""),this._monthsParse[d]=new RegExp(e.replace(".",""),"i")),c&&"MMMM"===b&&this._longMonthsParse[d].test(a)||c&&"MMM"===b&&this._shortMonthsParse[d].test(a)||!c&&
this._monthsParse[d].test(a))return d};O.monthsRegex=function(a){if(this._monthsParseExact)return g(this,"_monthsRegex")||Bb.call(this),a?this._monthsStrictRegex:this._monthsRegex;g(this,"_monthsRegex")||(this._monthsRegex=Ka);return this._monthsStrictRegex&&a?this._monthsStrictRegex:this._monthsRegex};O.monthsShortRegex=function(a){if(this._monthsParseExact)return g(this,"_monthsRegex")||Bb.call(this),a?this._monthsShortStrictRegex:this._monthsShortRegex;g(this,"_monthsShortRegex")||(this._monthsShortRegex=
Ka);return this._monthsShortStrictRegex&&a?this._monthsShortStrictRegex:this._monthsShortRegex};O.week=function(a){return Ga(a,this._week.dow,this._week.doy).week};O.firstDayOfYear=function(){return this._week.doy};O.firstDayOfWeek=function(){return this._week.dow};O.weekdays=function(b,c){c=a(this._weekdays)?this._weekdays:this._weekdays[b&&!0!==b&&this._weekdays.isFormat.test(c)?"format":"standalone"];return!0===b?eb(c,this._week.dow):b?c[b.day()]:c};O.weekdaysMin=function(a){return!0===a?eb(this._weekdaysMin,
this._week.dow):a?this._weekdaysMin[a.day()]:this._weekdaysMin};O.weekdaysShort=function(a){return!0===a?eb(this._weekdaysShort,this._week.dow):a?this._weekdaysShort[a.day()]:this._weekdaysShort};O.weekdaysParse=function(a,b,c){var d;if(this._weekdaysParseExact)return mc.call(this,a,b,c);this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]);for(d=0;7>d;d++){var e=l([2E3,1]).day(d);c&&!this._fullWeekdaysParse[d]&&(this._fullWeekdaysParse[d]=
new RegExp("^"+this.weekdays(e,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[d]=new RegExp("^"+this.weekdaysShort(e,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[d]=new RegExp("^"+this.weekdaysMin(e,"").replace(".","\\.?")+"$","i"));this._weekdaysParse[d]||(e="^"+this.weekdays(e,"")+"|^"+this.weekdaysShort(e,"")+"|^"+this.weekdaysMin(e,""),this._weekdaysParse[d]=new RegExp(e.replace(".",""),"i"));if(c&&"dddd"===b&&this._fullWeekdaysParse[d].test(a)||c&&"ddd"===b&&this._shortWeekdaysParse[d].test(a)||
c&&"dd"===b&&this._minWeekdaysParse[d].test(a)||!c&&this._weekdaysParse[d].test(a))return d}};O.weekdaysRegex=function(a){if(this._weekdaysParseExact)return g(this,"_weekdaysRegex")||fb.call(this),a?this._weekdaysStrictRegex:this._weekdaysRegex;g(this,"_weekdaysRegex")||(this._weekdaysRegex=Ka);return this._weekdaysStrictRegex&&a?this._weekdaysStrictRegex:this._weekdaysRegex};O.weekdaysShortRegex=function(a){if(this._weekdaysParseExact)return g(this,"_weekdaysRegex")||fb.call(this),a?this._weekdaysShortStrictRegex:
this._weekdaysShortRegex;g(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=Ka);return this._weekdaysShortStrictRegex&&a?this._weekdaysShortStrictRegex:this._weekdaysShortRegex};O.weekdaysMinRegex=function(a){if(this._weekdaysParseExact)return g(this,"_weekdaysRegex")||fb.call(this),a?this._weekdaysMinStrictRegex:this._weekdaysMinRegex;g(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Ka);return this._weekdaysMinStrictRegex&&a?this._weekdaysMinStrictRegex:this._weekdaysMinRegex};O.isPM=function(a){return"p"===
(a+"").toLowerCase().charAt(0)};O.meridiem=function(a,b,c){return 11<a?c?"pm":"PM":c?"am":"AM"};Aa("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(a){var b=a%10;b=1===u(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+b}});c.lang=B("moment.lang is deprecated. Use moment.locale instead.",Aa);c.langData=B("moment.langData is deprecated. Use moment.localeData instead.",sa);var ra=Math.abs,Oc=qa("ms"),Pc=qa("s"),Qc=qa("m"),Rc=qa("h"),Sc=qa("d"),Tc=qa("w"),Uc=qa("M"),
Vc=qa("Q"),Wc=qa("y"),Xc=ya("milliseconds"),Yc=ya("seconds"),Zc=ya("minutes"),$c=ya("hours"),ad=ya("days"),bd=ya("months"),cd=ya("years"),ua=Math.round,ka={ss:44,s:45,m:45,h:22,d:26,M:11},sb=Math.abs,M=Qa.prototype;M.isValid=function(){return this._isValid};M.abs=function(){var a=this._data;this._milliseconds=ra(this._milliseconds);this._days=ra(this._days);this._months=ra(this._months);a.milliseconds=ra(a.milliseconds);a.seconds=ra(a.seconds);a.minutes=ra(a.minutes);a.hours=ra(a.hours);a.months=
ra(a.months);a.years=ra(a.years);return this};M.add=function(a,b){return $b(this,a,b,1)};M.subtract=function(a,b){return $b(this,a,b,-1)};M.as=function(a){if(!this.isValid())return NaN;var b=this._milliseconds;a=C(a);if("month"===a||"quarter"===a||"year"===a){var c=this._days+b/864E5;c=this._months+4800*c/146097;switch(a){case "month":return c;case "quarter":return c/3;case "year":return c/12}}else switch(c=this._days+Math.round(146097*this._months/4800),a){case "week":return c/7+b/6048E5;case "day":return c+
b/864E5;case "hour":return 24*c+b/36E5;case "minute":return 1440*c+b/6E4;case "second":return 86400*c+b/1E3;case "millisecond":return Math.floor(864E5*c)+b;default:throw Error("Unknown unit "+a);}};M.asMilliseconds=Oc;M.asSeconds=Pc;M.asMinutes=Qc;M.asHours=Rc;M.asDays=Sc;M.asWeeks=Tc;M.asMonths=Uc;M.asQuarters=Vc;M.asYears=Wc;M.valueOf=function(){return this.isValid()?this._milliseconds+864E5*this._days+this._months%12*2592E6+31536E6*u(this._months/12):NaN};M._bubble=function(){var a=this._milliseconds,
b=this._days,c=this._months,e=this._data;0<=a&&0<=b&&0<=c||0>=a&&0>=b&&0>=c||(a+=864E5*ac(146097*c/4800+b),c=b=0);e.milliseconds=a%1E3;a=v(a/1E3);e.seconds=a%60;a=v(a/60);e.minutes=a%60;a=v(a/60);e.hours=a%24;b+=v(a/24);a=v(4800*b/146097);c+=a;b-=ac(146097*a/4800);a=v(c/12);e.days=b;e.months=c%12;e.years=a;return this};M.clone=function(){return ha(this)};M.get=function(a){a=C(a);return this.isValid()?this[a+"s"]():NaN};M.milliseconds=Xc;M.seconds=Yc;M.minutes=Zc;M.hours=$c;M.days=ad;M.weeks=function(){return v(this.days()/
7)};M.months=bd;M.years=cd;M.humanize=function(a){if(!this.isValid())return this.localeData().invalidDate();var b=this.localeData();var c=!a;var d=ha(this).abs(),e=ua(d.as("s")),f=ua(d.as("m")),g=ua(d.as("h")),h=ua(d.as("d")),l=ua(d.as("M"));d=ua(d.as("y"));e=e<=ka.ss&&["s",e]||e<ka.s&&["ss",e]||1>=f&&["m"]||f<ka.m&&["mm",f]||1>=g&&["h"]||g<ka.h&&["hh",g]||1>=h&&["d"]||h<ka.d&&["dd",h]||1>=l&&["M"]||l<ka.M&&["MM",l]||1>=d&&["y"]||["yy",d];e[2]=c;e[3]=0<+this;e[4]=b;c=Cc.apply(null,e);a&&(c=b.pastFuture(+this,
c));return b.postformat(c)};M.toISOString=Ta;M.toString=Ta;M.toJSON=Ta;M.locale=Sb;M.localeData=Tb;M.toIsoString=B("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Ta);M.lang=hc;G("X",0,0,"unix");G("x",0,0,"valueOf");A("x",Xa);A("X",/[+-]?\d+(\.\d{1,3})?/);N("X",function(a,b,c){c._d=new Date(1E3*parseFloat(a,10))});N("x",function(a,b,c){c._d=new Date(u(a))});c.version="2.24.0";var jc=P;c.fn=y;c.min=function(){var a=[].slice.call(arguments,0);return Mb("isBefore",
a)};c.max=function(){var a=[].slice.call(arguments,0);return Mb("isAfter",a)};c.now=function(){return Date.now?Date.now():+new Date};c.utc=l;c.unix=function(a){return P(1E3*a)};c.months=function(a,b){return Zb(a,b,"months")};c.isDate=h;c.locale=Aa;c.invalid=w;c.duration=ha;c.isMoment=r;c.weekdays=function(a,b,c){return rb(a,b,c,"weekdays")};c.parseZone=function(){return P.apply(null,arguments).parseZone()};c.localeData=sa;c.isDuration=mb;c.monthsShort=function(a,b){return Zb(a,b,"monthsShort")};c.weekdaysMin=
function(a,b,c){return rb(a,b,c,"weekdaysMin")};c.defineLocale=hb;c.updateLocale=function(a,b){if(null!=b){var c=Gb;var d=Oa(a);null!=d&&(c=d._config);b=I(c,b);b=new F(b);b.parentLocale=S[a];S[a]=b;Aa(a)}else null!=S[a]&&(null!=S[a].parentLocale?S[a]=S[a].parentLocale:null!=S[a]&&delete S[a]);return S[a]};c.locales=function(){return Dc(S)};c.weekdaysShort=function(a,b,c){return rb(a,b,c,"weekdaysShort")};c.normalizeUnits=C;c.relativeTimeRounding=function(a){return void 0===a?ua:"function"===typeof a?
(ua=a,!0):!1};c.relativeTimeThreshold=function(a,b){if(void 0===ka[a])return!1;if(void 0===b)return ka[a];ka[a]=b;"s"===a&&(ka.ss=b-1);return!0};c.calendarFormat=function(a,b){a=a.diff(b,"days",!0);return-6>a?"sameElse":-1>a?"lastWeek":0>a?"lastDay":1>a?"sameDay":2>a?"nextDay":7>a?"nextWeek":"sameElse"};c.prototype=y;c.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",
TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"};return c});
function EventEnabledBuilder(c){c.addEventListener=function(a,b){void 0==this._listeners&&(this._listeners={});var c=this._listeners;void 0==c[a]&&(c[a]=[]);-1==c[a].indexOf(b)&&c[a].push(b)};c.hasEventListener=function(a,b){if(void 0==this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)?!0:!1};c.removeEventListener=function(a,b){void 0!=this._listeners&&(a=this._listeners[a],void 0!==a&&(b=a.indexOf(b),-1!==b&&a.splice(b,1)))};c.dispatchEvent=function(a){if(void 0!=
this._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;var c=[],f,h=b.length;for(f=0;f<h;f++)c[f]=b[f];for(f=0;f<h;f++)c[f].call(this,a)}}}}
var EfficientMovingCycle=function(){function c(){}function a(){m&&(l.removeEventListener("touchend",m),m=void 0)}function b(){g&&(l.removeEventListener("touchmove",g),g=void 0)}function e(){k&&(l.removeEventListener("mouseup",k),k=void 0)}function f(){h&&(l.removeEventListener("mousemove",h),h=void 0)}var h,k,g,m,l=document.documentElement;return function(n){var p=this,w=n.element,q=n.stopPropagation;this.onEnd=this.onMove=this.onStart=c;if(window.isMobile){var t=function(c){c||(c=window.event);p.onEnd(c)||
(a(),b())},r=function(a){a||(a=window.event);p.onMove(a);a.preventDefault&&a.preventDefault()};w.addEventListener("touchstart",function(c){c||(c=window.event);0!=p.onStart(c)&&(b(),a(),l.addEventListener("touchmove",r),g=r,l.addEventListener("touchend",t),m=t)})}else{var v=function(a){q&&(a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault())},u=function(a){a||(a=window.event);p.onEnd(a);e();f();v(a)},z=function(a){a||(a=window.event);p.onMove(a);v(a)};w.addEventListener("mousedown",
function(a){a||(a=window.event);0!=p.onStart(a)&&(f(),e(),l.addEventListener("mousemove",z),h=z,l.addEventListener("mouseup",u),k=u,v(a))})}}}(),DragManager=function(){return function(c){var a,b,e=this,f=c.handle;c=c.stopPropagation;c=new EfficientMovingCycle({element:f.getElement(),stopPropagation:c});var h;c.onStart=function(c){e.onStart&&e.onStart(c);c=f.getAbsolutePosition(c);a=f.getX()-c.left;b=f.getY()-c.top;h=f.getConstraints()};c.onMove=function(c){c={x:c.pageX+a,y:c.pageY+b};c.x>h.maxX?c.x=
h.maxX:c.x<h.minX&&(c.x=h.minX);c.y>h.maxY?c.y=h.maxY:c.y<h.minY&&(c.y=h.minY);f.setPosition(c)};c.onEnd=function(){f.endDrag&&f.endDrag()}}}();function Iterator(c){var a=0,b=c.length;this.next=function(){var b=c[a];a++;return b};this.hasNext=function(){return a<b};this.remove=function(){c.splice(a-1,1);a--;b--}}
function ReverseIterator(c){var a=c.length,b=a-1;this.next=function(){var a=c[b];b--;return a};this.previous=function(){b++;return c[b+1]};this.hasNext=function(){return 0<=b};this.hasPrevious=function(){return b+2<a};this.remove=function(){c.splice(b+1,1);a--};this.insert=function(e){c.splice(b+1,0,e);a++};this.insertAfter=function(e){c.splice(b+2,0,e);a++};this.append=function(b){c.push(b);a++}}
function Once(c){function a(){setTimeout(function(){b=!1;c()},0);b=!0}var b=!1;this.trigger=function(){b||a()}}
var Timer=function(){return function(c){function a(){0<=k&&(g++,g>=k&&e.stop());try{h()}catch(n){console.log(n)}}function b(){l=!1;m&&(clearInterval(m),m=null)}var e=this,f=c.delay,h=c.callback,k=c.nTicks,g=0,m,l=!1;void 0==k&&(k=-1);void 0==f&&(f=1E3);this.stop=b;this.reset=function(){g=0;b()};this.start=function(){l||(l=!0,m=setInterval(a,f))};this.setDelay=function(b){e.reset();f=b;l=!0;m=setInterval(a,f)};this.isRunning=function(){return l}}}(),TemporalCallback=function(){return function(c){function a(){h.stop();
k.stop();g=0;b()}var b=c.callback,e=c.maxNTriggers,f=c.maxTotalDelay;c=c.delay;e||f||(f=3*c);var h=new Timer({callback:a,delay:c,nTicks:1}),k=new Timer({callback:a,delay:f,nTicks:1}),g=0;this.trigger=function(){g++;h.isRunning()?e&&g>e?a():h.reset():(h.start(),k.start())}}}();function Task(c,a){this.run=function(b){setTimeout(function(){try{c()}catch(e){console.error(e)}if(a)try{a()}catch(e){console.error(e)}if(b)try{b()}catch(e){console.error(e)}},0)}}
function getAbsolute(c){c=c.getBoundingClientRect();var a=document.documentElement;return{top:c.top+window.pageYOffset-a.clientTop,left:c.left+window.pageXOffset-a.clientLeft,right:c.right+window.pageYOffset-a.clientTop,bottom:c.bottom+window.pageXOffset-a.clientLeft}}
var ImagePreloader=new function(){function c(a){var c=new b({url:a});return f[a]=c}function a(a){function b(a){a=e.indexOf(a.preloader);0>a||e.splice(a,1);1>e.length&&c&&c()}var c=a.callback,e=[];this.addPreloader=function(a){a.addEventListener("done",b);e.push(a)}}function b(a){function b(){c.dispatchEvent({type:"done",preloader:c})}EventEnabledBuilder(this);var c=this;a=a.url;var e=E.IMG(),f=!1;console.log('preloading "'+a+'"');e.onload=function(a){f=!0;b()};e.onerror=function(a){console.log(a);
b()};e.src=a;this.getSuccessful=function(){return f}}var e={},f={};this.preloadRange=function(b,k){var g;each(b,function(b){if(!e[b]){var h=f[b];g||(g=new a({callback:k}));g.addPreloader(h?h:c(b))}});g||k&&k()}},ClickedOff=new function(){function c(a){a=b.indexOf(a);0>a||b.splice(a,1)}function a(a,b,c){var e=[];this.addAdditionalElement=function(a){0>e.indexOf(a)&&e.push(a)};this.removeAdditionalElement=function(a){a=e.indexOf(a);0>a||e.splice(a,1)};this.getElement=function(){return a};this.hide=
function(){c();b()};this.dispose=c}var b=[];this.register=function(e,f){var h=new a(e,f,c);setTimeout(function(){a:{var a=0;for(var c;c=b[a];a++)if(c.getElement()==e){a=!0;break a}a=!1}a||b.push(h)},0);return h};this.remove=function(a){for(var c=new Iterator(b);c.hasNext();){var e=c.next();if(e.getElement()==a){e.dispose();break}}};document.addEventListener("mousedown",function(a){var c=a.pageX;a=a.pageY;for(var e=b.slice(),k=0,g;g=e[k];k++){var m=g.getElement(),l=getAbsolute(m),n=l.left,p=n+m.offsetWidth;
l=l.top;m=l+m.offsetHeight;(c<n||c>p||a<l||a>m)&&g.hide()}})},Popup=new function(){return function(c){function a(a){b(a.popup)}function b(a){h.removeAdditionalElement(a.getElement());a=k.indexOf(a);0>a||k.splice(a,1)}function e(){g.style.display="none";each(k.slice(),b);f.dispatchEvent({type:"hide",popup:f})}c=c||{};EventEnabledBuilder(this);var f=this,h,k=[],g=E.DIV(),m=!1,l=void 0==c.closeOnClickOff?!0:c.closeOnClickOff;g.classList.add("popup");this.show=function(){l&&(h=ClickedOff.register(g,e));
g.style.display="block";m=!0};this.hide=function(){m=!1;l&&h.dispose();e()};this.setPosition=function(a){a.left&&(g.style.left=String(a.left)+"px");a.top&&(g.style.top=String(a.top)+"px");a.right&&(g.style.right=String(a.right)+"px");a.bottom&&(g.style.bottom=String(a.bottom)+"px")};this.dispose=function(){l&&ClickedOff.dispose();g.parentNode.removeChild(g)};this.addChildPopup=function(b){if(!m)throw Error("Cant add child while popup is not showing. Children should be added when made visible only");
h&&(b.addEventListener("hide",a),h.addAdditionalElement(b.getElement()),k.push(b))};this.getElement=function(){return g}}},Heading=function(){function c(a){var b=E.DIV(),c=E.DIV(),f=E.DIV();b.classList.add("heading");f.classList.add("heading-title");c.classList.add("heading-entries");f.title=f.innerHTML=a.title;b.appendChild(f);b.appendChild(c);this.getElement=function(){return b};this.getEntries=function(){return c}}return function(a){a=new c(a);this.getElement=a.getElement;this.getEntries=a.getEntries}}(),
StandardMenu=new function(){function c(a){var b=a.title;EventEnabledBuilder(this);b=a.title;var c=a.classNames,f=a.popup.getElement(),h=E.DIV(),k=E.DIV();k.classList.add("entries");h.classList.add("standard-menu-inner");c&&each(c,function(a){f.classList.add(a)});c=a.buttonClose;var g=E.DIV();g.innerHTML="&nbsp;"+b;g.classList.add("heading");g.appendChild(c.getElement());f.appendChild(h);h.appendChild(g);h.appendChild(k);f.classList.add("standard-menu");each(a.entries,function(a){k.appendChild(a.getElement())});
document.body.appendChild(f);this.getElement=function(){return f};this.getEntries=function(){return k};this.setVisible=function(a){k.style.display=a?"block":"none"}}return function(a){function b(){h.hide()}var e=a.title,f=a.classNames,h=new Popup({});a=new Button({className:"button-close"});e=new c({popup:h,buttonClose:a,entries:[],title:e,classNames:f});this.getElement=e.getElement;this.getEntries=e.getEntries;this.setVisible=e.setVisible;this.show=function(){console.log("show");h.show()};this.hide=
b;a&&a.addEventListener("click",b)}},StandardSearch=function(){function c(a){var b=a.spinner,c=E.DIV(),f=a.callbackSearch;c.classList.add("standard-search-entries");var h=a.standardMenu;a=a.searchBar;h.getElement().appendChild(b.getElement());h.getEntries().appendChild(a.getElement());h.getEntries().appendChild(c);this.getEntries=function(){return c};a.addEventListener("search",f)}return function(a){EventEnabledBuilder(this);var b=a.callbackSearch,e=a.classNames,f=a.getEntryId,h=a.title;a=new Spinner({});
e=new StandardMenu({title:h,classNames:e});h=new SearchBar({});b=new c({standardMenu:e,searchBar:h,callbackSearch:b,spinner:a});new SortedFilteredEntries({element:b.getEntries(),getEntryId:f});this.show=e.show;this.hide=e.hide;this.getEntries=b.getEntries;this.showSpinner=a.show;this.hideSpinner=a.hide}}(),Enumerable=function(){var c=function(a,b,c){this.moveNext=a;this.current=b;this.reset=c};c.fromArray=function(a){return new function(a){var b=-1,f=a.length;return new c(function(){b++;return b<
f},function(){return a[b]},function(){b=-1})}(a)};return c}();Enumerable.prototype.toList=function(){this.reset();for(var c=[];this.moveNext();)c.push(this.current());return c};Enumerable.prototype.select=function(c){var a=this;return new Enumerable(this.moveNext,function(){return c(a.current())},this.reset)};Enumerable.prototype.take=function(c){return function(a,b){var c=0;return new Enumerable(function(){return b.moveNext()&&(c++,c<=a)?!0:!1},b.current,b.reset)}(c,this)};
Enumerable.prototype.leave=function(c){var a=this,b=0;return new Enumerable(function(){return a.moveNext()&&(b++,b>c)?!0:!1},a.current,a.reset)};Enumerable.prototype.where=function(c){var a=this;return new Enumerable(function(){do if(!a.moveNext())return!1;while(!c(a.current()));return!0},this.current,this.reset)};Enumerable.prototype.firstOrDefault=function(){this.reset();this.moveNext();return this.current()};Enumerable.prototype.reverse=function(){this.reset();return Enumerable.fromArray(this.toList().reverse())};
Enumerable.prototype.sum=function(c){this.reset();for(var a=0;this.moveNext();)a+=c(this.current());return a};Enumerable.prototype.count=function(){this.reset();for(var c=0;this.moveNext();)c++;return c};Enumerable.prototype.each=function(c){for(this.reset();this.moveNext();)c(this.current())};Array.prototype.select=function(c){return Enumerable.fromArray(this).select(c)};Array.prototype.where=function(c){return Enumerable.fromArray(this).where(c)};Array.prototype.each=function(c){return Enumerable.fromArray(this).each(c)};
Array.prototype.take=function(c){return Enumerable.fromArray(this).take(c)};Array.prototype.leave=function(c){return Enumerable.fromArray(this).leave(c)};Array.prototype.sum=function(c){return Enumerable.fromArray(this).sum(c)};
var Ajax=function(){function c(b,c){var e=b.parameters,f=b.callbackSuccessful,h=b.callbackFailed,l=b.callbackTimeout,n=b.contentType?b.contentType:"application/json",p=b.timeout,w=new XMLHttpRequest;w.open(c?"POST":"GET",b.url,!0);p&&(w.timeout=p);w.setRequestHeader("Content-Type",n);if(e){n=!0;for(var q in e)n&&(n=!1)}return new a(w,c?b.data:void 0,f,h,l)}function a(a,b,c,g,m){e++;var f=this,h;a.onload=function(){4===a.readyState&&(200===a.status?(h=!0,f.onDone&&f.onDone(f),c&&c(a.responseText)):
(h=!1,console.log("Request failed.  Returned status of "+a.status),f.onDone&&f.onDone(f),g&&g()))};m&&(a.ontimeout=m);a.onprogress=function(a){f.onProgress&&f.onProgress(a.total?a.loaded/a.total:1)};a.send(b);a.onerror=function(a){console.error(a);g&&g(a)};this.getXhr=function(){return a};this.abort=a.abort;this.getSuccessful=function(){return h}}var b=function(a){var c=a.url;this.post=function(a){a.url=a.url?a.url:c;return b.post(a)};this.get=function(a){a.url=a.url?a.url:c;return b.get(a)}};b.post=
function(a){return c(a,!0)};b.get=function(a){return c(a,!1)};var e=0;return b}(),Longpoll=function(){return function(c){function a(){q.get({url:K+("?t="+w++ +"_"+(new Date).getTime()),callbackSuccessful:k,callbackFailed:h,callbackTimeout:f})}function b(b){console.log(b);b=JSON.parse(b);b.disposed?(u=!0,l.dispose()):r||(r=!0,p=b.id,K=n+"/"+p,m(p),each(z,function(a){l.send(a)}),z=null,a())}function e(a){console.error(a);l.onError&&l.onError(a)}function f(){a()}function h(b){console.error(b);l.onError&&
l.onError(b);t||a()}function k(b){a();b&&(b=JSON.parse(b),b.disposed&&l.dispose(),g(b))}function g(a){a.msgs&&each(a.msgs,function(a){console.log(a);l.onMessage&&l.onMessage(a)})}function m(a){console.log("dispatchGotId");l.onGotId&&l.onGotId(a)}var l=this,n=c.url,p=c.id,w=0,q=new Ajax({url:n}),t=!1,r=!1,v=!1,u=!1,z=[],K;this.send=function(a){t||(r||!v?(v=!0,q.post({data:JSON.stringify({id:p,msg:a}),callbackSuccessful:b,callbackFailed:e})):z.push(a))};this.getDisposedByServer=function(){return u};
this.dispose=function(){t||(t=!0,l.onDispose&&l.onDispose())}}}();
function Spinner(c){function a(a){h.addEventListener(a,function(a){a||(a=window.event);a.stopPropagation&&a.stopPropagation();a.preventDefault&&a.preventDefault();return!1})}var b=c.preventInterraction,e=this;c=E.DIV();c.classList.add("spinner");for(var f=0;3>f;f++)c.appendChild(E.DIV());if(b){b=E.DIV();b.classList.add("prevent-interraction");document.documentElement.appendChild(b);b.appendChild(c);var h=b}else h=c;h.style.display="none";this.getElement=function(){return h};this.show=function(){e.setVisible(!0)};
this.hide=function(){e.setVisible(!1)};this.setVisible=function(a){h.style.display=a?"inline-block":"none";a&&b&&setTimeout(function(){document.activeElement&&document.activeElement.blur&&document.activeElement.blur()},0)};b&&(a("click"),a("mousedown"),a("mouseup"))}var Settings=function(){return function(c){this.get=function(a){try{var b=window.localStorage.getItem(c+"_"+a);return null==b||void 0==b?void 0:JSON.parse(b)}catch(e){}};this.set=function(a,b){try{window.localStorage.setItem(c+"_"+a,JSON.stringify(b))}catch(e){console.log(e)}}}}();
function TabPanel(c,a,b){function e(a,b,c){this.div=E.DIV();var e=E.DIV();this.div.style.width=String(l)+"%";this.div.style.left=String(c*l)+"%";this.div.classList.add("tab");e.classList.add("name");this.div.appendChild(e);e.innerHTML=a;this.div.addEventListener("mousedown",function(){h(b)});this.close=function(){};this.setActive=function(){this.div.style.height="18px"};this.setInactive=function(){this.div.style.height="17px"}}function f(){var b=this;this.div=E.DIV();this.div.style.height=a?"auto":
"calc(100% - 3px)";this.div.style.position=a?"relative":"absolute";this.div.classList.add("panel");this.show=function(){b.div.style.display="inline"};this.hide=function(){b.div.style.display="none"};this.close=function(){}}function h(a){for(var b=0;b<k.panels.length;b++){var c=k.panels[b];c.hide();if(a!=c)k.tabs[b].setInactive();else if(k.tabs[b].setActive(),k.onChangeTab)k.onChangeTab(b)}a.show()}var k=this;this.panels=[];this.tabs=[];b=c.length;this.div=E.DIV();var g=E.DIV(),m=E.DIV();m.classList.add("tabs");
this.div.style.height=a?"auto":"100%";this.div.classList.add("tab-panel");var l=100/b;g.style.height=a?"auto":"calc(100% - 20px)";g.style.width="100%";a||(g.style.top="20px");g.style.float="left";g.style.position=a?"relative":"absolute";this.div.appendChild(m);this.div.appendChild(g);for(var n=0;n<b;n++){var p=new f,w=new e(c[n],p,n);k.panels.push(p);k.tabs.push(w);g.appendChild(p.div);m.appendChild(w.div)}h(k.panels[0]);this.close=function(){for(var a=0;a<k.panels.length;a++)k.panels[a].close(),
k.tabs[a].close()}}
var WindowResizeManager=new function(){EventEnabledBuilder(this);var c=this;window.addEventListener("resize",function(){console.log("doing resize");c.dispatchEvent({type:"resized"})})},ResizeManager=new function(){function c(a){function b(){g.trigger()}function c(a){if(m){if(a=m,m=h.getBoundingClientRect(),a.height!=m.height||a.width!=m.width)f.dispatchEvent({type:"resized"}),k&&k()}else m=h.getBoundingClientRect()}EventEnabledBuilder(this);var f=this,h=a.element,k=a.onResized,g=(a=a.staggered)?new TemporalCallback({callback:c,
delay:500,maxTotalDelay:800}):void 0,m;this.manual=function(){c()};window.ResizeObserver?(new window.ResizeObserver(a?b:c)).observe(h):WindowResizeManager.addEventListener("resized",a?b:c)}EventEnabledBuilder(this);this.add=function(a){return new c(a)}},Tickbox=function(){return function(c){function a(){b?f.classList.contains("ticked")||f.classList.add("ticked"):f.classList.contains("ticked")&&f.classList.remove("ticked")}var b=!1,e=E.DIV();e.classList.add("tickbox");var f=E.DIV();f.classList.add("box");
if(c.text){var h=E.DIV();h.classList.add("text");e.appendChild(h);h.innerHTML=c.text}e.appendChild(f);this.getElement=function(){return e};this.setTicked=function(c){b=c;a()};this.getTicked=function(){return b};f.addEventListener("click",function(){b=!b;a()})}}();function Genders(){}
function GenderPicker(){var c=document.createElement("select");c.classList.add("gender");for(var a=0;a<Genders.values.length;a++){var b=Genders.values[a],e=document.createElement("option");e.innerHTML=b.txt;e.value=b.value;c.appendChild(e)}this.getValue=function(){return c.options[c.selectedIndex].value};this.getElement=function(){return c}}
Genders.values=[{value:0,txt:"a man"},{value:1,txt:"a woman"},{value:2,txt:"a couple(man + woman)"},{value:3,txt:"a couple of men"},{value:4,txt:"a couple of women"},{value:5,txt:"a transexual man"},{value:6,txt:"a transexual women"}];
function Birthday(){function c(a,b){var c=document.createElement("option");c.value=a;c.innerHTML=b;return c}var a=E.DIV(),b=E.SELECT(),e=E.SELECT(),f=E.SELECT();a.classList.add("birthday");a.appendChild(b);a.appendChild(e);a.appendChild(f);b.classList.add("not-right");e.classList.add("not-right");var h=1900+(new Date).getYear(),k="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");b.appendChild(c(void 0,"Day"));e.appendChild(c(void 0,"Month"));f.appendChild(c(void 0,"Year"));for(var g=1;32>
g;g++){var m=c(g,String(g));b.appendChild(m)}for(g=1;12>g;g++)m=c(g,k[g]),e.appendChild(m);h-=17;for(g=h-100;g<h;g++)m=c(g,String(g)),f.appendChild(m);this.getElement=function(){return a};this.getValue=function(){var a=b.options[b.selectedIndex].value,c=e.options[e.selectedIndex].value,g=f.options[f.selectedIndex].value;return{day:"undefined"==a?void 0:parseInt(a),month:"undefined"==c?void 0:parseInt(c),year:"undefined"==g?void 0:parseInt(g)}}}
var Authenticate=function(){return function(c){function a(){if(1>I.value.length)g("You must enter an email address!");else if(1>F.value.length)g("You must enter a username!");else if(1>J.value.length)g("You must enter a password!");else if(1>D.value.length)g("You must re-enter your password!");else if(J.value!=D.value)g("The passwords entered do not match!");else{p.show();var a=la.getValue();a.year?void 0==a.month?g("You must enter a birth month!"):a.day?(a={email:I.value,username:F.value,password:J.value,
gender:ba.getValue(),birthday:a,staySignedIn:H.getTicked()},m(a)):g("You must enter a birth day!"):g("You must enter a birth year!")}}function b(){p.show();l({password:B.value,username:u.value,staySignedIn:z.getTicked()})}function e(){p.show();n({username:C.value,staySignedIn:K.getTicked()})}function f(c){c=c||window.event;if(13==c.keyCode)switch(aa){case W.Guest:e();break;case W.SignIn:b();break;default:a()}}function h(a,b){a.classList.add("entry");a.placeholder=b;r.appendChild(a)}function k(a,b){a.classList.add("entry");
a.placeholder=b;G.appendChild(a)}function g(a){a?(p.hide(),ia.style.display="inline",L.innerHTML=a):ia.style.display="none"}var m=c.callbackRegister,l=c.callbackSignIn,n=c.callbackGuest,p=new Spinner({preventInterraction:!0});document.documentElement.appendChild(p.getElement());var w=new Settings("#username",function(){this.set("username")}),q=E.DIV(),t=E.DIV(),r=E.DIV(),v=E.DIV(),u=E.TEXT(),z=new Tickbox({text:"Stay signed in"}),K=new Tickbox({text:"Stay signed in"}),B=E.PASSWORD(),J=E.PASSWORD(),
D=E.PASSWORD(),I=E.TEXT(),F=E.TEXT(),H=new Tickbox({text:"Stay signed in"}),C=E.TEXT();c=new Button({classNames:["button-register"],text:"Enter"});var U=new Button({classNames:["button-register"],text:"Done"}),ia=E.DIV(),L=E.TEXTAREA();q.classList.add("authenticate");t.classList.add("div-inner");r.classList.add("div-inputs-sign-in");var G=E.DIV();C.className="form-control";F.className="form-control";I.className="form-control";D.className="form-control";J.className="form-control";B.className="form-control";
u.className="form-control";var la=new Birthday,ba=new GenderPicker;t=new Button({classNames:["button-register"],text:"Done"});k(I,"Email");k(F,"Username");k(J,"Password");k(D,"Re-enter Password");C.onkeydown=f;B.onkeydown=f;I.onkeydown=f;F.onkeydown=f;J.onkeydown=f;D.onkeydown=f;G.appendChild(ba.getElement());G.appendChild(la.getElement());G.appendChild(H.getElement());G.appendChild(t.getElement());G.classList.add("inputs-register");v.appendChild(C);t.addEventListener("click",a);(function(a,b){a.classList.add("entry");
a.placeholder=b;v.appendChild(a)})(C,"Username");h(u,"Username");h(B,"Password");B.type="password";ia.classList.add("error");L.classList.add("error-text");L.readOnly=!0;c.innerHTML="Enter";this.setError=g;U.addEventListener("click",e);c.addEventListener("click",b);u.onkeydown=f;u.addEventListener("click",function(){u.focus()});var W={Guest:0,SignIn:1,Register:2},aa=W.Guest;t=new TabPanel(["Guest","Sign In","Register"],!0);t.onChangeTab=function(a){g("");switch(a){case 1:aa=W.SignIn;break;case 2:aa=
W.Register;break;default:aa=W.Guest}};q.appendChild(t.div);t.panels[0].div.appendChild(v);t.panels[1].div.appendChild(r);t.panels[2].div.appendChild(G);t.panels[2].div.className="panel";t.div.style.height="auto";t.div.style.position="relative";v.appendChild(K.getElement());v.appendChild(U.getElement());r.appendChild(z.getElement());r.appendChild(c.getElement());q.appendChild(ia);ia.appendChild(L);document.body.appendChild(q);if(c=w.get("username"))u.value=c;this.show=function(){q.style.display="block"};
this.hide=function(){p.setVisible(!1);q.style.display="none";w.set("username",u.value)}}}(),MappedSets=function(){function c(a){var b=this,c=[a];this.add=function(a){if(b.contains(a))return!1;c.push(a);return!0};this.remove=function(a){a=c.indexOf(a);if(0>a)return!1;c.splice(a,1)};this.contains=function(a){return 0<=c.indexOf(a)};this.getList=function(){return c};this.count=function(){return c.length}}return function(){var a={};this.add=function(b,e){if(!e)return!1;var f=a[b];return f?f.add(e):(a[b]=
new c(e),!0)};this.remove=function(b,c){var e=a[b];if(!e)return!1;if(!c)return delete a[b],!0;if(!e.remove(c))return!1;1>e.count()&&delete a[b];return!0};this.contains=function(b,c){return(b=a[b])?c?b.contains(c):!0:!1};this.getList=function(b){console.log(a);if(b=a[b])return b.getList()}}}(),TabPortal=new function(){function c(a,b){this.receivedMessage=b}var a=new MappedSets,b=new BroadcastChannel("x-chat");b.onmessage=function(b){var c=b.data;c.id&&(b=a.getList(c.id))&&b.each(function(a){return a.receivedMessage(c.message)})};
return function(e){var f=e.id;EventEnabledBuilder(this);var h=this;this.sendMessage=function(a){console.log("send");console.log(a);b.postMessage({id:f,message:a})};this.dispose=function(){a.remove(f,h);h.dispatchEvent({type:"closed"})};a.add(f,new c(h,function(a){h.dispatchEvent({type:"message",message:a})}))}},OnlineIndicators=function(){var c={},a=function(a){EventEnabledBuilder(this);var b=this,c=!1;this.setOnline=function(a){a?c||b.dispatchEvent({type:"cameonline"}):c&&b.dispatchEvent({type:"wentoffline"});
c=a};this.getOnline=function(){return c}},b={get:function(b){var e=c[b];if(e)return e;e=new a;return c[b]=e},setOnline:function(a,c){b.get(a).setOnline(c)}};return b}();
function OnlineIndicatorUI(c){function a(a){e.classList.add("online");e.classList.remove("offline")}function b(a){e.classList.remove("online");e.classList.add("offline")}var e=E.DIV();e.classList.add("online-indicator");this.getElement=function(){return e};c.addEventListener("cameonline",a);c.addEventListener("wentoffline",b);(c.getOnline()?a:b)();this.dispose=function(){c.addEventListener("cameonline",a);c.addEventListener("wentoffline",b)}}
var Ignored=function(){var c=function(a){this.getUsername=function(){return a.username};this.getId=function(){return a.id};this.toJSON=function(){return a}};c.fromUser=function(a){return new c({id:a.getId(),username:a.getUsername()})};c.fromJSON=function(a){return new c(a)};return c}(),IgnoreManager=new function(){return function(c){function a(){l.set("ignores",n.getEntries().select(function(a){return a.toJSON()}).toList())}function b(a,b){k.dispatchEvent({type:"ignored",userId:a,ignored:b})}function e(a,
b){k.dispatchEvent({type:"unignored",userId:a,ignored:b})}function f(c){n.add(c)&&(a(),b(c.getId(),c),h.sendMessage({type:"ignore",ignored:c.toJSON()}))}EventEnabledBuilder(this);var h=new TabPortal({id:"IgnoreManager"}),k=this,g=c.getUserById,m=c.getUserMe,l=new Settings("ignore"),n=new Set({getEntryId:function(a){return a.getId()}});this.ignoreUser=function(a){a=Ignored.fromUser(a);f(a)};this.ignoreUserById=function(a){!k.userIdIsIgnored(a)&&(a=g(a))&&(a=Ignored.fromUser(a),f(a))};this.ignoreUserByIdAndUsername=
function(a){a=Ignored.fromJSON(a);f(a)};this.unignoreUser=function(a){k.unignoreUserById(a.getId())};this.unignoreUserById=function(a){if(a=n.removeById(a))e(a.getId(),a),h.sendMessage({type:"unignore",ignored:a.toJSON()})};this.userIsIgnored=function(a){return k.userIdIsIgnored(a.getId())};this.userIdIsIgnored=function(a){return n.containsId(a)};this.getIgnores=function(){return n.getEntries()};this.clearSave=function(){l.set("ignores",[])};this.load=function(){var a=l.get("ignores");a&&each(a,function(a){n.add(Ignored.fromJSON(a))})};
h.addEventListener("message",function(c){var f=Ignored.fromJSON(c.message.ignored);switch(c.message.type){case "ignore":f.getId()!=m().getId()&&n.add(f)&&(a(),b(f.getId(),f));break;case "unignore":n.remove(f)&&(a(),e(f.getId(),f))}})}},OverflowManager=new function(){return function(c){var a=c.getMessages,b=c.remove,e=c.maxNMessages;this.trigger=(new TemporalCallback({callback:function(){var c=a().where(function(a){return!a.getIgnored()}).toList(),h=c.length-e;1>h||each(c.take(h).toList(),function(a){b(a)})},
maxNDelays:50,maxTotalDelay:6E3})).trigger}},ChannelType={JSONP:"jsonp",LONGPOLL:"longpoll",WEBSOCKET:"websocket"},MysocketChannelAnalysis=new function(){return function(c){EventEnabledBuilder(this);var a=this,b=!1,e=[],f,h,k=new StopWatch;this.getSuccessfullyOpened=function(){return b};this.getOpenForMilliseconds=k.getMilliseconds;this.getOpenForSeconds=k.getSeconds;this.getOpenedAt=function(){return f};this.getClosedAt=function(){return h};this.getChannelType=function(){return c};this.opened=function(){b=
!0;f=(new Date).getTime();k.start()};this.receivedMessage=function(){};this.closed=function(){k.stop();h=(new Date).getTime();a.dispatchEvent({type:"closed",mysocketChannelAnalysis:a})};this.error=function(a){for(e.push(a);30<e.length;)e.splice(0,1)}}},MysocketAnalysis=function(){return function(c){function a(){return b().where(function(a){return 5E3>a.getOpenForMilliseconds()}).count()}function b(){return e().where(function(a){return a.getChannelType()==ChannelType.WEBSOCKET})}function e(){var a=
(new Date).getTime(),b=h.length-1,c=[];a-=6E4;for(console.log("channelAnalysiss.length is: "+h.length);0<=b;){var e=h[b];if(a<e.getClosedAt())c.push(e);else break;b--}return c}function f(a){console.log("channelAnalysisClosed");a=a.mysocketChannelAnalysis;a.removeEventListener("closed",f);for(h.push(a);20<h.length;)h.splice(0,1);a.getChannelType()}var h=[],k;this.getRecommendedTypes=function(){var b=a(),c,e=(window.WebSocket?!0:!1)&&!(c=0<b);console.log("nRecentWebsocketsFailedQuickly"+b);console.log("shouldUseWebsocket"+
e);console.log("websocket failed quickly"+c);e&&c&&(console.log("websocket failed quickly"),b=6E4<(new Date).getTime()-c.getOpenedAt(),console.log("shouldAttemptWebsocketAgain"+b),e=b);return e?[ChannelType.WEBSOCKET,ChannelType.LONGPOLL]:[ChannelType.LONGPOLL]};this.getRecommendedDelayBeforeCreatingChannel=function(){console.log(1>h.length);if(1>h.length)return{type:When.NOW};for(var a=0,b=(new Date).getTime()-6E4,c=h.length-1;0<=c;c--)if(h[c].getOpenedAt()>b)a++;else break;return 3<a?{type:When.SECONDS,
seconds:5}:2E3<(new Date).getTime()-h[h.length-1].getClosedAt()?{type:When.NOW}:{type:When.SECONDS,seconds:1}};this.add=function(a){k=a;a.addEventListener("closed",f)};this.clear=function(){k.closed();h=[];k=void 0}}}(),MysocketChannelManager=function(){return function(c){function a(){console.log("callbackCreateChannel");b();e.dispatchEvent({type:"newchannel",channel:m});l=!1}function b(){console.log("get id is: "+g());return m=MysocketChannelFactory.create({id:g(),urlWebsocket:k,url:h,mysocketAnalysis:f})}
EventEnabledBuilder(this);var e=this,f=c.mysocketAnalysis,h=c.url,k=c.urlWebsocket,g=c.getId,m,l=!1;this.wouldLikeNewChannel=function(){if(!l){var c=f.getRecommendedDelayBeforeCreatingChannel();console.log("Reccomended delay before creating a channel was: "+c.type);console.log(c);switch(c.type){case When.NOW:return b();case When.SECONDS:c=c.seconds,console.log(c),c*=1E3,l=!0,console.log("function createNewChannelAfterDelayMilliseconds(milliseconds){"),(new Timer({delay:c,callback:a,nTicks:1})).start()}}}}}(),
MysocketChannelFactory=new function(){function c(a,c){console.log("websocket created"+a);var b=this,e=new MysocketChannelAnalysis(ChannelType.WEBSOCKET),k=!1;this.send=function(a){console.log(a);g.send(JSON.stringify(a))};this.getAnalysis=function(){return e};this.getChannelType=function(){return ChannelType.WEBSOCKET};this.isOpen=function(){return g&&g.readyState==g.OPEN};var g=new WebSocket(c+(a?"?mysocketId="+a:""));g.onmessage=function(c){c=JSON.parse(c.data);console.log("on message");console.log(c);
c.mysocketId&&(a=c.mysocketId);c.disposed?(console.log("got disposed message"),k=!0,g.close()):(e.receivedMessage(),b.onMessage&&b.onMessage(c))};g.onopen=function(){e.opened();b.onOpen&&b.onOpen()};g.onclose=function(){e.closed();b.onClose&&b.onClose()};g.onerror=function(a){e.error(a);console.log(a);b.onError&&b.onError(a)};this.close=function(){g.close()};this.getDisposedByServer=function(){console.log(k);return k};window.channel=this}function a(a,c){function b(){k||(k=!0,m.dispose(),g.closed(),
e.onClose&&e.onClose())}var e=this,k=!1,g=new MysocketChannelAnalysis(ChannelType.LONGPOLL),m=new Longpoll({url:c,id:a});m.onMessage=function(a){g.receivedMessage();e.onMessage&&e.onMessage(a)};m.onError=function(a){g.error(a);console.log(a);b();e.onError&&e.onError(a)};m.onSent=function(){};m.onDispose=function(){console.log("on dispose");b()};window.channel=this;this.close=b;this.send=m.send;this.getAnalysis=function(){return g};this.getChannelType=function(){return ChannelType.LONGPOLL};this.getDisposedByServer=
m.getDisposedByServer;setTimeout(function(){g.opened();e.onOpen&&e.onOpen()},0);this.isOpen=function(){return!k}}this.create=function(b){var e=b.mysocketAnalysis.getRecommendedTypes();console.log("The recommended channel types was: "+e);switch(e[0]){case Mysocket.WEBSOCKET:return new c(b.id,b.urlWebsocket);default:return console.log(b.url),new a(b.id,b.url)}}},Mysocket=function(){var c=function(a){function b(){if(l)return l;(l=t.wouldLikeNewChannel())&&c(l)}function c(a){a.onClose=h;a.onOpen=k;a.onMessage=
f;q.add(a.getAnalysis())}function f(a){console.log(a);console.log(Error().stack);"mysocket_id"==a.type?n=a.id:m.dispatchEvent({type:"message",msg:a})}function h(){var a=l.getDisposedByServer();console.log(a);l=null;a?(console.log(Error().stack),console.log("dispatchDisposedByServer"),m.dispatchEvent({type:"disposedbyserver"})):w||setTimeout(b,0)}function k(){console.log("open");if(0<p.length)for(var a=new Iterator(p);a.hasNext();){var b=a.next();try{l&&l.isOpen()&&l.send(b),a.remove()}catch(u){break}}else console.log("sayHiAgain"),
l&&l.isOpen()&&l.send({type:"hi"});m.dispatchEvent({type:"open"})}var g=a.url;a=a.urlWebsocket;EventEnabledBuilder(this);var m=this,l,n,p=[],w=!1;this.reset=function(){w=!0;n=null;p=[];l&&l.dispose();l=null;q.clear()};this.send=function(a){w=!1;var c=b();c&&c.isOpen()?c.send(a):p.push(a)};this.getUrl=function(){return g};var q=new MysocketAnalysis({mysocket:this}),t=new MysocketChannelManager({mysocketAnalysis:q,urlWebsocket:a,url:g,getId:function(){return n}});t.addEventListener("newchannel",function(a){l=
a.channel;c(l)});b()};c.JSONP="jsonp";c.LONGPOLL="longpoll";c.WEBSOCKET="websocket";return c}(),SplitPane=function(){function c(a){function b(a){if(a)switch(a.getUnit()){case Dimension.PX:return a.getValue();case Dimension.PERCENT:return a.getValue()*f()/100}}EventEnabledBuilder(this);var c=this,e=a.panels,f=a.getPaneHeight,h=a.minHeight,k=!0;h?h.isDimension||(h=new Dimension(h)):h=Dimension.pixels(20);var q=a.maxHeight;q&&!q.isDimension&&(q=new Dimension(q));var t=a.height;t&&!t.isDimension&&(t=
new Dimension(t));var r;this.setAssociatedSlider=function(a){r=a};this.getAssociatedSlider=function(){return r};this.getTop=function(){return e[0].getTop()};this.setVisible=function(a){k=a;each(e,function(b){b.setVisible(a)});c.dispatchEvent({type:"setvisible",visible:a})};this.getVisible=function(){return k};this.setTop=function(a){each(e,function(b){b.setTop(a)})};this.setBottom=function(a){var b=c.getTop();c.setHeight(a-b)};this.getDesiredHeight=function(){return b(t)};this.getHeight=function(){return e[0].getHeight()};
this.setHeight=function(a){each(e,function(b){b.setHeight(a)})};this.getMinHeight=function(){return b(h)}}function a(a){function b(a){if(a)switch(a.getUnit()){case Dimension.PX:return a.getValue();case Dimension.PERCENT:return a.getValue()*e()/100}}EventEnabledBuilder(this);var c=this,e=a.getPaneWidth,f=a.minWidth,h=!0;f?f.isDimension||(f=new Dimension(f)):f=Dimension.pixels(20);var k=a.maxWidth;k&&!k.isDimension&&(k=new Dimension(k));var q=a.width;q&&!q.isDimension&&(q=new Dimension(q));var t=[],
r;this.getFirstPanel=function(){return t[0]};this.setAssociatedSlider=function(a){r=a};this.getAssociatedSlider=function(){return r};this.setVisible=function(a){h=a;each(t,function(b){b.setVisible(a)});c.dispatchEvent({type:"setvisible",visible:a})};this.getVisible=function(){return h};this.getPanel=function(a){return t[a]};this.setPanelColumnRight=function(a){};this.addNextPanel=function(a){t.push(a)};this.setLeft=function(a){each(t,function(b){b.setLeft(a)})};this.getLeft=function(){return t[0].getLeft()};
this.setLeft=function(a){each(t,function(b){b.setLeft(a)})};this.setRight=function(a){var b=c.getLeft();c.setWidth(a-b)};this.getWidth=function(){return t[0].getWidth()};this.getDesiredWidth=function(){return b(q)};this.setWidth=function(a){each(t,function(b){b.setWidth(a)})};this.getMinWidth=function(){return b(f)}}function b(a){var b=E.DIV();b.classList.add("panel");a.isLeft&&b.classList.add("panel-left");a.isRight&&b.classList.add("panel-right");a.isTop&&b.classList.add("panel-top");a.isBottom&&
b.classList.add("panel-bottom");this.setVisible=function(a){b.style.display=a?"block":"none"};this.getElement=function(){return b};this.setTop=function(a){b.style.top=String(a)+"px"};this.setLeft=function(a){b.style.left=String(a)+"px"};this.setWidth=function(a){b.style.width=String(a)+"px"};this.getWidth=function(){return b.clientWidth};this.getLeft=function(){return b.offsetLeft};this.getTop=function(){return b.offsetTop};this.setHeight=function(a){b.style.height=String(a)+"px"};this.getHeight=
function(){return b.clientHeight}}function e(a){function b(){return v.offsetLeft}var c=this,e=a.leftPanelColumn,f=a.getNextSiblingVisible,h,k,q,t,r,v=E.DIV();v.classList.add("slider");v.classList.add("x");e.setAssociatedSlider(this);this.updateVisibility=function(){if(e.getVisible()){var a=f(e);a&&a.getVisible()?c.setVisible(!0):c.setVisible(!1)}else c.setVisible(!1)};this.setVisible=function(a){v.style.display=a?"block":"none"};this.setLeft=function(a){v.style.left=String(a)+"px";e.setRight(a);var b=
f(e);b&&b.setLeft(a+c.getWidth())};this.getWidth=function(){return v.getBoundingClientRect().width};this.getConstraints=function(){r=f(e);h=e.getWidth();k=r.getWidth();q=r.getLeft();t=b();v.getBoundingClientRect();var a=b(),c=a-(e.getWidth()-e.getMinWidth());a+=r.getWidth()-r.getMinWidth();return{minX:c,maxX:a}};this.getElement=function(){return v};this.getX=b;this.getY=function(){return v.offsetTop};this.setPosition=function(a){a=a.x;var b=a-t;v.style.left=String(a)+"px";e.setWidth(h+b);r.setWidth(k-
b);r.setLeft(q+b)};this.endDrag=function(){};this.getAbsolutePosition=function(){return getAbsolute(v)};new DragManager({handle:this})}function f(a){var b=this,c=a.getNextSiblingVisible,e=a.topPanelRow,f,h,k,q,t,r=E.DIV();r.classList.add("slider");r.classList.add("y");e.setAssociatedSlider(this);this.updateVisibility=function(){if(e.getVisible()){var a=c(e);a&&a.getVisible()?b.setVisible(!0):b.setVisible(!1)}else b.setVisible(!1)};this.setVisible=function(a){r.style.display=a?"block":"none"};this.setTop=
function(a){r.style.top=String(a)+"px";e.setBottom(a);var f=c(e);f&&f.setTop(a+b.getHeight())};this.getHeight=function(){return r.getBoundingClientRect().height};this.getConstraints=function(){k=c(e);q=e.getHeight();f=k.getHeight();h=k.getTop();t=r.offsetTop;r.getBoundingClientRect();var a=r.offsetTop,b=a-(e.getHeight()-e.getMinHeight());a+=k.getHeight()-k.getMinHeight();return{minY:b,maxY:a}};this.getElement=function(){return r};this.getX=function(){return r.offsetLeft};this.getY=function(){return r.offsetTop};
this.setPosition=function(a){var b=a.y-t;r.style.top=String(a.y)+"px";e.setHeight(q+b);k.setHeight(f-b);k.setTop(h+b)};this.endDrag=function(){};this.getAbsolutePosition=function(){return getAbsolute(r)};new DragManager({handle:this})}function h(){var a=[];this.add=function(b){a.push(b)};this.count=function(){return a.length};this.get=function(b){return a[b]};this.updateVisibility=function(){each(a,function(a){a.updateVisibility()})}}return function(k){var g;function m(){K=!0;D.updateVisibility();
I.updateVisibility();w(F.getBoundingClientRect().width,1>D.count()?0:D.get(0).getWidth(),function(a){return a.getDesiredWidth()});p(q(),1>I.count()?0:I.get(0).getHeight());g=F.getBoundingClientRect().width;q()}function l(a){return F.getBoundingClientRect().width/g*a.getWidth()}function n(){var a=[];this.add=function(b){a.push(b)};this.get=function(b){return a[b]};this.getVisible=function(){var b=[];each(a,function(a){a.getVisible()&&b.push(a)});return b};this.count=function(){return a.length};this.getNextSiblingVisible=
function(b){for(var c=0;c<a.length;c++)if(a[c]==b){for(b=c+1;b<a.length;b++)if(c=a[b],c.getVisible())return c;break}}}function p(a,b){var c=a,e=B.getVisible(),f=e.length,h=0;e[0].setTop(0);for(var g=0;g<f;g++){var l=e[g],k=e.slice(g+1),m=k.length;k=k.sum(function(a){return a.getMinHeight()})+m*b;var n=l.getDesiredHeight(),p=g>=f-1;if(!n||p)n=(c-m*b)/(m+1);c-n<k&&(n=c-k);p?l.setBottom(a):l.getAssociatedSlider().setTop(h+n);h=h+n+b;c=a-h}}function w(a,b,c){var e=a,f=J.getVisible(),h=f.length,g=0;f[0].setLeft(0);
for(var l=0;l<h;l++){var k=f[l],m=f.slice(l+1),n=m.length;m=m.sum(function(a){return a.getMinWidth()})+n*b;var p=c(k),q=l>=h-1;if(!p||q)p=(e-n*b)/(n+1);e-p<m&&(p=e-m);q?k.setRight(a):k.getAssociatedSlider().setLeft(g+p);g=g+p+b;e=a-g}}function q(){return F.getBoundingClientRect().height}function t(){m()}var r=k.nPanelsWidth,v=k.nPanelsHeight,u=k.rowProfiles,z=k.columnProfiles,K=!1;EventEnabledBuilder(this);var B=new function(){return new n},J=new function(){return new n},D=new h,I=new h,F=E.DIV();
F.classList.add("split-pane");this.getElement=function(){return F};this.getPanelColumns=function(){return J};this.getPanelRows=function(){return B};this.getPanelRow=B.get;this.getPanelColumn=J.get;this.getPanelXY=function(a,b){return J.get(a).getPanel(b)};(function(){for(var b,c=0;c<r;c++){var e=z?z[c]:void 0;e=new a({panelColumnLeft:J.get(c-1),minWidth:e?e.minWidth:void 0,width:e?e.width:void 0});e.addEventListener("setvisible",t);b&&b.setPanelColumnRight(e);b=e;J.add(e)}})();(function(){for(var a,
e=0;e<v;e++){for(var f=[],h=u?u[e]:void 0,g=0;g<r;g++){var l=new b({isLeft:1>g?!0:!1,isRight:g>=r-1?!0:!1,isTop:1>e?!0:!1,isBottom:e>=v-1?!0:!1});F.appendChild(l.getElement());J.get(g).addNextPanel(l);f.push(l)}f=new c({rowAbove:a,panels:f,minHeight:h?h.minHeight:void 0,height:h?h.height:void 0,getPaneHeight:q});f.addEventListener("setvisible",t);a=f;B.add(f)}})();(function(){for(var a=0;a<r-1;a++){var b=new e({leftPanelColumn:J.get(a),getNextSiblingVisible:J.getNextSiblingVisible});D.add(b);F.appendChild(b.getElement())}for(a=
0;a<v-1;a++)b=new f({topPanelRow:B.get(a),getNextSiblingVisible:B.getNextSiblingVisible}),I.add(b),F.appendChild(b.getElement())})();this.resize=function(){if(!K)return m();D.updateVisibility();I.updateVisibility();w(F.getBoundingClientRect().width,1>D.count()?0:D.get(0).getWidth(),l);p(q(),1>I.count()?0:I.get(0).getHeight());g=F.getBoundingClientRect().width;q()};this.initialize=m}}(),ClientClientVideoAudio=new function(){return function(c){function a(a){for(var b=$jscomp.makeIterator(a.getTracks()),
c=b.next();!c.done;c=b.next())u.addTrack(c.value,a);console.log("dispatching local stream");v.dispatchEvent({type:"localstream",stream:a})}function b(){h(function(a){a.successful?v.dispatchEvent({type:"sendaccept",accept:a.answer}):l(a.error)})}function e(){f(function(a){a.successful?v.dispatchEvent({type:"sendoffer",offer:a.offer}):n(a.error)})}function f(a){u.createOffer(function(b){console.log("set offer a");u.setLocalDescription(b,function(){a({successful:!0,offer:b})},function(b){g(a,b)})},function(b){g(a,
b)})}function h(a){u.createAnswer(function(b){console.log("set answer a");u.setLocalDescription(b,function(){a({successful:!0,answer:b})},function(b){g(a,b)})},function(b){g(a,b)})}function k(){u&&u.close();u=new RTCPeerConnection(null);u.ontrack=p;u.onremovestream=w;u.oniceconnectionstatechange=q;u.onicecandidate=t;return u}function g(a,b){m(b);a({successful:!1,error:b})}function m(a){console.error(a.message?a.message:a);console.error(Error().stack)}function l(a){v.dispatchEvent({type:"acceptfailed",
error:a})}function n(a){v.dispatchEvent({type:"offerfailed",error:a})}function p(a){console.log(a.streams[0]);a=a.streams[0];console.log("dispatchAddRemoteStream");v.dispatchEvent({type:"addremotestream",stream:a})}function w(a){v.dispatchEvent({type:"removeremotestream",stream:a.stream})}function q(a){console.log("ICE state: ",u.iceConnectionState);a=u.iceConnectionState;switch(a){case "failed":case "disconnected":case "closed":v.dispatchEvent({type:"ended",iceConnectionState:a})}}function t(a){console.log("onicecandidate");
console.log(a);a=a.candidate;null!=a?v.dispatchEvent({type:"sendice",candidate:a}):v.dispatchEvent({type:"allicecandidatessent"})}function r(a){navigator.getUserMedia({audio:!1,video:!0},function(b){console.log("GOT USRE MEDIA");a({successful:!0,stream:b})},function(b){g(a,b)})}EventEnabledBuilder(this);var v=this,u;this.createOffer=function(b){r(function(c){c.successful?(k(),a(c.stream),e()):(b&&b(c),n(c.error))})};this.incomingOffer=function(a){k();console.log("setting remote description b");console.log("set offer b");
u.setRemoteDescription(a,function(){},function(a){m(a)})};this.acceptedOffer=function(c){console.log("ClientClientVideoAudio.acceptedOffer");r(function(c){c.successful?(a(c.stream),b()):l(c.error)})};this.incomingIceCandidate=function(a){console.log("incoming ice candidate");u&&u.addIceCandidate(a,function(){v.dispatchEvent({type:"addedicecandidate",candidate:a})},m)};this.incomingAccept=function(a){console.log(a);console.log("setting remote description a");console.log("set answer b");u.setRemoteDescription(a,
function(){console.log("set")},function(){console.error(m)})}}},VideoFeedUI=function(){return function(c){function a(){c.acceptedOffer(k.offer)}function b(){f(VideoOfferRejectedReasons.DECLINED)}function e(a){h.dispatchEvent({type:"showmessagetouser",message:a})}function f(a){console.log(a);h.dispatchEvent({type:"offerrejected",reason:a})}EventEnabledBuilder(this);var h=this,k,g,m=E.DIV(),l=E.DIV(),n=E.VIDEO();m.classList.add("video-feed");l.classList.add("me");var p=E.VIDEO();p.classList.add("video-them");
n.classList.add("video-me");m.appendChild(p);m.appendChild(l);l.appendChild(n);c.addEventListener("gotoffer",function(c){k=c.wrappedOffer;console.log(c.offer);g&&g.dispose();g=Dialog.show({message:k.userFrom.getUsername()+" want's to video chat!",buttons:[{text:"Accept",callback:a},{text:"decline",callback:b}]})});c.addEventListener("setlocalstream",function(a){console.log("setting stream");var b=a.stream;console.log(a);console.log(a.stream);n.srcObject=b;n.play();h.dispatchEvent({type:"show"})});
c.addEventListener("setremotestream",function(a){a=a.stream;console.log(a);console.log(Error().stack);console.log("setting videoThem and calling play");p.srcObject=a;p.play()});c.addEventListener("stopped",function(a){h.dispatchEvent({type:"hide"})});c.addEventListener("offerfailed",function(a){a=a.error?a.error.message:void 0;e(a?"Offer failed with reason: "+a:"Offer failed")});c.addEventListener("acceptfailed",function(a){a=a.error?a.error.message:void 0;e(a?"Accept failed with reason: "+a:"Accept failed");
console.log(a);f(VideoOfferRejectedReasons.ERROR)});this.getElement=function(){return m}}}(),VideoFeed=function(){return function(c){function a(a){f.dispatchEvent({type:"setremotestream",stream:a})}function b(a){f.dispatchEvent({type:"generalfailure",error:a.error})}function e(){n&&n.getTracks().forEach(function(a){a.stop()});n=null}EventEnabledBuilder(this);var f=this,h=c.getOfferTemplate,k=c.getAcceptTemplate,g=c.getIceCandidateTemplate,m=c.send,l=new ClientClientVideoAudio({}),n;this.start=function(){e();
l.createOffer(function(a){})};this.acceptedOffer=l.acceptedOffer;this.incomingOffer=function(a){l.incomingOffer(a.offer);f.dispatchEvent({type:"gotoffer",wrappedOffer:a,offer:a.offer})};this.incomingAccept=l.incomingAccept;this.incomingIceCandidate=l.incomingIceCandidate;this.stop=function(){e();f.dispatchEvent({type:"stopped"})};l.addEventListener("acceptfailed",function(a){console.log(Error().stack);console.log(a);b(a);f.dispatchEvent({type:"acceptfailed",error:a.error})});l.addEventListener("offerfailed",
function(a){b(a);f.dispatchEvent({type:"offerfailed",error:a.error})});l.addEventListener("sendice",function(a){a=a.candidate;var b=g();b.candidate=a;console.log(b);m(b)});l.addEventListener("allicesent",function(){});l.addEventListener("localstream",function(a){f.dispatchEvent({type:"setlocalstream",stream:a.stream})});l.addEventListener("addremotestream",function(b){console.log("onAddRemoteStream");e();n=b.stream;a(n)});l.addEventListener("remoteremotestream",function(b){e();a()});l.addEventListener("sendoffer",
function(a){a=a.offer;var b=h();b.offer=a;console.log(b);m(b)});l.addEventListener("sendaccept",function(a){a=a.accept;var b=k();b.accept=a;console.log(b);m(b)});l.addEventListener("ended",function(a){f.dispatchEvent({type:"stopped"})})}}(),VideoFeedPm=function(){return function(c){var a=c.userTo,b=c.getSessionId;c=new VideoFeed({getOfferTemplate:function(){return{type:"pm_video_offer",userToId:a.getId(),sessionId:b()}},getAcceptTemplate:function(){return{type:"pm_video_accept",userToId:a.getId(),
sessionId:b()}},getIceCandidateTemplate:function(){return{type:"pm_video_ice_candidate",userToId:a.getId(),sessionId:b()}},send:c.send});this.acceptedOffer=c.acceptedOffer;this.incomingAccept=c.incomingAccept;this.iceCandidate=c.iceCandidate;return c}}(),Button=function(){return function(c){function a(){m?(l.classList.remove(k),m=!1):(l.classList.add(k),m=!0)}EventEnabledBuilder(this);var b=this,e=c.preventPropagation,f=c.className,h=c.classNames,k=c.classNameToggled,g=c.toggle,m=c.toggled?!0:!1;
c=c.text;var l=E.BUTTON();c&&(l.innerHTML=c);f&&l.classList.add(f);h&&each(h,function(a){l.classList.add(a)});g&&a();l.addEventListener("click",function(c){e&&(c=c||window.event,c.stopPropagation());b.dispatchEvent({type:"click"});g&&k&&(a(),b.dispatchEvent({type:"toggled",toggled:m}))});this.getElement=function(){return l}}}(),VideoButton=function(){return function(c){EventEnabledBuilder(this);var a=this,b=new Button(c),e=!1;this.setOn=function(a){e!=a&&(a?b.getElement().classList.add("on"):b.getElement().classList.remove("on"),
e=a)};this.getElement=b.getElement;b.addEventListener("click",function(){a.dispatchEvent({type:"click"})})}}(),ClickMenu=new function(){function c(a){var b=a.element;b.classList.add("click-menu");this.removeOptionEntry=function(a){b.removeChild(a.getElement())};this.addOptionEntry=function(a){b.appendChild(a.getElement())}}var a=function(){function a(a){var b=E.DIV();b.classList.add("option-entry");b.innerText=a.text;this.getElement=function(){return b}}return function(b){EventEnabledBuilder(this);
var c=this,e=new a({text:b.text,tooltip:b.tooltip});this.getElement=e.getElement;e.getElement().addEventListener("click",function(){b.callback();c.dispatchEvent({type:"hide"})})}}();return function(b){function e(b){each(b,function(b){b=new a(b);m.addOptionEntry(b);b.addEventListener("hide",h);k.push(b)})}function f(){each(k,function(a){m.removeOptionEntry(a)});k=[]}function h(a){g.hide()}EventEnabledBuilder(this);b.options&&e(b.options);console.log(Error().stack);var k=[],g=new Popup;b=g.getElement();
document.body.appendChild(b);var m=new c({element:b});this.show=function(a){a.options&&(f(),e(a.options));g.show()};this.setPosition=g.setPosition}},Dialog=function(){var c=function(a){function b(){f&&c()}function c(){k.dispose()}var f=a.disposeOnHide,h=a.message,k=new Popup({closeOnClickOff:!1}),g=k.getElement(),m=E.DIV();h=E.DIV();g.classList.add("dialog");m.classList.add("inner");h.classList.add("message");h.innerHTML=a.message;document.body.appendChild(k.getElement());k.getElement().appendChild(m);
m.appendChild(h);(function(a){each(a.buttons,function(a){var c=new Button({text:a.text,className:"dialog-button"});c.addEventListener("click",a.callback?function(){b();a.callback()}:b);m.appendChild(c.getElement())})})(a);this.show=function(){g.style.display="block"};this.dispose=c};c.show=function(a){a.disposeOnHide=!0;a=new c(a);a.show();return a};return c}(),SeenNotificationsManager=new function(){return function(c){var a=c.getSessionId,b=c.mysocket,e=new TemporalCallback({delay:4E3,callback:function(){console.log("sending seen notifications");
b.send({type:"seen_notifications",seenPmNotificationUserIds:f,sessionId:a()});f=[]},maxNTriggers:5,maxTotalDelay:15E3}),f=[];this.seen=function(a){a=a.getId();0>f.indexOf(a)&&f.push(a);e.trigger()}}},Notification=function(){var c=function(a){console.log(a);EventEnabledBuilder(this);var b=this;this.getNotificationType=function(){return a.notificationType};this.getIsPm=function(){return"pm"==b.getNotificationType()};this.getUsername=function(){return a.username};this.getImage=function(){return a.image};
this.getId=function(){return a.id};this.seen=function(){b.dispatchEvent({type:"seen",notification:b})}};c.PM="pm";c.pmNotificationFromJSON=function(a){return new c({notificationType:"pm",username:a.username,id:a.userId})};return c}(),NotificationsButton=function(){function c(a){a=a.button.getElement();var b=E.DIV(),c=E.DIV();b.appendChild(c);b.classList.add("count");c.classList.add("text");a.appendChild(b);this.setCount=function(a){c.innerHTML=9<a?"!":String(a)}}return function(a){function b(){h.setCount(f.getCount())}
var e=new Button({classNames:["button-notifications"]}),f=a.notifications,h=new c({button:e});f.addEventListener("added",b);f.addEventListener("removed",b);b();return e}}(),Notifications=function(){return function(){function c(a){b.dispatchEvent({type:"removed",notification:a})}EventEnabledBuilder(this);var a=new Set({getEntryId:function(a){return a.getId()}}),b=this;this.add=function(c){a.add(c)&&b.dispatchEvent({type:"added",notification:c})};this.remove=function(b){a.remove(b)&&c(b)};this.removeById=
function(b){if(b=a.getById(b))a.remove(b),c(b)};this.clear=function(){var c=a.getEntries().slice();each(c,b.remove)};this.getById=a.getById;this.getCount=a.count}}(),NotificationEntry=function(){function c(a){EventEnabledBuilder(this);var b=this,c=a.userImage,f=a.buttonClose,h=a.userId;a=a.text;var k=E.DIV();k.classList.add("notification-entry");var g=E.DIV();g.classList.add("inner");k.appendChild(g);h=new OnlineIndicatorUI(OnlineIndicators.get(h));var m=E.DIV();m.classList.add("username");g.appendChild(c.getElement());
g.appendChild(m);g.appendChild(f.getElement());g.appendChild(h.getElement());m.innerHTML=a;this.getElement=function(){return k};this.parentWidth=function(a){k.style.width=200>a?"100%":400>=a?"50%":600>=a?"33.3%":"25%"};g.addEventListener("click",function(){b.dispatchEvent({type:"click"})})}return function(a){function b(){e.dispatchEvent({type:"dispose",notification:a})}EventEnabledBuilder(this);var e=this,f=a.getIsPm(),h=new Button({className:"button-close",preventPropagation:!0}),k=new UserImage({userId:a.getId(),
username:a.getUsername()});k=new c({userImage:k,buttonClose:h,text:"PM from "+a.getUsername(),isPm:f,userId:f?a.getId():void 0});this.getElement=k.getElement;this.getId=a.getId;this.parentWidth=k.parentWidth;f&&(k.addEventListener("click",function(){e.dispatchEvent({type:"showpm",user:User.fromPmNotification(a),isNotification:!0});a.seen();b()}),h.addEventListener("click",b))}}(),NotificationsMenu=function(){function c(a){function b(){var a=g.clientWidth;each(k(),function(b){console.log(b);b.parentWidth(a)})}
var c=a.popup,f=a.buttonClose,h=c.getElement(),k=a.getEntries;h.classList.add("notifications-menu");var g=E.DIV();a=E.DIV();var m=new Heading({title:"&nbsp;PM Notifications"}),l=E.DIV(),n=E.DIV();n.classList.add("notifications-menu-inner");g.classList.add("entries");a.classList.add("entries-wrapper");l.classList.add("heading-wrapper");m.getEntries().appendChild(f.getElement());l.appendChild(m.getElement());n.appendChild(l);n.appendChild(a);a.appendChild(g);h.appendChild(n);this.show=function(){c.show();
b()};this.addEntry=function(a){g.appendChild(a.getElement())};this.removeEntry=function(a){g.removeChild(a.getElement())};this.getElement=function(){return h};this.getEntries=function(){return g};ResizeManager.add({element:h,onResized:b,staggered:!0}).manual(!0)}return function(a){function b(a){h.dispatchEvent(a);l&&l.hide()}function e(a){m.seen(a.notification)}function f(a){k.remove(a.notification)}EventEnabledBuilder(this);var h=this,k=a.notifications,g=a.pms,m=a.seenNotificationsManager,l=new Popup({});
a=new Button({className:"button-close"});var n=new c({popup:l,buttonClose:a,getEntries:function(){return p.getEntries()}}),p=new SortedFilteredEntries({compare:function(a,b){},getEntryId:function(a){return a.getId()},element:n.getEntries()});this.show=n.show;this.getElement=n.getElement;a.addEventListener("click",l.hide);k.addEventListener("added",function(a){a=a.notification;a.addEventListener("seen",e);a=new NotificationEntry(a);a.addEventListener("showpm",b);a.addEventListener("dispose",f);p.addEntry(a)});
k.addEventListener("removed",function(a){console.log(a);p.removeEntryById(a.notification.getId())});g.addEventListener("showingpm",function(a){a=a.user.getId();if(a=k.getById(a))k.remove(a),m.seen(a)})}}(),MissingUsersManager=new function(){return function(){this.get=function(c){};this.getRange=function(c){}}},Set=function(){return function(c){var a=this,b=c.getEntryId,e=[],f={};this.add=function(c){if(a.contains(c))return!1;e.push(c);f[b(c)]=c;return!0};this.remove=function(c){if(a.contains(c))return e.splice(e.indexOf(c),
1),delete f[b(c)],c};this.removeById=function(b){var c=a.getById(b);if(c)return e.splice(e.indexOf(c),1),delete f[b],c};this.count=function(){return e.length};this.contains=function(a){return f[b(a)]?!0:!1};this.getByIndex=function(a){return e[a]};this.getById=function(a){return f[a]};this.containsId=function(a){return f[a]?!0:!1};this.getIds=function(){return Object.keys(f)};this.getEntries=function(){return e};this.each=function(a){each(e,a)}}}();
function ReferenceCounter(c){var a=[];this.add=function(b){0<=a.indexOf(b)||a.push(b)};this.remove=function(b){b=a.indexOf(b);0>b||(a.splice(b,1),1>a.length&&c())}}
var User=function(){function c(a){EventEnabledBuilder(this);new ReferenceCounter;var b=this;this.getId=function(){return a.id};this.setId=function(b){a.id=b};this.getUsername=function(){return String(a.username)};this.getEmail=function(){return a.email};this.isGuest=function(){return a.isGuest};this.getGender=function(){return a.gender};this.getBirthday=function(){return a.birthday};this.getImage=function(){return a.image};this.setImage=function(b){a.image=b};this.toJSON=function(){return a};this.left=
function(){b.dispatchEvent({type:"left",user:b})}}var a=new Set({getEntryId:function(a){return a.getId()}});return{fromJSON:function(b){var e=a.getById(b.id);if(e)return e;e=new c(b);a.add(e);return e},fromMessage:function(b){var e=a.getById(b.getUserId());if(e)return e;e=new c({id:b.getUserId(),username:b.getUsername(),image:b.getImage()});a.add(e);return e},fromPmNotification:function(b){var e=a.getById(b.getId());if(e)return e;e=new c({id:b.getId(),username:b.getUsername(),image:b.getImage()});
a.add(e);return e},TYPE:"user"}}(),Users=function(){return function(c){function a(a){if(!f.remove(a))return!1;console.log("dispatchingt remove");e.dispatchEvent({type:"remove",user:a})}function b(b){a(b.user)}EventEnabledBuilder(this);var e=this,f=new Set({getEntryId:function(a){return a.getId()}});this.add=function(a){f.add(a)&&(a.addEventListener("left",b),e.dispatchEvent({type:"add",user:a}))};this.contains=f.contains;this.containsId=f.containsId;this.getById=f.getById;this.remove=function(c){c.removeEventListener("left",
b);a(c)};this.clear=function(){var a=f.getEntries().slice();each(a,e.remove)};this.getIds=f.getIds;this.getEntries=f.getEntries}}(),SortedFilteredEntries=new function(){return function(c){function a(c,e,f){var g=e-c;if(5>g){a:{for(;c<=e;c++)if(!b(f,k[c])){e=c;break a}e+=1}return e}g=Math.floor(g/2)+c;return b(f,k[g])?a(g+1,e,f):a(c,g,f)}var b=c.compare,e=c.element,f=c.getEntryId,h=this,k=[],g={};this.containsEntryId=function(a){return g[a]?!0:!1};this.getByEntryId=function(a){return g[a]};this.getEntries=
function(){return k};this.addEntry=function(b){var c=f(b);if(!g[c])if(g[f(b)]=b,1>k.length)k.push(b),e.appendChild(b.getElement());else{c=k.length-1;var h=a(0,c,b);h<=c?(e.insertBefore(b.getElement(),k[h].getElement()),k.splice(h,0,b)):(k.push(b),e.appendChild(b.getElement()))}};this.removeEntry=function(a){var b=k.indexOf(a);0>b||(k.splice(b,1),e.removeChild(a.getElement()),delete g[f(a)])};this.removeEntryById=function(a){(a=h.getByEntryId(a))&&h.removeEntry(a)};this.clear=function(){for(;0<k.length;){var a=
k.splice(0,1)[0];e.removeChild(a.getElement())}}}},OverlappingEntries=new function(){return function(c){function a(a){k.show(a.entry)}function b(a){k.hide(a.entry)}function e(a){g.remove(a);g.add(a);a.bringElementToFront()}function f(){return g.getEntries().slice().reverse().where(function(a){return a.getIsSetShow()}).firstOrDefault()}function h(a){var b=!1;a.getVisible()&&(b=!0);this.getId=function(){return a.getId()};this.getIsSetShow=function(){return b};this.setIsSetShow=function(a){b=a};this.setVisible=
function(b){a.setVisible(b)};this.bringElementToFront=function(){var b=a.getElement(),c=b.parentNode;c.removeChild(b);c.appendChild(b)};this.removeElement=function(){var b=a.getElement();b.parentNode.removeChild(b)};this.getString=function(){return(a.getName?a.getName():"")+b};this.getEntry=function(){return a}}var k=this,g=new Set({getEntryId:function(a){return a.getId()}}),m=c.element;this.show=function(a){var b=g.getById(a.getId());b&&(b.setIsSetShow(!0),g.each(function(a){return a.setVisible(a==
b)}),e(b))};this.hide=function(a){a=g.getById(a.getId());a.setVisible(!1);a.setIsSetShow(!1);(a=f(a))&&a.setVisible(!0)};this.add=function(c){if(!g.containsId(c.getId())){c.addEventListener("show",a);c.addEventListener("show",b);var e=new h(c);g.add(e);m.appendChild(c.getElement())}};this.remove=function(a){if(a=g.getById(a.getId()))g.remove(a),a.removeElement(),(a=f(a))&&a.setVisible(!0)};this.getTopEntry=function(){return g.getByIndex(g.count()-1)}}},ConnectedImage=function(){function c(a,c){if(a=
b[a])return a[c]}function a(a,c,e){var f=b[a];f?(a=f[c])?0>a.indexOf(e)&&a.push(e):f[c]=[e]:b[a]={id:[e]}}var b={},e=function(e){var f=e.id,k=e.type,g={connectedImage:this,set:function(a){n.src=a}},m=e.def;e=e.url;var l=E.DIV();l.classList.add("connected-image");var n=E.IMG();l.appendChild(n);var p=0;n.onerror=function(a){2>p++&&(n.src=m)};n.src=e?e:m;this.getElement=function(){return l};this.dispose=function(){var a=c(k,f);if(a){var e=a.indexOf(g);0>e||(a.splice(e,1),0<a.length||(delete b[k][f],
2>Object.keys(b[k]).length&&delete b[k]))}};a(k,f,g)};e.update=function(a,b,e){(a=c(a,b))&&each(a,function(a){a.set(e)})};return e}(),RoomImage=new function(){return function(c){return new ConnectedImage({def:"/images/room-default.gif",type:"room-image",id:c})}};
function PmsOpenHistory(c){function a(){var a=[];each(h.getEntries(),function(b){a.push(b.toJSON())});f.set("listUsers",a)}var b="PmsOpenHistory_"+e,e=c.userMeId,f=new Settings(b),h=new Set({getEntryId:function(a){return a.getId()}});new TabPortal({id:b});this.add=function(b){h.add(b);a()};this.remove=function(b){h.remove(b);a()};this.getUsers=h.getEntries;(function(){var a=f.get("listUsers");a?each(a,function(a){a=User.fromJSON(a);h.add(a)}):a=[]})()}
var Pms=function(){return function(c){function a(a){var b=h(a.getId());l.showRoom({id:b,name:"PM with "+a.getUsername(),isPm:!0,userTo:a});m.dispatchEvent({type:"showingpm",user:a})}function b(a){p.remove(a);a=h(a.getId());(a=l.getById(a))&&a.close()}function e(c){var e=c.message;console.log(c);switch(e.type){case "add":a(User.fromJSON(e.userTo));break;case "remove":b(User.fromJSON(e.userTo))}}function f(a){w&&w.sendMessage({type:"remove",userTo:a.toJSON()})}function h(a){return"pm_"+String(a)}function k(a){m.dispatchEvent({type:"addnotification",
notification:a})}function g(a){m.dispatchEvent({type:"addclosed",userTo:a})}EventEnabledBuilder(this);var m=this,l=c.rooms,n=c.getUserById,p,w;this.showPmWithUser=function(b){a(b);w&&w.sendMessage({type:"add",userTo:b.toJSON()})};this.closePmWithUser=function(a){b(a);f(a)};this.incomingMessage=function(a){var b=h(a.userId);(b=l.getById(b))?b.incomingMessage(a.message):k(Notification.pmNotificationFromJSON(a.message))};this.incomingMessages=function(a){var b=l.getById(h(a.userId));b?b.incomingMessages(a.messages):
k(Notification.pmNotificationFromJSON(a.message))};this.videoOfferFail=function(a){var b=l.getById(h(a.userToId));b&&b.videoOfferFail(a)};this.videoOffer=function(a){console.log(a);var b=l.getById(h(a.userFromId));b?(a.userFrom=n(a.userFromId),b.videoOffer(a)):m.dispatchEvent({type:"videoofferrejected",userToId:a.userFromId,reason:VideoOfferRejectedReasons.PM_NOT_OPEN})};this.videoAcceptFail=function(a){var b=l.getById(h(a.userToId));b&&b.videoAcceptFail(a)};this.videoAccept=function(a){var b=l.getById(h(a.userFromId));
b&&b.videoAccept(a.accept)};this.videoIceCandidate=function(a){console.log("video ice candidate");console.log(a);var b=l.getById(h(a.userFromId));console.log("roomId is: ");console.log(h(a.userFromId));console.log(b);b&&(console.log("video ice candidate b"),b.videoIceCandidate(a.candidate))};this.load=function(a){p=new PmsOpenHistory({userMeId:a});w=new TabPortal({id:"PmsMenu_"+a});w.addEventListener("message",e);a=p.getUsers();each(a,g)};this.videoOfferRejected=function(a){var b=l.getById(h(a.userFromId));
b&&b.videoOfferRejected(a)};l.addEventListener("showpm",function(a){console.log("called");m.showPmWithUser(a.user)});l.addEventListener("sendpm",function(a){return m.dispatchEvent(a)});l.addEventListener("getpms",function(a){return m.dispatchEvent(a)});l.addEventListener("createdroom",function(a){a=a.room;a.isPm()&&(a=a.getUserTo())&&(m.dispatchEvent({type:"add",userTo:a}),p.add(a))});l.addEventListener("destroyedroom",function(a){a=a.room;a.isPm()&&(a=a.getUserTo())&&(m.dispatchEvent({type:"remove",
userTo:a}),p.remove(a),f(a))})}}(),PmEntry=new function(){function c(a){EventEnabledBuilder(this);var b=this,c=a.userImage,f=a.buttonClose,h=new OnlineIndicatorUI(OnlineIndicators.get(a.userId)),k=E.DIV();k.classList.add("pm-entry");var g=E.DIV();g.classList.add("inner");k.appendChild(g);var m=E.DIV();m.classList.add("username");g.appendChild(c.getElement());g.appendChild(m);g.appendChild(f.getElement());g.appendChild(h.getElement());m.innerHTML=a.name;k.title="Open PM with "+a.name;this.getElement=
function(){return k};this.dispose=function(){c.dispose();h.dispose()};this.parentWidth=function(a){k.style.width=200>a?"100%":400>=a?"50%":600>=a?"33.3%":"25%"};g.addEventListener("click",function(){b.dispatchEvent({type:"click"})})}return function(a){EventEnabledBuilder(this);var b=this,e=a.userTo;a=new Button({className:"button-close",preventPropagation:!0});var f=new UserImage({userId:e.getId(),username:e.getUsername()});f=new c({userImage:f,name:e.getUsername(),buttonClose:a,userId:e.getId()});
this.getId=function(){return e.getId()};this.getUsername=function(){return e.getUsername()};this.getElement=f.getElement;this.setVisible=f.setVisible;this.parentWidth=f.parentWidth;this.dispose=f.dispose;f.addEventListener("click",function(){b.dispatchEvent({type:"showpm",user:e})});a.addEventListener("click",function(){b.dispatchEvent({type:"closepm",user:e,pmEntry:b})})}},PmsMenu=new function(){function c(a){function b(){var a=m.clientWidth;each(g(),function(b){b.parentWidth(a)});k()}var c=a.popup,
f=window.isMobile?c.getElement():E.DIV(),h=a.buttonClose,k=a.onResized,g=a.getEntries,m=E.DIV();a=E.DIV();var l=E.DIV();if(window.isMobile){document.body.appendChild(c.getElement());var n=new Heading({title:"&nbsp;Pms "}),p=E.DIV();p.classList.add("heading-wrapper");n.getEntries().appendChild(h.getElement());p.appendChild(n.getElement());l.appendChild(p)}l.classList.add("pms-menu-inner");f.classList.add("pms-menu");a.classList.add("entries-wrapper");m.classList.add("entries");a.appendChild(m);l.appendChild(a);
f.appendChild(l);this.getElement=function(){return f};this.setVisible=function(a){m.style.display=a?"block":"none"};this.getEntries=function(){return m};this.show=function(){c.show();b()};this.checkResized=function(){w.manual(!0)};var w=ResizeManager.add({element:f,onResized:b,staggered:!0});w.manual(!0);this.resize=b}ImagePreloader.preloadRange(["/images/close.jpg","/images/close-hover.jpg"]);return function(a){function b(a){a=new PmEntry({userTo:a.userTo});a.parentWidth(l.getElement().clientWidth);
a.addEventListener("showpm",f);a.addEventListener("closepm",h);p.addEntry(a);l.checkResized()}function e(a){a&&(p.removeEntry(a),l.checkResized(),a.dispose())}function f(a){n.showPmWithUser(a.user);g&&g.hide()}function h(a){p.removeEntry(a.pmEntry);l.checkResized();n.closePmWithUser(a.user)}EventEnabledBuilder(this);var k=this,g=window.isMobile?new Popup({}):void 0,m=window.isMobile?new Button({className:"button-close"}):void 0,l=new c({popup:g,buttonClose:m,getEntries:function(){return p.getEntries()},
onResized:function(){k.dispatchEvent({type:"resized"})}}),n=a.pms,p=new SortedFilteredEntries({getEntryId:function(a){return a.getId()},element:l.getEntries(),compare:function(a,b){return a.getUsername()>b.getUsername()}});this.getElement=l.getElement;this.setVisible=l.setVisible;this.show=l.show;this.clear=function(){each(p.getEntries().slice(),e)};this.resize=l.resize;n.addEventListener("add",function(a){b(a)});n.addEventListener("remove",function(a){a=p.getByEntryId(a.userTo.getId());a.dispose();
e(a)});n.addEventListener("addclosed",function(a){b(a)});m&&m.addEventListener("click",g.hide)}},RoomEntry=new function(){function c(a){var b=E.DIV();b.classList.add("room-entry");var c=E.DIV();c.classList.add("inner");c.appendChild(a.roomImage.getElement());b.appendChild(c);var f=E.DIV();f.classList.add("name");f.innerHTML=a.name;c.appendChild(f);b.title=a.name;this.getElement=function(){return b};this.parentWidth=function(a){b.style.width=200>a?"100%":400>=a?"50%":600>=a?"33.3%":"25%"}}return function(a){EventEnabledBuilder(this);
var b=this,e=new RoomImage,f=new c({name:a.name,roomImage:e});this.getId=function(){return a.id};this.getElement=f.getElement;this.parentWidth=f.parentWidth;f.getElement().addEventListener("click",function(){b.dispatchEvent({type:"selected",roomInfo:a})});this.dispose=e.dispose}},Room=new function(){function c(a){function b(a){p.setOn(!0);I.setVisible(!0)}function c(){p.setOn(!1);I.setVisible(!1)}function f(a){a=Message.error({message:a.message});w(a)}EventEnabledBuilder(this);var h=this,k=!1,g=a.buttonSend,
m=a.buttonExit,l=a.buttonEmoticons,n=a.buttonClose,p=a.buttonVideoPmStart,w=a.addMessage,q=a.videoFeed,t=a.videoPmOfferRejected;a=a.spinner;var r=E.DIV();r.classList.add("room");var v=E.DIV();v.classList.add("top");var u=E.DIV();u.classList.add("bottom");var z=E.DIV();z.classList.add("feed");var K=E.DIV();K.classList.add("menu");var B=E.TEXT();B.classList.add("text");if(q){q=new VideoFeedUI(q);var J=new SplitPane({nPanelsWidth:1,nPanelsHeight:2,rowProfiles:[{height:"200px"}]});var D=J.getPanelXY(0,
0).getElement();var I=J.getPanelRow(0);D.classList.add("video-feed-panel");D.appendChild(q.getElement());v.appendChild(J.getElement());J.getPanelXY(0,1).getElement().appendChild(z);c();(new Task(J.resize)).run();q.addEventListener("show",b);q.addEventListener("hide",c);q.addEventListener("showmessagetouser",f);q.addEventListener("offerrejected",t)}else v.appendChild(z);r.appendChild(v);r.appendChild(u);r.appendChild(a.getElement());u.appendChild(B);u.appendChild(K);K.appendChild(l.getElement());K.appendChild(g.getElement());
K.appendChild(m.getElement());K.appendChild(n.getElement());p&&K.appendChild(p.getElement());B.addEventListener("keypress",function(a){a||(a=window.events);h.dispatchEvent({type:"keypress",keyCode:a.keyCode||a.which})});this.getElement=function(){return r};this.getFeed=function(){return z};this.setVisible=function(a){k=a;r.style.display=a?"block":"none"};this.getVisible=function(){return k};this.getTextValue=function(){return B.value};this.addMessage=function(a){z.appendChild(a.getElement())};this.removeMessage=
function(a){z.removeChild(a.getElement())};this.insertIntoTextAtCurrentIndex=function(a){var b=B.selectionStart;if(a){if(void 0==b)B.value+=a;else{var c=b+a.length;B.value=B.value.splice(b,0,a);B.selectionStart=B.selectionEnd=c}B.focus()}};this.clearText=function(){B.value=""};this.scrollFeedToBottom=function(){z.scrollTop=z.scrollHeight};this.feedIsAtBottom=function(){return z.scrollTop>=z.scrollHeight-z.offsetHeight-10};this.resize=function(){console.log("Room.UI.resize");J&&J.resize()}}return function(a){function b(a){a.emoticonsParser=
t;a.clickMenuUser=J;a.ignoreManager=B;a.getUserMe=l;C.addReceived(Message.fromJSON(a))}function e(){K.start()}function f(){C.dispose();g.dispatchEvent({type:"dispose",room:g})}function h(){var a=H.getTextValue();if(""!=a){var b=l();a=Message.fromTypedString({str:a,userId:b.getId(),username:b.getUsername(),uniqueId:C.nextUniqueId(),emoticonsParser:t,pending:!0,clickMenuUser:J,getUserMe:l,image:b.getImage()});console.log(a);g.dispatchEvent(g.isPm()?{type:"sendpm",userToId:g.getUserTo().getId(),message:a}:
{type:"sendmessage",message:a,roomId:v});C.addSending(a);H.clearText();H.scrollFeedToBottom()}}function k(a){H.insertIntoTextAtCurrentIndex(a.getStringRepresentation())}console.log(a);EventEnabledBuilder(this);var g=this,m=a.send,l=a.getUserMe,n=a.getUserById,p=a.getNDevice,w=a.getSessionId,q=a.showUsersSearch,t=a.emoticonsParser,r=a.name,v=a.id,u=a.isPm,z=a.userTo;if(u){var K=new VideoFeedPm({userTo:z,getSessionId:w,send:m});this.videoOffer=K.incomingOffer;this.videoAccept=K.incomingAccept;this.videoIceCandidate=
K.incomingIceCandidate}var B=a.ignoreManager,J=a.clickMenuUser,D=new Users({getUserById:n}),I=new UsersMenu({name:a.isPm?"PM with "+a.userTo.getUsername():r+" Users",users:D,id:v,ignoreManager:B,clickMenu:J,getUserMe:l,showUsersSearch:q});m=new Button({className:"button-send",text:"Send"});n=new Button({className:"button-emoticons"});w=new Button({className:"button-exit"});q=new Button({className:"button-close"});r=u?new VideoButton({className:"button-video-pm-start"}):void 0;var F=new Spinner({});
F.show();var H=new c({buttonSend:m,buttonEmoticons:n,buttonExit:w,buttonClose:q,buttonVideoPmStart:r,spinner:F,videoFeed:K,addMessage:function(a){var b=H.feedIsAtBottom();C.add(a);b&&H.scrollFeedToBottom()},videoPmOfferRejected:function(a){console.log(a);g.dispatchEvent({type:"videopmofferrejected",userToId:z.getId(),reason:a.reason})}}),C=new Messages({getUserId:function(){var a=l();if(a)return a.getId()},element:H.getFeed(),maxNMessages:100,ignoreManager:B,getNDevice:p});D.addEventListener("missingusers",
g.dispatchEvent);this.getId=function(){return a.id};this.getName=function(){return a.name};this.getUsersMenu=function(){return I};this.getUserTo=function(){return a.userTo};this.isPm=function(){return u};this.incomingMessage=function(a){var c=H.feedIsAtBottom();b(a);c&&H.scrollFeedToBottom()};this.incomingMessages=function(a){var c=H.feedIsAtBottom();each(a,function(a){b(a)});c&&H.scrollFeedToBottom();F.hide()};C.addEventListener("showpm",function(a){g.dispatchEvent(a)});this.join=function(a){D.contains(a)||
D.add(a)};this.leave=function(a){D.contains(a)&&D.remove(a)};this.close=f;this.getUsers=function(){return D};this.getElement=H.getElement;this.setVisible=function(a){var b=H.getVisible();!b&&a?I.show():b&&!a&&I.hide();H.setVisible(a);a&&(new Task(function(){H.resize();H.scrollFeedToBottom()})).run()};this.getVisible=H.getVisible;this.videoOfferFail=function(a){K.stop();Dialog.show({message:"Starting video chat with "+z.getUsername()+" failed as they are offline!",buttons:[{text:"OK"}]})};this.videoOfferRejected=
function(a){K.stop();Dialog.show({message:a.reason,buttons:[{text:"OK"}]})};this.resize=H.resize;m.addEventListener("click",h);n.addEventListener("click",function(){g.dispatchEvent({type:"showemoticons",picked:k})});q.addEventListener("click",f);w.addEventListener("click",function(){g.dispatchEvent({type:"hide",room:g})});r&&r.addEventListener("click",e);H.addEventListener("keypress",function(a){if("13"==a.keyCode)return h(),!1});(new Task(function(){g.dispatchEvent(g.isPm()?{type:"getpms",userToId:g.getUserTo().getId()}:
{type:"getmessages",roomId:v});g.dispatchEvent({type:"getuserids",roomId:v});g.isPm()&&(D.add(a.userTo),D.add(l()))})).run()}},MessageComponents=new function(){this.Text=function(c){this.getString=function(){return c};this.getElement=function(){return document.createTextNode(c)};this.TYPE="text"};this.Text.TYPE="text";this.Emoticon=function(c){this.getElement=function(){if(c.isCharacter())return document.createTextNode(c.getStringRepresentation());var a=E.IMG();a.classList.add("emoticon");a.src=c.getImageSource();
return a};this.TYPE="emoticon"};this.Emoticon.TYPE="emoticon"};
function MessageUI(c){function a(a){a=moment.utc(a).local();var b=moment();moment.duration(b.diff(a));var c=moment().startOf("day");b=a.format("HH:mm:ss");if(0<=a.diff(c,"seconds"))return b;c=c.diff(a,"seconds");if(604800>c)return a=a.format("dddd")+" at "+b,518400>c?a:"last "+a;b=a.isSame(new Date,"year");c=a.format("Do")+" "+a.format("MMMM");return b?c:c+" "+a.year()}EventEnabledBuilder(this);var b=this,e=c.components,f=c.username,h=c.userImage,k=c.sentAt,g=c.messageType,m=E.DIV();m.classList.add("message");
var l=E.DIV();l.classList.add("inner");var n=E.DIV();n.classList.add("username-and-timestamp");var p=E.DIV();p.classList.add("username");if(c.pending){var w=E.DIV();w.classList.add("pending");m.appendChild(w)}n.appendChild(p);c=E.DIV();c.classList.add("timestamp");n.appendChild(c);switch(g){case Message.ERROR:m.classList.add("error");c.innerHTML=" ("+a(new Date)+")";break;default:l.appendChild(h.getElement()),p.innerHTML+=f&&0<f.length?f:"&nbsp;",k&&(c.innerHTML=" ("+a(k)+")")}l.appendChild(n);each(e,
function(a){l.appendChild(a.getElement())});m.appendChild(l);this.getElement=function(){return m};this.getUsername=function(){return n};this.setVisible=function(a){m.style.display=a?"inline-block":"none"};this.hidePending=function(){w&&m.removeChild(w)};p.addEventListener("click",function(a){b.dispatchEvent({type:"showusermenu",left:a.clientX,top:a.clientY})})}
var Message=function(){function c(a,c){c||(c="");var b=a.emoticonsParser,e=[],k=new MessageComponents.Text(c);b?b.pipe(k,function(a){e.push(a)}):e=[k];return new Message({userId:a.userId,username:a.username,uniqueId:a.uniqueId,components:e,content:c,serverAssignedNMessage:a.serverAssignedNMessage,pending:a.pending,clickMenuUser:a.clickMenuUser,ignoreManager:a.ignoreManager,getUserMe:a.getUserMe,image:a.image,sentAt:a.sentAt,messageType:a.messageType})}var a=function(a){function b(){K||(K=new MessageUI({userImage:t,
components:p,username:n,pending:a.pending,sentAt:m.getSentAtUTC(),messageType:u}),K.addEventListener("showusermenu",c));return K}function c(a){l!=v().getId()&&(q.setPosition(a),q.show({options:[{text:"Pm "+n,callback:h},{text:(z?"Unignore ":"Ignore ")+n,callback:z?g:k}]}))}function h(){m.dispatchEvent({type:"showpm",user:User.fromMessage(m)})}function k(){r.ignoreUserByIdAndUsername({id:l,username:n})}function g(){r.unignoreUserById(l)}EventEnabledBuilder(this);var m=this,l=a.userId,n=a.username,
p=a.components,w=a.content,q=a.clickMenuUser,t=new UserImage({userId:l,image:a.image}),r=a.ignoreManager,v=a.getUserMe,u=a.messageType?a.messageType:"user",z=!1,K;this.getElement=function(){return b().getElement()};this.getUniqueId=function(){return a.uniqueId};this.getImage=function(){return a.image};this.getUserId=function(){return a.userId};this.getUsername=function(){return a.username};this.getSentAtUTC=function(){return a.sentAt?moment(a.sentAt):void 0};this.getServerAssignedNMessage=function(){return a.serverAssignedNMessage};
this.getMessageType=function(){return u};this.confirm=function(c){a.serverAssignedNMessage=c.getServerAssignedNMessage();b().hidePending()};this.toJSON=function(){return{content:w,userId:l,uniqueId:a.uniqueId}};this.dispose=function(){t.dispose()};this.setIgnored=function(a){z=a;b().setVisible(!z)};this.getIgnored=function(){return z}};a.ERROR="error";a.USER="user";a.fromJSON=function(a){console.log(a);return c(a,a.content)};a.fromTypedString=function(a){a.sentAt=moment().format();return c(a,a.str)};
a.error=function(a){a.messageType="error";return c(a,a.message)};return a}(),Messages=new function(){var c=0;return function(a){function b(a){a.addEventListener("showpm",f);p.push(a);w[a.getUniqueId()]=a;n.appendChild(a.getElement())}function e(a){var b=p.indexOf(a);0>b||(p.splice(b,1),delete w[a.getUniqueId()],n.removeChild(a.getElement()),a.removeEventListener("showpm",f))}function f(a){g.dispatchEvent(a)}function h(a){p.where(function(b){return b.getUserId()==a.userId}).each(function(a){return a.setIgnored(!0)})}
function k(a){p.where(function(b){return b.getUserId()==a.userId}).each(function(a){return a.setIgnored(!1)})}EventEnabledBuilder(this);var g=this,m=a.getNDevice,l=a.ignoreManager,n=a.element,p=[],w={},q=new OverflowManager({getMessages:function(){return p},remove:e,maxNMessages:a.maxNMessages});this.addSending=function(a){b(a);q.trigger()};this.addReceived=function(a){var b=w[a.getUniqueId()];if(b)b.confirm(a);else a:if(w[a.getUniqueId()]=a,a.addEventListener("showpm",f),1>p.length)p.push(a),n.appendChild(a.getElement());
else{var c=a.getServerAssignedNMessage();for(b=new ReverseIterator(p);b.hasNext();)if(b.next().getServerAssignedNMessage()<c){if(b.hasPrevious()&&(c=b.previous().getElement().nextSibling)){n.insertBefore(a.getElement(),c);b.insertAfter(a);break a}n.appendChild(a.getElement());b.append(a);break a}n.insertBefore(a.getElement(),p[0].getElement());b.insert(a)}l.userIdIsIgnored(a.getUserId())&&a.setIgnored(!0);q.trigger()};this.add=function(a){w[a.getUniqueId()]=a;b(a)};this.remove=function(a){e(a)};this.nextUniqueId=
function(){return m()+"_"+c++};this.dispose=function(){each(p,function(a){a.dispose()});l.removeEventListener("ignored",h);l.removeEventListener("unignored",k)};l.addEventListener("ignored",h);l.addEventListener("unignored",k)}},EmoticonsLibrary={defaultFolder:"/emoji/",folders:{folderName:"/path"},emoticons:[{strings:[":)","/smile",":smile:"],file:"smile.png"},{strings:[":p",":P","/tongue",":tongue:"],file:"stuck_out_tongue.png"},{strings:[":D",":d","/grin",":grin:"],file:"grinning.png"},{strings:["/kiss",
":kiss:",":*",":-*"],file:"kissing_heart.png"},{strings:[":cry:",":'",":,("],file:"cry.png"},{strings:["/shocked",":shocked:","anguished,",":O",":O"],file:"anguished.png"},{strings:["/blush",":blush:"],file:"blush.png"},{strings:"/speachless /shocked :speachless: :shocked: :O :o".split(" "),file:"open_mouth.png"},{strings:["/laugh",":laugh:"],file:"laughing.png"},{strings:["/angry",":angry:"],file:"angry.png"},{strings:["/anguished",":anguished:"],file:"anguished.png"},{strings:["/disappointed",":disappointed:"],
file:"disappointed.png"},{strings:["/frowning",":frowning:"],file:"frowning.png"},{strings:["/heart eyes",":heart eyes:"],file:"heart_eyes.png"},{strings:["/innocent eyes",":innocent:"],file:"innocent.png"},{strings:["/laughing",":laughing:"],file:"laughing.png"},{strings:["/mask",":mask:"],file:"mask.png"},{strings:["/neutral",":neutral:"],file:"neutral_face.png"},{strings:["/imp",":imp:"],file:"smiling_imp.png"},{strings:["/rage",":rage:"],file:"rage.png"},{strings:["/scream",":scream:"],file:"scream.png"},
{strings:["/sleeping",":sleeping:"],file:"sleeping.png"},{strings:["/smirk",":smirk:"],file:"smirk.png"},{strings:["/sunglasses",":sunglasses:"],file:"sunglasses.png"},{strings:["/unamused",":unamused:"],file:"unamused.png"},{strings:["/wink",":wink:"],file:"wink.png"},{strings:["/yum",":yum:"],file:"yum.png"},{strings:[":/","/confused",":confused:"],file:"confused.png"},{strings:["/alien",":alien:"],file:"alien.png"},{strings:["/poop",":poop:","/hankey",":hankey:"],file:"hankey.png"},{strings:["/heart",
":heart:"],file:"heart.png"},{strings:["/broken heart",":broken heart:"],file:"broken_heart.png"},{strings:["/dog",":dog:"],file:"dog.png"},{strings:["/bear",":bear:"],file:"bear.png"},{strings:["/cat",":cat:"],file:"cat.png"},{strings:["/chick",":chick:"],file:"baby_chick.png"},{strings:["/chicken",":chicken:"],file:"chicken.png"},{strings:["/cow",":cow:"],file:"cow.png"},{strings:["/fish",":fish:"],file:"fish.png"},{strings:["/dolphin",":dolphin:"],file:"dolphin.png"},{strings:["/frog",":frog:"],
file:"frog.png"},{strings:["/ghost",":ghost:"],file:"ghost.png"},{strings:["/hamster",":hamster:"],file:"hamster.png"},{strings:["/horse",":horse:"],file:"horse.png"},{strings:["/koala",":koala:"],file:"koala.png"},{strings:["/mouse",":mouse:"],file:"mouse.png"},{strings:["/penguin",":penguin:"],file:"penguin.png"},{strings:["/pig",":pig:"],file:"pig.png"},{strings:["/rabbit",":rabbit:"],file:"rabbit.png"},{strings:["/bear",":bear:"],file:"bear.png"},{strings:["/snake",":snake:"],file:"snake.png"},
{strings:["/whale",":whale:"],file:"whale.png"},{strings:["/wolf",":wolf:"],file:"wolf.png"},{strings:["/cookie",":cookie:"],file:"cookie.png"},{strings:["/coffee",":coffee:"],file:"coffee.png"},{strings:["/banana",":banana:"],file:"banana.png"},{strings:["/bread",":bread:"],file:"bread.png"},{strings:["/cake",":cake:"],file:"cake.png"},{strings:["/chocolate",":chocolate:"],file:"chocolate_bar.png"},{strings:["/fries",":fries:"],file:"fries.png"},{strings:["/apple",":apple:"],file:"apple.png"},{strings:["/hamburger",
":hamburger:"],file:"hamburger.png"},{strings:["/icecream",":icecream:"],file:"icecream.png"},{strings:["/lollipop",":lollipop:"],file:"lollipop.png"},{strings:["/strawberry",":strawberry:"],file:"strawberry.png"},{strings:["/watermelon",":watermelon:"],file:"watermelon.png"},{strings:["/wine",":wine:"],file:"wine_glass.png"},{strings:["/smoking",":smoking:"],file:"smoking.png"},{strings:["/uk",":uk:"],file:"uk.png"},{strings:["/us",":us:"],file:"us.png"},{strings:["/car",":car:"],file:"car.png"},
{strings:["/train",":train:"],file:"steam_locomotive.png"},{strings:["/bus",":bus:"],file:"bus.png"},{strings:["/lorry",":lorry:"],file:"articulated_lorry.png"},{strings:["/taxi",":taxi:"],file:"taxi.png"},{strings:["/bank",":bank:"],file:"bank.png"},{strings:["/church",":church:"],file:"church.png"},{strings:["/hotel",":hotel:"],file:"hotel.png"},{strings:["/hospital",":hospital:"],file:"hospital.png"},{strings:["/convenience",":convenience:"],file:"convenience_store.png"},{strings:["/money",":money:"],
file:"dollar.png"},{strings:["/pound",":pound:"],file:"pound.png"},{strings:["/moneybag",":moneybag:"],file:"moneybag.png"}]};function EmoticonInfo(c){var a=this;this.isCharacter=function(){return a.getCharacter()?!0:!1};this.getCharacter=function(){return c.character};this.getImageSource=function(){return c.imageSource};this.getStringRepresentation=function(){return a.isCharacter()?a.getCharacter():c.strings[0]}}
var EmoticonsParser=function(){return function(c){function a(a,c){if(!(1>a.length)){var e=b;each(a,function(a){var b=e[a];b?e=b:(b={},e=e[a]=b)});e.emoticonInfo=c}}var b={};(function(b){each(b.emoticons,function(b){var c=new EmoticonInfo(b);b.strings&&each(b.strings,function(b){a(b,c)})})})(c.emoticonsLibrary);this.pipe=function(a,c){if(a.TYPE!=MessageComponents.Text.TYPE)c(a);else{a=a.getString();for(var e={value:0},f=a.length,g=0;e.value<f;){var m=b[a[e.value]];if(m){var l=e.value;a:{var n=void 0;
for(var p=e,w=f,q=a;;){p.value++;m.emoticonInfo&&(n=m.emoticonInfo);if(p>=w)break a;m=m[q[p.value]];if(!m)break a}}n&&(l>g&&c(new MessageComponents.Text(a.substring(g,l))),c(new MessageComponents.Emoticon(n)),g=e.value)}else e.value++}e.value>g&&c(new MessageComponents.Text(a.substring(g,e.value)))}}}}(),EmoticonEntry=function(){function c(a){var b=E.IMG();b.src=a.getImageSource();b.addEventListener("error",function(){b.style.display="none"});this.getElement=function(){return b}}return function(a){var b=
this;EventEnabledBuilder(this);var e=E.DIV();e.classList.add("emoticon-entry");var f=a.emoticonInfo;f.isCharacter()?e.innerHTML=f.getCharacter():(a=new c(f),e.appendChild(a.getElement()));e.addEventListener("click",function(){b.dispatchEvent({type:"selected",emoticonInfo:f})});this.getElement=function(){return e}}}(),Emoticons=function(){function c(a){var b=a.popup.getElement();b.classList.add("emoticons");var c=E.DIV();c.classList.add("entries");b.appendChild(c);this.addEntry=function(a){c.appendChild(a.getElement())};
this.getElement=function(){return b};this.setVisible=function(a){b.style.display=a?"block":"none"}}return function(a){function b(a){a=a.emoticonInfo;k&&k(a);f.hide()}var e=a.emoticonsLibrary;EventEnabledBuilder(this);var f=new Popup,h=new c({popup:f}),k;this.show=function(a){k=a.picked;f.show()};this.getElement=h.getElement;this.setVisible=h.setVisible;(function(){var a=e.folders,c=e.defaultFolder;each(e.emoticons,function(e){if(!e.character){var f=e.folder&&a?a[e.folder]:c;f+=e.file;e.imageSource=
f}e=new EmoticonEntry({emoticonInfo:new EmoticonInfo(e)});e.addEventListener("selected",b);h.addEntry(e)})})()}}(),RoomsMenu=new function(){function c(a){var b=a.entries;a=a.showRoomsSearch;var c=!1,f=E.DIV();f.classList.add("rooms-menu");var h=new Button({className:"button-search"});f.appendChild(h.getElement());h.addEventListener("click",a);this.getElement=function(){return f};this.add=function(a){f.appendChild(a)};this.remove=function(a){f.removeChild(a)};this.setVisible=function(a){c=a;f.style.display=
a?"block":"none"};this.getVisible=function(){return c};this.resize=function(){var a=f.clientWidth;each(b,function(b){b.parentWidth&&b.parentWidth(a)})}}return function(a){function b(a){a.dispose();delete h[a.getId()];k.splice(k.indexOf(a),1);g.remove(a.getElement())}function e(a){f.dispatchEvent({type:"showroom",roomInfo:a.roomInfo})}EventEnabledBuilder(this);var f=this,h={},k=[],g=new c({entries:k,showRoomsSearch:a.showRoomsSearch}),m=a.usersMenu;new Spinner({});this.getId=function(){return"RoomsMenu"};
this.set=function(a){var c=[];each(a,function(a){var b=h[a.id];b||(console.log("add"),a=new RoomEntry(a),k.push(a),h[a.getId()]=a,g.add(a.getElement()),a.addEventListener("selected",e),b=a);c.push(b.getId())});for(var f in h)0>c.indexOf(f)&&b(h[f]);g.resize()};this.getName=function(){return"roomsmenu"};this.getElement=g.getElement;this.setVisible=function(a){var b=g.getVisible();!b&&a?m.show():b&&!a&&m.hide();g.setVisible(a)};this.clear=function(){for(var a in h)b(h[a])};this.getVisible=g.getVisible;
this.resize=g.resize}},SearchBar=function(){function c(a){var b=a.callbackSearch,c=new TemporalCallback({callback:function(){b(k.value)},maxTotalDelay:1200,delay:400}),f=E.DIV();a=E.DIV();var h=E.DIV(),k=E.TEXT(),g=E.BUTTON();f.classList.add("search-bar");a.classList.add("search-bar-text-wrapper");h.classList.add("search-bar-button-wrapper");k.classList.add("search-bar-text");g.classList.add("search-bar-button");f.appendChild(a);f.appendChild(h);a.appendChild(k);h.appendChild(g);this.getElement=function(){return f};
k.addEventListener("keydown",function(){c.trigger()})}return function(a){EventEnabledBuilder(this);var b=this;this.getElement=(new c({callbackSearch:function(a){b.dispatchEvent({type:"search",text:a})}})).getElement}}(),RoomsSearch=function(){return function(){function c(a){var c=[];each(a,function(a){k.getByEntryId(a.id)||(a=new RoomEntry(a),k.addEntry(a),a.addEventListener("selected",e))});for(var f in k.getEntries().slice())0>c.indexOf(f)&&b(f)}function a(a){return a.getId()}function b(a){a=k.getByEntryId(a);
k.removeEntry(a)}function e(a){h.hide();f.dispatchEvent({type:"showroom",roomInfo:a.roomInfo})}EventEnabledBuilder(this);var f=this,h=new StandardSearch({title:"Rooms Search",getEntryId:a,callbackSearch:function(a){!a.text||1>a.text.length||f.dispatchEvent({type:"search",text:a.text})},classNames:["rooms-search"]}),k=new SortedFilteredEntries({element:h.getEntries(),getEntryId:a,compare:function(a,b){return a.getName()>b.getName()}});this.show=h.show;this.incomingRooms=function(a){c(a)}}}(),UsersSearch=
function(){return function(c){function a(a){return a.getId()}function b(a){var b=[];each(a,function(a){b.push(a.id);g.getById(a.id)||g.add(User.fromJSON(a))});each(g.getEntries().slice(),function(a){0>b.indexOf(a.getId())&&g.remove(a)})}EventEnabledBuilder(this);var e=this,f=c.clickMenu,h=c.ignoreManager,k=c.getUserMe,g=new Users({}),m=new StandardSearch({title:"Users Search",getEntryId:a,callbackSearch:function(a){!a.text||1>a.text.length||(e.dispatchEvent({type:"search",text:a.text}),m.showSpinner())},
classNames:["users-search"]}),l=new SortedFilteredEntries({element:m.getEntries(),getEntryId:a,compare:function(a,b){return a.getUsername()>b.getUsername()}});this.show=m.show;this.incomingUsers=function(a){b(a);m.hideSpinner()};g.addEventListener("add",function(a){l.getByEntryId(a.user.getId())||(a=new UserEntry({user:a.user,clickMenu:f,ignoreManager:h,getUserMe:k}),l.addEntry(a),a.addEventListener("showpm",function(a){e.dispatchEvent(a)}))});g.addEventListener("remove",function(a){a=l.getByEntryId(a.user.getId());
a.dispose();l.removeEntry(a)})}}(),UserImage=new function(){function c(a,c){return a?"/images/uploaded/"+a+"_"+c+".jpeg":void 0}var a=function(a){var b=a.userId,f=a.image;a=(a=a.size)?a:"32_32";b=new ConnectedImage({def:"/images/user-default.jpg",type:User.TYPE+"_"+a,id:b,url:c(f,a)});this.getElement=b.getElement;this.dispose=b.dispose};a.LARGE="128_128";a.SMALL="32_32";a.SIZES=["32_32","128_128"];a.update=function(b,e){each(a.SIZES,function(a){var f=c(e,a);f&&ConnectedImage.update(User.TYPE+"_"+
a,b,f)})};return a},UserEntry=function(){function c(a){var b=a.userImage,c=new OnlineIndicatorUI(OnlineIndicators.get(a.userId)),h=E.DIV();h.classList.add("user-entry");var k=E.DIV();k.classList.add("inner");h.appendChild(k);var g=E.DIV();g.classList.add("username");k.appendChild(b.getElement());k.appendChild(g);k.appendChild(c.getElement());h.title=a.name;g.innerHTML=a.name;this.getElement=function(){return h};this.dispose=function(){b.dispose();c.dispose();console.log("disposed")}}var a=function(a){function b(){k.dispatchEvent({type:"showpm",
user:g})}function f(){l.ignoreUser(g)}function h(){l.unignoreUser(g)}EventEnabledBuilder(this);var k=this,g=a.user,m=a.getUserMe,l=a.ignoreManager,n=a.clickMenu;a=new UserImage({userId:g.getId(),username:g.getUsername()});a=new c({name:g.getUsername(),userImage:a,userId:g.getId()});this.getElement=a.getElement;this.getId=function(){return g.getId()};this.getUsername=g.getUsername;this.dispose=a.dispose;a.getElement().addEventListener("click",function(a){n.setPosition({left:a.clientX,top:a.clientY});
if(m()!=g){a=l.userIsIgnored(g);var c=g.getUsername();n.show({options:[{text:"Pm "+c,callback:b},{text:(a?"Unignore ":"Ignore ")+c,callback:a?h:f}]})}})};a.fromIgnored=function(b){return new a(b)};return a}(),UsersMenu=function(){function c(a){var b=a.buttonClose,c=a.buttonSearch,f=!1,h=E.DIV(),k=E.DIV(),g=E.DIV(),m=E.DIV(),l=E.DIV(),n=E.DIV(),p=E.DIV(),w=new SplitPane({nPanelsWidth:1,nPanelsHeight:2,rowProfiles:[{height:"70%",minHeight:"60px"},{minMeight:"60px"}]}),q=w.getPanelXY(0,0).getElement(),
t=w.getPanelXY(0,1).getElement();a=new Heading({title:"&nbsp;"+a.name});var r=new Heading({title:"&nbsp;Ignored "});h.classList.add("users-menu");k.classList.add("users-menu-entries");l.classList.add("users-menu-entries");m.classList.add("heading-wrapper");g.classList.add("user-menu-entries-wrapper");p.classList.add("heading-wrapper");n.classList.add("user-menu-entries-wrapper");m.appendChild(a.getElement());g.appendChild(k);p.appendChild(r.getElement());n.appendChild(l);h.appendChild(w.getElement());
q.appendChild(m);q.appendChild(g);t.appendChild(p);t.appendChild(n);g=a.getEntries();g.appendChild(c.getElement());b&&g.appendChild(b.getElement());this.getEntries=function(){return k};this.getEntriesIgnored=function(){return l};this.getElement=function(){return h};this.resize=w.resize;this.setVisible=function(a){f=a;h.style.display=a?"block":"none";(new Task(w.resize)).run()};this.getVisible=function(){return f}}return function(a){function b(){k.dispatchEvent({type:"hidepopup"})}function e(a,b){return a.getUsername()>
b.getUsername()}function f(a){return a.getId()}function h(a){u.getByEntryId(a.getId())||u.addEntry(UserEntry.fromIgnored({user:a,clickMenu:r,ignoreManager:t,getUserMe:w}))}EventEnabledBuilder(this);var k=this,g=a.id,m=a.showUsersSearch;if(window.isMobile){var l=new Button({className:"button-close"});l.addEventListener("click",b)}var n=new Button({className:"button-search"}),p=new c({name:a.name,buttonClose:l,buttonSearch:n}),w=a.getUserMe,q=a.users,t=a.ignoreManager,r=a.clickMenu,v=new SortedFilteredEntries({compare:e,
getEntryId:f,element:p.getEntries(),buttonClose:l}),u=new SortedFilteredEntries({compare:e,getEntryId:f,element:p.getEntriesIgnored()});this.getElement=p.getElement;this.getId=function(){return g};q.addEventListener("add",function(a){v.getByEntryId(a.user.getId())||(a=new UserEntry({user:a.user,clickMenu:r,ignoreManager:t,getUserMe:w}),v.addEntry(a),a.addEventListener("showpm",function(a){console.log("a");k.dispatchEvent(a)}))});q.addEventListener("remove",function(a){a=v.getByEntryId(a.user.getId());
a.dispose();v.removeEntry(a)});t.addEventListener("ignored",function(a){h(a.ignored)});t.addEventListener("unignored",function(a){u.removeEntryById(a.ignored.getId())});this.getVisible=p.getVisible;this.setVisible=p.setVisible;this.show=function(){k.dispatchEvent({type:"show",entry:k})};this.hide=function(){k.dispatchEvent({type:"hide",entry:k})};this.resize=p.resize;this.dispose=p.dispose;n.addEventListener("click",m);(function(){try{each(t.getIgnores(),function(a){h(a)})}catch(z){console.log(z),
t.clearSave()}})()}}(),UsersMenues=function(){function c(a){var b=a.popupElement,c=a.getTopEntry;b?document.body.appendChild(b):b=E.DIV();b.classList.add("users-menues");this.getElement=function(){return b};this.getEntries=function(){return f};var f=E.DIV();f.classList.add("users-menues-entries");b.appendChild(f);this.setVisible=function(a){f.style.display=a?"block":"none"};this.resize=function(){console.log("a");c().getEntry().resize()}}return function(){function a(){h.hide()}function b(a){g.hide(a.entry)}
function e(a){g.show(a.entry)}EventEnabledBuilder(this);var f=this,h;window.isMobile&&(h=new Popup({}));var k=new c({popupElement:window.isMobile?h.getElement():void 0,getTopEntry:function(){return g.getTopEntry()}}),g=new OverlappingEntries({element:k.getEntries()});this.getElement=k.getElement;this.setVisible=k.setVisible;this.add=function(c){g.add(c);c.addEventListener("showpm",function(a){return f.dispatchEvent(a)});c.addEventListener("show",e);c.addEventListener("hide",b);window.isMobile&&c.addEventListener("hidepopup",
a)};this.remove=function(a){g.remove(a)};this.setUsers=function(a){g.set(a)};this.show=function(){h.show();console.log(g.getTopEntry().getEntry());g.getTopEntry().getEntry().resize()};this.resize=k.resize}}(),FileUploader=function(){function c(a){var b=this,c=a.button;EventEnabledBuilder(this);a=a.accept;console.log(a);var f=E.DIV();f.classList.add("file-uploader");var h=E.FILE();h.accept=a;h.type="file";f.appendChild(c.getElement());c.addEventListener("click",function(){h.click()});this.getElement=
function(){return f};this.setVisible=function(a){f.style.display=a?"block":"none"};h.addEventListener("change",function(a){b.dispatchEvent({type:"filechange",files:h.files})});this.clearFile=function(){h.value=""}}return function(a){function b(a){var b=new FileReader;b.onload=function(){e.dispatchEvent({type:"file",dataUrl:b.result,file:a})};b.readAsDataURL(a);h.clearFile()}EventEnabledBuilder(this);var e=this;a=a.accept;var f=new Button({className:"button"}),h=new c({accept:a,button:f});this.getElement=
h.getElement;this.setVisible=h.setVisible;h.addEventListener("filechange",function(a){console.log(a);a=a.files;1>a.length||b(a[0])})}}(),Cropper=function(){function c(a){var b=a.getConstraints,c=a.starting,f=a.setPosition,h=a.topElseBottom,k=a.leftElseRight;this.getX=a.getX;this.getY=a.getY;var g=E.DIV();g.classList.add("corner");g.classList.add(a.className);this.getElement=function(){return g};this.getConstraints=function(){return b(h,k)};this.setPosition=f;this.setVisible=function(a){g.style.display=
a?"block":"none"};this.getElement=function(){return g};this.getAbsolutePosition=function(){return getAbsolute(g)};(new DragManager({handle:this,stopPropagation:!0})).onStart=c}return function(a){var b,e,f,h,k,g;function m(a){each(U,function(b){b.setVisible(a)})}function l(){return 0}function n(){var a=C.clientWidth,c=C.clientHeight;b=a;e=c;var l=C.offsetLeft,m=C.offsetTop;f=l;h=m;k=l+a;g=m+c}function p(a,b){var c;void 0!=a&&(c=function(a){return function(b){a(b.y)}}(a?K:B));var e;void 0!=b&&(e=function(a){return function(b){a(b.x)}}(b?
u:z));c=c?e?function(a,b){return function(c){a(c);b(c)}}(c,e):c:e;return F?w(c,b,a):c}function w(a,c,l){return function(a){return c&&!l?function(c){c=(c.x-f+(g-c.y)*F)/2;a({x:c+f,y:(b-c)/F+h})}:!c&&l?function(b){b=(k-b.x+(b.y-h)*F)/2;a({x:f+(e-b)*F,y:b+h})}:function(b){b=(b.x-f+(b.y-h)*F)/2;a({x:f+b,y:(h+b)/F})}}(a)}function q(){return C.offsetLeft}function t(){return q()+C.clientWidth}function r(){return C.offsetTop}function v(){return r()+C.clientHeight}function u(a){C.style.left=String(a)+"px";
C.style.width=String(b+f-a)+"px"}function z(a){C.style.width=String(a-f)+"px"}function K(a){C.style.top=String(a)+"px";C.style.height=String(e+h-a)+"px"}function B(a){C.style.height=String(a-h)+"px"}function J(a,b){if(!F)return b?a?{minX:0,maxX:t(),minY:0,maxY:v()}:{minX:0,maxX:t(),minY:r(),maxY:I()}:a?{minX:q(),maxX:D(),minY:0,maxY:v()}:{minX:q(),maxX:D(),minY:r(),maxY:I()};if(b){b=q();var c=t()-(q()+50);if(a){var e=v()-(r()+50);a=r();var f=e*F,g=a*F;c>f?c=f:e=c/F;b>g?b=g:a=b/F;e+=r();a=r()-a}else e=
I()-v(),a=v()-(r()+50),f=e*F,g=a*F,c>g?c=g:a=c/F,b>f?b=f:e=b/F,e+=v(),a=v()-a;c+=q();b=q()-b}else c=D()-t(),b=t()-(q()+50),a?(e=v()-(r()+50),a=r(),f=e*F,g=a*F,c>g?c=g:a=c/F,b>f?b=f:e=b/F,e+=r(),a=r()-a):(e=I()-v(),a=v()-(r()+50),f=e*F,g=a*F,c>f?c=f:e=c/F,b>g?b=g:a=b/F,e+=v(),a=v()-a),c+=t(),b=t()-b;return{minX:b,minY:a,maxX:c,maxY:e}}var D=a.getImageWidth,I=a.getImageHeight,F=a.aspectRatio,H=[],C=E.DIV();C.classList.add("cropper");var U=[];each([!0,!1],function(a){var b="corner-"+(a?"top":"bottom"),
e=new c({className:b,topElseBottom:a,leftElseRight:void 0,starting:n,getConstraints:J,setPosition:p(a,void 0),getX:l,getY:a?r:v});H.push(e);U.push(e);C.appendChild(e.getElement());each([!0,!1],function(f){b="corner-"+(a?"top":"bottom")+"-"+(f?"left":"right");e=new c({className:b,topElseBottom:a,leftElseRight:f,starting:n,getConstraints:J,setPosition:p(a,f),getX:f?q:t,getY:a?r:v});H.push(e);C.appendChild(e.getElement())})});each([!0,!1],function(a){a=new c({className:"corner-"+(a?"left":"right"),topElseBottom:void 0,
leftElseRight:a,starting:n,getConstraints:J,setPosition:p(void 0,a),getX:a?q:t,getY:l});H.push(a);U.push(a);C.appendChild(a.getElement())});this.positionDefault=function(a,b){var c=a,e=b;F&&(b*F>a?e=c/F:c=e*F);C.style.left="0px";C.style.top="0px";C.style.width=String(c)+"px";C.style.height=String(e)+"px"};this.onShow=function(){m(F?!1:!0)};this.getElement=function(){return C};this.getConstraints=function(){var a=C.clientWidth/2,b=C.clientHeight/2,c=D()-a,e=I()-b;console.log({minX:a,minY:b,maxX:c,
maxY:e});return{minX:a,minY:b,maxX:c,maxY:e}};this.getPosition=function(a){return{left:C.offsetLeft,top:C.offsetTop}};this.getAbsolutePosition=function(a){return{left:a.pageX,top:a.pageY}};this.getDimensions=function(){return{width:C.clientWidth,height:C.clientHeight}};this.getX=function(){return q()+C.clientWidth/2};this.getY=function(){return r()+C.clientHeight/2};this.setPosition=function(a){C.style.left=String(a.x-C.clientWidth/2)+"px";C.style.top=String(a.y-C.clientHeight/2)+"px"};a=new DragManager({handle:this});
a.onStart=function(){};a.onMove=function(){}}}(),CroppingFrame=new function(){return function(c){function a(a){e.dispatchEvent({type:"error",error:a})}function b(a,b){l.style.width=String(a)+"px";l.style.height=String(b)+"px";var c=f.clientWidth;l.style.marginTop=String((f.clientHeight-b)/2)+"px";l.style.marginLeft=String((c-a)/2)+"px"}EventEnabledBuilder(this);var e=this;c=c.aspectRatio;var f=E.DIV();f.classList.add("cropping-frame");var h,k,g,m,l=E.DIV();l.classList.add("img-wrapper");var n=new Cropper({getImageWidth:function(){return l.getBoundingClientRect().width},
getImageHeight:function(){return l.getBoundingClientRect().height},aspectRatio:c});l.appendChild(n.getElement());f.appendChild(l);this.getElement=function(){return f};this.hide=function(){f.style.display="none"};this.load=function(c){m&&l.removeChild(m);m=void 0;m=E.IMG();m.onload=function(){h=this.width;k=this.height;g=h/k;f.style.display="table-row";n.onShow();if(f.clientWidth/f.clientHeight>g){var a=f.clientHeight;b(g*a,a)}else a=f.clientWidth,b(a,a/g);l.appendChild(m);n.positionDefault(m.clientWidth,
m.clientHeight)};m.onerror=a;m.src=c};this.getCroppedImage=function(a){console.log(a);var b=n.getPosition(),c=n.getDimensions();return ImageProcessing.crop({img:m,imgWidthRaw:h,imgHeightRaw:k,cropperWidth:c.width,cropperHeight:c.height,cropperLeft:b.left,cropperTop:b.top,format:a.format?a.format:"image/jpeg",profile:a.profile})}}},ImageProcessing=new function(){this.crop=function(c){var a=c.img,b=c.imgWidthRaw,e=c.imgHeightRaw,f=c.cropperWidth,h=c.cropperHeight,k=c.cropperLeft,g=c.cropperTop,m=c.format,
l=c.quality,n=c.profile;c=E.CANVAS();var p=c.getContext("2d");if(n.desiredWidth){var w=n.desiredWidth;if(n.aspectRatio)var q=w/n.aspectRatio;else n.finalCroppedHeight&&(q=n.finalCroppedHeight)}else n.finalCroppedHeight&&(q=n.finalCroppedHeight,n.aspectRatio&&(w=q*n.aspectRatio));console.log({width:w,height:q});c.width=w;c.height=q;n=E.CANVAS();var t=n.getContext("2d");n.width=a.width;n.height=a.height;t.drawImage(a,0,0,b,e,0,0,a.width,a.height);p.drawImage(n,k,g,f,h,0,0,w,q);return c.toDataURL(m,
l)}},ProgressBar=function(){return function(c){var a=this,b=!1,e=c.showText,f=c.text,h=E.DIV();h.classList.add("progress-bar");var k=E.DIV();k.classList.add("progress");h.appendChild(k);var g=E.DIV();g.classList.add("text");h.appendChild(g);this.setPercent=function(a){var c=String(a)+"%";k.style.width=c;e&&(g.innerHTML=(f?f:"")+" "+c);100<=a?b||(h.classList.add("progress-bar-done"),b=!0):b&&(h.classList.remove("progress-bar-done"),b=!1)};this.setProportion=function(b){a.setPrecentage(100*b)};this.getElement=
function(){return h}}}(),FileSender=function(){function c(a){function b(){h.dispatchEvent({type:"done",sender:h})}function c(a){console.log("progress");console.log(a);h.onProgress&&h.onProgress(a)}EventEnabledBuilder(this);var h=this,k=a.ajax,g=a.data,m=a.fileName,l;this.send=function(){var a=l=k.post({data:g});a.onDone=b;a.onProgress=c;h.onSending&&h.onSending()};this.abort=function(){l&&l.abort()};this.getSuccessful=function(){return l.getSuccessful()};this.getFileName=function(){return m}}function a(a){console.log("handle");
EventEnabledBuilder(this);var b=this;this.abort=a.abort;a.addEventListener("done",function(){b.dispatchEvent({type:"done",sendingHandle:b,successful:a.getSuccessful()})});a.onProgress=function(a){b.dispatchEvent({type:"progress",sendingHandle:b,percent:a,proportion:a/100})};a.onSending=function(){b.dispatchEvent({type:"sending",handle:b})};this.getFileName=a.getFileName}return function(b){function e(){if(1>n.length)return!1;n.splice(0,1)[0].addEventListener("done",h);return!0}function f(a){a.sender.removeEventListener("done");
k(a.sender);1>n.length&&g.dispatchEvent({type:"done"})}function h(a){a.sender.removeEventListener("done");k(a.sender);e()&&g.dispatchEvent({type:"done"})}function k(a){a=n.indexOf(a);0>a||n.splice(a,1)}EventEnabledBuilder(this);var g=this,m=b.sequentially,l=new Ajax({url:b.url}),n=[];this.queue=function(b){var h=new c({data:b.data,fileName:b.fileName,ajax:l});b=new a(h);m?(n.push(h),2>n.length&&e()):(new Task(function(){n.push(h);h.addEventListener("done",f);h.send()})).run();g.dispatchEvent({type:"queued",
handle:b});return b}}}(),FileSenderUI=function(){function c(a){var b=E.DIV();b.classList.add("sending");var c=new ProgressBar({showText:!0,text:a.getFileName()});c.setPercent(3);b.appendChild(c.getElement());this.getElement=function(){return b};a.addEventListener("sending",function(a){});a.addEventListener("progress",function(a){c.setPercent(a.percent)});a.addEventListener("done",function(a){c.setPercent(100)})}return function(a){a=a.fileSender;var b=[],e=E.DIV();e.classList.add("file-sender");var f=
E.DIV();f.classList.add("entries");e.appendChild(f);this.getElement=function(){return e};this.setVisible=function(a){e.style.display=a?"table-row":"none"};this.clear=function(){each(b,function(a){f.removeChild(a.getElement())});b=[]};a.addEventListener("queued",function(a){a=new c(a.handle);b.push(a);f.appendChild(a.getElement())})}}(),ImageUploader=new function(){function c(a){function b(){var a=E.DIV();a.classList.add("button-wrapper");return a}var c=a.buttonClose,f=a.buttonAccept,h=a.buttonReject,
k=a.croppingFrame,g=a.fileUploader,m=new FileSenderUI({fileSender:a.fileSender});ImagePreloader.preloadRange(["/images/upload-file.jpg","/images/tick.jpg","/images/cross.jpg","/images/tick-hover.jpg","/images/cross-hover.jpg"]);a=a.popup.getElement();a.classList.add("image-uploader");var l=E.DIV();l.classList.add("inner");var n=E.DIV();n.classList.add("heading");var p=b(),w=b(),q=E.DIV();q.classList.add("cropping-menu");document.body.appendChild(a);a.appendChild(l);l.appendChild(n);n.appendChild(c.getElement());
p.appendChild(f.getElement());w.appendChild(h.getElement());q.appendChild(w);q.appendChild(p);l.appendChild(k.getElement());l.appendChild(g.getElement());l.appendChild(q);l.appendChild(m.getElement());this.setHeading=function(a){n.innerHTML=a};this.setCroppingMenuVisible=function(a){q.style.display=a?"table-row":"none"};this.setFileSenderVisible=m.setVisible;this.clearFileSender=m.clear}return function(a){function b(){w.hide();e()}function e(){n.setVisible(!0);t.hide();r.setCroppingMenuVisible(!1);
r.setFileSenderVisible(!1)}EventEnabledBuilder(this);var f=a.aspectRatio,h=a.profiles,k=a.getSessionId,g=new Button({className:"button-close"}),m=new Button({className:"button-accept"}),l=new Button({className:"button-reject"}),n=new FileUploader({accept:"image/*"}),p=new FileSender({url:a.url}),w=new Popup({}),q,t=new CroppingFrame({aspectRatio:f}),r=new c({popup:w,buttonClose:g,buttonAccept:m,buttonReject:l,croppingFrame:t,fileUploader:n,fileSender:p});g.addEventListener("click",b);n.addEventListener("file",
function(a){q=a.file.name;a=a.dataUrl;n.setVisible(!1);t.load(a);r.setCroppingMenuVisible(!0);r.setFileSenderVisible(!1)});t.addEventListener("error",function(a){console.log(a.error);t.hide();n.setVisible(!1)});p.addEventListener("done",function(){console.log("fileSenderDone");(new Timer({callback:function(){r.clearFileSender();b()},delay:1E3,nTicks:1})).start()});this.show=function(){w.show()};m.addEventListener("click",function(){var a=[];each(h,function(b){var c=t.getCroppedImage({profile:b});
a.push({dataUrl:c,profile:b})});p.queue({data:JSON.stringify({images:a,sessionId:k()}),fileName:q});n.setVisible(!1);t.hide();r.setCroppingMenuVisible(!1);r.setFileSenderVisible(!0)});l.addEventListener("click",e)}},Rooms=new function(){function c(a){var b=a.emoticons,c=a.getTopEntry,f=E.DIV();f.classList.add("rooms");var h=E.DIV();a=E.DIV();a.classList.add("rooms-inner");f.appendChild(a);h.classList.add("entries");a.appendChild(h);a.appendChild(b.getElement());this.getEntries=function(){return h};
this.getElement=function(){return f};this.resize=(new Once(function(){console.log("rooms.resize");var a=c();a&&(a=a.getEntry())&&a.resize&&a.resize()})).trigger}return function(a){function b(a){a=new Room({id:a.id,name:a.name,isPm:a.isPm,getUserMe:p,emoticonsParser:K,userTo:a.userTo,getUserById:w,ignoreManager:r,clickMenuUser:v,getNDevice:q,getSessionId:n,send:l,showUsersSearch:u});z.add(a);var b=a.isPm();D.add(a);a.addEventListener("showemoticons",k);a.addEventListener("hide",f);a.addEventListener("showpm",
function(a){return m.dispatchEvent(a)});b?(a.addEventListener("sendpm",function(a){return m.dispatchEvent(a)}),a.addEventListener("getpms",function(a){m.dispatchEvent(a)}),a.addEventListener("videopmofferrejected",function(a){m.dispatchEvent(a)})):(a.addEventListener("sendmessage",function(a){return m.dispatchEvent(a)}),a.addEventListener("getmessages",function(a){return m.dispatchEvent(a)}));m.dispatchEvent({type:"createdroom",room:a});a.addEventListener("dispose",e);h();b||a.addEventListener("missingusers",
m.dispatchEvent);return a}function e(a){g(a.room);h()}function f(a){D.hide(a.room)}function h(){m.dispatchEvent({type:"roomsinchanged",roomIds:z.getEntries().where(function(a){return!a.isPm()}).select(function(a){return a.getId()}).toList()})}function k(a){J.show({picked:a.picked})}function g(a){z.remove(a);D.remove(a);m.dispatchEvent({type:"destroyedroom",room:a})}EventEnabledBuilder(this);var m=this,l=a.send,n=a.getSessionId,p=a.getUserMe,w=a.getUserById,q=a.getNDevice,t=a.showRoomsSearch,r=a.ignoreManager,
v=a.clickMenu,u=a.showUsersSearch,z=new Set({getEntryId:function(a){return a.getId()}});a=a.usersMenuAll;var K=new EmoticonsParser({emoticonsLibrary:EmoticonsLibrary}),B=new RoomsMenu({usersMenu:a,showRoomsSearch:t}),J=new Emoticons({emoticonsLibrary:EmoticonsLibrary});t=new c({emoticons:J,getTopEntry:function(){return D.getTopEntry()}});var D=new OverlappingEntries({element:t.getEntries(),name:"rooms"});B.addEventListener("showroom",function(a){m.showRoom(a.roomInfo)});J.addEventListener("addemoticon",
function(a){});D.add(B);D.show(B);this.getElement=t.getElement;this.resize=t.resize;this.showMenu=function(){D.show(B)};this.getById=function(a){return z.getById(a)};this.set=function(a){B.set(a);var b=[];each(a,function(a){b.push(a.id)});each(z.getIds(),function(a){0<=b.indexOf(a)||(a=z.getById(a),a.dispose(),g(a))})};this.incomingMessage=function(a){var b=z.getById(a.roomId);b&&b.incomingMessage(a.message)};this.incomingMessages=function(a){var b=z.getById(a.roomId);b&&b.incomingMessages(a.messages)};
this.showPm=function(a){};this.join=function(a,b){b&&(a=z.getById(a.roomId))&&a.join(b)};this.getById=z.getById;this.showRoom=function(a){var c=z.getById(a.id);c||(c=b(a));D.show(c)};this.clear=function(){each(z.getEntries().slice(),function(a){console.log(a);a.dispose&&a.dispose();g(a)});B.clear()}}},AutomaticAuthentication=new function(){return function(c){var a=c.send,b=new Settings("AutomaticAuthentication");this.authenticate=function(){var c=b.get("token");if(!c)return!1;a({type:"automatic_authenticate",
token:c});return!0};this.setToken=function(a){b.set("token",a)};this.clear=function(){b.set("token",null)}}};function Logo(){EventEnabledBuilder(this);var c=this,a=E.DIV();a.classList.add("logo");var b=E.DIV();a.appendChild(b);ImagePreloader.preloadRange(["/logo.gif","/logo-hover.gif"]);this.getElement=function(){return a};a.addEventListener("click",function(){c.dispatchEvent({type:"click"})})}
var Lobby=function(){function c(a){function b(){B&&B.resize();t.resize();c.resize();f.resize()}var c=a.rooms,f=a.pmsMenu,h=a.mainMenu,k=a.buttonUsers,g=a.buttonPms,m=a.buttonProfilePicture,l=a.buttonNotifications,n=a.buttonMenu,p=a.notificationsMenu,w=new Spinner({preventInterraction:!0}),q=E.DIV(),t=a.usersMenues,r=E.DIV();a=E.DIV();var v=E.DIV();q=E.DIV();r.classList.add("lobby");a.classList.add("right");v.classList.add("right-inner");q.classList.add("button-show-hide-wrapper");if(window.isMobile)v.appendChild(f.getElement()),
v.appendChild(q),v.appendChild(c.getElement()),document.body.appendChild(p.getElement());else{var u=E.DIV();u.classList.add("left");var z=E.DIV();z.classList.add("left-inner");r.appendChild(u);u.appendChild(z);var K=new window.Logo;z.appendChild(K.getElement());z.appendChild(t.getElement());var B=new SplitPane({nPanelsWidth:1,nPanelsHeight:2,rowProfiles:[{height:"120px",minHeight:"60px"},{minHeight:"160px"}]});var J=B.getPanelRow(0);var D=B.getPanelXY(0,0);z=B.getPanelXY(0,1);D=D.getElement();z=z.getElement();
D.appendChild(f.getElement());z.appendChild(q);z.appendChild(c.getElement());v.appendChild(B.getElement());v.appendChild(p.getElement());(new Task(B.resize)).run();K.addEventListener("click",c.showMenu);k.addEventListener("click",b);ResizeManager.add({element:r,onResized:b})}r.appendChild(a);a.appendChild(v);document.documentElement.appendChild(w.getElement());p=E.IMG();p.classList.add("logo-sign-in");p.src="/images/logo.gif";document.body.appendChild(p);q.appendChild(k.getElement());q.appendChild(g.getElement());
q.appendChild(n.getElement());q.appendChild(l.getElement());q.appendChild(m.getElement());this.getElement=function(){return r};this.showMainMenu=function(a){console.log(getAbsolute(m.getElement()).right);h.show(a);h.setPosition({right:6,top:getAbsolute(m.getElement()).bottom+3})};this.setPmsMenuVisible=function(a){console.log(a);J.setVisible(a);b()};this.setLeftVisible=function(a){u.style.display=a?"block":"none";b()};this.setSpinnerAutomaticAuthenticationVisible=w.setVisible;this.setVisible=function(a){r.style.display=
a?"block":"none"};this.resize=b}ImagePreloader.preloadRange("/images/close.jpg /images/tickbox-unticked.gif /images/tickbox-ticked.gif /images/menu.gif /images/menu-hover.gif /images/notifications.gif /images/profile-picture.gif /images/room-default.gif /images/room-exit.gif /images/smiley.gif /images/tick.gif /images/upload-file.gif".split(" "));window.isMobile?ImagePreloader.preloadRange(["/images/pms-mobile.gif","/images/users-mobile.gif"]):ImagePreloader.preloadRange("/images/tickbox-unticked-hover.gif /images/tickbox-ticked-hover.gif /images/close-hover.jpg /images/profile-picture-hover.gif /images/notifications-hover.gif /images/pms-hide.gif /images/pms-hide-hover.gif /images/users-hide.gif /images/users-hide-hover.gif /images/users-show.gif /images/users-show-hover.gif /images/pms-show.gif /images/pms-show-hover.gif /images/room-exit-hover.gif /images/smiley-hover.gif /images/tick-hover.gif".split(" "));
return function(){function a(){var a=(new Date).getTime()-3E4;J&&J>a?D.show():(J=(new Date).getTime(),G.authenticate()?Y.setSpinnerAutomaticAuthenticationVisible(!0):D.show())}function b(){L.send({type:"sign_out",sessionId:z});G.clear();e()}function e(){z=null;A.clear();I.clear();N.clear();ca.clear();D.show();v(!1)}function f(){W.show()}function h(a,b){each(b,function(b){var c=I.getById(b);c?a.join(c):ia.get(b)})}function k(a,b){var c=a.getUsers().getEntries().where(function(a){return 0>b.indexOf(a.getId())}).toList();
each(c,function(b){console.log(b.getId());a.leave(b)})}function g(a){Y.setLeftVisible(a.toggled)}function m(a){Y.setPmsMenuVisible(a.toggled)}function l(a){a.pmNotifications&&each(a.pmNotifications,function(a){N.add(Notification.pmNotificationFromJSON(a))})}function n(a){a.where(function(a){return!I.containsId(a)}).each(function(a){return ia.get(a)});I.getIds().where(function(b){return 0>a.indexOf(b)}).each(function(a){(a=I.getById(a))&&a.left()})}function p(a){a.successful?(z=a.sessionId,a.token&&
G.setToken(a.token),K=a.nDevice,I.add(User.fromJSON(a.user)),B=I.getById(a.user.id),a.users.select(function(a){return User.fromJSON(a)}).each(function(a){return I.add(a)}),D.hide(),v(!0),L.send({type:"rooms_get",sessionId:z}),X.load(B.getId()),F.load(B.getId())):D.setError(a.error)}function w(a){return I.getById(a)}function q(){return B}function t(){return z}function r(a){X.showPmWithUser(a.user)}function v(a){Y.setVisible(a);a&&(new Task(Y.resize)).run()}function u(a){console.log(a);L.send({type:"pm_video_offer_rejected",
userToId:a.userToId,reason:a.reason,sessionId:z})}var z,K,B,J,D=new Authenticate({callbackRegister:function(a){a.type="register";L.send(a)},callbackSignIn:function(a){a.type="authenticate";L.send(a)},callbackGuest:function(a){a.type="authenticate";a.isGuest=!0;L.send(a)}}),I=new Users({}),F=new IgnoreManager({getUserById:w,getUserMe:q}),H=new ClickMenu({}),C=new ClickMenu({}),U=new UsersMenu({name:"All Users (Lobby)",users:I,id:"UsersMenuLobby",ignoreManager:F,getUserMe:q,clickMenu:H,showUsersSearch:f}),
ia=new MissingUsersManager,L=new Mysocket({url:"poll",urlWebsocket:getWebsocketUrl("endpoint")});window.debug&&window.debug.setMysocket(L);var G=new AutomaticAuthentication({send:L.send});(new Task(a)).run();var la=new SeenNotificationsManager({getSessionId:t,mysocket:L}),ba=new UsersMenues({ignoreManager:F});ba.add(U);var W=new UsersSearch({clickMenu:H,ignoreManager:F,getUserMe:q}),aa=new RoomsSearch({clickMenu:H}),A=new Rooms({getUserMe:q,getUserById:w,ignoreManager:F,clickMenu:H,usersMenuAll:U,
getNDevice:function(){return K},getSessionId:t,send:L.send,showUsersSearch:f,showRoomsSearch:function(){aa.show()}}),cb=new ImageUploader({getSessionId:t,aspectRatio:1,profiles:[{desiredWidth:32,aspectRatio:1,name:UserImage.SMALL},{desiredWidth:256,aspectRatio:1,name:UserImage.LARGE}],url:"/image_uploader"}),X=new Pms({rooms:A,getUserById:I.getById}),ca=new PmsMenu({pms:X}),N=new Notifications({}),ma=new NotificationsMenu({notifications:N,pms:X,seenNotificationsManager:la});H=new Button({toggle:!window.isMobile,
classNames:["button-users"],classNameToggled:"button-users-hide"});U=new Button({toggle:!window.isMobile,classNames:["button-pms"],classNameToggled:"button-pms-hide"});la=new Button({classNames:["button-profile-picture"]});var da=new NotificationsButton({notifications:N}),na=new Button({classNames:["button-menu"]}),Y=new c({rooms:A,buttonUsers:H,buttonPms:U,buttonProfilePicture:la,buttonNotifications:da,pmsMenu:ca,usersMenues:ba,notificationsMenu:ma,buttonMenu:na,mainMenu:C});L.addEventListener("message",
function(a){a=a.msg;console.log(a);switch(a.type){case "test":console.log(a);break;case "join":var b=User.fromJSON(a.user);I.contains(b)||I.add(b);(a=a.userIds)&&n(a);break;case "users":I.update(a.users);break;case "authenticate":p(a);l(a);break;case "automatic_authenticate":Y.setSpinnerAutomaticAuthenticationVisible(!1);a.successful?(p(a),l(a)):D.show();break;case "register":p(a);break;case "rooms":A.set(a.rooms);break;case "room_userids":if(b=A.getById(a.roomId))h(b,a.userIds),k(b,a.userIds);break;
case "message":A.incomingMessage(a);break;case "pm_message":X.incomingMessage(a);break;case "messages":A.incomingMessages(a);break;case "pm_messages":X.incomingMessages(a);break;case "userids":n(a.userIds);break;case "pm_video_offer_fail":X.videoOfferFail(a);break;case "pm_video_offer_rejected":console.log("got video offer rejected");X.videoOfferRejected(a);break;case "pm_video_offer":X.videoOffer(a);break;case "pm_video_accept_fail":X.videoAcceptFail(a);break;case "pm_video_accept":X.videoAccept(a);
break;case "pm_video_ice_candidate":X.videoIceCandidate(a);break;case "user_image_set":console.log(a);UserImage.update(a.userId,a.image);(b=I.getById(a.userId))&&b.setImage(a.image);break;case "rooms_search":aa.incomingRooms(a.rooms);break;case "users_search":W.incomingUsers(a.users)}});L.addEventListener("open",function(){});la.addEventListener("click",function(){cb.show()});da.addEventListener("click",function(){console.log("showing notifications");ma.show()});na.addEventListener("click",function(){Y.showMainMenu({options:[{text:"Sign Out ",
callback:b}]})});I.addEventListener("add",function(a){OnlineIndicators.setOnline(a.user.getId(),!0)});I.addEventListener("remove",function(a){OnlineIndicators.setOnline(a.user.getId(),!1)});window.isMobile?(U.addEventListener("click",ca.show),H.addEventListener("click",function(){ba.show()})):(U.addEventListener("toggled",m),H.addEventListener("toggled",g));A.addEventListener("sendmessage",function(a){var b=a.message.toJSON();b.roomId=a.roomId;b.type="room_message_send";b.sessionId=z;L.send(b)});
A.addEventListener("getmessages",function(a){L.send({type:"room_messages_get",roomId:a.roomId,sessionId:z})});A.addEventListener("getpms",function(a){console.log("get pms");L.send({type:"pm_messages_get",userToId:a.userToId,sessionId:z})});A.addEventListener("getuserids",function(a){L.send({type:"room_userids_get",roomId:a.roomId,sessionId:z})});A.addEventListener("createdroom",function(a){a=a.room;ba.add(a.getUsersMenu());L.send({type:"room_join",sessionId:z,roomId:a.getId()})});A.addEventListener("destroyedroom",
function(a){console.log("removing from user menues");ba.remove(a.room.getUsersMenu());L.send({type:"room_leave",sessionId:z,roomId:a.room.getId()})});A.addEventListener("roomsinchanged",function(a){L.send({type:"rooms_in_changed",sessionId:z,roomIds:a.roomIds})});A.addEventListener("sendpm",function(a){var b=a.message.toJSON();b.userToId=a.userToId;b.type="room_pm_send";b.sessionId=z;L.send(b)});A.addEventListener("videopmofferrejected",u);aa.addEventListener("search",function(a){L.send({type:"rooms_search",
text:a.text,sessionId:z})});aa.addEventListener("showroom",function(a){A.showRoom(a.roomInfo)});ba.addEventListener("showpm",r);W.addEventListener("search",function(a){console.log(a);L.send({type:"users_search",text:a.text,sessionId:z})});W.addEventListener("showpm",r);ma.addEventListener("showpm",r);X.addEventListener("addnotification",function(a){N.add(a.notification)});X.addEventListener("videoofferrejected",u);L.addEventListener("disposedbyserver",function(){L.reset();e();a()});this.getElement=
Y.getElement}}(),lobby=new Lobby;document.body.appendChild(lobby.getElement());
/*
 Alessandro Piana 2015
 @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js  isVis - v0.5.5 Aug 2011 - Page Visibility API Polyfill
 Copyright (c) 2011 Addy Osmani
 Dual licensed under the MIT and GPL licenses.
 Sniffer is a clientside browser/engine/os/device detection tool
 v. 3.1.1 | https://github.com/wilddeer/Sniffer
 Copyright Oleg Korsunsky | http://wd.dizaina.net/

 MIT License
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(h){var g=0;return function(){return g<h.length?{done:!1,value:h[g++]}:{done:!0}}};$jscomp.arrayIterator=function(h){return{next:$jscomp.arrayIteratorImpl(h)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(h,g,f){h!=Array.prototype&&h!=Object.prototype&&(h[g]=f.value)};$jscomp.getGlobal=function(h){return"undefined"!=typeof window&&window===h?h:"undefined"!=typeof global&&null!=global?global:h};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(h,g){this.$jscomp$symbol$id_=h;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:g})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function h(f){if(this instanceof h)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(f||"")+"_"+g++,f)}var g=0;return h}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var h=$jscomp.global.Symbol.iterator;h||(h=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[h]&&$jscomp.defineProperty(Array.prototype,h,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var h=$jscomp.global.Symbol.asyncIterator;h||(h=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(h){$jscomp.initSymbolIterator();h={next:h};h[$jscomp.global.Symbol.iterator]=function(){return this};return h};
$jscomp.iteratorFromArray=function(h,g){$jscomp.initSymbolIterator();h instanceof String&&(h+="");var f=0,d={next:function(){if(f<h.length){var a=f++;return{value:g(a,h[a]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill=function(h,g,f,d){if(g){f=$jscomp.global;h=h.split(".");for(d=0;d<h.length-1;d++){var a=h[d];a in f||(f[a]={});f=f[a]}h=h[h.length-1];d=f[h];g=g(d);g!=d&&null!=g&&$jscomp.defineProperty(f,h,{configurable:!0,writable:!0,value:g})}};$jscomp.polyfill("Array.prototype.keys",function(h){return h?h:function(){return $jscomp.iteratorFromArray(this,function(g){return g})}},"es6","es3");
$jscomp.checkStringArgs=function(h,g,f){if(null==h)throw new TypeError("The 'this' value for String.prototype."+f+" must not be null or undefined");if(g instanceof RegExp)throw new TypeError("First argument to String.prototype."+f+" must not be a regular expression");return h+""};
$jscomp.polyfill("String.prototype.endsWith",function(h){return h?h:function(g,f){var d=$jscomp.checkStringArgs(this,g,"endsWith");g+="";void 0===f&&(f=d.length);f=Math.max(0,Math.min(f|0,d.length));for(var a=g.length;0<a&&0<f;)if(d[--f]!=g[--a])return!1;return 0>=a}},"es6","es3");$jscomp.checkEs6ConformanceViaProxy=function(){try{var h={},g=Object.create(new $jscomp.global.Proxy(h,{get:function(f,d,a){return f==h&&"q"==d&&a==g}}));return!0===g.q}catch(f){return!1}};
$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.makeIterator=function(h){var g="undefined"!=typeof Symbol&&Symbol.iterator&&h[Symbol.iterator];return g?g.call(h):$jscomp.arrayIterator(h)};$jscomp.owns=function(h,g){return Object.prototype.hasOwnProperty.call(h,g)};
$jscomp.polyfill("WeakMap",function(h){function g(){if(!h||!Object.seal)return!1;try{var a=Object.seal({}),b=Object.seal({}),e=new h([[a,2],[b,3]]);if(2!=e.get(a)||3!=e.get(b))return!1;e.delete(a);e.set(b,4);return!e.has(a)&&4==e.get(b)}catch(p){return!1}}function f(){}function d(a){if(!$jscomp.owns(a,c)){var b=new f;$jscomp.defineProperty(a,c,{value:b})}}function a(a){var b=Object[a];b&&(Object[a]=function(e){if(e instanceof f)return e;d(e);return b(e)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(h&&
$jscomp.ES6_CONFORMANCE)return h}else if(g())return h;var c="$jscomp_hidden_"+Math.random();a("freeze");a("preventExtensions");a("seal");var b=0,k=function(a){this.id_=(b+=Math.random()+1).toString();if(a){a=$jscomp.makeIterator(a);for(var k;!(k=a.next()).done;)k=k.value,this.set(k[0],k[1])}};k.prototype.set=function(a,b){d(a);if(!$jscomp.owns(a,c))throw Error("WeakMap key fail: "+a);a[c][this.id_]=b;return this};k.prototype.get=function(a){return $jscomp.owns(a,c)?a[c][this.id_]:void 0};k.prototype.has=
function(a){return $jscomp.owns(a,c)&&$jscomp.owns(a[c],this.id_)};k.prototype.delete=function(a){return $jscomp.owns(a,c)&&$jscomp.owns(a[c],this.id_)?delete a[c][this.id_]:!1};return k},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(h){function g(){if($jscomp.ASSUME_NO_NATIVE_MAP||!h||"function"!=typeof h||!h.prototype.entries||"function"!=typeof Object.seal)return!1;try{var a=Object.seal({x:4}),b=new h($jscomp.makeIterator([[a,"s"]]));if("s"!=b.get(a)||1!=b.size||b.get({x:4})||b.set({x:4},"t")!=b||2!=b.size)return!1;var e=b.entries(),k=e.next();if(k.done||k.value[0]!=a||"s"!=k.value[1])return!1;k=e.next();return k.done||4!=k.value[0].x||"t"!=k.value[1]||!e.next().done?!1:!0}catch(t){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(h&&$jscomp.ES6_CONFORMANCE)return h}else if(g())return h;$jscomp.initSymbolIterator();var f=new WeakMap,d=function(a){this.data_={};this.head_=b();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var k;!(k=a.next()).done;)k=k.value,this.set(k[0],k[1])}};d.prototype.set=function(b,k){b=0===b?0:b;var e=a(this,b);e.list||(e.list=this.data_[e.id]=[]);e.entry?e.entry.value=k:(e.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:b,
value:k},e.list.push(e.entry),this.head_.previous.next=e.entry,this.head_.previous=e.entry,this.size++);return this};d.prototype.delete=function(b){b=a(this,b);return b.entry&&b.list?(b.list.splice(b.index,1),b.list.length||delete this.data_[b.id],b.entry.previous.next=b.entry.next,b.entry.next.previous=b.entry.previous,b.entry.head=null,this.size--,!0):!1};d.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=b();this.size=0};d.prototype.has=function(b){return!!a(this,b).entry};
d.prototype.get=function(b){return(b=a(this,b).entry)&&b.value};d.prototype.entries=function(){return c(this,function(a){return[a.key,a.value]})};d.prototype.keys=function(){return c(this,function(a){return a.key})};d.prototype.values=function(){return c(this,function(a){return a.value})};d.prototype.forEach=function(a,b){for(var e=this.entries(),k;!(k=e.next()).done;)k=k.value,a.call(b,k[1],k[0],this)};d.prototype[Symbol.iterator]=d.prototype.entries;var a=function(a,b){var e=b&&typeof b;"object"==
e||"function"==e?f.has(b)?e=f.get(b):(e=""+ ++k,f.set(b,e)):e="p_"+b;var c=a.data_[e];if(c&&$jscomp.owns(a.data_,e))for(a=0;a<c.length;a++){var l=c[a];if(b!==b&&l.key!==l.key||b===l.key)return{id:e,list:c,index:a,entry:l}}return{id:e,list:c,index:-1,entry:void 0}},c=function(a,b){var e=a.head_;return $jscomp.iteratorPrototype(function(){if(e){for(;e.head!=a.head_;)e=e.previous;for(;e.next!=e.head;)return e=e.next,{done:!1,value:b(e)};e=null}return{done:!0,value:void 0}})},b=function(){var a={};return a.previous=
a.next=a.head=a},k=0;return d},"es6","es3");$jscomp.findInternal=function(h,g,f){h instanceof String&&(h=String(h));for(var d=h.length,a=0;a<d;a++){var c=h[a];if(g.call(f,c,a,h))return{i:a,v:c}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(h){return h?h:function(g,f){return $jscomp.findInternal(this,g,f).v}},"es6","es3");$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(h){function g(){this.batch_=null}function f(b){return b instanceof a?b:new a(function(a,c){a(b)})}if(h&&!$jscomp.FORCE_POLYFILL_PROMISE)return h;g.prototype.asyncExecute=function(a){if(null==this.batch_){this.batch_=[];var b=this;this.asyncExecuteFunction(function(){b.executeBatch_()})}this.batch_.push(a)};var d=$jscomp.global.setTimeout;g.prototype.asyncExecuteFunction=function(a){d(a,0)};g.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var k=0;k<a.length;++k){var c=a[k];a[k]=null;try{c()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};g.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var a=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(m){b.reject(m)}};a.prototype.createResolveAndReject_=function(){function a(a){return function(e){c||(c=!0,a.call(k,e))}}var k=this,c=!1;
return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};a.prototype.resolveTo_=function(b){if(b===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(b instanceof a)this.settleSameAsPromise_(b);else{a:switch(typeof b){case "object":var k=null!=b;break a;case "function":k=!0;break a;default:k=!1}k?this.resolveToNonPromiseObj_(b):this.fulfill_(b)}};a.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(m){this.reject_(m);return}"function"==typeof b?
this.settleSameAsThenable_(b,a):this.fulfill_(a)};a.prototype.reject_=function(a){this.settle_(2,a)};a.prototype.fulfill_=function(a){this.settle_(1,a)};a.prototype.settle_=function(a,k){if(0!=this.state_)throw Error("Cannot settle("+a+", "+k+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=k;this.executeOnSettledCallbacks_()};a.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)c.asyncExecute(this.onSettledCallbacks_[a]);
this.onSettledCallbacks_=null}};var c=new g;a.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};a.prototype.settleSameAsThenable_=function(a,k){var b=this.createResolveAndReject_();try{a.call(k,b.resolve,b.reject)}catch(l){b.reject(l)}};a.prototype.then=function(b,k){function c(a,b){return"function"==typeof a?function(b){try{l(a(b))}catch(n){e(n)}}:b}var l,e,d=new a(function(a,b){l=a;e=b});this.callWhenSettled_(c(b,l),c(k,e));return d};
a.prototype.catch=function(a){return this.then(void 0,a)};a.prototype.callWhenSettled_=function(a,k){function b(){switch(l.state_){case 1:a(l.result_);break;case 2:k(l.result_);break;default:throw Error("Unexpected state: "+l.state_);}}var l=this;null==this.onSettledCallbacks_?c.asyncExecute(b):this.onSettledCallbacks_.push(b)};a.resolve=f;a.reject=function(b){return new a(function(a,c){c(b)})};a.race=function(b){return new a(function(a,c){for(var k=$jscomp.makeIterator(b),e=k.next();!e.done;e=k.next())f(e.value).callWhenSettled_(a,
c)})};a.all=function(b){var k=$jscomp.makeIterator(b),c=k.next();return c.done?f([]):new a(function(a,e){function b(e){return function(b){l[e]=b;d--;0==d&&a(l)}}var l=[],d=0;do l.push(void 0),d++,f(c.value).callWhenSettled_(b(l.length-1),e),c=k.next();while(!c.done)})};return a},"es6","es3");$jscomp.polyfill("Object.is",function(h){return h?h:function(g,f){return g===f?0!==g||1/g===1/f:g!==g&&f!==f}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(h){return h?h:function(g,f){var d=this;d instanceof String&&(d=String(d));var a=d.length;f=f||0;for(0>f&&(f=Math.max(f+a,0));f<a;f++){var c=d[f];if(c===g||Object.is(c,g))return!0}return!1}},"es7","es3");$jscomp.polyfill("String.prototype.includes",function(h){return h?h:function(g,f){return-1!==$jscomp.checkStringArgs(this,g,"includes").indexOf(g,f||0)}},"es6","es3");
$jscomp.assign="function"==typeof Object.assign?Object.assign:function(h,g){for(var f=1;f<arguments.length;f++){var d=arguments[f];if(d)for(var a in d)$jscomp.owns(d,a)&&(h[a]=d[a])}return h};$jscomp.polyfill("Object.assign",function(h){return h||$jscomp.assign},"es6","es3");
$jscomp.polyfill("String.prototype.startsWith",function(h){return h?h:function(g,f){var d=$jscomp.checkStringArgs(this,g,"startsWith");g+="";var a=d.length,c=g.length;f=Math.max(0,Math.min(f|0,d.length));for(var b=0;b<c&&f<a;)if(d[f++]!=g[b++])return!1;return b>=c}},"es6","es3");$jscomp.polyfill("Array.prototype.entries",function(h){return h?h:function(){return $jscomp.iteratorFromArray(this,function(g,f){return[g,f]})}},"es6","es3");
$jscomp.polyfill("Array.prototype.values",function(h){return h?h:function(){return $jscomp.iteratorFromArray(this,function(g,f){return f})}},"es8","es3");(function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(h,g){var f=this.length>>>0;g=Number(g)||0;g=0>g?Math.ceil(g):Math.floor(g);for(0>g&&(g+=f);g<f;g++)if(g in this&&this[g]===h)return g;return-1})})();
Function.prototype.bind||(Function.prototype.bind=function(h){var g=this,f=Array.prototype.slice.call(arguments,1);if("function"!==typeof g)throw new TypeError("Function.prototype.bind - context must be a valid function");return function(){return g.apply(h,f.concat(Array.prototype.slice.call(arguments)))}});
"document"in self&&("classList"in document.createElement("_")&&(!document.createElementNS||"classList"in document.createElementNS("http://www.w3.org/2000/svg","g"))||!function(h){if("Element"in h){h=h.Element.prototype;var g=Object,f=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},d=Array.prototype.indexOf||function(a){for(var e=0,b=this.length;b>e;e++)if(e in this&&this[e]===a)return e;return-1},a=function(a,e){this.name=a;this.code=DOMException[a];this.message=e},c=function(b,
e){if(""===e)throw new a("SYNTAX_ERR","The token must not be empty.");if(/\s/.test(e))throw new a("INVALID_CHARACTER_ERR","The token must not contain space characters.");return d.call(b,e)},b=function(a){var e=f.call(a.getAttribute("class")||"");e=e?e.split(/\s+/):[];for(var b=0,c=e.length;c>b;b++)this.push(e[b]);this._updateClassName=function(){a.setAttribute("class",this.toString())}},k=b.prototype=[],m=function(){return new b(this)};if(a.prototype=Error.prototype,k.item=function(a){return this[a]||
null},k.contains=function(a){return~c(this,a+"")},k.add=function(){var a=arguments,e=0,b=a.length,k=!1;do{var d=a[e]+"";~c(this,d)||(this.push(d),k=!0)}while(++e<b);k&&this._updateClassName()},k.remove=function(){var a,e=arguments,b=0,k=e.length,d=!1;do{var m=e[b]+"";for(a=c(this,m);~a;)this.splice(a,1),d=!0,a=c(this,m)}while(++b<k);d&&this._updateClassName()},k.toggle=function(a,e){var b=this.contains(a),k=b?!0!==e&&"remove":!1!==e&&"add";return k&&this[k](a),!0===e||!1===e?e:!b},k.replace=function(a,
e){a=c(a+"");~a&&(this.splice(a,1,e),this._updateClassName())},k.toString=function(){return this.join(" ")},g.defineProperty){k={get:m,enumerable:!0,configurable:!0};try{g.defineProperty(h,"classList",k)}catch(l){void 0!==l.number&&-2146823252!==l.number||(k.enumerable=!1,g.defineProperty(h,"classList",k))}}else g.prototype.__defineGetter__&&h.__defineGetter__("classList",m)}}(self),function(){var h=document.createElement("_");if(h.classList.add("c1","c2"),!h.classList.contains("c2")){var g=function(d){var a=
DOMTokenList.prototype[d];DOMTokenList.prototype[d]=function(c){var b,k=arguments.length;for(b=0;k>b;b++)c=arguments[b],a.call(this,c)}};g("add");g("remove")}if(h.classList.toggle("c3",!1),h.classList.contains("c3")){var f=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(d,a){return 1 in arguments&&!this.contains(d)==!a?a:f.call(this,d)}}"replace"in document.createElement("_").classList||(DOMTokenList.prototype.replace=function(d,a){var c=this.toString().split(" ");d=c.indexOf(d+
"");~d&&(c=c.slice(d),this.remove.apply(this,c),this.add(a),this.add.apply(this,c.slice(1)))});h=null}());
!window.addEventListener&&function(h,g,f,d,a,c,b){h[d]=g[d]=f[d]=function(a,c){var k=this;b.unshift([k,a,c,function(a){a.currentTarget=k;a.preventDefault=function(){a.returnValue=!1};a.stopPropagation=function(){a.cancelBubble=!0};a.target=a.srcElement||k;c.call(k,a)}]);this.attachEvent("on"+a,b[0][3])};h[a]=g[a]=f[a]=function(a,c){for(var k=0,e;e=b[k];++k)if(e[0]==this&&e[1]==a&&e[2]==c)return this.detachEvent("on"+a,b.splice(k,1)[0][3])};h[c]=g[c]=f[c]=function(a){return this.fireEvent("on"+a.type,
a)}}(Window.prototype,HTMLDocument.prototype,Element.prototype,"addEventListener","removeEventListener","dispatchEvent",[]);
(function(h){function g(a){for(var b="",c=0;c<(a||5);c++)b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return b}function f(a){return{timestamp:(new Date).getTime(),isTrusted:!0,target:null,currentTarget:null,data:a,bubbles:!1,cancelable:!1,defaultPrevented:!1,lastEventId:"",origin:h.location.origin}}function d(k){if(!h.localStorage)throw new "localStorage not available";k="polyBC_"+k;var d=null===c;this.channelId=k;b=b||g();c=c||{};c[k]=c[k]||
[];c[k].push(this);this.name=k+"::::"+g()+(new Date).getTime();d&&(console.log(h),console.log(h.addEventListener),h.addEventListener("storage",a.bind(this),!1));return this}function a(a){var k=a.key,l=a.newValue,e=!l;a=null;if(-1<k.indexOf("eomBCmessage_")&&!e){try{a=JSON.parse(l)}catch(t){throw new "Message conversion has resulted in an error.";}if(a.tabId!==b&&a.channelId&&c&&c[a.channelId]){l=c[a.channelId];for(var d in l)if(!l[d].closed&&l[d].onmessage)l[d].onmessage(a.message);h.localStorage.removeItem(k)}}}
var c=null,b=null;d.prototype.onmessage=function(a){};d.prototype.postMessage=function(a){if(c){if(this.closed)throw new "This BroadcastChannel is closed.";a=f(a);var k=c[this.channelId]||[];for(l in k)if(!k[l].closed&&k[l].name!==this.name&&k[l].onmessage)k[l].onmessage(a);var l={channelId:this.channelId,bcId:this.name,tabId:b,message:a};try{var e=JSON.stringify(l),d="eomBCmessage_"+g()+"_"+this.channelId;h.localStorage.setItem(d,e)}catch(t){throw new "Message conversion has resulted in an error.";
}setTimeout(function(){h.localStorage.removeItem(d)},1E3)}};d.prototype.close=function(){this.closed=!0;var b=c[this.channelId].indexOf(this);-1<b&&c[this.channelId].splice(b,1);c[this.channelId].length||delete c[this.channelId];a:{b=c;for(d in b)if(b.hasOwnProperty(d)){var d=!1;break a}d=!0}d&&h.removeEventListener("storage",a.bind(this))};h.BroadcastChannel=h.BroadcastChannel||d})(window);
(function(){window.visibly={b:null,q:document,p:void 0,prefixes:["webkit","ms"],props:["VisibilityState","visibilitychange","Hidden"],m:["focus","blur"],visibleCallbacks:[],hiddenCallbacks:[],_callbacks:[],onVisible:function(h){this.visibleCallbacks.push(h)},onHidden:function(h){this.hiddenCallbacks.push(h)},isSupported:function(){return this._supports(0)||this._supports(1)},_supports:function(h){return this.prefixes[h]+this.props[2]in this.q},runCallbacks:function(h){if(h)for(this._callbacks=1==
h?this.visibleCallbacks:this.hiddenCallbacks,h=0;h<this._callbacks.length;h++)this._callbacks[h]()},_visible:function(){window.visibly.runCallbacks(1)},_hidden:function(){window.visibly.runCallbacks(2)},_nativeSwitch:function(){!0===this.q[this.b+this.props[2]]?this._hidden():this._visible()},listen:function(){try{this.isSupported()?(this.b=this._supports(0)==this.p?this.prefixes[1]:this.prefixes[0],this.q.addEventListener(this.b+this.props[1],function(){window.visibly._nativeSwitch.apply(window.visibly,
arguments)},1)):document.addEventListener?(window.addEventListener(this.m[0],this._visible,1),window.addEventListener(this.m[1],this._hidden,1)):(this.q.attachEvent("onfocusin",this._visible),this.q.attachEvent("onfocusout",this._hidden))}catch(h){}},init:function(){this.listen()}};this.visibly.init()})();
(function(h){var g=function(a){var b={browser:{fullName:"",name:"",version:"",majorVersion:null,minorVersion:null,patchVersion:null,engine:""},os:{fullName:"",name:"",version:"",versionName:"",versionAltNames:[],majorVersion:null,minorVersion:null,patchVersion:null},features:{bw:!1,mobile:!1,tv:!1,proxy:!1}},c={browser:[{test:["SailfishBrowser"],browser:{fullName:"Sailfish Browser",name:"sailfishbrowser",engine:"gecko",$version:{search:"SailfishBrowser/"}},features:{mobile:!0}},{test:["Edge/"],browser:{fullName:"Edge",
name:"edge",engine:"edgehtml",$version:{search:"Edge/"}}},{test:["MSIE"],browser:{fullName:"Internet Explorer",name:"ie",engine:"trident",$version:{search:"MSIE "}}},{test:["Trident"],browser:{fullName:"Internet Explorer",name:"ie",engine:"trident",$version:{search:"rv:"}}},{test:["OPR/"],browser:{fullName:"Opera",name:"opera",engine:"webkit",$version:{search:"OPR/"}}},{test:["Chrome"],browser:{fullName:"Chrome",name:"chrome",engine:"webkit",$version:{search:"Chrome/"}}},{test:["Firefox"],browser:{fullName:"Firefox",
name:"firefox",engine:"gecko",$version:{search:"Firefox/"}}},{test:["NokiaBrowser"],browser:{fullName:"Nokia Browser",name:"nokiabrowser",engine:"webkit",$version:{search:"NokiaBrowser/"}},features:{mobile:!0}},{test:["Opera Mini","Presto"],browser:{fullName:"Opera Mini",name:"operamini",engine:"presto",$version:{search:"Version/"}},features:{mobile:!0,proxy:!0}},{test:["Opera Mini","WebKit"],browser:{fullName:"Opera Mini",name:"operamini",engine:"webkit"},features:{mobile:!0,proxy:!0}},{test:["Opera"],
browser:{fullName:"Opera",name:"opera",engine:"presto",$version:{search:"Version/"}}},{test:["OviBrowser"],browser:{fullName:"Ovi Browser",name:"ovi",engine:"gecko",$version:{search:"OviBrowser/"}},features:{mobile:!0,proxy:!0}},{test:["CriOS/"],browser:{fullName:"Chrome",name:"chrome",engine:"webkit",$version:{search:"CriOS/"}}},{test:["Coast/"],browser:{fullName:"Opera Coast",name:"coast",engine:"webkit",$version:{search:"Coast/"}}},{test:["Safari","Version/",/(iPhone|iPod|iPad|Macintosh|Windows)/],
browser:{fullName:"Safari",name:"safari",engine:"webkit",$version:{search:"Version/"}}},{test:["WebKit"],browser:{engine:"webkit"}},{test:["Gecko/"],browser:{engine:"gecko"}}],os:[{test:["Sailfish"],os:{fullName:"Sailfish OS",name:"sailfish"},features:{mobile:!0}},{test:["Windows Phone"],os:{fullName:"Windows Phone",name:"winphone",$version:{search:"Windows Phone "}},features:{mobile:!0}},{test:["Windows"],os:{fullName:"Windows",name:"win",$version:{search:"Windows NT ",names:{"10.0":"10","6.3":"8.1",
"6.2":"8","6.1":"7","6.0":"Vista","5.2":"XP","5.1":"XP","5.01":"2000","5.0":"2000"},altNames:{"5.2":["Server 2003"]}}}},{test:["Macintosh","OS X 10"],os:{fullName:"Mac OS X",name:"osx",$version:{search:/OS X /,names:{"10.6":"Snow Leopard","10.7":"Lion","10.8":"Mountain Lion","10.9":"Mavericks","10.10":"Yosemite","10.11":"El Capitan"}}}},{test:["Ubuntu"],os:{fullName:"Ubuntu",name:"ubuntu"}},{test:["Fedora"],os:{fullName:"Fedora",name:"fedora",$version:{search:"Fedora/",names:{20:"Heisenbug",19:"Schr\ufffddinger's Cat",
18:"Spherical Cow",17:"Beefy Miracle",16:"Verne",15:"Lovelock",14:"Laughlin",13:"Goddard",12:"Constantine",11:"Leonidas",10:"Cambridge",9:"Sulphur",8:"Werewolf",7:"Moonshine"}}}},{test:["Kindle"],os:{fullName:"Kindle",name:"kindle",$version:{search:"Kindle/"}},features:{bw:!0,mobile:!0}},{test:[/(BlackBerry|BB\d+)/],os:{fullName:"BlackBerry",name:"blackberry",$version:{search:"Version/"}},features:{mobile:!0}},{test:["Symbian"],os:{fullName:"Symbian",name:"symbian"},features:{mobile:!0}},{test:["Series40"],
os:{fullName:"Symbian",name:"symbian"},features:{mobile:!0}},{test:["PlayStation Vita"],os:{fullName:"PlayStation Vita",name:"psvita"},features:{mobile:!0}},{test:[/playstation/i],os:{fullName:"PlayStation",name:"playstation",$version:{search:/playstation\s/i}},features:{tv:!0}},{test:["Nintendo DSi"],os:{fullName:"Nintendo DSi",name:"dsi"},features:{mobile:!0}},{test:["New Nintendo 3DS"],os:{fullName:"New Nintendo 3DS",name:"n3ds"},browser:{engine:"webkit"},features:{mobile:!0}},{test:["Nintendo 3DS"],
os:{fullName:"Nintendo 3DS",name:"3ds"},browser:{engine:"webkit"},features:{mobile:!0}},{test:["Viera"],os:{fullName:"Viera",name:"viera"},browser:{engine:"webkit"},features:{tv:!0}},{test:["SonyDTV"],features:{tv:!0}},{test:["Android"],os:{fullName:"Android",name:"android",$version:{search:"Android "}},features:{mobile:!0}},{test:[/iPhone|iPod|iPad/],os:{fullName:"iOS",name:"ios",$version:{search:"OS "}},features:{mobile:!0}}],features:[{test:[/mobile/i],features:{mobile:!0}},{test:[/smart-{0,1}tv/i],
features:{tv:!0}}]};if(!a)return b;for(var d in c)for(var l=c[d],e=0;e<l.length;e++){for(var f=!0,g=0;g<l[e].test.length;g++)if(l[e].test[g]instanceof RegExp){if(!l[e].test[g].test(a)){f=!1;break}}else if(-1==a.indexOf(l[e].test[g])){f=!1;break}if(f){f=void 0;l=l[e];for(f in c)if(c.hasOwnProperty(f)&&l[f]){if(l[f].$version){a:{e=l[f].$version.search;if(e instanceof RegExp&&(e=(a.match(e)||[])[0],!e)){var h=void 0;break a}g=a.indexOf(e);if(-1!=g&&(e=a.substring(g+e.length),e=/^(\d+(\.|_)){0,2}\d+/.exec(e))){h=
e[0].replace(/_/g,".");break a}h=void 0}if(h){e=h.split(".");g=l[f].$version.names;var r=l[f].$version.altNames;l[f].version=h;e[0]&&(l[f].majorVersion=parseInt(e[0]));e[1]&&(l[f].minorVersion=parseInt(e[1]));e[2]&&(l[f].patchVersion=parseInt(e[2]));if(g)for(var n=[],u=0;u<e.length;u++)n.push(e[u]),h=n.join("."),g[h]&&(l[f].versionName=g[h]),r&&r[h]&&(l[f].versionAltNames=r[h])}}for(var q in l[f])l[f].hasOwnProperty(q)&&"$"!==q[0]&&(b[f][q]=l[f][q])}break}}return b}(navigator.userAgent),f=document.getElementsByTagName("html")[0],
d=[f.className];g.browser.name&&d.push(g.browser.name);g.browser.engine&&d.push(g.browser.engine);g.os.name&&d.push(g.os.name);for(var a in g.features)g.features[a]&&d.push(a);f.className=d.join(" ");"undefined"!=typeof module&&module.exports?module.exports=g:h.Sniff=g})(this);
(function(h){"object"===typeof exports&&"undefined"!==typeof module?module.exports=h():"function"===typeof define&&define.amd?define([],h):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).adapter=h()})(function(){return function(){function h(g,f,d){function a(b,m){if(!f[b]){if(!g[b]){var k="function"==typeof require&&require;if(!m&&k)return k(b,!0);if(c)return c(b,!0);m=Error("Cannot find module '"+b+"'");throw m.code="MODULE_NOT_FOUND",m;
}m=f[b]={exports:{}};g[b][0].call(m.exports,function(e){return a(g[b][1][e]||e)},m,m.exports,h,g,f,d)}return f[b].exports}for(var c="function"==typeof require&&require,b=0;b<d.length;b++)a(d[b]);return a}return h}()({1:[function(h,g,f){h=h("./adapter_factory.js");h=(0,h.adapterFactory)({window:window});g.exports=h},{"./adapter_factory.js":2}],2:[function(h,g,f){function d(a){if(a&&a.__esModule)return a;var e={};if(null!=a)for(var b in a)Object.prototype.hasOwnProperty.call(a,b)&&(e[b]=a[b]);e.default=
a;return e}Object.defineProperty(f,"__esModule",{value:!0});f.adapterFactory=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).window,d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},f=a.log,g=a.detectBrowser(e),h={browserDetails:g,commonShim:l,extractVersion:a.extractVersion,disableLog:a.disableLog,disableWarnings:a.disableWarnings};switch(g.browser){case "chrome":if(!c||!c.shimPeerConnection||!d.shimChrome){f("Chrome shim is not included in this adapter release.");
break}f("adapter.js shimming chrome.");h.browserShim=c;c.shimGetUserMedia(e);c.shimMediaStream(e);c.shimPeerConnection(e);c.shimOnTrack(e);c.shimAddTrackRemoveTrack(e);c.shimGetSendersWithDtmf(e);c.shimSenderReceiverGetStats(e);c.fixNegotiationNeeded(e);l.shimRTCIceCandidate(e);l.shimConnectionState(e);l.shimMaxMessageSize(e);l.shimSendThrowTypeError(e);l.removeAllowExtmapMixed(e);break;case "firefox":if(!k||!k.shimPeerConnection||!d.shimFirefox){f("Firefox shim is not included in this adapter release.");
break}f("adapter.js shimming firefox.");h.browserShim=k;k.shimGetUserMedia(e);k.shimPeerConnection(e);k.shimOnTrack(e);k.shimRemoveStream(e);k.shimSenderGetStats(e);k.shimReceiverGetStats(e);k.shimRTCDataChannel(e);l.shimRTCIceCandidate(e);l.shimConnectionState(e);l.shimMaxMessageSize(e);l.shimSendThrowTypeError(e);break;case "edge":if(!b||!b.shimPeerConnection||!d.shimEdge){f("MS edge shim is not included in this adapter release.");break}f("adapter.js shimming edge.");h.browserShim=b;b.shimGetUserMedia(e);
b.shimGetDisplayMedia(e);b.shimPeerConnection(e);b.shimReplaceTrack(e);l.shimMaxMessageSize(e);l.shimSendThrowTypeError(e);break;case "safari":if(!m||!d.shimSafari){f("Safari shim is not included in this adapter release.");break}f("adapter.js shimming safari.");h.browserShim=m;m.shimRTCIceServerUrls(e);m.shimCreateOfferLegacy(e);m.shimCallbacksAPI(e);m.shimLocalStreamsAPI(e);m.shimRemoteStreamsAPI(e);m.shimTrackEventTransceiver(e);m.shimGetUserMedia(e);l.shimRTCIceCandidate(e);l.shimMaxMessageSize(e);
l.shimSendThrowTypeError(e);l.removeAllowExtmapMixed(e);break;default:f("Unsupported browser!")}return h};g=h("./utils");var a=d(g);g=h("./chrome/chrome_shim");var c=d(g);g=h("./edge/edge_shim");var b=d(g);g=h("./firefox/firefox_shim");var k=d(g);g=h("./safari/safari_shim");var m=d(g);h=h("./common_shim");var l=d(h)},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(h,g,f){function d(a,b,c){b&&!c.has(b.id)&&
(c.set(b.id,b),Object.keys(b).forEach(function(e){e.endsWith("Id")?d(a,a.get(b[e]),c):e.endsWith("Ids")&&b[e].forEach(function(e){d(a,a.get(e),c)})}))}function a(a,b,c){var e=c?"outbound-rtp":"inbound-rtp",k=new Map;if(null===b)return k;var l=[];a.forEach(function(a){"track"===a.type&&a.trackIdentifier===b.id&&l.push(a)});l.forEach(function(b){a.forEach(function(c){c.type===e&&c.trackId===b.id&&d(a,c,k)})});return k}function c(a){a.RTCPeerConnection.prototype.getLocalStreams=function(){var a=this;
this._shimmedLocalStreams=this._shimmedLocalStreams||{};return Object.keys(this._shimmedLocalStreams).map(function(e){return a._shimmedLocalStreams[e][0]})};var e=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,b){if(!b)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var c=e.apply(this,arguments);this._shimmedLocalStreams[b.id]?-1===this._shimmedLocalStreams[b.id].indexOf(c)&&this._shimmedLocalStreams[b.id].push(c):this._shimmedLocalStreams[b.id]=
[b,c];return c};var b=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){var e=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};a.getTracks().forEach(function(a){if(e.getSenders().find(function(e){return e.track===a}))throw new DOMException("Track already exists.","InvalidAccessError");});var c=this.getSenders();b.apply(this,arguments);var k=this.getSenders().filter(function(a){return-1===c.indexOf(a)});this._shimmedLocalStreams[a.id]=[a].concat(k)};
var c=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{};delete this._shimmedLocalStreams[a.id];return c.apply(this,arguments)};var k=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){var e=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};a&&Object.keys(this._shimmedLocalStreams).forEach(function(b){var c=e._shimmedLocalStreams[b].indexOf(a);
-1!==c&&e._shimmedLocalStreams[b].splice(c,1);1===e._shimmedLocalStreams[b].length&&delete e._shimmedLocalStreams[b]});return k.apply(this,arguments)}}Object.defineProperty(f,"__esModule",{value:!0});f.shimGetDisplayMedia=f.shimGetUserMedia=void 0;$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbolIterator();var b="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbol();return a&&
"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},k=h("./getusermedia");Object.defineProperty(f,"shimGetUserMedia",{enumerable:!0,get:function(){return k.shimGetUserMedia}});var m=h("./getdisplaymedia");Object.defineProperty(f,"shimGetDisplayMedia",{enumerable:!0,get:function(){return m.shimGetDisplayMedia}});f.shimMediaStream=function(a){a.MediaStream=a.MediaStream||a.webkitMediaStream};f.shimOnTrack=function(a){if("object"!==("undefined"===typeof a?"undefined":
b(a))||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype)l.wrapPeerConnectionEvent(a,"track",function(a){a.transceiver||Object.defineProperty(a,"transceiver",{value:{receiver:a.receiver}});return a});else{Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&this.removeEventListener("track",this._ontrack);this.addEventListener("track",this._ontrack=a)},enumerable:!0,configurable:!0});var e=a.RTCPeerConnection.prototype.setRemoteDescription;
a.RTCPeerConnection.prototype.setRemoteDescription=function(){var b=this;this._ontrackpoly||(this._ontrackpoly=function(e){e.stream.addEventListener("addtrack",function(c){var k=void 0;k=a.RTCPeerConnection.prototype.getReceivers?b.getReceivers().find(function(a){return a.track&&a.track.id===c.track.id}):{track:c.track};var l=new Event("track");l.track=c.track;l.receiver=k;l.transceiver={receiver:k};l.streams=[e.stream];b.dispatchEvent(l)});e.stream.getTracks().forEach(function(c){var k=void 0;k=
a.RTCPeerConnection.prototype.getReceivers?b.getReceivers().find(function(a){return a.track&&a.track.id===c.id}):{track:c};var l=new Event("track");l.track=c;l.receiver=k;l.transceiver={receiver:k};l.streams=[e.stream];b.dispatchEvent(l)})},this.addEventListener("addstream",this._ontrackpoly));return e.apply(this,arguments)}}};f.shimGetSendersWithDtmf=function(a){if("object"===("undefined"===typeof a?"undefined":b(a))&&a.RTCPeerConnection&&!("getSenders"in a.RTCPeerConnection.prototype)&&"createDTMFSender"in
a.RTCPeerConnection.prototype){var e=function(a,b){return{track:b,get dtmf(){void 0===this._dtmf&&(this._dtmf="audio"===b.kind?a.createDTMFSender(b):null);return this._dtmf},_pc:a}};if(!a.RTCPeerConnection.prototype.getSenders){a.RTCPeerConnection.prototype.getSenders=function(){this._senders=this._senders||[];return this._senders.slice()};var c=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,b){var k=c.apply(this,arguments);k||(k=e(this,a),this._senders.push(k));
return k};var k=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){k.apply(this,arguments);var b=this._senders.indexOf(a);-1!==b&&this._senders.splice(b,1)}}var l=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){var b=this;this._senders=this._senders||[];l.apply(this,[a]);a.getTracks().forEach(function(a){b._senders.push(e(b,a))})};var d=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=
function(a){var b=this;this._senders=this._senders||[];d.apply(this,[a]);a.getTracks().forEach(function(a){var e=b._senders.find(function(b){return b.track===a});e&&b._senders.splice(b._senders.indexOf(e),1)})}}else if("object"===("undefined"===typeof a?"undefined":b(a))&&a.RTCPeerConnection&&"getSenders"in a.RTCPeerConnection.prototype&&"createDTMFSender"in a.RTCPeerConnection.prototype&&a.RTCRtpSender&&!("dtmf"in a.RTCRtpSender.prototype)){var f=a.RTCPeerConnection.prototype.getSenders;a.RTCPeerConnection.prototype.getSenders=
function(){var a=this,b=f.apply(this,[]);b.forEach(function(b){return b._pc=a});return b};Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get:function(){void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null);return this._dtmf}})}};f.shimSenderReceiverGetStats=function(e){if("object"===("undefined"===typeof e?"undefined":b(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var c=e.RTCPeerConnection.prototype.getSenders;
c&&(e.RTCPeerConnection.prototype.getSenders=function(){var a=this,b=c.apply(this,[]);b.forEach(function(b){return b._pc=a});return b});var k=e.RTCPeerConnection.prototype.addTrack;k&&(e.RTCPeerConnection.prototype.addTrack=function(){var a=k.apply(this,arguments);a._pc=this;return a});e.RTCRtpSender.prototype.getStats=function(){var b=this;return this._pc.getStats().then(function(e){return a(e,b.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var d=e.RTCPeerConnection.prototype.getReceivers;
d&&(e.RTCPeerConnection.prototype.getReceivers=function(){var a=this,b=d.apply(this,[]);b.forEach(function(b){return b._pc=a});return b});l.wrapPeerConnectionEvent(e,"track",function(a){a.receiver._pc=a.srcElement;return a});e.RTCRtpReceiver.prototype.getStats=function(){var b=this;return this._pc.getStats().then(function(e){return a(e,b.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var f=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=
function(){if(0<arguments.length&&arguments[0]instanceof e.MediaStreamTrack){var a=arguments[0],b=void 0,c=void 0,k=void 0;this.getSenders().forEach(function(e){e.track===a&&(b?k=!0:b=e)});this.getReceivers().forEach(function(b){b.track===a&&(c?k=!0:c=b);return b.track===a});return k||b&&c?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):b?b.getStats():c?c.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.",
"InvalidAccessError"))}return f.apply(this,arguments)}}}};f.shimAddTrackRemoveTrackWithNative=c;f.shimAddTrackRemoveTrack=function(a){function b(a,b){var e=b.sdp;Object.keys(a._reverseStreams||[]).forEach(function(b){b=a._reverseStreams[b];e=e.replace(new RegExp(a._streams[b.id].id,"g"),b.id)});return new RTCSessionDescription({type:b.type,sdp:e})}function e(a,b){var e=b.sdp;Object.keys(a._reverseStreams||[]).forEach(function(b){b=a._reverseStreams[b];e=e.replace(new RegExp(b.id,"g"),a._streams[b.id].id)});
return new RTCSessionDescription({type:b.type,sdp:e})}if(a.RTCPeerConnection){var k=l.detectBrowser(a);if(a.RTCPeerConnection.prototype.addTrack&&65<=k.version)return c(a);var d=a.RTCPeerConnection.prototype.getLocalStreams;a.RTCPeerConnection.prototype.getLocalStreams=function(){var a=this,b=d.apply(this);this._reverseStreams=this._reverseStreams||{};return b.map(function(b){return a._reverseStreams[b.id]})};var f=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(b){var e=
this;this._streams=this._streams||{};this._reverseStreams=this._reverseStreams||{};b.getTracks().forEach(function(a){if(e.getSenders().find(function(b){return b.track===a}))throw new DOMException("Track already exists.","InvalidAccessError");});if(!this._reverseStreams[b.id]){var c=new a.MediaStream(b.getTracks());this._streams[b.id]=c;this._reverseStreams[c.id]=b;b=c}f.apply(this,[b])};var m=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){this._streams=
this._streams||{};this._reverseStreams=this._reverseStreams||{};m.apply(this,[this._streams[a.id]||a]);delete this._reverseStreams[this._streams[a.id]?this._streams[a.id].id:a.id];delete this._streams[a.id]};a.RTCPeerConnection.prototype.addTrack=function(b,e){var c=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var k=[].slice.call(arguments,1);if(1!==k.length||!k[0].getTracks().find(function(a){return a===b}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.",
"NotSupportedError");if(this.getSenders().find(function(a){return a.track===b}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{};this._reverseStreams=this._reverseStreams||{};(k=this._streams[e.id])?(k.addTrack(b),Promise.resolve().then(function(){c.dispatchEvent(new Event("negotiationneeded"))})):(k=new a.MediaStream([b]),this._streams[e.id]=k,this._reverseStreams[k.id]=e,this.addStream(k));return this.getSenders().find(function(a){return a.track===
b})};["createOffer","createAnswer"].forEach(function(e){var c=a.RTCPeerConnection.prototype[e];a.RTCPeerConnection.prototype[e]=function(){var a=this,e=arguments;return arguments.length&&"function"===typeof arguments[0]?c.apply(this,[function(c){c=b(a,c);e[0].apply(null,[c])},function(a){e[1]&&e[1].apply(null,a)},arguments[2]]):c.apply(this,arguments).then(function(e){return b(a,e)})}});var g=a.RTCPeerConnection.prototype.setLocalDescription;a.RTCPeerConnection.prototype.setLocalDescription=function(){if(!arguments.length||
!arguments[0].type)return g.apply(this,arguments);arguments[0]=e(this,arguments[0]);return g.apply(this,arguments)};var h=Object.getOwnPropertyDescriptor(a.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(a.RTCPeerConnection.prototype,"localDescription",{get:function(){var a=h.get.apply(this);return""===a.type?a:b(this,a)}});a.RTCPeerConnection.prototype.removeTrack=function(a){var b=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.",
"InvalidStateError");if(!a._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(a._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var e=void 0;Object.keys(this._streams).forEach(function(c){b._streams[c].getTracks().find(function(b){return a.track===b})&&(e=b._streams[c])});e&&(1===e.getTracks().length?this.removeStream(this._reverseStreams[e.id]):
e.removeTrack(a.track),this.dispatchEvent(new Event("negotiationneeded")))}}};f.shimPeerConnection=function(a){!a.RTCPeerConnection&&a.webkitRTCPeerConnection&&(a.RTCPeerConnection=a.webkitRTCPeerConnection);if(a.RTCPeerConnection){var b=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(a,e,c){var k=this,l=arguments;if(0<arguments.length&&"function"===typeof a)return b.apply(this,arguments);if(0===b.length&&(0===arguments.length||"function"!==typeof arguments[0]))return b.apply(this,
[]);var d=function(a){var b={};a.result().forEach(function(a){var e={id:a.id,timestamp:a.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[a.type]||a.type};a.names().forEach(function(b){e[b]=a.stat(b)});b[e.id]=e});return b},f=function(a){return new Map(Object.keys(a).map(function(b){return[b,a[b]]}))};return 2<=arguments.length?b.apply(this,[function(a){l[1](f(d(a)))},arguments[0]]):(new Promise(function(a,e){b.apply(k,[function(b){a(f(d(b)))},e])})).then(e,c)};
["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var e=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){arguments[0]=new ("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]);return e.apply(this,arguments)}});var e=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};
f.fixNegotiationNeeded=function(a){l.wrapPeerConnectionEvent(a,"negotiationneeded",function(a){if("stable"===a.target.signalingState)return a})};var l=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var e in a)Object.prototype.hasOwnProperty.call(a,e)&&(b[e]=a[e]);b.default=a;return b}(h("../utils.js"))},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(h,g,f){Object.defineProperty(f,"__esModule",{value:!0});f.shimGetDisplayMedia=function(d,a){d.navigator.mediaDevices&&
"getDisplayMedia"in d.navigator.mediaDevices||!d.navigator.mediaDevices||("function"!==typeof a?console.error("shimGetDisplayMedia: getSourceId argument is not a function"):d.navigator.mediaDevices.getDisplayMedia=function(c){return a(c).then(function(a){var b=c.video&&c.video.width,f=c.video&&c.video.height;c.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:c.video&&c.video.frameRate||3}};b&&(c.video.mandatory.maxWidth=b);f&&(c.video.mandatory.maxHeight=f);return d.navigator.mediaDevices.getUserMedia(c)})})}},
{}],5:[function(h,g,f){Object.defineProperty(f,"__esModule",{value:!0});$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbolIterator();var d="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbol();return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};f.shimGetUserMedia=function(b){var k=b&&b.navigator;if(k.mediaDevices){var f=a.detectBrowser(b),
l=function(a){if("object"!==("undefined"===typeof a?"undefined":d(a))||a.mandatory||a.optional)return a;var b={};Object.keys(a).forEach(function(e){if("require"!==e&&"advanced"!==e&&"mediaSource"!==e){var c="object"===d(a[e])?a[e]:{ideal:a[e]};void 0!==c.exact&&"number"===typeof c.exact&&(c.min=c.max=c.exact);var k=function(a,b){return a?a+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==c.ideal){b.optional=b.optional||[];var l={};"number"===typeof c.ideal?(l[k("min",
e)]=c.ideal,b.optional.push(l),l={},l[k("max",e)]=c.ideal):l[k("",e)]=c.ideal;b.optional.push(l)}void 0!==c.exact&&"number"!==typeof c.exact?(b.mandatory=b.mandatory||{},b.mandatory[k("",e)]=c.exact):["min","max"].forEach(function(a){void 0!==c[a]&&(b.mandatory=b.mandatory||{},b.mandatory[k(a,e)]=c[a])})}});a.advanced&&(b.optional=(b.optional||[]).concat(a.advanced));return b},e=function(a,b){if(61<=f.version)return b(a);if((a=JSON.parse(JSON.stringify(a)))&&"object"===d(a.audio)){var e=function(a,
b,e){b in a&&!(e in a)&&(a[e]=a[b],delete a[b])};a=JSON.parse(JSON.stringify(a));e(a.audio,"autoGainControl","googAutoGainControl");e(a.audio,"noiseSuppression","googNoiseSuppression");a.audio=l(a.audio)}if(a&&"object"===d(a.video)){var m=a.video.facingMode;m=m&&("object"===("undefined"===typeof m?"undefined":d(m))?m:{ideal:m});e=66>f.version;if(!(!m||"user"!==m.exact&&"environment"!==m.exact&&"user"!==m.ideal&&"environment"!==m.ideal||k.mediaDevices.getSupportedConstraints&&k.mediaDevices.getSupportedConstraints().facingMode&&
!e)){delete a.video.facingMode;var g=void 0;if("environment"===m.exact||"environment"===m.ideal)g=["back","rear"];else if("user"===m.exact||"user"===m.ideal)g=["front"];if(g)return k.mediaDevices.enumerateDevices().then(function(e){e=e.filter(function(a){return"videoinput"===a.kind});var k=e.find(function(a){return g.some(function(b){return a.label.toLowerCase().includes(b)})});!k&&e.length&&g.includes("back")&&(k=e[e.length-1]);k&&(a.video.deviceId=m.exact?{exact:k.deviceId}:{ideal:k.deviceId});
a.video=l(a.video);c("chrome: "+JSON.stringify(a));return b(a)})}a.video=l(a.video)}c("chrome: "+JSON.stringify(a));return b(a)},g=function(a){return 64<=f.version?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",
TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};k.getUserMedia=function(a,b,c){e(a,function(a){k.webkitGetUserMedia(a,b,function(a){c&&c(g(a))})})}.bind(k);var h=k.mediaDevices.getUserMedia.bind(k.mediaDevices);k.mediaDevices.getUserMedia=function(a){return e(a,function(a){return h(a).then(function(b){if(a.audio&&
!b.getAudioTracks().length||a.video&&!b.getVideoTracks().length)throw b.getTracks().forEach(function(a){a.stop()}),new DOMException("","NotFoundError");return b},function(a){return Promise.reject(g(a))})})}}};var a=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);b.default=a;return b}(h("../utils.js")),c=a.log},{"../utils.js":15}],6:[function(h,g,f){Object.defineProperty(f,"__esModule",{value:!0});$jscomp.initSymbol();
$jscomp.initSymbol();$jscomp.initSymbolIterator();var d="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbol();return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};f.shimRTCIceCandidate=function(b){if(b.RTCIceCandidate&&!(b.RTCIceCandidate&&"foundation"in b.RTCIceCandidate.prototype)){var k=b.RTCIceCandidate;b.RTCIceCandidate=function(b){"object"===
("undefined"===typeof b?"undefined":d(b))&&b.candidate&&0===b.candidate.indexOf("a=")&&(b=JSON.parse(JSON.stringify(b)),b.candidate=b.candidate.substr(2));if(b.candidate&&b.candidate.length){var c=new k(b);b=a.default.parseCandidate(b.candidate);var e=Object.assign(c,b);e.toJSON=function(){return{candidate:e.candidate,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex,usernameFragment:e.usernameFragment}};return e}return new k(b)};b.RTCIceCandidate.prototype=k.prototype;c.wrapPeerConnectionEvent(b,"icecandidate",
function(a){a.candidate&&Object.defineProperty(a,"candidate",{value:new b.RTCIceCandidate(a.candidate),writable:"false"});return a})}};f.shimMaxMessageSize=function(b){if(!b.RTCSctpTransport&&b.RTCPeerConnection){var k=c.detectBrowser(b);"sctp"in b.RTCPeerConnection.prototype||Object.defineProperty(b.RTCPeerConnection.prototype,"sctp",{get:function(){return"undefined"===typeof this._sctp?null:this._sctp}});var d=function(b){b=a.default.splitSections(b.sdp);b.shift();return b.some(function(b){return(b=
a.default.parseMLine(b))&&"application"===b.kind&&-1!==b.protocol.indexOf("SCTP")})},l=function(a){a=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===a||2>a.length)return-1;a=parseInt(a[1],10);return a!==a?-1:a},e=function(a){var b=65536;"firefox"===k.browser&&(b=57>k.version?-1===a?16384:2147483637:60>k.version?57===k.version?65535:65536:2147483637);return b},f=function(b,e){var c=65536;"firefox"===k.browser&&57===k.version&&(c=65535);b=a.default.matchPrefix(b.sdp,"a=max-message-size:");
0<b.length?c=parseInt(b[0].substr(19),10):"firefox"===k.browser&&-1!==e&&(c=2147483637);return c},g=b.RTCPeerConnection.prototype.setRemoteDescription;b.RTCPeerConnection.prototype.setRemoteDescription=function(){this._sctp=null;if(d(arguments[0])){var a=l(arguments[0]),b=e(a);a=f(arguments[0],a);var c=void 0;c=0===b&&0===a?Number.POSITIVE_INFINITY:0===b||0===a?Math.max(b,a):Math.min(b,a);b={};Object.defineProperty(b,"maxMessageSize",{get:function(){return c}});this._sctp=b}return g.apply(this,arguments)}}};
f.shimSendThrowTypeError=function(a){function b(a,b){var e=a.send;a.send=function(){var c=arguments[0];c=c.length||c.size||c.byteLength;if("open"===a.readyState&&b.sctp&&c>b.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+b.sctp.maxMessageSize+" bytes)");return e.apply(a,arguments)}}if(a.RTCPeerConnection&&"createDataChannel"in a.RTCPeerConnection.prototype){var d=a.RTCPeerConnection.prototype.createDataChannel;a.RTCPeerConnection.prototype.createDataChannel=function(){var a=
d.apply(this,arguments);b(a,this);return a};c.wrapPeerConnectionEvent(a,"datachannel",function(a){b(a.channel,a.target);return a})}};f.shimConnectionState=function(a){if(a.RTCPeerConnection&&!("connectionState"in a.RTCPeerConnection.prototype)){var b=a.RTCPeerConnection.prototype;Object.defineProperty(b,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0});Object.defineProperty(b,"onconnectionstatechange",
{get:function(){return this._onconnectionstatechange||null},set:function(a){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange);a&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=a)},enumerable:!0,configurable:!0});["setLocalDescription","setRemoteDescription"].forEach(function(a){var c=b[a];b[a]=function(){this._connectionstatechangepoly||(this._connectionstatechangepoly=
function(a){var b=a.target;if(b._lastConnectionState!==b.connectionState){b._lastConnectionState=b.connectionState;var e=new Event("connectionstatechange",a);b.dispatchEvent(e)}return a},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly));return c.apply(this,arguments)}})}};f.removeAllowExtmapMixed=function(a){if(a.RTCPeerConnection){var b=c.detectBrowser(a);if(!("chrome"===b.browser&&71<=b.version)){var d=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=
function(a){a&&a.sdp&&-1!==a.sdp.indexOf("\na=extmap-allow-mixed")&&(a.sdp=a.sdp.split("\n").filter(function(a){return"a=extmap-allow-mixed"!==a.trim()}).join("\n"));return d.apply(this,arguments)}}}};var a=(g=h("sdp"))&&g.__esModule?g:{default:g},c=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);b.default=a;return b}(h("./utils"))},{"./utils":15,sdp:17}],7:[function(h,g,f){Object.defineProperty(f,"__esModule",{value:!0});
f.shimGetDisplayMedia=f.shimGetUserMedia=void 0;var d=h("./getusermedia");Object.defineProperty(f,"shimGetUserMedia",{enumerable:!0,get:function(){return d.shimGetUserMedia}});var a=h("./getdisplaymedia");Object.defineProperty(f,"shimGetDisplayMedia",{enumerable:!0,get:function(){return a.shimGetDisplayMedia}});f.shimPeerConnection=function(a){var d=c.detectBrowser(a);if(a.RTCIceGatherer&&(a.RTCIceCandidate||(a.RTCIceCandidate=function(a){return a}),a.RTCSessionDescription||(a.RTCSessionDescription=
function(a){return a}),15025>d.version)){var e=Object.getOwnPropertyDescriptor(a.MediaStreamTrack.prototype,"enabled");Object.defineProperty(a.MediaStreamTrack.prototype,"enabled",{set:function(a){e.set.call(this,a);var b=new Event("enabled");b.enabled=a;this.dispatchEvent(b)}})}!a.RTCRtpSender||"dtmf"in a.RTCRtpSender.prototype||Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get:function(){void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new a.RTCDtmfSender(this):"video"===this.track.kind&&
(this._dtmf=null));return this._dtmf}});a.RTCDtmfSender&&!a.RTCDTMFSender&&(a.RTCDTMFSender=a.RTCDtmfSender);var f=(0,k.default)(a,d.version);a.RTCPeerConnection=function(a){a&&a.iceServers&&(a.iceServers=(0,b.filterIceServers)(a.iceServers,d.version),c.log("ICE servers after filtering:",a.iceServers));return new f(a)};a.RTCPeerConnection.prototype=f.prototype};f.shimReplaceTrack=function(a){!a.RTCRtpSender||"replaceTrack"in a.RTCRtpSender.prototype||(a.RTCRtpSender.prototype.replaceTrack=a.RTCRtpSender.prototype.setTrack)};
var c=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var e in a)Object.prototype.hasOwnProperty.call(a,e)&&(b[e]=a[e]);b.default=a;return b}(h("../utils")),b=h("./filtericeservers"),k=(h=h("rtcpeerconnection-shim"))&&h.__esModule?h:{default:h}},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(h,g,f){Object.defineProperty(f,"__esModule",{value:!0});f.filterIceServers=function(a,c){var b=!1;a=JSON.parse(JSON.stringify(a));
return a.filter(function(a){if(a&&(a.urls||a.url)){var c=a.urls||a.url;a.url&&!a.urls&&d.deprecated("RTCIceServer.url","RTCIceServer.urls");var k="string"===typeof c;k&&(c=[c]);c=c.filter(function(a){return 0===a.indexOf("stun:")?!1:(a=a.startsWith("turn")&&!a.startsWith("turn:[")&&a.includes("transport=udp"))&&!b?b=!0:a&&!b});delete a.url;a.urls=k?c[0]:c;return!!c.length}})};var d=function(a){if(a&&a.__esModule)return a;var c={};if(null!=a)for(var b in a)Object.prototype.hasOwnProperty.call(a,b)&&
(c[b]=a[b]);c.default=a;return c}(h("../utils"))},{"../utils":15}],9:[function(h,g,f){Object.defineProperty(f,"__esModule",{value:!0});f.shimGetDisplayMedia=function(d){"getDisplayMedia"in d.navigator&&d.navigator.mediaDevices&&!(d.navigator.mediaDevices&&"getDisplayMedia"in d.navigator.mediaDevices)&&(d.navigator.mediaDevices.getDisplayMedia=d.navigator.getDisplayMedia.bind(d.navigator))}},{}],10:[function(h,g,f){Object.defineProperty(f,"__esModule",{value:!0});f.shimGetUserMedia=function(d){d=d&&
d.navigator;var a=function(a){return{name:{PermissionDeniedError:"NotAllowedError"}[a.name]||a.name,message:a.message,constraint:a.constraint,toString:function(){return this.name}}},c=d.mediaDevices.getUserMedia.bind(d.mediaDevices);d.mediaDevices.getUserMedia=function(b){return c(b).catch(function(b){return Promise.reject(a(b))})}}},{}],11:[function(h,g,f){Object.defineProperty(f,"__esModule",{value:!0});f.shimGetDisplayMedia=f.shimGetUserMedia=void 0;$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbolIterator();
var d="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbol();return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},a=h("./getusermedia");Object.defineProperty(f,"shimGetUserMedia",{enumerable:!0,get:function(){return a.shimGetUserMedia}});var c=h("./getdisplaymedia");Object.defineProperty(f,"shimGetDisplayMedia",{enumerable:!0,get:function(){return c.shimGetDisplayMedia}});
f.shimOnTrack=function(a){"object"===("undefined"===typeof a?"undefined":d(a))&&a.RTCTrackEvent&&"receiver"in a.RTCTrackEvent.prototype&&!("transceiver"in a.RTCTrackEvent.prototype)&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})};f.shimPeerConnection=function(a){var c=b.detectBrowser(a);if("object"===("undefined"===typeof a?"undefined":d(a))&&(a.RTCPeerConnection||a.mozRTCPeerConnection)){!a.RTCPeerConnection&&a.mozRTCPeerConnection&&
(a.RTCPeerConnection=a.mozRTCPeerConnection);["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var e=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){arguments[0]=new ("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]);return e.apply(this,arguments)}});var k=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?k.apply(this,arguments):(arguments[1]&&
arguments[1].apply(null),Promise.resolve())};var e={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},f=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(a,b,k){return f.apply(this,[a||null]).then(function(a){if(53>c.version&&!b)try{a.forEach(function(a){a.type=e[a.type]||a.type})}catch(u){if("TypeError"!==u.name)throw u;a.forEach(function(b,c){a.set(c,Object.assign({},
b,{type:e[b.type]||b.type}))})}return a}).then(b,k)}}};f.shimSenderGetStats=function(a){if("object"===("undefined"===typeof a?"undefined":d(a))&&a.RTCPeerConnection&&a.RTCRtpSender&&!(a.RTCRtpSender&&"getStats"in a.RTCRtpSender.prototype)){var b=a.RTCPeerConnection.prototype.getSenders;b&&(a.RTCPeerConnection.prototype.getSenders=function(){var a=this,c=b.apply(this,[]);c.forEach(function(b){return b._pc=a});return c});var c=a.RTCPeerConnection.prototype.addTrack;c&&(a.RTCPeerConnection.prototype.addTrack=
function(){var a=c.apply(this,arguments);a._pc=this;return a});a.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}};f.shimReceiverGetStats=function(a){if("object"===("undefined"===typeof a?"undefined":d(a))&&a.RTCPeerConnection&&a.RTCRtpSender&&!(a.RTCRtpSender&&"getStats"in a.RTCRtpReceiver.prototype)){var c=a.RTCPeerConnection.prototype.getReceivers;c&&(a.RTCPeerConnection.prototype.getReceivers=function(){var a=this,b=c.apply(this,
[]);b.forEach(function(b){return b._pc=a});return b});b.wrapPeerConnectionEvent(a,"track",function(a){a.receiver._pc=a.srcElement;return a});a.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}};f.shimRemoveStream=function(a){!a.RTCPeerConnection||"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(a){var c=this;b.deprecated("removeStream","removeTrack");this.getSenders().forEach(function(b){b.track&&a.getTracks().includes(b.track)&&
c.removeTrack(b)})})};f.shimRTCDataChannel=function(a){a.DataChannel&&!a.RTCDataChannel&&(a.RTCDataChannel=a.DataChannel)};var b=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);b.default=a;return b}(h("../utils"))},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(h,g,f){Object.defineProperty(f,"__esModule",{value:!0});f.shimGetDisplayMedia=function(d,a){d.navigator.mediaDevices&&"getDisplayMedia"in
d.navigator.mediaDevices||!d.navigator.mediaDevices||(d.navigator.mediaDevices.getDisplayMedia=function(c){if(!c||!c.video)return c=new DOMException("getDisplayMedia without video constraints is undefined"),c.name="NotFoundError",c.code=8,Promise.reject(c);!0===c.video?c.video={mediaSource:a}:c.video.mediaSource=a;return d.navigator.mediaDevices.getUserMedia(c)})}},{}],13:[function(h,g,f){Object.defineProperty(f,"__esModule",{value:!0});$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbolIterator();
var d="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbol();return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};f.shimGetUserMedia=function(c){var b=a.detectBrowser(c),k=c&&c.navigator;c=c&&c.MediaStreamTrack;k.getUserMedia=function(b,e,c){a.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia");k.mediaDevices.getUserMedia(b).then(e,
c)};if(!(55<b.version&&"autoGainControl"in k.mediaDevices.getSupportedConstraints())){var f=function(a,b,e){b in a&&!(e in a)&&(a[e]=a[b],delete a[b])},l=k.mediaDevices.getUserMedia.bind(k.mediaDevices);k.mediaDevices.getUserMedia=function(a){"object"===("undefined"===typeof a?"undefined":d(a))&&"object"===d(a.audio)&&(a=JSON.parse(JSON.stringify(a)),f(a.audio,"autoGainControl","mozAutoGainControl"),f(a.audio,"noiseSuppression","mozNoiseSuppression"));return l(a)};if(c&&c.prototype.getSettings){var e=
c.prototype.getSettings;c.prototype.getSettings=function(){var a=e.apply(this,arguments);f(a,"mozAutoGainControl","autoGainControl");f(a,"mozNoiseSuppression","noiseSuppression");return a}}if(c&&c.prototype.applyConstraints){var g=c.prototype.applyConstraints;c.prototype.applyConstraints=function(a){"audio"===this.kind&&"object"===("undefined"===typeof a?"undefined":d(a))&&(a=JSON.parse(JSON.stringify(a)),f(a,"autoGainControl","mozAutoGainControl"),f(a,"noiseSuppression","mozNoiseSuppression"));return g.apply(this,
[a])}}}};var a=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);b.default=a;return b}(h("../utils"))},{"../utils":15}],14:[function(h,g,f){function d(a){return a&&void 0!==a.video?Object.assign({},a,{video:c.compactObject(a.video)}):a}Object.defineProperty(f,"__esModule",{value:!0});$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbolIterator();var a="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?
function(a){return typeof a}:function(a){$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbol();return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};f.shimLocalStreamsAPI=function(b){if("object"===("undefined"===typeof b?"undefined":a(b))&&b.RTCPeerConnection){"getLocalStreams"in b.RTCPeerConnection.prototype||(b.RTCPeerConnection.prototype.getLocalStreams=function(){this._localStreams||(this._localStreams=[]);return this._localStreams});if(!("addStream"in
b.RTCPeerConnection.prototype)){var c=b.RTCPeerConnection.prototype.addTrack;b.RTCPeerConnection.prototype.addStream=function(a){var b=this;this._localStreams||(this._localStreams=[]);this._localStreams.includes(a)||this._localStreams.push(a);a.getTracks().forEach(function(e){return c.call(b,e,a)})};b.RTCPeerConnection.prototype.addTrack=function(a,b){b&&(this._localStreams?this._localStreams.includes(b)||this._localStreams.push(b):this._localStreams=[b]);return c.call(this,a,b)}}"removeStream"in
b.RTCPeerConnection.prototype||(b.RTCPeerConnection.prototype.removeStream=function(a){var b=this;this._localStreams||(this._localStreams=[]);var e=this._localStreams.indexOf(a);if(-1!==e){this._localStreams.splice(e,1);var c=a.getTracks();this.getSenders().forEach(function(a){c.includes(a.track)&&b.removeTrack(a)})}})}};f.shimRemoteStreamsAPI=function(b){if("object"===("undefined"===typeof b?"undefined":a(b))&&b.RTCPeerConnection&&("getRemoteStreams"in b.RTCPeerConnection.prototype||(b.RTCPeerConnection.prototype.getRemoteStreams=
function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in b.RTCPeerConnection.prototype))){Object.defineProperty(b.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(a){var b=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly));this.addEventListener("addstream",this._onaddstream=a);this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(function(a){b._remoteStreams||
(b._remoteStreams=[]);if(!b._remoteStreams.includes(a)){b._remoteStreams.push(a);var e=new Event("addstream");e.stream=a;b.dispatchEvent(e)}})})}});var c=b.RTCPeerConnection.prototype.setRemoteDescription;b.RTCPeerConnection.prototype.setRemoteDescription=function(){var a=this;this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(b){b.streams.forEach(function(b){a._remoteStreams||(a._remoteStreams=[]);if(!(0<=a._remoteStreams.indexOf(b))){a._remoteStreams.push(b);var e=
new Event("addstream");e.stream=b;a.dispatchEvent(e)}})});return c.apply(a,arguments)}}};f.shimCallbacksAPI=function(b){if("object"===("undefined"===typeof b?"undefined":a(b))&&b.RTCPeerConnection){b=b.RTCPeerConnection.prototype;var c=b.createOffer,d=b.createAnswer,f=b.setLocalDescription,e=b.setRemoteDescription,g=b.addIceCandidate;b.createOffer=function(a,b){var e=c.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);if(!b)return e;e.then(a,b);return Promise.resolve()};b.createAnswer=function(a,
b){var e=d.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);if(!b)return e;e.then(a,b);return Promise.resolve()};var h=function(a,b,e){a=f.apply(this,[a]);if(!e)return a;a.then(b,e);return Promise.resolve()};b.setLocalDescription=h;h=function(a,b,c){a=e.apply(this,[a]);if(!c)return a;a.then(b,c);return Promise.resolve()};b.setRemoteDescription=h;h=function(a,b,e){a=g.apply(this,[a]);if(!e)return a;a.then(b,e);return Promise.resolve()};b.addIceCandidate=h}};f.shimGetUserMedia=function(a){var b=
a&&a.navigator;if(b.mediaDevices&&b.mediaDevices.getUserMedia){a=b.mediaDevices;var c=a.getUserMedia.bind(a);b.mediaDevices.getUserMedia=function(a){return c(d(a))}}!b.getUserMedia&&b.mediaDevices&&b.mediaDevices.getUserMedia&&(b.getUserMedia=function(a,e,c){b.mediaDevices.getUserMedia(a).then(e,c)}.bind(b))};f.shimConstraints=d;f.shimRTCIceServerUrls=function(a){var b=a.RTCPeerConnection;a.RTCPeerConnection=function(a,d){if(a&&a.iceServers){for(var e=[],k=0;k<a.iceServers.length;k++){var f=a.iceServers[k];
!f.hasOwnProperty("urls")&&f.hasOwnProperty("url")?(c.deprecated("RTCIceServer.url","RTCIceServer.urls"),f=JSON.parse(JSON.stringify(f)),f.urls=f.url,delete f.url,e.push(f)):e.push(a.iceServers[k])}a.iceServers=e}return new b(a,d)};a.RTCPeerConnection.prototype=b.prototype;"generateCertificate"in a.RTCPeerConnection&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return b.generateCertificate}})};f.shimTrackEventTransceiver=function(b){"object"===("undefined"===typeof b?
"undefined":a(b))&&b.RTCPeerConnection&&"receiver"in b.RTCTrackEvent.prototype&&!b.RTCTransceiver&&Object.defineProperty(b.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})};f.shimCreateOfferLegacy=function(a){var b=a.RTCPeerConnection.prototype.createOffer;a.RTCPeerConnection.prototype.createOffer=function(a){if(a){"undefined"!==typeof a.offerToReceiveAudio&&(a.offerToReceiveAudio=!!a.offerToReceiveAudio);var c=this.getTransceivers().find(function(a){return a.sender.track&&
"audio"===a.sender.track.kind});!1===a.offerToReceiveAudio&&c?"sendrecv"===c.direction?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":"recvonly"===c.direction&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):!0!==a.offerToReceiveAudio||c||this.addTransceiver("audio");"undefined"!==typeof a.offerToReceiveVideo&&(a.offerToReceiveVideo=!!a.offerToReceiveVideo);c=this.getTransceivers().find(function(a){return a.sender.track&&"video"===a.sender.track.kind});!1===a.offerToReceiveVideo&&
c?"sendrecv"===c.direction?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":"recvonly"===c.direction&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):!0!==a.offerToReceiveVideo||c||this.addTransceiver("video")}return b.apply(this,arguments)}};var c=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);b.default=a;return b}(h("../utils"))},{"../utils":15}],15:[function(h,g,f){function d(a,
b,c){b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c;return a}function a(a,b,c){return(a=a.match(b))&&a.length>=c&&parseInt(a[c],10)}function c(a){return"object"!==("undefined"===typeof a?"undefined":b(a))?a:Object.keys(a).reduce(function(e,k){var f="object"===b(a[k]),g=f?c(a[k]):a[k];f=f&&!Object.keys(g).length;return void 0===g||f?e:Object.assign(e,d({},k,g))},{})}Object.defineProperty(f,"__esModule",{value:!0});$jscomp.initSymbol();$jscomp.initSymbol();
$jscomp.initSymbolIterator();var b="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbol();return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};f.extractVersion=a;f.wrapPeerConnectionEvent=function(a,b,c){if(a.RTCPeerConnection){a=a.RTCPeerConnection.prototype;var e=a.addEventListener;a.addEventListener=function(a,d){if(a!==b)return e.apply(this,
arguments);var k=function(a){(a=c(a))&&d(a)};this._eventMap=this._eventMap||{};this._eventMap[d]=k;return e.apply(this,[a,k])};var d=a.removeEventListener;a.removeEventListener=function(a,e){if(a!==b||!this._eventMap||!this._eventMap[e])return d.apply(this,arguments);var c=this._eventMap[e];delete this._eventMap[e];return d.apply(this,[a,c])};Object.defineProperty(a,"on"+b,{get:function(){return this["_on"+b]},set:function(a){this["_on"+b]&&(this.removeEventListener(b,this["_on"+b]),delete this["_on"+
b]);a&&this.addEventListener(b,this["_on"+b]=a)},enumerable:!0,configurable:!0})}};f.disableLog=function(a){return"boolean"!==typeof a?Error("Argument type: "+("undefined"===typeof a?"undefined":b(a))+". Please use a boolean."):(k=a)?"adapter.js logging disabled":"adapter.js logging enabled"};f.disableWarnings=function(a){if("boolean"!==typeof a)return Error("Argument type: "+("undefined"===typeof a?"undefined":b(a))+". Please use a boolean.");m=!a;return"adapter.js deprecation warnings "+(a?"disabled":
"enabled")};f.log=function(){"object"!==("undefined"===typeof window?"undefined":b(window))||k||"undefined"!==typeof console&&"function"===typeof console.log&&console.log.apply(console,arguments)};f.deprecated=function(a,b){m&&console.warn(a+" is deprecated, please use "+b+" instead.")};f.detectBrowser=function(b){var e=b.navigator,c={browser:null,version:null};if("undefined"===typeof b||!b.navigator)return c.browser="Not a browser.",c;e.mozGetUserMedia?(c.browser="firefox",c.version=a(e.userAgent,
/Firefox\/(\d+)\./,1)):e.webkitGetUserMedia?(c.browser="chrome",c.version=a(e.userAgent,/Chrom(e|ium)\/(\d+)\./,2)):e.mediaDevices&&e.userAgent.match(/Edge\/(\d+).(\d+)$/)?(c.browser="edge",c.version=a(e.userAgent,/Edge\/(\d+).(\d+)$/,2)):b.RTCPeerConnection&&e.userAgent.match(/AppleWebKit\/(\d+)\./)?(c.browser="safari",c.version=a(e.userAgent,/AppleWebKit\/(\d+)\./,1)):c.browser="Not a supported browser.";return c};f.compactObject=c;var k=!0,m=!0},{}],16:[function(h,g,f){function d(a,b,c,d,k){b=
l.writeRtpDescription(a.kind,b);b+=l.writeIceParameters(a.iceGatherer.getLocalParameters());b+=l.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===c?"actpass":k||"active");b+="a=mid:"+a.mid+"\r\n";b=a.rtpSender&&a.rtpReceiver?b+"a=sendrecv\r\n":a.rtpSender?b+"a=sendonly\r\n":a.rtpReceiver?b+"a=recvonly\r\n":b+"a=inactive\r\n";a.rtpSender&&(c=a.rtpSender._initialTrackId||a.rtpSender.track.id,a.rtpSender._initialTrackId=c,d="msid:"+(d?d.id:"-")+" "+c+"\r\n",b=b+("a="+d)+("a=ssrc:"+
a.sendEncodingParameters[0].ssrc+" "+d),a.sendEncodingParameters[0].rtx&&(b+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+d,b+="a=ssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+"\r\n"));b+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+l.localCName+"\r\n";a.rtpSender&&a.sendEncodingParameters[0].rtx&&(b+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" cname:"+l.localCName+"\r\n");return b}function a(a,b){var c=!1;a=JSON.parse(JSON.stringify(a));
return a.filter(function(a){if(a&&(a.urls||a.url)){var e=a.urls||a.url;a.url&&!a.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var d="string"===typeof e;d&&(e=[e]);e=e.filter(function(a){return 0!==a.indexOf("turn:")||-1===a.indexOf("transport=udp")||-1!==a.indexOf("turn:[")||c?0===a.indexOf("stun:")&&14393<=b&&-1===a.indexOf("?transport=udp"):c=!0});delete a.url;a.urls=d?e[0]:e;return!!e.length}})}function c(a,b){var c={codecs:[],headerExtensions:[],fecMechanisms:[]},e=
function(a,b){a=parseInt(a,10);for(var c=0;c<b.length;c++)if(b[c].payloadType===a||b[c].preferredPayloadType===a)return b[c]},d=function(a,b,c,d){a=e(a.parameters.apt,c);b=e(b.parameters.apt,d);return a&&b&&a.name.toLowerCase()===b.name.toLowerCase()};a.codecs.forEach(function(e){for(var k=0;k<b.codecs.length;k++){var f=b.codecs[k];if(e.name.toLowerCase()===f.name.toLowerCase()&&e.clockRate===f.clockRate&&("rtx"!==e.name.toLowerCase()||!e.parameters||!f.parameters.apt||d(e,f,a.codecs,b.codecs))){f=
JSON.parse(JSON.stringify(f));f.numChannels=Math.min(e.numChannels,f.numChannels);c.codecs.push(f);f.rtcpFeedback=f.rtcpFeedback.filter(function(a){for(var b=0;b<e.rtcpFeedback.length;b++)if(e.rtcpFeedback[b].type===a.type&&e.rtcpFeedback[b].parameter===a.parameter)return!0;return!1});break}}});a.headerExtensions.forEach(function(a){for(var e=0;e<b.headerExtensions.length;e++){var d=b.headerExtensions[e];if(a.uri===d.uri){c.headerExtensions.push(d);break}}});return c}function b(a,b,c){return-1!==
{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[b][a].indexOf(c)}function k(a,b){var c=a.getRemoteCandidates().find(function(a){return b.foundation===a.foundation&&b.ip===a.ip&&b.port===a.port&&b.priority===a.priority&&b.protocol===a.protocol&&b.type===a.type});c||a.addRemoteCandidate(b);return!c}function m(a,
b){b=Error(b);b.name=a;b.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[a];return b}var l=h("sdp");g.exports=function(e,f){function g(a,b){b.addTrack(a);b.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:a}))}function h(a,b){b.removeTrack(a);b.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:a}))}function p(a,b,c,d){var k=new Event("track");k.track=b;k.receiver=c;k.transceiver={receiver:c};k.streams=d;e.setTimeout(function(){a._dispatchEvent("track",
k)})}var n=function(b){var c=this,d=document.createDocumentFragment();["addEventListener","removeEventListener","dispatchEvent"].forEach(function(a){c[a]=d[a].bind(d)});this.canTrickleIceCandidates=null;this.needNegotiation=!1;this.localStreams=[];this.remoteStreams=[];this._remoteDescription=this._localDescription=null;this.signalingState="stable";this.iceGatheringState=this.connectionState=this.iceConnectionState="new";b=JSON.parse(JSON.stringify(b||{}));this.usingBundle="max-bundle"===b.bundlePolicy;
if("negotiate"===b.rtcpMuxPolicy)throw m("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");b.rtcpMuxPolicy||(b.rtcpMuxPolicy="require");switch(b.iceTransportPolicy){case "all":case "relay":break;default:b.iceTransportPolicy="all"}switch(b.bundlePolicy){case "balanced":case "max-compat":case "max-bundle":break;default:b.bundlePolicy="balanced"}b.iceServers=a(b.iceServers||[],f);this._iceGatherers=[];if(b.iceCandidatePoolSize)for(var k=b.iceCandidatePoolSize;0<k;k--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:b.iceServers,
gatherPolicy:b.iceTransportPolicy}));else b.iceCandidatePoolSize=0;this._config=b;this.transceivers=[];this._sdpSessionId=l.generateSessionId();this._sdpSessionVersion=0;this._dtlsRole=void 0;this._isClosed=!1};Object.defineProperty(n.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}});Object.defineProperty(n.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}});n.prototype.onicecandidate=null;n.prototype.onaddstream=
null;n.prototype.ontrack=null;n.prototype.onremovestream=null;n.prototype.onsignalingstatechange=null;n.prototype.oniceconnectionstatechange=null;n.prototype.onconnectionstatechange=null;n.prototype.onicegatheringstatechange=null;n.prototype.onnegotiationneeded=null;n.prototype.ondatachannel=null;n.prototype._dispatchEvent=function(a,b){if(!this._isClosed&&(this.dispatchEvent(b),"function"===typeof this["on"+a]))this["on"+a](b)};n.prototype._emitGatheringStateChange=function(){var a=new Event("icegatheringstatechange");
this._dispatchEvent("icegatheringstatechange",a)};n.prototype.getConfiguration=function(){return this._config};n.prototype.getLocalStreams=function(){return this.localStreams};n.prototype.getRemoteStreams=function(){return this.remoteStreams};n.prototype._createTransceiver=function(a,b){var c=0<this.transceivers.length;a={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:a,mid:null,sendEncodingParameters:null,
recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};this.usingBundle&&c?(a.iceTransport=this.transceivers[0].iceTransport,a.dtlsTransport=this.transceivers[0].dtlsTransport):(c=this._createIceAndDtlsTransports(),a.iceTransport=c.iceTransport,a.dtlsTransport=c.dtlsTransport);b||this.transceivers.push(a);return a};n.prototype.addTrack=function(a,b){if(this._isClosed)throw m("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");if(this.transceivers.find(function(b){return b.track===
a}))throw m("InvalidAccessError","Track already exists.");for(var c,d=0;d<this.transceivers.length;d++)this.transceivers[d].track||this.transceivers[d].kind!==a.kind||(c=this.transceivers[d]);c||(c=this._createTransceiver(a.kind));this._maybeFireNegotiationNeeded();-1===this.localStreams.indexOf(b)&&this.localStreams.push(b);c.track=a;c.stream=b;c.rtpSender=new e.RTCRtpSender(a,c.dtlsTransport);return c.rtpSender};n.prototype.addStream=function(a){var b=this;if(15025<=f)a.getTracks().forEach(function(c){b.addTrack(c,
a)});else{var c=a.clone();a.getTracks().forEach(function(a,b){var e=c.getTracks()[b];a.addEventListener("enabled",function(a){e.enabled=a.enabled})});c.getTracks().forEach(function(a){b.addTrack(a,c)})}};n.prototype.removeTrack=function(a){if(this._isClosed)throw m("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(a instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var b=this.transceivers.find(function(b){return b.rtpSender===
a});if(!b)throw m("InvalidAccessError","Sender was not created by this connection.");var c=b.stream;b.rtpSender.stop();b.rtpSender=null;b.track=null;b.stream=null;-1===this.transceivers.map(function(a){return a.stream}).indexOf(c)&&-1<this.localStreams.indexOf(c)&&this.localStreams.splice(this.localStreams.indexOf(c),1);this._maybeFireNegotiationNeeded()};n.prototype.removeStream=function(a){var b=this;a.getTracks().forEach(function(a){var c=b.getSenders().find(function(b){return b.track===a});c&&
b.removeTrack(c)})};n.prototype.getSenders=function(){return this.transceivers.filter(function(a){return!!a.rtpSender}).map(function(a){return a.rtpSender})};n.prototype.getReceivers=function(){return this.transceivers.filter(function(a){return!!a.rtpReceiver}).map(function(a){return a.rtpReceiver})};n.prototype._createIceGatherer=function(a,b){var c=this;if(b&&0<a)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var d=new e.RTCIceGatherer({iceServers:this._config.iceServers,
gatherPolicy:this._config.iceTransportPolicy});Object.defineProperty(d,"state",{value:"new",writable:!0});this.transceivers[a].bufferedCandidateEvents=[];this.transceivers[a].bufferCandidates=function(b){var e=!b.candidate||0===Object.keys(b.candidate).length;d.state=e?"completed":"gathering";null!==c.transceivers[a].bufferedCandidateEvents&&c.transceivers[a].bufferedCandidateEvents.push(b)};d.addEventListener("localcandidate",this.transceivers[a].bufferCandidates);return d};n.prototype._gather=function(a,
b){var c=this,d=this.transceivers[b].iceGatherer;if(!d.onlocalcandidate){var k=this.transceivers[b].bufferedCandidateEvents;this.transceivers[b].bufferedCandidateEvents=null;d.removeEventListener("localcandidate",this.transceivers[b].bufferCandidates);d.onlocalcandidate=function(e){if(!(c.usingBundle&&0<b)){var k=new Event("icecandidate");k.candidate={sdpMid:a,sdpMLineIndex:b};var f=e.candidate;if(e=!f||0===Object.keys(f).length){if("new"===d.state||"gathering"===d.state)d.state="completed"}else"new"===
d.state&&(d.state="gathering"),f.component=1,f.ufrag=d.getLocalParameters().usernameFragment,f=l.writeCandidate(f),k.candidate=Object.assign(k.candidate,l.parseCandidate(f)),k.candidate.candidate=f,k.candidate.toJSON=function(){return{candidate:k.candidate.candidate,sdpMid:k.candidate.sdpMid,sdpMLineIndex:k.candidate.sdpMLineIndex,usernameFragment:k.candidate.usernameFragment}};f=l.getMediaSections(c._localDescription.sdp);f[k.candidate.sdpMLineIndex]=e?f[k.candidate.sdpMLineIndex]+"a=end-of-candidates\r\n":
f[k.candidate.sdpMLineIndex]+("a="+k.candidate.candidate+"\r\n");c._localDescription.sdp=l.getDescription(c._localDescription.sdp)+f.join("");f=c.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});"gathering"!==c.iceGatheringState&&(c.iceGatheringState="gathering",c._emitGatheringStateChange());e||c._dispatchEvent("icecandidate",k);f&&(c._dispatchEvent("icecandidate",new Event("icecandidate")),c.iceGatheringState="complete",c._emitGatheringStateChange())}};e.setTimeout(function(){k.forEach(function(a){d.onlocalcandidate(a)})},
0)}};n.prototype._createIceAndDtlsTransports=function(){var a=this,b=new e.RTCIceTransport(null);b.onicestatechange=function(){a._updateIceConnectionState();a._updateConnectionState()};var c=new e.RTCDtlsTransport(b);c.ondtlsstatechange=function(){a._updateConnectionState()};c.onerror=function(){Object.defineProperty(c,"state",{value:"failed",writable:!0});a._updateConnectionState()};return{iceTransport:b,dtlsTransport:c}};n.prototype._disposeIceAndDtlsTransports=function(a){var b=this.transceivers[a].iceGatherer;
b&&(delete b.onlocalcandidate,delete this.transceivers[a].iceGatherer);if(b=this.transceivers[a].iceTransport)delete b.onicestatechange,delete this.transceivers[a].iceTransport;if(b=this.transceivers[a].dtlsTransport)delete b.ondtlsstatechange,delete b.onerror,delete this.transceivers[a].dtlsTransport};n.prototype._transceive=function(a,b,e){var d=c(a.localCapabilities,a.remoteCapabilities);b&&a.rtpSender&&(d.encodings=a.sendEncodingParameters,d.rtcp={cname:l.localCName,compound:a.rtcpParameters.compound},
a.recvEncodingParameters.length&&(d.rtcp.ssrc=a.recvEncodingParameters[0].ssrc),a.rtpSender.send(d));e&&a.rtpReceiver&&0<d.codecs.length&&("video"===a.kind&&a.recvEncodingParameters&&15019>f&&a.recvEncodingParameters.forEach(function(a){delete a.rtx}),d.encodings=a.recvEncodingParameters.length?a.recvEncodingParameters:[{}],d.rtcp={compound:a.rtcpParameters.compound},a.rtcpParameters.cname&&(d.rtcp.cname=a.rtcpParameters.cname),a.sendEncodingParameters.length&&(d.rtcp.ssrc=a.sendEncodingParameters[0].ssrc),
a.rtpReceiver.receive(d))};n.prototype.setLocalDescription=function(a){var e=this;if(-1===["offer","answer"].indexOf(a.type))return Promise.reject(m("TypeError",'Unsupported type "'+a.type+'"'));if(!b("setLocalDescription",a.type,e.signalingState)||e._isClosed)return Promise.reject(m("InvalidStateError","Can not set local "+a.type+" in state "+e.signalingState));if("offer"===a.type){var d=l.splitSections(a.sdp);var k=d.shift();d.forEach(function(a,b){a=l.parseRtpParameters(a);e.transceivers[b].localCapabilities=
a});e.transceivers.forEach(function(a,b){e._gather(a.mid,b)})}else if("answer"===a.type){d=l.splitSections(e._remoteDescription.sdp);k=d.shift();var f=0<l.matchPrefix(k,"a=ice-lite").length;d.forEach(function(a,b){var d=e.transceivers[b],g=d.iceGatherer,h=d.iceTransport,m=d.dtlsTransport,q=d.localCapabilities,w=d.remoteCapabilities;if(!(l.isRejected(a)&&0===l.matchPrefix(a,"a=bundle-only").length||d.rejected)){var p=l.getIceParameters(a,k);a=l.getDtlsParameters(a,k);f&&(a.role="server");e.usingBundle&&
0!==b||(e._gather(d.mid,b),"new"===h.state&&h.start(g,p,f?"controlling":"controlled"),"new"===m.state&&m.start(a));b=c(q,w);e._transceive(d,0<b.codecs.length,!1)}})}e._localDescription={type:a.type,sdp:a.sdp};"offer"===a.type?e._updateSignalingState("have-local-offer"):e._updateSignalingState("stable");return Promise.resolve()};n.prototype.setRemoteDescription=function(a){var d=this;if(-1===["offer","answer"].indexOf(a.type))return Promise.reject(m("TypeError",'Unsupported type "'+a.type+'"'));if(!b("setRemoteDescription",
a.type,d.signalingState)||d._isClosed)return Promise.reject(m("InvalidStateError","Can not set remote "+a.type+" in state "+d.signalingState));var q={};d.remoteStreams.forEach(function(a){q[a.id]=a});var n=[],t=l.splitSections(a.sdp),x=t.shift(),u=0<l.matchPrefix(x,"a=ice-lite").length,r=0<l.matchPrefix(x,"a=group:BUNDLE ").length;d.usingBundle=r;var H=l.matchPrefix(x,"a=ice-options:")[0];d.canTrickleIceCandidates=H?0<=H.substr(14).split(" ").indexOf("trickle"):!1;t.forEach(function(b,m){var p=l.splitLines(b),
t=l.getKind(b),w=l.isRejected(b)&&0===l.matchPrefix(b,"a=bundle-only").length,B=p[0].substr(2).split(" ")[2];p=l.getDirection(b,x);var A=l.parseMsid(b),F=l.getMid(b)||l.generateIdentifier();if(w||"application"===t&&("DTLS/SCTP"===B||"UDP/DTLS/SCTP"===B))d.transceivers[m]={mid:F,kind:t,protocol:B,rejected:!0};else{!w&&d.transceivers[m]&&d.transceivers[m].rejected&&(d.transceivers[m]=d._createTransceiver(t,!0));var G=l.parseRtpParameters(b);if(!w){var K=l.getIceParameters(b,x);var C=l.getDtlsParameters(b,
x);C.role="client"}B=l.parseRtpEncodingParameters(b);var I=l.parseRtcpParameters(b),O=0<l.matchPrefix(b,"a=end-of-candidates",x).length,H=l.matchPrefix(b,"a=candidate:").map(function(a){return l.parseCandidate(a)}).filter(function(a){return 1===a.component});("offer"===a.type||"answer"===a.type)&&!w&&r&&0<m&&d.transceivers[m]&&(d._disposeIceAndDtlsTransports(m),d.transceivers[m].iceGatherer=d.transceivers[0].iceGatherer,d.transceivers[m].iceTransport=d.transceivers[0].iceTransport,d.transceivers[m].dtlsTransport=
d.transceivers[0].dtlsTransport,d.transceivers[m].rtpSender&&d.transceivers[m].rtpSender.setTransport(d.transceivers[0].dtlsTransport),d.transceivers[m].rtpReceiver&&d.transceivers[m].rtpReceiver.setTransport(d.transceivers[0].dtlsTransport));if("offer"!==a.type||w)"answer"!==a.type||w||(y=d.transceivers[m],N=y.iceGatherer,t=y.iceTransport,F=y.dtlsTransport,Q=y.rtpReceiver,w=y.sendEncodingParameters,b=y.localCapabilities,d.transceivers[m].recvEncodingParameters=B,d.transceivers[m].remoteCapabilities=
G,d.transceivers[m].rtcpParameters=I,H.length&&"new"===t.state&&(!u&&!O||r&&0!==m?H.forEach(function(a){k(y.iceTransport,a)}):t.setRemoteCandidates(H)),r&&0!==m||("new"===t.state&&t.start(N,K,"controlling"),"new"===F.state&&F.start(C)),!c(y.localCapabilities,y.remoteCapabilities).codecs.filter(function(a){return"rtx"===a.name.toLowerCase()}).length&&y.sendEncodingParameters[0].rtx&&delete y.sendEncodingParameters[0].rtx,d._transceive(y,"sendrecv"===p||"recvonly"===p,"sendrecv"===p||"sendonly"===p),
!Q||"sendrecv"!==p&&"sendonly"!==p?delete y.rtpReceiver:(p=Q.track,A?(q[A.stream]||(q[A.stream]=new e.MediaStream),g(p,q[A.stream]),n.push([p,Q,q[A.stream]])):(q.default||(q.default=new e.MediaStream),g(p,q.default),n.push([p,Q,q.default]))));else{var y=d.transceivers[m]||d._createTransceiver(t);y.mid=F;y.iceGatherer||(y.iceGatherer=d._createIceGatherer(m,r));H.length&&"new"===y.iceTransport.state&&(!O||r&&0!==m?H.forEach(function(a){k(y.iceTransport,a)}):y.iceTransport.setRemoteCandidates(H));b=
e.RTCRtpReceiver.getCapabilities(t);15019>f&&(b.codecs=b.codecs.filter(function(a){return"rtx"!==a.name}));w=y.sendEncodingParameters||[{ssrc:1001*(2*m+2)}];K=!1;if("sendrecv"===p||"sendonly"===p){K=!y.rtpReceiver;var Q=y.rtpReceiver||new e.RTCRtpReceiver(y.dtlsTransport,t);if(K){p=Q.track;if(!A||"-"!==A.stream)if(A){q[A.stream]||(q[A.stream]=new e.MediaStream,Object.defineProperty(q[A.stream],"id",{get:function(){return A.stream}}));Object.defineProperty(p,"id",{get:function(){return A.track}});
var N=q[A.stream]}else q.default||(q.default=new e.MediaStream),N=q.default;N&&(g(p,N),y.associatedRemoteMediaStreams.push(N));n.push([p,Q,N])}}else y.rtpReceiver&&y.rtpReceiver.track&&(y.associatedRemoteMediaStreams.forEach(function(a){var b=a.getTracks().find(function(a){return a.id===y.rtpReceiver.track.id});b&&h(b,a)}),y.associatedRemoteMediaStreams=[]);y.localCapabilities=b;y.remoteCapabilities=G;y.rtpReceiver=Q;y.rtcpParameters=I;y.sendEncodingParameters=w;y.recvEncodingParameters=B;d._transceive(d.transceivers[m],
!1,K)}}});void 0===d._dtlsRole&&(d._dtlsRole="offer"===a.type?"active":"passive");d._remoteDescription={type:a.type,sdp:a.sdp};"offer"===a.type?d._updateSignalingState("have-remote-offer"):d._updateSignalingState("stable");Object.keys(q).forEach(function(a){var b=q[a];if(b.getTracks().length){if(-1===d.remoteStreams.indexOf(b)){d.remoteStreams.push(b);var c=new Event("addstream");c.stream=b;e.setTimeout(function(){d._dispatchEvent("addstream",c)})}n.forEach(function(a){b.id===a[2].id&&p(d,a[0],a[1],
[b])})}});n.forEach(function(a){a[2]||p(d,a[0],a[1],[])});e.setTimeout(function(){d&&d.transceivers&&d.transceivers.forEach(function(a){a.iceTransport&&"new"===a.iceTransport.state&&0<a.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),a.iceTransport.addRemoteCandidate({}))})},4E3);return Promise.resolve()};n.prototype.close=function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop();
a.dtlsTransport&&a.dtlsTransport.stop();a.rtpSender&&a.rtpSender.stop();a.rtpReceiver&&a.rtpReceiver.stop()});this._isClosed=!0;this._updateSignalingState("closed")};n.prototype._updateSignalingState=function(a){this.signalingState=a;a=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",a)};n.prototype._maybeFireNegotiationNeeded=function(){var a=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(a.needNegotiation){a.needNegotiation=
!1;var b=new Event("negotiationneeded");a._dispatchEvent("negotiationneeded",b)}},0))};n.prototype._updateIceConnectionState=function(){var a={"new":0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(b){b.iceTransport&&!b.rejected&&a[b.iceTransport.state]++});var b="new";0<a.failed?b="failed":0<a.checking?b="checking":0<a.disconnected?b="disconnected":0<a.new?b="new":0<a.connected?b="connected":0<a.completed&&(b="completed");b!==this.iceConnectionState&&
(this.iceConnectionState=b,b=new Event("iceconnectionstatechange"),this._dispatchEvent("iceconnectionstatechange",b))};n.prototype._updateConnectionState=function(){var a={"new":0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(b){b.iceTransport&&b.dtlsTransport&&!b.rejected&&(a[b.iceTransport.state]++,a[b.dtlsTransport.state]++)});a.connected+=a.completed;var b="new";0<a.failed?b="failed":0<a.connecting?b="connecting":0<a.disconnected?b="disconnected":
0<a.new?b="new":0<a.connected&&(b="connected");b!==this.connectionState&&(this.connectionState=b,b=new Event("connectionstatechange"),this._dispatchEvent("connectionstatechange",b))};n.prototype.createOffer=function(a){var b=this;if(b._isClosed)return Promise.reject(m("InvalidStateError","Can not call createOffer after close"));var c=b.transceivers.filter(function(a){return"audio"===a.kind}).length,k=b.transceivers.filter(function(a){return"video"===a.kind}).length;if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");
void 0!==a.offerToReceiveAudio&&(c=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio);void 0!==a.offerToReceiveVideo&&(k=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(b.transceivers.forEach(function(a){"audio"===a.kind?(c--,0>c&&(a.wantReceive=!1)):"video"===a.kind&&(k--,0>k&&(a.wantReceive=!1))});0<c||0<k;)0<c&&(b._createTransceiver("audio"),c--),0<k&&(b._createTransceiver("video"),k--);var g=l.writeSessionBoilerplate(b._sdpSessionId,
b._sdpSessionVersion++);b.transceivers.forEach(function(a,c){var d=a.track,k=a.kind,g=a.mid||l.generateIdentifier();a.mid=g;a.iceGatherer||(a.iceGatherer=b._createIceGatherer(c,b.usingBundle));g=e.RTCRtpSender.getCapabilities(k);15019>f&&(g.codecs=g.codecs.filter(function(a){return"rtx"!==a.name}));g.codecs.forEach(function(b){"H264"===b.name&&void 0===b.parameters["level-asymmetry-allowed"]&&(b.parameters["level-asymmetry-allowed"]="1");a.remoteCapabilities&&a.remoteCapabilities.codecs&&a.remoteCapabilities.codecs.forEach(function(a){b.name.toLowerCase()===
a.name.toLowerCase()&&b.clockRate===a.clockRate&&(b.preferredPayloadType=a.payloadType)})});g.headerExtensions.forEach(function(b){(a.remoteCapabilities&&a.remoteCapabilities.headerExtensions||[]).forEach(function(a){b.uri===a.uri&&(b.id=a.id)})});c=a.sendEncodingParameters||[{ssrc:1001*(2*c+1)}];d&&15019<=f&&"video"===k&&!c[0].rtx&&(c[0].rtx={ssrc:c[0].ssrc+1});a.wantReceive&&(a.rtpReceiver=new e.RTCRtpReceiver(a.dtlsTransport,k));a.localCapabilities=g;a.sendEncodingParameters=c});"max-compat"!==
b._config.bundlePolicy&&(g+="a=group:BUNDLE "+b.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n");g+="a=ice-options:trickle\r\n";b.transceivers.forEach(function(a,c){g+=d(a,a.localCapabilities,"offer",a.stream,b._dtlsRole);g+="a=rtcp-rsize\r\n";!a.iceGatherer||"new"===b.iceGatheringState||0!==c&&b.usingBundle||(a.iceGatherer.getLocalCandidates().forEach(function(a){a.component=1;g+="a="+l.writeCandidate(a)+"\r\n"}),"completed"===a.iceGatherer.state&&(g+="a=end-of-candidates\r\n"))});a=
new e.RTCSessionDescription({type:"offer",sdp:g});return Promise.resolve(a)};n.prototype.createAnswer=function(){var a=this;if(a._isClosed)return Promise.reject(m("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==a.signalingState&&"have-local-pranswer"!==a.signalingState)return Promise.reject(m("InvalidStateError","Can not call createAnswer in signalingState "+a.signalingState));var b=l.writeSessionBoilerplate(a._sdpSessionId,a._sdpSessionVersion++);a.usingBundle&&
(b+="a=group:BUNDLE "+a.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n");b+="a=ice-options:trickle\r\n";var k=l.getMediaSections(a._remoteDescription.sdp).length;a.transceivers.forEach(function(e,g){if(!(g+1>k))if(e.rejected)"application"===e.kind?b="DTLS/SCTP"===e.protocol?b+"m=application 0 DTLS/SCTP 5000\r\n":b+("m=application 0 "+e.protocol+" webrtc-datachannel\r\n"):"audio"===e.kind?b+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(b+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),
b+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n";else{if(e.stream){var l;"audio"===e.kind?l=e.stream.getAudioTracks()[0]:"video"===e.kind&&(l=e.stream.getVideoTracks()[0]);l&&15019<=f&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1})}g=c(e.localCapabilities,e.remoteCapabilities);!g.codecs.filter(function(a){return"rtx"===a.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx;
b+=d(e,g,"answer",e.stream,a._dtlsRole);e.rtcpParameters&&e.rtcpParameters.reducedSize&&(b+="a=rtcp-rsize\r\n")}});var g=new e.RTCSessionDescription({type:"answer",sdp:b});return Promise.resolve(g)};n.prototype.addIceCandidate=function(a){var b=this,c;return a&&void 0===a.sdpMLineIndex&&!a.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(e,d){if(b._remoteDescription)if(a&&""!==a.candidate){var f=a.sdpMLineIndex;if(a.sdpMid)for(var g=0;g<b.transceivers.length;g++)if(b.transceivers[g].mid===
a.sdpMid){f=g;break}var h=b.transceivers[f];if(h){if(h.rejected)return e();g=0<Object.keys(a.candidate).length?l.parseCandidate(a.candidate):{};if("tcp"===g.protocol&&(0===g.port||9===g.port)||g.component&&1!==g.component)return e();if((0===f||0<f&&h.iceTransport!==b.transceivers[0].iceTransport)&&!k(h.iceTransport,g))return d(m("OperationError","Can not add ICE candidate"));d=a.candidate.trim();0===d.indexOf("a=")&&(d=d.substr(2));c=l.getMediaSections(b._remoteDescription.sdp);c[f]+="a="+(g.type?
d:"end-of-candidates")+"\r\n";b._remoteDescription.sdp=l.getDescription(b._remoteDescription.sdp)+c.join("")}else return d(m("OperationError","Can not add ICE candidate"))}else for(f=0;f<b.transceivers.length&&(b.transceivers[f].rejected||(b.transceivers[f].iceTransport.addRemoteCandidate({}),c=l.getMediaSections(b._remoteDescription.sdp),c[f]+="a=end-of-candidates\r\n",b._remoteDescription.sdp=l.getDescription(b._remoteDescription.sdp)+c.join(""),!b.usingBundle));f++);else return d(m("InvalidStateError",
"Can not add ICE candidate without a remote description"));e()})};n.prototype.getStats=function(a){if(a&&a instanceof e.MediaStreamTrack){var b=null;this.transceivers.forEach(function(c){c.rtpSender&&c.rtpSender.track===a?b=c.rtpSender:c.rtpReceiver&&c.rtpReceiver.track===a&&(b=c.rtpReceiver)});if(!b)throw m("InvalidAccessError","Invalid selector.");return b.getStats()}var c=[];this.transceivers.forEach(function(a){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(b){a[b]&&
c.push(a[b].getStats())})});return Promise.all(c).then(function(a){var b=new Map;a.forEach(function(a){a.forEach(function(a){b.set(a.id,a)})});return b})};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(a){if((a=e[a])&&a.prototype&&a.prototype.getStats){var b=a.prototype.getStats;a.prototype.getStats=function(){return b.apply(this).then(function(a){var b=new Map;Object.keys(a).forEach(function(c){var e=a[c];a[c].type={inboundrtp:"inbound-rtp",
outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type;b.set(c,a[c])});return b})}}});var u=["createOffer","createAnswer"];u.forEach(function(a){var b=n.prototype[a];n.prototype[a]=function(){var a=arguments;return"function"===typeof a[0]||"function"===typeof a[1]?b.apply(this,[arguments[2]]).then(function(b){"function"===typeof a[0]&&a[0].apply(null,[b])},function(b){"function"===typeof a[1]&&a[1].apply(null,
[b])}):b.apply(this,arguments)}});u=["setLocalDescription","setRemoteDescription","addIceCandidate"];u.forEach(function(a){var b=n.prototype[a];n.prototype[a]=function(){var a=arguments;return"function"===typeof a[1]||"function"===typeof a[2]?b.apply(this,arguments).then(function(){"function"===typeof a[1]&&a[1].apply(null)},function(b){"function"===typeof a[2]&&a[2].apply(null,[b])}):b.apply(this,arguments)}});["getStats"].forEach(function(a){var b=n.prototype[a];n.prototype[a]=function(){var a=
arguments;return"function"===typeof a[1]?b.apply(this,arguments).then(function(){"function"===typeof a[1]&&a[1].apply(null)}):b.apply(this,arguments)}});return n}},{sdp:17}],17:[function(h,g,f){var d={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};d.localCName=d.generateIdentifier();d.splitLines=function(a){return a.trim().split("\n").map(function(a){return a.trim()})};d.splitSections=function(a){return a.split("\nm=").map(function(a,b){return(0<b?"m="+a:a).trim()+
"\r\n"})};d.getDescription=function(a){return(a=d.splitSections(a))&&a[0]};d.getMediaSections=function(a){a=d.splitSections(a);a.shift();return a};d.matchPrefix=function(a,c){return d.splitLines(a).filter(function(a){return 0===a.indexOf(c)})};d.parseCandidate=function(a){a=0===a.indexOf("a=candidate:")?a.substring(12).split(" "):a.substring(10).split(" ");for(var c={foundation:a[0],component:parseInt(a[1],10),protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],
10),type:a[7]},b=8;b<a.length;b+=2)switch(a[b]){case "raddr":c.relatedAddress=a[b+1];break;case "rport":c.relatedPort=parseInt(a[b+1],10);break;case "tcptype":c.tcpType=a[b+1];break;case "ufrag":c.ufrag=a[b+1];c.usernameFragment=a[b+1];break;default:c[a[b]]=a[b+1]}return c};d.writeCandidate=function(a){var c=[];c.push(a.foundation);c.push(a.component);c.push(a.protocol.toUpperCase());c.push(a.priority);c.push(a.address||a.ip);c.push(a.port);var b=a.type;c.push("typ");c.push(b);"host"!==b&&a.relatedAddress&&
a.relatedPort&&(c.push("raddr"),c.push(a.relatedAddress),c.push("rport"),c.push(a.relatedPort));a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(c.push("tcptype"),c.push(a.tcpType));if(a.usernameFragment||a.ufrag)c.push("ufrag"),c.push(a.usernameFragment||a.ufrag);return"candidate:"+c.join(" ")};d.parseIceOptions=function(a){return a.substr(14).split(" ")};d.parseRtpMap=function(a){a=a.substr(9).split(" ");var c={payloadType:parseInt(a.shift(),10)};a=a[0].split("/");c.name=a[0];c.clockRate=parseInt(a[1],
10);c.channels=3===a.length?parseInt(a[2],10):1;c.numChannels=c.channels;return c};d.writeRtpMap=function(a){var c=a.payloadType;void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType);var b=a.channels||a.numChannels||1;return"a=rtpmap:"+c+" "+a.name+"/"+a.clockRate+(1!==b?"/"+b:"")+"\r\n"};d.parseExtmap=function(a){a=a.substr(9).split(" ");return{id:parseInt(a[0],10),direction:0<a[0].indexOf("/")?a[0].split("/")[1]:"sendrecv",uri:a[1]}};d.writeExtmap=function(a){return"a=extmap:"+(a.id||a.preferredId)+
(a.direction&&"sendrecv"!==a.direction?"/"+a.direction:"")+" "+a.uri+"\r\n"};d.parseFmtp=function(a){for(var c={},b=a.substr(a.indexOf(" ")+1).split(";"),d=0;d<b.length;d++)a=b[d].trim().split("="),c[a[0].trim()]=a[1];return c};d.writeFmtp=function(a){var c="",b=a.payloadType;void 0!==a.preferredPayloadType&&(b=a.preferredPayloadType);if(a.parameters&&Object.keys(a.parameters).length){var d=[];Object.keys(a.parameters).forEach(function(b){a.parameters[b]?d.push(b+"="+a.parameters[b]):d.push(b)});
c+="a=fmtp:"+b+" "+d.join(";")+"\r\n"}return c};d.parseRtcpFb=function(a){a=a.substr(a.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}};d.writeRtcpFb=function(a){var c="",b=a.payloadType;void 0!==a.preferredPayloadType&&(b=a.preferredPayloadType);a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(function(a){c+="a=rtcp-fb:"+b+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+"\r\n"});return c};d.parseSsrcMedia=function(a){var c=a.indexOf(" "),b={ssrc:parseInt(a.substr(7,
c-7),10)},d=a.indexOf(":",c);-1<d?(b.attribute=a.substr(c+1,d-c-1),b.value=a.substr(d+1)):b.attribute=a.substr(c+1);return b};d.parseSsrcGroup=function(a){a=a.substr(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(function(a){return parseInt(a,10)})}};d.getMid=function(a){if(a=d.matchPrefix(a,"a=mid:")[0])return a.substr(6)};d.parseFingerprint=function(a){a=a.substr(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1]}};d.getDtlsParameters=function(a,c){return{role:"auto",fingerprints:d.matchPrefix(a+
c,"a=fingerprint:").map(d.parseFingerprint)}};d.writeDtlsParameters=function(a,c){var b="a=setup:"+c+"\r\n";a.fingerprints.forEach(function(a){b+="a=fingerprint:"+a.algorithm+" "+a.value+"\r\n"});return b};d.getIceParameters=function(a,c){a=d.splitLines(a);a=a.concat(d.splitLines(c));return{usernameFragment:a.filter(function(a){return 0===a.indexOf("a=ice-ufrag:")})[0].substr(12),password:a.filter(function(a){return 0===a.indexOf("a=ice-pwd:")})[0].substr(10)}};d.writeIceParameters=function(a){return"a=ice-ufrag:"+
a.usernameFragment+"\r\na=ice-pwd:"+a.password+"\r\n"};d.parseRtpParameters=function(a){for(var c={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},b=d.splitLines(a)[0].split(" "),k=3;k<b.length;k++){var f=b[k],g=d.matchPrefix(a,"a=rtpmap:"+f+" ")[0];if(g){g=d.parseRtpMap(g);var e=d.matchPrefix(a,"a=fmtp:"+f+" ");g.parameters=e.length?d.parseFmtp(e[0]):{};g.rtcpFeedback=d.matchPrefix(a,"a=rtcp-fb:"+f+" ").map(d.parseRtcpFb);c.codecs.push(g);switch(g.name.toUpperCase()){case "RED":case "ULPFEC":c.fecMechanisms.push(g.name.toUpperCase())}}}d.matchPrefix(a,
"a=extmap:").forEach(function(a){c.headerExtensions.push(d.parseExtmap(a))});return c};d.writeRtpDescription=function(a,c){var b="";b+="m="+a+" ";b+=0<c.codecs.length?"9":"0";b+=" UDP/TLS/RTP/SAVPF ";b+=c.codecs.map(function(a){return void 0!==a.preferredPayloadType?a.preferredPayloadType:a.payloadType}).join(" ")+"\r\n";b+="c=IN IP4 0.0.0.0\r\n";b+="a=rtcp:9 IN IP4 0.0.0.0\r\n";c.codecs.forEach(function(a){b+=d.writeRtpMap(a);b+=d.writeFmtp(a);b+=d.writeRtcpFb(a)});var k=0;c.codecs.forEach(function(a){a.maxptime>
k&&(k=a.maxptime)});0<k&&(b+="a=maxptime:"+k+"\r\n");b+="a=rtcp-mux\r\n";c.headerExtensions&&c.headerExtensions.forEach(function(a){b+=d.writeExtmap(a)});return b};d.parseRtpEncodingParameters=function(a){var c=[],b=d.parseRtpParameters(a),k=-1!==b.fecMechanisms.indexOf("RED"),f=-1!==b.fecMechanisms.indexOf("ULPFEC"),g=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute}),e=0<g.length&&g[0].ssrc,h;g=d.matchPrefix(a,"a=ssrc-group:FID").map(function(a){return a.substr(17).split(" ").map(function(a){return parseInt(a,
10)})});0<g.length&&1<g[0].length&&g[0][0]===e&&(h=g[0][1]);b.codecs.forEach(function(a){"RTX"===a.name.toUpperCase()&&a.parameters.apt&&(a={ssrc:e,codecPayloadType:parseInt(a.parameters.apt,10)},e&&h&&(a.rtx={ssrc:h}),c.push(a),k&&(a=JSON.parse(JSON.stringify(a)),a.fec={ssrc:e,mechanism:f?"red+ulpfec":"red"},c.push(a)))});0===c.length&&e&&c.push({ssrc:e});var t=d.matchPrefix(a,"b=");t.length&&(t=0===t[0].indexOf("b=TIAS:")?parseInt(t[0].substr(7),10):0===t[0].indexOf("b=AS:")?950*parseInt(t[0].substr(5),
10)-16E3:void 0,c.forEach(function(a){a.maxBitrate=t}));return c};d.parseRtcpParameters=function(a){var c={},b=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute})[0];b&&(c.cname=b.value,c.ssrc=b.ssrc);b=d.matchPrefix(a,"a=rtcp-rsize");c.reducedSize=0<b.length;c.compound=0===b.length;a=d.matchPrefix(a,"a=rtcp-mux");c.mux=0<a.length;return c};d.parseMsid=function(a){var c=d.matchPrefix(a,"a=msid:");if(1===c.length)return a=c[0].substr(7).split(" "),
{stream:a[0],track:a[1]};a=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"msid"===a.attribute});if(0<a.length)return a=a[0].value.split(" "),{stream:a[0],track:a[1]}};d.generateSessionId=function(){return Math.random().toString().substr(2,21)};d.writeSessionBoilerplate=function(a,c,b){c=void 0!==c?c:2;a=a?a:d.generateSessionId();return"v=0\r\no="+(b||"thisisadapterortc")+" "+a+" "+c+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"};d.writeMediaSection=function(a,
c,b,f){c=d.writeRtpDescription(a.kind,c);c+=d.writeIceParameters(a.iceGatherer.getLocalParameters());c+=d.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===b?"actpass":"active");c+="a=mid:"+a.mid+"\r\n";c=a.direction?c+("a="+a.direction+"\r\n"):a.rtpSender&&a.rtpReceiver?c+"a=sendrecv\r\n":a.rtpSender?c+"a=sendonly\r\n":a.rtpReceiver?c+"a=recvonly\r\n":c+"a=inactive\r\n";a.rtpSender&&(b="msid:"+f.id+" "+a.rtpSender.track.id+"\r\n",c=c+("a="+b)+("a=ssrc:"+a.sendEncodingParameters[0].ssrc+
" "+b),a.sendEncodingParameters[0].rtx&&(c+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+b,c+="a=ssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+"\r\n"));c+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+d.localCName+"\r\n";a.rtpSender&&a.sendEncodingParameters[0].rtx&&(c+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" cname:"+d.localCName+"\r\n");return c};d.getDirection=function(a,c){a=d.splitLines(a);for(var b=0;b<a.length;b++)switch(a[b]){case "a=sendrecv":case "a=sendonly":case "a=recvonly":case "a=inactive":return a[b].substr(2)}return c?
d.getDirection(c):"sendrecv"};d.getKind=function(a){return d.splitLines(a)[0].split(" ")[0].substr(2)};d.isRejected=function(a){return"0"===a.split(" ",2)[1]};d.parseMLine=function(a){a=d.splitLines(a)[0].substr(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}};d.parseOLine=function(a){a=d.matchPrefix(a,"o=")[0].substr(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}};d.isValidSDP=
function(a){if("string"!==typeof a||0===a.length)return!1;a=d.splitLines(a);for(var c=0;c<a.length;c++)if(2>a[c].length||"="!==a[c].charAt(1))return!1;return!0};"object"===typeof g&&(g.exports=d)},{}]},{},[1])(1)});String.prototype.splice=function(h,g,f){return this.slice(0,h)+f+this.slice(h+Math.abs(g))};function getWebsocketUrl(h){var g=window.location;var f="https:"===g.protocol?"wss:":"ws:";f+="//"+g.host;return f+("/"+h)}
var Dimension=function(){function h(f){return Error("The string 2"+f+'" is an invalid dimension')}var g=function(f,d){this.isDimension=!0;(function(a,c){if(!c){c=a.indexOf("%");if(0<c){c=a.substr(0,c);if(0>=c.length)throw h(a);a=parseInt(c);c="%"}else{c=a.indexOf("px");if(0>=c)throw h(a);c=a.substr(0,c);if(0>=c.length)throw h(a);a=parseInt(c);c="px"}f=a;d=c}})(f,d);this.getValue=function(){return f};this.getUnit=function(){return d}};g.PX="px";g.PERCENT="%";g.px;g.pixels=function(f){return new g(f,
"px")};g.percent=function(f){return new g(f,"%")};return g}(),moment;
(function(h,g){"object"===typeof exports&&"undefined"!==typeof module?module.exports=g():"function"===typeof define&&define.amd?define(g):h.moment=g()})(this,function(){function h(){return jc.apply(null,arguments)}function g(a){return a instanceof Array||"[object Array]"===Object.prototype.toString.call(a)}function f(a){return null!=a&&"[object Object]"===Object.prototype.toString.call(a)}function d(a){return void 0===a}function a(a){return"number"===typeof a||"[object Number]"===Object.prototype.toString.call(a)}
function c(a){return a instanceof Date||"[object Date]"===Object.prototype.toString.call(a)}function b(a,b){var c=[],e;for(e=0;e<a.length;++e)c.push(b(a[e],e));return c}function k(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function m(a,b){for(var c in b)k(b,c)&&(a[c]=b[c]);k(b,"toString")&&(a.toString=b.toString);k(b,"valueOf")&&(a.valueOf=b.valueOf);return a}function l(a,b,c,e){return Ab(a,b,c,e,!0).utc()}function e(a){null==a._pf&&(a._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,
charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null,rfc2822:!1,weekdayMismatch:!1});return a._pf}function p(a){if(null==a._isValid){var b=e(a),c=kc.call(b.parsedDateParts,function(a){return null!=a});c=!isNaN(a._d.getTime())&&0>b.overflow&&!b.empty&&!b.invalidMonth&&!b.invalidWeekday&&!b.weekdayMismatch&&!b.nullInput&&!b.invalidFormat&&!b.userInvalidated&&(!b.meridiem||b.meridiem&&c);a._strict&&(c=c&&0===b.charsLeftOver&&0===b.unusedTokens.length&&
void 0===b.bigHour);if(null!=Object.isFrozen&&Object.isFrozen(a))return c;a._isValid=c}return a._isValid}function t(a){var b=l(NaN);null!=a?m(e(b),a):e(b).userInvalidated=!0;return b}function x(a,b){var c;d(b._isAMomentObject)||(a._isAMomentObject=b._isAMomentObject);d(b._i)||(a._i=b._i);d(b._f)||(a._f=b._f);d(b._l)||(a._l=b._l);d(b._strict)||(a._strict=b._strict);d(b._tzm)||(a._tzm=b._tzm);d(b._isUTC)||(a._isUTC=b._isUTC);d(b._offset)||(a._offset=b._offset);d(b._pf)||(a._pf=e(b));d(b._locale)||(a._locale=
b._locale);if(0<eb.length)for(c=0;c<eb.length;c++){var M=eb[c];var f=b[M];d(f)||(a[M]=f)}return a}function r(a){x(this,a);this._d=new Date(null!=a._d?a._d.getTime():NaN);this.isValid()||(this._d=new Date(NaN));!1===fb&&(fb=!0,h.updateOffset(this),fb=!1)}function n(a){return a instanceof r||null!=a&&null!=a._isAMomentObject}function u(a){return 0>a?Math.ceil(a)||0:Math.floor(a)}function q(a){a=+a;var b=0;0!==a&&isFinite(a)&&(b=u(a));return b}function w(a,b,c){var e=Math.min(a.length,b.length),d=Math.abs(a.length-
b.length),M=0,f;for(f=0;f<e;f++)(c&&a[f]!==b[f]||!c&&q(a[f])!==q(b[f]))&&M++;return M+d}function B(a){!1===h.suppressDeprecationWarnings&&"undefined"!==typeof console&&console.warn&&console.warn("Deprecation warning: "+a)}function A(a,b){var c=!0;return m(function(){null!=h.deprecationHandler&&h.deprecationHandler(null,a);if(c){for(var e=[],d,M=0;M<arguments.length;M++){d="";if("object"===typeof arguments[M]){d+="\n["+M+"] ";for(var f in arguments[0])d+=f+": "+arguments[0][f]+", ";d=d.slice(0,-2)}else d=
arguments[M];e.push(d)}B(a+"\nArguments: "+Array.prototype.slice.call(e).join("")+"\n"+Error().stack);c=!1}return b.apply(this,arguments)},b)}function F(a,b){null!=h.deprecationHandler&&h.deprecationHandler(a,b);Bb[a]||(B(b),Bb[a]=!0)}function G(a){return a instanceof Function||"[object Function]"===Object.prototype.toString.call(a)}function C(a,b){var c=m({},a),e;for(e in b)k(b,e)&&(f(a[e])&&f(b[e])?(c[e]={},m(c[e],a[e]),m(c[e],b[e])):null!=b[e]?c[e]=b[e]:delete c[e]);for(e in a)k(a,e)&&!k(b,e)&&
f(a[e])&&(c[e]=m({},c[e]));return c}function K(a){null!=a&&this.set(a)}function H(a,b){var c=a.toLowerCase();Na[c]=Na[c+"s"]=Na[b]=a}function I(a){return"string"===typeof a?Na[a]||Na[a.toLowerCase()]:void 0}function O(a){var b={},c,e;for(e in a)k(a,e)&&(c=I(e))&&(b[c]=a[e]);return b}function la(a){var b=[],c;for(c in a)b.push({unit:c,priority:fa[c]});b.sort(function(a,b){return a.priority-b.priority});return b}function J(a,b,c){var e=""+Math.abs(a);return(0<=a?c?"+":"":"-")+Math.pow(10,Math.max(0,
b-e.length)).toString().substr(1)+e}function D(a,b,c,e){var d=e;"string"===typeof e&&(d=function(){return this[e]()});a&&(Ha[a]=d);b&&(Ha[b[0]]=function(){return J(d.apply(this,arguments),b[1],b[2])});c&&(Ha[c]=function(){return this.localeData().ordinal(d.apply(this,arguments),a)})}function ia(a){return a.match(/\[[\s\S]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function V(a){var b=a.match(Cb),c;var e=0;for(c=b.length;e<c;e++)b[e]=Ha[b[e]]?Ha[b[e]]:ia(b[e]);return function(e){var d="",M;for(M=
0;M<c;M++)d+=G(b[M])?b[M].call(e,a):b[M];return d}}function Y(a,b){if(!a.isValid())return a.localeData().invalidDate();b=ha(b,a.localeData());gb[b]=gb[b]||V(b);return gb[b](a)}function ha(a,b){function c(a){return b.longDateFormat(a)||a}var e=5;for(Ta.lastIndex=0;0<=e&&Ta.test(a);)a=a.replace(Ta,c),Ta.lastIndex=0,--e;return a}function v(a,b,c){hb[a]=G(b)?b:function(a,e){return a&&c?c:b}}function da(a,b){return k(hb,a)?hb[a](b._strict,b._locale):new RegExp(Z(a))}function Z(a){return ja(a.replace("\\",
"").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(a,b,c,e,d){return b||c||e||d}))}function ja(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function L(b,c){var e,d=c;"string"===typeof b&&(b=[b]);a(c)&&(d=function(a,b){b[c]=q(a)});for(e=0;e<b.length;e++)ib[b[e]]=d}function y(a,b){L(a,function(a,c,e,d){e._w=e._w||{};b(a,e._w,e,d)})}function Q(a){return 0===a%4&&0!==a%100||0===a%400}function N(a,b){return function(c){return null!=c?(W(this,a,c),h.updateOffset(this,b),this):ea(this,a)}}
function ea(a,b){return a.isValid()?a._d["get"+(a._isUTC?"UTC":"")+b]():NaN}function W(a,b,c){if(a.isValid()&&!isNaN(c))if("FullYear"===b&&Q(a.year())&&1===a.month()&&29===a.date())a._d["set"+(a._isUTC?"UTC":"")+b](c,a.month(),ma(c,a.month()));else a._d["set"+(a._isUTC?"UTC":"")+b](c)}function ma(a,b){if(isNaN(a)||isNaN(b))return NaN;var c=(b%12+12)%12;return 1===c?Q(a+(b-c)/12)?29:28:31-c%7%2}function ra(b,c){if(!b.isValid())return b;if("string"===typeof c)if(/^\d+$/.test(c))c=q(c);else if(c=b.localeData().monthsParse(c),
!a(c))return b;var e=Math.min(b.date(),ma(b.year(),c));b._d["set"+(b._isUTC?"UTC":"")+"Month"](c,e);return b}function za(a){return null!=a?(ra(this,a),h.updateOffset(this,!0),this):ea(this,"Month")}function na(){function a(a,b){return b.length-a.length}var b=[],c=[],e=[],d;for(d=0;12>d;d++){var f=l([2E3,d]);b.push(this.monthsShort(f,""));c.push(this.months(f,""));e.push(this.months(f,""));e.push(this.monthsShort(f,""))}b.sort(a);c.sort(a);e.sort(a);for(d=0;12>d;d++)b[d]=ja(b[d]),c[d]=ja(c[d]);for(d=
0;24>d;d++)e[d]=ja(e[d]);this._monthsShortRegex=this._monthsRegex=new RegExp("^("+e.join("|")+")","i");this._monthsStrictRegex=new RegExp("^("+c.join("|")+")","i");this._monthsShortStrictRegex=new RegExp("^("+b.join("|")+")","i")}function X(a,b,c,e,d,f,k){100>a&&0<=a?(b=new Date(a+400,b,c,e,d,f,k),isFinite(b.getFullYear())&&b.setFullYear(a)):b=new Date(a,b,c,e,d,f,k);return b}function R(a){if(100>a&&0<=a){var b=Array.prototype.slice.call(arguments);b[0]=a+400;b=new Date(Date.UTC.apply(null,b));isFinite(b.getUTCFullYear())&&
b.setUTCFullYear(a)}else b=new Date(Date.UTC.apply(null,arguments));return b}function ua(a,b,c){c=7+b-c;return-((7+R(a,0,c).getUTCDay()-b)%7)+c-1}function Ia(a,b,c,e,d){c=(7+c-e)%7;e=ua(a,e,d);e=1+7*(b-1)+c+e;0>=e?(b=a-1,a=(Q(b)?366:365)+e):e>(Q(a)?366:365)?(b=a+1,a=e-(Q(a)?366:365)):(b=a,a=e);return{year:b,dayOfYear:a}}function Oa(a,b,c){var e=ua(a.year(),b,c);e=Math.floor((a.dayOfYear()-e-1)/7)+1;1>e?(a=a.year()-1,b=e+Da(a,b,c)):e>Da(a.year(),b,c)?(b=e-Da(a.year(),b,c),a=a.year()+1):(a=a.year(),
b=e);return{week:b,year:a}}function Da(a,b,c){var e=ua(a,b,c);b=ua(a+1,b,c);return((Q(a)?366:365)-e+b)/7}function jb(a,b){return a.slice(b,7).concat(a.slice(0,b))}function lc(a,b,c){var e;a=a.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],e=0;7>e;++e){var d=l([2E3,1]).day(e);this._minWeekdaysParse[e]=this.weekdaysMin(d,"").toLocaleLowerCase();this._shortWeekdaysParse[e]=this.weekdaysShort(d,"").toLocaleLowerCase();this._weekdaysParse[e]=
this.weekdays(d,"").toLocaleLowerCase()}if(c)b="dddd"===b?aa.call(this._weekdaysParse,a):"ddd"===b?aa.call(this._shortWeekdaysParse,a):aa.call(this._minWeekdaysParse,a);else if("dddd"===b){b=aa.call(this._weekdaysParse,a);if(-1!==b)return b;b=aa.call(this._shortWeekdaysParse,a);if(-1!==b)return b;b=aa.call(this._minWeekdaysParse,a)}else if("ddd"===b){b=aa.call(this._shortWeekdaysParse,a);if(-1!==b)return b;b=aa.call(this._weekdaysParse,a);if(-1!==b)return b;b=aa.call(this._minWeekdaysParse,a)}else{b=
aa.call(this._minWeekdaysParse,a);if(-1!==b)return b;b=aa.call(this._weekdaysParse,a);if(-1!==b)return b;b=aa.call(this._shortWeekdaysParse,a)}return-1!==b?b:null}function kb(){function a(a,b){return b.length-a.length}var b=[],c=[],e=[],d=[],f;for(f=0;7>f;f++){var k=l([2E3,1]).day(f);var g=this.weekdaysMin(k,"");var h=this.weekdaysShort(k,"");k=this.weekdays(k,"");b.push(g);c.push(h);e.push(k);d.push(g);d.push(h);d.push(k)}b.sort(a);c.sort(a);e.sort(a);d.sort(a);for(f=0;7>f;f++)c[f]=ja(c[f]),e[f]=
ja(e[f]),d[f]=ja(d[f]);this._weekdaysMinRegex=this._weekdaysShortRegex=this._weekdaysRegex=new RegExp("^("+d.join("|")+")","i");this._weekdaysStrictRegex=new RegExp("^("+e.join("|")+")","i");this._weekdaysShortStrictRegex=new RegExp("^("+c.join("|")+")","i");this._weekdaysMinStrictRegex=new RegExp("^("+b.join("|")+")","i")}function lb(){return this.hours()%12||12}function Db(a,b){D(a,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),b)})}function Eb(a,b){return b._meridiemParse}
function Fb(a){return a?a.toLowerCase().replace("_","-"):a}function Ua(a){var b=null;if(!ba[a]&&"undefined"!==typeof module&&module&&module.exports)try{b=Pa._abbr;var c=window.require;c("./locale/"+a);Ja(b)}catch(cd){}return ba[a]}function Ja(a,b){a&&((b=d(b)?Aa(a):mb(a,b))?Pa=b:"undefined"!==typeof console&&console.warn&&console.warn("Locale "+a+" not found. Did you forget to load it?"));return Pa._abbr}function mb(a,b){if(null!==b){var c=Gb;b.abbr=a;if(null!=ba[a])F("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),
c=ba[a]._config;else if(null!=b.parentLocale)if(null!=ba[b.parentLocale])c=ba[b.parentLocale]._config;else if(c=Ua(b.parentLocale),null!=c)c=c._config;else return Qa[b.parentLocale]||(Qa[b.parentLocale]=[]),Qa[b.parentLocale].push({name:a,config:b}),null;ba[a]=new K(C(c,b));Qa[a]&&Qa[a].forEach(function(a){mb(a.name,a.config)});Ja(a);return ba[a]}delete ba[a];return null}function Aa(a){var b;a&&a._locale&&a._locale._abbr&&(a=a._locale._abbr);if(!a)return Pa;if(!g(a)){if(b=Ua(a))return b;a=[a]}a:{b=
0;for(var c,e,d,f;b<a.length;){f=Fb(a[b]).split("-");c=f.length;for(e=(e=Fb(a[b+1]))?e.split("-"):null;0<c;){if(d=Ua(f.slice(0,c).join("-"))){a=d;break a}if(e&&e.length>=c&&w(f,e,!0)>=c-1)break;c--}b++}a=Pa}return a}function nb(a){var b;(b=a._a)&&-2===e(a).overflow&&(b=0>b[va]||11<b[va]?va:1>b[sa]||b[sa]>ma(b[oa],b[va])?sa:0>b[ca]||24<b[ca]||24===b[ca]&&(0!==b[pa]||0!==b[wa]||0!==b[Ea])?ca:0>b[pa]||59<b[pa]?pa:0>b[wa]||59<b[wa]?wa:0>b[Ea]||999<b[Ea]?Ea:-1,e(a)._overflowDayOfYear&&(b<oa||b>sa)&&(b=
sa),e(a)._overflowWeeks&&-1===b&&(b=mc),e(a)._overflowWeekday&&-1===b&&(b=nc),e(a).overflow=b);return a}function Ka(a,b,c){return null!=a?a:null!=b?b:c}function ob(a){var b=[];if(!a._d){var c=new Date(h.now());c=a._useUTC?[c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()]:[c.getFullYear(),c.getMonth(),c.getDate()];if(a._w&&null==a._a[sa]&&null==a._a[va]){var d=a._w;if(null!=d.GG||null!=d.W||null!=d.E){var f=1;var k=4;var g=Ka(d.GG,a._a[oa],Oa(T(),1,4).year);var l=Ka(d.W,1);var M=Ka(d.E,1);if(1>M||
7<M)var m=!0}else if(f=a._locale._week.dow,k=a._locale._week.doy,l=Oa(T(),f,k),g=Ka(d.gg,a._a[oa],l.year),l=Ka(d.w,l.week),null!=d.d){if(M=d.d,0>M||6<M)m=!0}else if(null!=d.e){if(M=d.e+f,0>d.e||6<d.e)m=!0}else M=f;1>l||l>Da(g,f,k)?e(a)._overflowWeeks=!0:null!=m?e(a)._overflowWeekday=!0:(m=Ia(g,l,M,f,k),a._a[oa]=m.year,a._dayOfYear=m.dayOfYear)}if(null!=a._dayOfYear){m=Ka(a._a[oa],c[oa]);if(a._dayOfYear>(Q(m)?366:365)||0===a._dayOfYear)e(a)._overflowDayOfYear=!0;m=R(m,0,a._dayOfYear);a._a[va]=m.getUTCMonth();
a._a[sa]=m.getUTCDate()}for(m=0;3>m&&null==a._a[m];++m)a._a[m]=b[m]=c[m];for(;7>m;m++)a._a[m]=b[m]=null==a._a[m]?2===m?1:0:a._a[m];24===a._a[ca]&&0===a._a[pa]&&0===a._a[wa]&&0===a._a[Ea]&&(a._nextDay=!0,a._a[ca]=0);a._d=(a._useUTC?R:X).apply(null,b);b=a._useUTC?a._d.getUTCDay():a._d.getDay();null!=a._tzm&&a._d.setUTCMinutes(a._d.getUTCMinutes()-a._tzm);a._nextDay&&(a._a[ca]=24);a._w&&"undefined"!==typeof a._w.d&&a._w.d!==b&&(e(a).weekdayMismatch=!0)}}function Hb(a){var b;var c=a._i;var d=oc.exec(c)||
pc.exec(c);if(d){e(a).iso=!0;c=0;for(b=Va.length;c<b;c++)if(Va[c][1].exec(d[1])){var f=Va[c][0];var k=!1!==Va[c][2];break}if(null==f)a._isValid=!1;else{if(d[3]){c=0;for(b=pb.length;c<b;c++)if(pb[c][1].exec(d[3])){var g=(d[2]||" ")+pb[c][0];break}if(null==g){a._isValid=!1;return}}if(k||null==g){if(d[4])if(qc.exec(d[4]))var h="Z";else{a._isValid=!1;return}a._f=f+(g||"")+(h||"");qb(a)}else a._isValid=!1}}else a._isValid=!1}function Ib(a){var b=rc.exec(a._i.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g,
" ").replace(/^\s\s*/,"").replace(/\s\s*$/,""));if(b){var c=b[3],d=b[2],f=b[5],k=b[6],g=b[7],h=parseInt(b[4],10);c=[49>=h?2E3+h:999>=h?1900+h:h,Jb.indexOf(c),parseInt(d,10),parseInt(f,10),parseInt(k,10)];g&&c.push(parseInt(g,10));a:{if(g=b[1])if(g=Kb.indexOf(g),d=(new Date(c[0],c[1],c[2])).getDay(),g!==d){e(a).weekdayMismatch=!0;g=a._isValid=!1;break a}g=!0}g&&(a._a=c,(g=b[8])?b=sc[g]:b[9]?b=0:(b=parseInt(b[10],10),g=b%100,b=(b-g)/100*60+g),a._tzm=b,a._d=R.apply(null,a._a),a._d.setUTCMinutes(a._d.getUTCMinutes()-
a._tzm),e(a).rfc2822=!0)}else a._isValid=!1}function tc(a){var b=uc.exec(a._i);null!==b?a._d=new Date(+b[1]):(Hb(a),!1===a._isValid&&(delete a._isValid,Ib(a),!1===a._isValid&&(delete a._isValid,h.createFromInputFallback(a))))}function qb(a){if(a._f===h.ISO_8601)Hb(a);else if(a._f===h.RFC_2822)Ib(a);else{a._a=[];e(a).empty=!0;var b=""+a._i,c,d,f=b.length,g=0;var l=ha(a._f,a._locale).match(Cb)||[];for(c=0;c<l.length;c++){var m=l[c];if(d=(b.match(da(m,a))||[])[0]){var M=b.substr(0,b.indexOf(d));0<M.length&&
e(a).unusedInput.push(M);b=b.slice(b.indexOf(d)+d.length);g+=d.length}if(Ha[m]){if(d?e(a).empty=!1:e(a).unusedTokens.push(m),M=a,null!=d&&k(ib,m))ib[m](d,M._a,M,m)}else a._strict&&!d&&e(a).unusedTokens.push(m)}e(a).charsLeftOver=f-g;0<b.length&&e(a).unusedInput.push(b);12>=a._a[ca]&&!0===e(a).bigHour&&0<a._a[ca]&&(e(a).bigHour=void 0);e(a).parsedDateParts=a._a.slice(0);e(a).meridiem=a._meridiem;b=a._a;c=ca;f=a._locale;l=a._a[ca];g=a._meridiem;null!=g&&(null!=f.meridiemHour?l=f.meridiemHour(l,g):null!=
f.isPM&&((f=f.isPM(g))&&12>l&&(l+=12),f||12!==l||(l=0)));b[c]=l;ob(a);nb(a)}}function vc(a){if(!a._d){var c=O(a._i);a._a=b([c.year,c.month,c.day||c.date,c.hour,c.minute,c.second,c.millisecond],function(a){return a&&parseInt(a,10)});ob(a)}}function Lb(a){var b=a._i,d=a._f;a._locale=a._locale||Aa(a._l);if(null===b||void 0===d&&""===b)return t({nullInput:!0});"string"===typeof b&&(a._i=b=a._locale.preparse(b));if(n(b))return new r(nb(b));if(c(b))a._d=b;else if(g(d))if(0===a._f.length)e(a).invalidFormat=
!0,a._d=new Date(NaN);else{for(b=0;b<a._f.length;b++){d=0;var f=x({},a);null!=a._useUTC&&(f._useUTC=a._useUTC);f._f=a._f[b];qb(f);if(p(f)&&(d+=e(f).charsLeftOver,d+=10*e(f).unusedTokens.length,e(f).score=d,null==k||d<k)){var k=d;var h=f}}m(a,h||f)}else d?qb(a):wc(a);p(a)||(a._d=null);return a}function wc(e){var k=e._i;d(k)?e._d=new Date(h.now()):c(k)?e._d=new Date(k.valueOf()):"string"===typeof k?tc(e):g(k)?(e._a=b(k.slice(0),function(a){return parseInt(a,10)}),ob(e)):f(k)?vc(e):a(k)?e._d=new Date(k):
h.createFromInputFallback(e)}function Ab(a,b,c,e,d){var k={};if(!0===c||!1===c)e=c,c=void 0;var h;if(h=f(a))a:if(h=a,Object.getOwnPropertyNames)h=0===Object.getOwnPropertyNames(h).length;else{for(var l in h)if(h.hasOwnProperty(l)){h=!1;break a}h=!0}if(h||g(a)&&0===a.length)a=void 0;k._isAMomentObject=!0;k._useUTC=k._isUTC=d;k._l=c;k._i=a;k._f=b;k._strict=e;a=new r(nb(Lb(k)));a._nextDay&&(a.add(1,"d"),a._nextDay=void 0);return a}function T(a,b,c,e){return Ab(a,b,c,e,!1)}function Mb(a,b){var c;1===
b.length&&g(b[0])&&(b=b[0]);if(!b.length)return T();var e=b[0];for(c=1;c<b.length;++c)if(!b[c].isValid()||b[c][a](e))e=b[c];return e}function Wa(a){var b=O(a);a=b.year||0;var c=b.quarter||0,e=b.month||0,d=b.week||b.isoWeek||0,f=b.day||0,k=b.hour||0,g=b.minute||0,h=b.second||0,l=b.millisecond||0;a:{for(var m in b)if(-1===aa.call(Ra,m)||null!=b[m]&&isNaN(b[m])){b=!1;break a}m=!1;for(var M=0;M<Ra.length;++M)if(b[Ra[M]]){if(m){b=!1;break a}parseFloat(b[Ra[M]])!==q(b[Ra[M]])&&(m=!0)}b=!0}this._isValid=
b;this._milliseconds=+l+1E3*h+6E4*g+36E5*k;this._days=+f+7*d;this._months=+e+3*c+12*a;this._data={};this._locale=Aa();this._bubble()}function rb(a){return a instanceof Wa}function sb(a){return 0>a?-1*Math.round(-1*a):Math.round(a)}function Nb(a,b){D(a,0,0,function(){var a=this.utcOffset(),c="+";0>a&&(a=-a,c="-");return c+J(~~(a/60),2)+b+J(~~a%60,2)})}function tb(a,b){a=(b||"").match(a);if(null===a)return null;a=((a[a.length-1]||[])+"").match(xc)||["-",0,0];b=+(60*a[1])+q(a[2]);return 0===b?0:"+"===
a[0]?b:-b}function ub(a,b){return b._isUTC?(b=b.clone(),a=(n(a)||c(a)?a.valueOf():T(a).valueOf())-b.valueOf(),b._d.setTime(b._d.valueOf()+a),h.updateOffset(b,!1),b):T(a).local()}function Ob(){return this.isValid()?this._isUTC&&0===this._offset:!1}function qa(b,c){var e=b;rb(b)?e={ms:b._milliseconds,d:b._days,M:b._months}:a(b)?(e={},c?e[c]=b:e.milliseconds=b):(c=yc.exec(b))?(e="-"===c[1]?-1:1,e={y:0,d:q(c[sa])*e,h:q(c[ca])*e,m:q(c[pa])*e,s:q(c[wa])*e,ms:q(sb(1E3*c[Ea]))*e}):(c=zc.exec(b))?(e="-"===
c[1]?-1:1,e={y:Fa(c[2],e),M:Fa(c[3],e),w:Fa(c[4],e),d:Fa(c[5],e),h:Fa(c[6],e),m:Fa(c[7],e),s:Fa(c[8],e)}):null==e?e={}:"object"===typeof e&&("from"in e||"to"in e)&&(c=T(e.from),e=T(e.to),c.isValid()&&e.isValid()?(e=ub(e,c),c.isBefore(e)?e=Pb(c,e):(e=Pb(e,c),e.milliseconds=-e.milliseconds,e.months=-e.months),c=e):c={milliseconds:0,months:0},e={},e.ms=c.milliseconds,e.M=c.months);e=new Wa(e);rb(b)&&k(b,"_locale")&&(e._locale=b._locale);return e}function Fa(a,b){a=a&&parseFloat(a.replace(",","."));return(isNaN(a)?
0:a)*b}function Pb(a,b){var c={};c.months=b.month()-a.month()+12*(b.year()-a.year());a.clone().add(c.months,"M").isAfter(b)&&--c.months;c.milliseconds=+b-+a.clone().add(c.months,"M");return c}function Qb(a,b){return function(c,e){if(null!==e&&!isNaN(+e)){F(b,"moment()."+b+"(period, number) is deprecated. Please use moment()."+b+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info.");var d=c;c=e;e=d}c=qa("string"===typeof c?+c:c,e);Rb(this,c,a);return this}}
function Rb(a,b,c,e){var d=b._milliseconds,f=sb(b._days);b=sb(b._months);a.isValid()&&(e=null==e?!0:e,b&&ra(a,ea(a,"Month")+b*c),f&&W(a,"Date",ea(a,"Date")+f*c),d&&a._d.setTime(a._d.valueOf()+d*c),e&&h.updateOffset(a,f||b))}function vb(a,b){var c=12*(b.year()-a.year())+(b.month()-a.month()),e=a.clone().add(c,"months");0>b-e?(a=a.clone().add(c-1,"months"),b=(b-e)/(e-a)):(a=a.clone().add(c+1,"months"),b=(b-e)/(a-e));return-(c+b)||0}function Sb(a){if(void 0===a)return this._locale._abbr;a=Aa(a);null!=
a&&(this._locale=a);return this}function Tb(){return this._locale}function La(a,b){return(a%b+b)%b}function Ub(a,b,c){return 100>a&&0<=a?new Date(a+400,b,c)-Vb:(new Date(a,b,c)).valueOf()}function Wb(a,b,c){return 100>a&&0<=a?Date.UTC(a+400,b,c)-Vb:Date.UTC(a,b,c)}function Xa(a,b){D(0,[a,a.length],0,b)}function Xb(a,b,c,e,d){if(null==a)return Oa(this,e,d).year;var f=Da(a,e,d);b>f&&(b=f);a=Ia(a,b,c,e,d);a=R(a.year,0,a.dayOfYear);this.year(a.getUTCFullYear());this.month(a.getUTCMonth());this.date(a.getUTCDate());
return this}function Ac(a,b){b[Ea]=q(1E3*("0."+a))}function Yb(a){return a}function Ya(a,b,c,e){var d=Aa();b=l().set(e,b);return d[c](b,a)}function Zb(b,c,e){a(b)&&(c=b,b=void 0);b=b||"";if(null!=c)return Ya(b,c,e,"month");var d=[];for(c=0;12>c;c++)d[c]=Ya(b,c,e,"month");return d}function wb(b,c,e,d){"boolean"!==typeof b&&(e=c=b,b=!1);a(c)&&(e=c,c=void 0);c=c||"";var f=Aa();b=b?f._week.dow:0;if(null!=e)return Ya(c,(e+b)%7,d,"day");f=[];for(e=0;7>e;e++)f[e]=Ya(c,(e+b)%7,d,"day");return f}function $b(a,
b,c,e){b=qa(b,c);a._milliseconds+=e*b._milliseconds;a._days+=e*b._days;a._months+=e*b._months;return a._bubble()}function ac(a){return 0>a?Math.floor(a):Math.ceil(a)}function xa(a){return function(){return this.as(a)}}function Ga(a){return function(){return this.isValid()?this._data[a]:NaN}}function Bc(a,b,c,e,d){return d.relativeTime(b||1,!!c,a,e)}function Ma(a){return(0<a)-(0>a)||+a}function Za(){if(!this.isValid())return this.localeData().invalidDate();var a=xb(this._milliseconds)/1E3,b=xb(this._days),
c=xb(this._months);var e=u(a/60);var d=u(e/60);a%=60;e%=60;var f=u(c/12);c%=12;a=a?a.toFixed(3).replace(/\.?0+$/,""):"";var k=this.asSeconds();if(!k)return"P0D";var g=0>k?"-":"",h=Ma(this._months)!==Ma(k)?"-":"",l=Ma(this._days)!==Ma(k)?"-":"";k=Ma(this._milliseconds)!==Ma(k)?"-":"";return g+"P"+(f?h+f+"Y":"")+(c?h+c+"M":"")+(b?l+b+"D":"")+(d||e||a?"T":"")+(d?k+d+"H":"")+(e?k+e+"M":"")+(a?k+a+"S":"")}var kc=Array.prototype.some?Array.prototype.some:function(a){for(var b=Object(this),c=b.length>>>
0,e=0;e<c;e++)if(e in b&&a.call(this,b[e],e,b))return!0;return!1};var eb=h.momentProperties=[],fb=!1,Bb={};h.suppressDeprecationWarnings=!1;h.deprecationHandler=null;var Cc=Object.keys?Object.keys:function(a){var b,c=[];for(b in a)k(a,b)&&c.push(b);return c};var Na={},fa={},Cb=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,Ta=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,
gb={},Ha={},bc=/\d/,ka=/\d\d/,cc=/\d{3}/,yb=/\d{4}/,$a=/[+-]?\d{6}/,U=/\d\d?/,dc=/\d\d\d\d?/,ec=/\d\d\d\d\d\d?/,ab=/\d{1,3}/,zb=/\d{1,4}/,bb=/[+-]?\d{1,6}/,Dc=/\d+/,cb=/[+-]?\d+/,Ec=/Z|[+-]\d\d:?\d\d/gi,db=/Z|[+-]\d\d(?::?\d\d)?/gi,Sa=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,hb={},ib={},oa=0,va=1,sa=2,ca=3,pa=4,wa=5,Ea=6,mc=7,nc=8;D("Y",0,0,function(){var a=this.year();return 9999>=a?""+
a:"+"+a});D(0,["YY",2],0,function(){return this.year()%100});D(0,["YYYY",4],0,"year");D(0,["YYYYY",5],0,"year");D(0,["YYYYYY",6,!0],0,"year");H("year","y");fa.year=1;v("Y",cb);v("YY",U,ka);v("YYYY",zb,yb);v("YYYYY",bb,$a);v("YYYYYY",bb,$a);L(["YYYYY","YYYYYY"],oa);L("YYYY",function(a,b){b[oa]=2===a.length?h.parseTwoDigitYear(a):q(a)});L("YY",function(a,b){b[oa]=h.parseTwoDigitYear(a)});L("Y",function(a,b){b[oa]=parseInt(a,10)});h.parseTwoDigitYear=function(a){return q(a)+(68<q(a)?1900:2E3)};var fc=
N("FullYear",!0);var aa=Array.prototype.indexOf?Array.prototype.indexOf:function(a){var b;for(b=0;b<this.length;++b)if(this[b]===a)return b;return-1};D("M",["MM",2],"Mo",function(){return this.month()+1});D("MMM",0,0,function(a){return this.localeData().monthsShort(this,a)});D("MMMM",0,0,function(a){return this.localeData().months(this,a)});H("month","M");fa.month=8;v("M",U);v("MM",U,ka);v("MMM",function(a,b){return b.monthsShortRegex(a)});v("MMMM",function(a,b){return b.monthsRegex(a)});L(["M","MM"],
function(a,b){b[va]=q(a)-1});L(["MMM","MMMM"],function(a,b,c,d){d=c._locale.monthsParse(a,d,c._strict);null!=d?b[va]=d:e(c).invalidMonth=a});var gc=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,Jb="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");D("w",["ww",2],"wo","week");D("W",["WW",2],"Wo","isoWeek");H("week","w");H("isoWeek","W");fa.week=5;fa.isoWeek=5;v("w",U);v("ww",U,ka);v("W",U);v("WW",U,ka);y(["w","ww","W","WW"],function(a,b,c,e){b[e.substr(0,1)]=q(a)});D("d",0,"do","day");D("dd",0,0,function(a){return this.localeData().weekdaysMin(this,
a)});D("ddd",0,0,function(a){return this.localeData().weekdaysShort(this,a)});D("dddd",0,0,function(a){return this.localeData().weekdays(this,a)});D("e",0,0,"weekday");D("E",0,0,"isoWeekday");H("day","d");H("weekday","e");H("isoWeekday","E");fa.day=11;fa.weekday=11;fa.isoWeekday=11;v("d",U);v("e",U);v("E",U);v("dd",function(a,b){return b.weekdaysMinRegex(a)});v("ddd",function(a,b){return b.weekdaysShortRegex(a)});v("dddd",function(a,b){return b.weekdaysRegex(a)});y(["dd","ddd","dddd"],function(a,
b,c,d){d=c._locale.weekdaysParse(a,d,c._strict);null!=d?b.d=d:e(c).invalidWeekday=a});y(["d","e","E"],function(a,b,c,e){b[e]=q(a)});var Kb="Sun Mon Tue Wed Thu Fri Sat".split(" ");D("H",["HH",2],0,"hour");D("h",["hh",2],0,lb);D("k",["kk",2],0,function(){return this.hours()||24});D("hmm",0,0,function(){return""+lb.apply(this)+J(this.minutes(),2)});D("hmmss",0,0,function(){return""+lb.apply(this)+J(this.minutes(),2)+J(this.seconds(),2)});D("Hmm",0,0,function(){return""+this.hours()+J(this.minutes(),
2)});D("Hmmss",0,0,function(){return""+this.hours()+J(this.minutes(),2)+J(this.seconds(),2)});Db("a",!0);Db("A",!1);H("hour","h");fa.hour=13;v("a",Eb);v("A",Eb);v("H",U);v("h",U);v("k",U);v("HH",U,ka);v("hh",U,ka);v("kk",U,ka);v("hmm",dc);v("hmmss",ec);v("Hmm",dc);v("Hmmss",ec);L(["H","HH"],ca);L(["k","kk"],function(a,b,c){a=q(a);b[ca]=24===a?0:a});L(["a","A"],function(a,b,c){c._isPm=c._locale.isPM(a);c._meridiem=a});L(["h","hh"],function(a,b,c){b[ca]=q(a);e(c).bigHour=!0});L("hmm",function(a,b,c){var d=
a.length-2;b[ca]=q(a.substr(0,d));b[pa]=q(a.substr(d));e(c).bigHour=!0});L("hmmss",function(a,b,c){var d=a.length-4,f=a.length-2;b[ca]=q(a.substr(0,d));b[pa]=q(a.substr(d,2));b[wa]=q(a.substr(f));e(c).bigHour=!0});L("Hmm",function(a,b,c){c=a.length-2;b[ca]=q(a.substr(0,c));b[pa]=q(a.substr(c))});L("Hmmss",function(a,b,c){c=a.length-4;var e=a.length-2;b[ca]=q(a.substr(0,c));b[pa]=q(a.substr(c,2));b[wa]=q(a.substr(e))});var Fc=N("Hours",!0),Gb={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",
nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},
months:"January February March April May June July August September October November December".split(" "),monthsShort:Jb,week:{dow:0,doy:6},weekdays:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),weekdaysMin:"Su Mo Tu We Th Fr Sa".split(" "),weekdaysShort:Kb,meridiemParse:/[ap]\.?m?\.?/i},ba={},Qa={},Pa,oc=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,pc=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,
qc=/Z|[+-]\d\d(?::?\d\d)?/,Va=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],pb=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",
/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],uc=/^\/?Date\((\-?\d+)/i,rc=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,sc={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};h.createFromInputFallback=A("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged and will be removed in an upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",
function(a){a._d=new Date(a._i+(a._useUTC?" UTC":""))});h.ISO_8601=function(){};h.RFC_2822=function(){};var Gc=A("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var a=T.apply(null,arguments);return this.isValid()&&a.isValid()?a<this?this:a:t()}),Hc=A("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var a=T.apply(null,arguments);return this.isValid()&&a.isValid()?a>this?this:
a:t()}),Ra="year quarter month week day hour minute second millisecond".split(" ");Nb("Z",":");Nb("ZZ","");v("Z",db);v("ZZ",db);L(["Z","ZZ"],function(a,b,c){c._useUTC=!0;c._tzm=tb(db,a)});var xc=/([\+\-]|\d\d)/gi;h.updateOffset=function(){};var yc=/^(\-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,zc=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;qa.fn=Wa.prototype;qa.invalid=
function(){return qa(NaN)};var Ic=Qb(1,"add"),Jc=Qb(-1,"subtract");h.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";h.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var hc=A("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(a){return void 0===a?this.localeData():this.locale(a)}),Vb=126227808E5;D(0,["gg",2],0,function(){return this.weekYear()%100});D(0,["GG",2],0,function(){return this.isoWeekYear()%100});Xa("gggg",
"weekYear");Xa("ggggg","weekYear");Xa("GGGG","isoWeekYear");Xa("GGGGG","isoWeekYear");H("weekYear","gg");H("isoWeekYear","GG");fa.weekYear=1;fa.isoWeekYear=1;v("G",cb);v("g",cb);v("GG",U,ka);v("gg",U,ka);v("GGGG",zb,yb);v("gggg",zb,yb);v("GGGGG",bb,$a);v("ggggg",bb,$a);y(["gggg","ggggg","GGGG","GGGGG"],function(a,b,c,e){b[e.substr(0,2)]=q(a)});y(["gg","GG"],function(a,b,c,e){b[e]=h.parseTwoDigitYear(a)});D("Q",0,"Qo","quarter");H("quarter","Q");fa.quarter=7;v("Q",bc);L("Q",function(a,b){b[va]=3*(q(a)-
1)});D("D",["DD",2],"Do","date");H("date","D");fa.date=9;v("D",U);v("DD",U,ka);v("Do",function(a,b){return a?b._dayOfMonthOrdinalParse||b._ordinalParse:b._dayOfMonthOrdinalParseLenient});L(["D","DD"],sa);L("Do",function(a,b){b[sa]=q(a.match(U)[0])});var ic=N("Date",!0);D("DDD",["DDDD",3],"DDDo","dayOfYear");H("dayOfYear","DDD");fa.dayOfYear=4;v("DDD",ab);v("DDDD",cc);L(["DDD","DDDD"],function(a,b,c){c._dayOfYear=q(a)});D("m",["mm",2],0,"minute");H("minute","m");fa.minute=14;v("m",U);v("mm",U,ka);
L(["m","mm"],pa);var Kc=N("Minutes",!1);D("s",["ss",2],0,"second");H("second","s");fa.second=15;v("s",U);v("ss",U,ka);L(["s","ss"],wa);var Lc=N("Seconds",!1);D("S",0,0,function(){return~~(this.millisecond()/100)});D(0,["SS",2],0,function(){return~~(this.millisecond()/10)});D(0,["SSS",3],0,"millisecond");D(0,["SSSS",4],0,function(){return 10*this.millisecond()});D(0,["SSSSS",5],0,function(){return 100*this.millisecond()});D(0,["SSSSSS",6],0,function(){return 1E3*this.millisecond()});D(0,["SSSSSSS",
7],0,function(){return 1E4*this.millisecond()});D(0,["SSSSSSSS",8],0,function(){return 1E5*this.millisecond()});D(0,["SSSSSSSSS",9],0,function(){return 1E6*this.millisecond()});H("millisecond","ms");fa.millisecond=16;v("S",ab,bc);v("SS",ab,ka);v("SSS",ab,cc);var Ba;for(Ba="SSSS";9>=Ba.length;Ba+="S")v(Ba,Dc);for(Ba="S";9>=Ba.length;Ba+="S")L(Ba,Ac);var Mc=N("Milliseconds",!1);D("z",0,0,"zoneAbbr");D("zz",0,0,"zoneName");var z=r.prototype;z.add=Ic;z.calendar=function(a,b){a=a||T();var c=ub(a,this).startOf("day");
c=h.calendarFormat(this,c)||"sameElse";b=b&&(G(b[c])?b[c].call(this,a):b[c]);return this.format(b||this.localeData().calendar(c,this,T(a)))};z.clone=function(){return new r(this)};z.diff=function(a,b,c){if(!this.isValid())return NaN;a=ub(a,this);if(!a.isValid())return NaN;var e=6E4*(a.utcOffset()-this.utcOffset());b=I(b);switch(b){case "year":b=vb(this,a)/12;break;case "month":b=vb(this,a);break;case "quarter":b=vb(this,a)/3;break;case "second":b=(this-a)/1E3;break;case "minute":b=(this-a)/6E4;break;
case "hour":b=(this-a)/36E5;break;case "day":b=(this-a-e)/864E5;break;case "week":b=(this-a-e)/6048E5;break;default:b=this-a}return c?b:u(b)};z.endOf=function(a){a=I(a);if(void 0===a||"millisecond"===a||!this.isValid())return this;var b=this._isUTC?Wb:Ub;switch(a){case "year":var c=b(this.year()+1,0,1)-1;break;case "quarter":c=b(this.year(),this.month()-this.month()%3+3,1)-1;break;case "month":c=b(this.year(),this.month()+1,1)-1;break;case "week":c=b(this.year(),this.month(),this.date()-this.weekday()+
7)-1;break;case "isoWeek":c=b(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case "day":case "date":c=b(this.year(),this.month(),this.date()+1)-1;break;case "hour":c=this._d.valueOf();c+=36E5-La(c+(this._isUTC?0:6E4*this.utcOffset()),36E5)-1;break;case "minute":c=this._d.valueOf();c+=6E4-La(c,6E4)-1;break;case "second":c=this._d.valueOf(),c+=1E3-La(c,1E3)-1}this._d.setTime(c);h.updateOffset(this,!0);return this};z.format=function(a){a||(a=this.isUtc()?h.defaultFormatUtc:h.defaultFormat);
a=Y(this,a);return this.localeData().postformat(a)};z.from=function(a,b){return this.isValid()&&(n(a)&&a.isValid()||T(a).isValid())?qa({to:this,from:a}).locale(this.locale()).humanize(!b):this.localeData().invalidDate()};z.fromNow=function(a){return this.from(T(),a)};z.to=function(a,b){return this.isValid()&&(n(a)&&a.isValid()||T(a).isValid())?qa({from:this,to:a}).locale(this.locale()).humanize(!b):this.localeData().invalidDate()};z.toNow=function(a){return this.to(T(),a)};z.get=function(a){a=I(a);
return G(this[a])?this[a]():this};z.invalidAt=function(){return e(this).overflow};z.isAfter=function(a,b){a=n(a)?a:T(a);if(!this.isValid()||!a.isValid())return!1;b=I(b)||"millisecond";return"millisecond"===b?this.valueOf()>a.valueOf():a.valueOf()<this.clone().startOf(b).valueOf()};z.isBefore=function(a,b){a=n(a)?a:T(a);if(!this.isValid()||!a.isValid())return!1;b=I(b)||"millisecond";return"millisecond"===b?this.valueOf()<a.valueOf():this.clone().endOf(b).valueOf()<a.valueOf()};z.isBetween=function(a,
b,c,e){a=n(a)?a:T(a);b=n(b)?b:T(b);if(!(this.isValid()&&a.isValid()&&b.isValid()))return!1;e=e||"()";return("("===e[0]?this.isAfter(a,c):!this.isBefore(a,c))&&(")"===e[1]?this.isBefore(b,c):!this.isAfter(b,c))};z.isSame=function(a,b){a=n(a)?a:T(a);if(!this.isValid()||!a.isValid())return!1;b=I(b)||"millisecond";if("millisecond"===b)return this.valueOf()===a.valueOf();a=a.valueOf();return this.clone().startOf(b).valueOf()<=a&&a<=this.clone().endOf(b).valueOf()};z.isSameOrAfter=function(a,b){return this.isSame(a,
b)||this.isAfter(a,b)};z.isSameOrBefore=function(a,b){return this.isSame(a,b)||this.isBefore(a,b)};z.isValid=function(){return p(this)};z.lang=hc;z.locale=Sb;z.localeData=Tb;z.max=Hc;z.min=Gc;z.parsingFlags=function(){return m({},e(this))};z.set=function(a,b){if("object"===typeof a){a=O(a);b=la(a);for(var c=0;c<b.length;c++)this[b[c].unit](a[b[c].unit])}else if(a=I(a),G(this[a]))return this[a](b);return this};z.startOf=function(a){a=I(a);if(void 0===a||"millisecond"===a||!this.isValid())return this;
var b=this._isUTC?Wb:Ub;switch(a){case "year":var c=b(this.year(),0,1);break;case "quarter":c=b(this.year(),this.month()-this.month()%3,1);break;case "month":c=b(this.year(),this.month(),1);break;case "week":c=b(this.year(),this.month(),this.date()-this.weekday());break;case "isoWeek":c=b(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case "day":case "date":c=b(this.year(),this.month(),this.date());break;case "hour":c=this._d.valueOf();c-=La(c+(this._isUTC?0:6E4*this.utcOffset()),
36E5);break;case "minute":c=this._d.valueOf();c-=La(c,6E4);break;case "second":c=this._d.valueOf(),c-=La(c,1E3)}this._d.setTime(c);h.updateOffset(this,!0);return this};z.subtract=Jc;z.toArray=function(){return[this.year(),this.month(),this.date(),this.hour(),this.minute(),this.second(),this.millisecond()]};z.toObject=function(){return{years:this.year(),months:this.month(),date:this.date(),hours:this.hours(),minutes:this.minutes(),seconds:this.seconds(),milliseconds:this.milliseconds()}};z.toDate=
function(){return new Date(this.valueOf())};z.toISOString=function(a){if(!this.isValid())return null;var b=(a=!0!==a)?this.clone().utc():this;return 0>b.year()||9999<b.year()?Y(b,a?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):G(Date.prototype.toISOString)?a?this.toDate().toISOString():(new Date(this.valueOf()+6E4*this.utcOffset())).toISOString().replace("Z",Y(b,"Z")):Y(b,a?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")};z.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+
this._i+" */)";var a="moment",b="";this.isLocal()||(a=0===this.utcOffset()?"moment.utc":"moment.parseZone",b="Z");a="["+a+'("]';var c=0<=this.year()&&9999>=this.year()?"YYYY":"YYYYYY";return this.format(a+c+"-MM-DD[T]HH:mm:ss.SSS"+(b+'[")]'))};z.toJSON=function(){return this.isValid()?this.toISOString():null};z.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")};z.unix=function(){return Math.floor(this.valueOf()/1E3)};z.valueOf=function(){return this._d.valueOf()-
6E4*(this._offset||0)};z.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}};z.year=fc;z.isLeapYear=function(){return Q(this.year())};z.weekYear=function(a){return Xb.call(this,a,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)};z.isoWeekYear=function(a){return Xb.call(this,a,this.isoWeek(),this.isoWeekday(),1,4)};z.quarter=z.quarters=function(a){return null==a?Math.ceil((this.month()+1)/3):this.month(3*
(a-1)+this.month()%3)};z.month=za;z.daysInMonth=function(){return ma(this.year(),this.month())};z.week=z.weeks=function(a){var b=this.localeData().week(this);return null==a?b:this.add(7*(a-b),"d")};z.isoWeek=z.isoWeeks=function(a){var b=Oa(this,1,4).week;return null==a?b:this.add(7*(a-b),"d")};z.weeksInYear=function(){var a=this.localeData()._week;return Da(this.year(),a.dow,a.doy)};z.isoWeeksInYear=function(){return Da(this.year(),1,4)};z.date=ic;z.day=z.days=function(a){if(!this.isValid())return null!=
a?this:NaN;var b=this._isUTC?this._d.getUTCDay():this._d.getDay();if(null!=a){var c=this.localeData();"string"===typeof a&&(isNaN(a)?(a=c.weekdaysParse(a),a="number"===typeof a?a:null):a=parseInt(a,10));return this.add(a-b,"d")}return b};z.weekday=function(a){if(!this.isValid())return null!=a?this:NaN;var b=(this.day()+7-this.localeData()._week.dow)%7;return null==a?b:this.add(a-b,"d")};z.isoWeekday=function(a){if(!this.isValid())return null!=a?this:NaN;if(null!=a){var b=this.localeData();a="string"===
typeof a?b.weekdaysParse(a)%7||7:isNaN(a)?null:a;return this.day(this.day()%7?a:a-7)}return this.day()||7};z.dayOfYear=function(a){var b=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864E5)+1;return null==a?b:this.add(a-b,"d")};z.hour=z.hours=Fc;z.minute=z.minutes=Kc;z.second=z.seconds=Lc;z.millisecond=z.milliseconds=Mc;z.utcOffset=function(a,b,c){var e=this._offset||0,d;if(!this.isValid())return null!=a?this:NaN;if(null!=a){if("string"===typeof a){if(a=tb(db,a),null===a)return this}else 16>
Math.abs(a)&&!c&&(a*=60);!this._isUTC&&b&&(d=15*-Math.round(this._d.getTimezoneOffset()/15));this._offset=a;this._isUTC=!0;null!=d&&this.add(d,"m");e!==a&&(!b||this._changeInProgress?Rb(this,qa(a-e,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,h.updateOffset(this,!0),this._changeInProgress=null));return this}return this._isUTC?e:15*-Math.round(this._d.getTimezoneOffset()/15)};z.utc=function(a){return this.utcOffset(0,a)};z.local=function(a){this._isUTC&&(this.utcOffset(0,a),this._isUTC=
!1,a&&this.subtract(15*-Math.round(this._d.getTimezoneOffset()/15),"m"));return this};z.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"===typeof this._i){var a=tb(Ec,this._i);null!=a?this.utcOffset(a):this.utcOffset(0,!0)}return this};z.hasAlignedHourOffset=function(a){if(!this.isValid())return!1;a=a?T(a).utcOffset():0;return 0===(this.utcOffset()-a)%60};z.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()};
z.isLocal=function(){return this.isValid()?!this._isUTC:!1};z.isUtcOffset=function(){return this.isValid()?this._isUTC:!1};z.isUtc=Ob;z.isUTC=Ob;z.zoneAbbr=function(){return this._isUTC?"UTC":""};z.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""};z.dates=A("dates accessor is deprecated. Use date instead.",ic);z.months=A("months accessor is deprecated. Use month instead",za);z.years=A("years accessor is deprecated. Use year instead",fc);z.zone=A("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",
function(a,b){return null!=a?("string"!==typeof a&&(a=-a),this.utcOffset(a,b),this):-this.utcOffset()});z.isDSTShifted=A("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",function(){if(!d(this._isDSTShifted))return this._isDSTShifted;var a={};x(a,this);a=Lb(a);if(a._a){var b=a._isUTC?l(a._a):T(a._a);this._isDSTShifted=this.isValid()&&0<w(a._a,b.toArray())}else this._isDSTShifted=!1;return this._isDSTShifted});var S=K.prototype;S.calendar=function(a,
b,c){a=this._calendar[a]||this._calendar.sameElse;return G(a)?a.call(b,c):a};S.longDateFormat=function(a){var b=this._longDateFormat[a],c=this._longDateFormat[a.toUpperCase()];if(b||!c)return b;this._longDateFormat[a]=c.replace(/MMMM|MM|DD|dddd/g,function(a){return a.slice(1)});return this._longDateFormat[a]};S.invalidDate=function(){return this._invalidDate};S.ordinal=function(a){return this._ordinal.replace("%d",a)};S.preparse=Yb;S.postformat=Yb;S.relativeTime=function(a,b,c,e){var d=this._relativeTime[c];
return G(d)?d(a,b,c,e):d.replace(/%d/i,a)};S.pastFuture=function(a,b){a=this._relativeTime[0<a?"future":"past"];return G(a)?a(b):a.replace(/%s/i,b)};S.set=function(a){var b;for(b in a){var c=a[b];G(c)?this[b]=c:this["_"+b]=c}this._config=a;this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)};S.months=function(a,b){return a?g(this._months)?this._months[a.month()]:this._months[(this._months.isFormat||gc).test(b)?"format":
"standalone"][a.month()]:g(this._months)?this._months:this._months.standalone};S.monthsShort=function(a,b){return a?g(this._monthsShort)?this._monthsShort[a.month()]:this._monthsShort[gc.test(b)?"format":"standalone"][a.month()]:g(this._monthsShort)?this._monthsShort:this._monthsShort.standalone};S.monthsParse=function(a,b,c){var e;if(this._monthsParseExact){a:{a=a.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],e=0;12>e;++e){var d=
l([2E3,e]);this._shortMonthsParse[e]=this.monthsShort(d,"").toLocaleLowerCase();this._longMonthsParse[e]=this.months(d,"").toLocaleLowerCase()}if(c)b="MMM"===b?aa.call(this._shortMonthsParse,a):aa.call(this._longMonthsParse,a);else if("MMM"===b){b=aa.call(this._shortMonthsParse,a);if(-1!==b)break a;b=aa.call(this._longMonthsParse,a)}else{b=aa.call(this._longMonthsParse,a);if(-1!==b)break a;b=aa.call(this._shortMonthsParse,a)}b=-1!==b?b:null}return b}this._monthsParse||(this._monthsParse=[],this._longMonthsParse=
[],this._shortMonthsParse=[]);for(e=0;12>e;e++)if(d=l([2E3,e]),c&&!this._longMonthsParse[e]&&(this._longMonthsParse[e]=new RegExp("^"+this.months(d,"").replace(".","")+"$","i"),this._shortMonthsParse[e]=new RegExp("^"+this.monthsShort(d,"").replace(".","")+"$","i")),c||this._monthsParse[e]||(d="^"+this.months(d,"")+"|^"+this.monthsShort(d,""),this._monthsParse[e]=new RegExp(d.replace(".",""),"i")),c&&"MMMM"===b&&this._longMonthsParse[e].test(a)||c&&"MMM"===b&&this._shortMonthsParse[e].test(a)||!c&&
this._monthsParse[e].test(a))return e};S.monthsRegex=function(a){if(this._monthsParseExact)return k(this,"_monthsRegex")||na.call(this),a?this._monthsStrictRegex:this._monthsRegex;k(this,"_monthsRegex")||(this._monthsRegex=Sa);return this._monthsStrictRegex&&a?this._monthsStrictRegex:this._monthsRegex};S.monthsShortRegex=function(a){if(this._monthsParseExact)return k(this,"_monthsRegex")||na.call(this),a?this._monthsShortStrictRegex:this._monthsShortRegex;k(this,"_monthsShortRegex")||(this._monthsShortRegex=
Sa);return this._monthsShortStrictRegex&&a?this._monthsShortStrictRegex:this._monthsShortRegex};S.week=function(a){return Oa(a,this._week.dow,this._week.doy).week};S.firstDayOfYear=function(){return this._week.doy};S.firstDayOfWeek=function(){return this._week.dow};S.weekdays=function(a,b){b=g(this._weekdays)?this._weekdays:this._weekdays[a&&!0!==a&&this._weekdays.isFormat.test(b)?"format":"standalone"];return!0===a?jb(b,this._week.dow):a?b[a.day()]:b};S.weekdaysMin=function(a){return!0===a?jb(this._weekdaysMin,
this._week.dow):a?this._weekdaysMin[a.day()]:this._weekdaysMin};S.weekdaysShort=function(a){return!0===a?jb(this._weekdaysShort,this._week.dow):a?this._weekdaysShort[a.day()]:this._weekdaysShort};S.weekdaysParse=function(a,b,c){var e;if(this._weekdaysParseExact)return lc.call(this,a,b,c);this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]);for(e=0;7>e;e++){var d=l([2E3,1]).day(e);c&&!this._fullWeekdaysParse[e]&&(this._fullWeekdaysParse[e]=
new RegExp("^"+this.weekdays(d,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[e]=new RegExp("^"+this.weekdaysShort(d,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[e]=new RegExp("^"+this.weekdaysMin(d,"").replace(".","\\.?")+"$","i"));this._weekdaysParse[e]||(d="^"+this.weekdays(d,"")+"|^"+this.weekdaysShort(d,"")+"|^"+this.weekdaysMin(d,""),this._weekdaysParse[e]=new RegExp(d.replace(".",""),"i"));if(c&&"dddd"===b&&this._fullWeekdaysParse[e].test(a)||c&&"ddd"===b&&this._shortWeekdaysParse[e].test(a)||
c&&"dd"===b&&this._minWeekdaysParse[e].test(a)||!c&&this._weekdaysParse[e].test(a))return e}};S.weekdaysRegex=function(a){if(this._weekdaysParseExact)return k(this,"_weekdaysRegex")||kb.call(this),a?this._weekdaysStrictRegex:this._weekdaysRegex;k(this,"_weekdaysRegex")||(this._weekdaysRegex=Sa);return this._weekdaysStrictRegex&&a?this._weekdaysStrictRegex:this._weekdaysRegex};S.weekdaysShortRegex=function(a){if(this._weekdaysParseExact)return k(this,"_weekdaysRegex")||kb.call(this),a?this._weekdaysShortStrictRegex:
this._weekdaysShortRegex;k(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=Sa);return this._weekdaysShortStrictRegex&&a?this._weekdaysShortStrictRegex:this._weekdaysShortRegex};S.weekdaysMinRegex=function(a){if(this._weekdaysParseExact)return k(this,"_weekdaysRegex")||kb.call(this),a?this._weekdaysMinStrictRegex:this._weekdaysMinRegex;k(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Sa);return this._weekdaysMinStrictRegex&&a?this._weekdaysMinStrictRegex:this._weekdaysMinRegex};S.isPM=function(a){return"p"===
(a+"").toLowerCase().charAt(0)};S.meridiem=function(a,b,c){return 11<a?c?"pm":"PM":c?"am":"AM"};Ja("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(a){var b=a%10;b=1===q(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+b}});h.lang=A("moment.lang is deprecated. Use moment.locale instead.",Ja);h.langData=A("moment.langData is deprecated. Use moment.localeData instead.",Aa);var ya=Math.abs,Nc=xa("ms"),Oc=xa("s"),Pc=xa("m"),Qc=xa("h"),Rc=xa("d"),Sc=xa("w"),Tc=xa("M"),
Uc=xa("Q"),Vc=xa("y"),Wc=Ga("milliseconds"),Xc=Ga("seconds"),Yc=Ga("minutes"),Zc=Ga("hours"),$c=Ga("days"),ad=Ga("months"),bd=Ga("years"),Ca=Math.round,ta={ss:44,s:45,m:45,h:22,d:26,M:11},xb=Math.abs,P=Wa.prototype;P.isValid=function(){return this._isValid};P.abs=function(){var a=this._data;this._milliseconds=ya(this._milliseconds);this._days=ya(this._days);this._months=ya(this._months);a.milliseconds=ya(a.milliseconds);a.seconds=ya(a.seconds);a.minutes=ya(a.minutes);a.hours=ya(a.hours);a.months=
ya(a.months);a.years=ya(a.years);return this};P.add=function(a,b){return $b(this,a,b,1)};P.subtract=function(a,b){return $b(this,a,b,-1)};P.as=function(a){if(!this.isValid())return NaN;var b=this._milliseconds;a=I(a);if("month"===a||"quarter"===a||"year"===a){var c=this._days+b/864E5;c=this._months+4800*c/146097;switch(a){case "month":return c;case "quarter":return c/3;case "year":return c/12}}else switch(c=this._days+Math.round(146097*this._months/4800),a){case "week":return c/7+b/6048E5;case "day":return c+
b/864E5;case "hour":return 24*c+b/36E5;case "minute":return 1440*c+b/6E4;case "second":return 86400*c+b/1E3;case "millisecond":return Math.floor(864E5*c)+b;default:throw Error("Unknown unit "+a);}};P.asMilliseconds=Nc;P.asSeconds=Oc;P.asMinutes=Pc;P.asHours=Qc;P.asDays=Rc;P.asWeeks=Sc;P.asMonths=Tc;P.asQuarters=Uc;P.asYears=Vc;P.valueOf=function(){return this.isValid()?this._milliseconds+864E5*this._days+this._months%12*2592E6+31536E6*q(this._months/12):NaN};P._bubble=function(){var a=this._milliseconds,
b=this._days,c=this._months,e=this._data;0<=a&&0<=b&&0<=c||0>=a&&0>=b&&0>=c||(a+=864E5*ac(146097*c/4800+b),c=b=0);e.milliseconds=a%1E3;a=u(a/1E3);e.seconds=a%60;a=u(a/60);e.minutes=a%60;a=u(a/60);e.hours=a%24;b+=u(a/24);a=u(4800*b/146097);c+=a;b-=ac(146097*a/4800);a=u(c/12);e.days=b;e.months=c%12;e.years=a;return this};P.clone=function(){return qa(this)};P.get=function(a){a=I(a);return this.isValid()?this[a+"s"]():NaN};P.milliseconds=Wc;P.seconds=Xc;P.minutes=Yc;P.hours=Zc;P.days=$c;P.weeks=function(){return u(this.days()/
7)};P.months=ad;P.years=bd;P.humanize=function(a){if(!this.isValid())return this.localeData().invalidDate();var b=this.localeData();var c=!a;var e=qa(this).abs(),d=Ca(e.as("s")),f=Ca(e.as("m")),k=Ca(e.as("h")),g=Ca(e.as("d")),h=Ca(e.as("M"));e=Ca(e.as("y"));d=d<=ta.ss&&["s",d]||d<ta.s&&["ss",d]||1>=f&&["m"]||f<ta.m&&["mm",f]||1>=k&&["h"]||k<ta.h&&["hh",k]||1>=g&&["d"]||g<ta.d&&["dd",g]||1>=h&&["M"]||h<ta.M&&["MM",h]||1>=e&&["y"]||["yy",e];d[2]=c;d[3]=0<+this;d[4]=b;c=Bc.apply(null,d);a&&(c=b.pastFuture(+this,
c));return b.postformat(c)};P.toISOString=Za;P.toString=Za;P.toJSON=Za;P.locale=Sb;P.localeData=Tb;P.toIsoString=A("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Za);P.lang=hc;D("X",0,0,"unix");D("x",0,0,"valueOf");v("x",cb);v("X",/[+-]?\d+(\.\d{1,3})?/);L("X",function(a,b,c){c._d=new Date(1E3*parseFloat(a,10))});L("x",function(a,b,c){c._d=new Date(q(a))});h.version="2.24.0";var jc=T;h.fn=z;h.min=function(){var a=[].slice.call(arguments,0);return Mb("isBefore",
a)};h.max=function(){var a=[].slice.call(arguments,0);return Mb("isAfter",a)};h.now=function(){return Date.now?Date.now():+new Date};h.utc=l;h.unix=function(a){return T(1E3*a)};h.months=function(a,b){return Zb(a,b,"months")};h.isDate=c;h.locale=Ja;h.invalid=t;h.duration=qa;h.isMoment=n;h.weekdays=function(a,b,c){return wb(a,b,c,"weekdays")};h.parseZone=function(){return T.apply(null,arguments).parseZone()};h.localeData=Aa;h.isDuration=rb;h.monthsShort=function(a,b){return Zb(a,b,"monthsShort")};h.weekdaysMin=
function(a,b,c){return wb(a,b,c,"weekdaysMin")};h.defineLocale=mb;h.updateLocale=function(a,b){if(null!=b){var c=Gb;var e=Ua(a);null!=e&&(c=e._config);b=C(c,b);b=new K(b);b.parentLocale=ba[a];ba[a]=b;Ja(a)}else null!=ba[a]&&(null!=ba[a].parentLocale?ba[a]=ba[a].parentLocale:null!=ba[a]&&delete ba[a]);return ba[a]};h.locales=function(){return Cc(ba)};h.weekdaysShort=function(a,b,c){return wb(a,b,c,"weekdaysShort")};h.normalizeUnits=I;h.relativeTimeRounding=function(a){return void 0===a?Ca:"function"===
typeof a?(Ca=a,!0):!1};h.relativeTimeThreshold=function(a,b){if(void 0===ta[a])return!1;if(void 0===b)return ta[a];ta[a]=b;"s"===a&&(ta.ss=b-1);return!0};h.calendarFormat=function(a,b){a=a.diff(b,"days",!0);return-6>a?"sameElse":-1>a?"lastWeek":0>a?"lastDay":1>a?"sameDay":2>a?"nextDay":7>a?"nextWeek":"sameElse"};h.prototype=z;h.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",
TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"};return h});function each(h,g){for(var f=0;f<h.length;f++)g(h[f])}var When={NOW:"now",SECONDS:"seconds",MINUTES:"minutes",NEVER:"never"},VideoOfferRejectedReasons={PM_NOT_OPEN:1,DECLINED:2,ERRORs:3};
function StopWatch(){var h=this,g=0,f,d=!1;this.getMilliseconds=function(){var a=g;d&&(a+=Date().getTime()-f);return a};this.getSeconds=function(){return h.getMilliseconds/1E3};this.start=function(){d||(d=!0,f=(new Date).getTime())};this.stop=function(){d&&(d=!1,g+=(new Date).getTime()-f,f=0)};this.reset=function(){d=!1;f=g=0}}
var Leaving=new function(){var h=[];this.add=function(g){0<=h.indexOf(g)||h.push(g)};console.log("Leave");window.onbeforeunload=function(g){each(h,function(f){f()})}},E=new function(){function h(f,d){f=g(f);f.type=d;return f}function g(f){f=document.createElement(f);f.addEventListener||(f.addEventListener=f.attachEvent);return f}this.DIV=function(){return g("div")};this.IMG=function(){return g("img")};this.CANVAS=function(){return g("canvas")};this.TABLE=function(){return g("table")};this.TR=function(){return g("tr")};
this.TD=function(){return g("td")};this.TH=function(){return g("th")};this.H3=function(){return g("h3")};this.H2=function(){return g("h2")};this.H1=function(){return g("h1")};this.VIDEO=function(){return g("video")};this.CHECKBOX=function(){return h("input","checkbox")};this.TEXT=function(){return h("input","text")};this.PASSWORD=function(){return h("input","password")};this.TEXTAREA=function(){return g("textarea")};this.SPAN=function(){return g("span")};this.SELECT=function(){return g("select")};
this.OPTION=function(){return g("option")};this.TABLE=function(){return g("table")};this.COLGROUP=function(){return g("colgroup")};this.COL=function(){return g("col")};this.BUTTON=function(){return g("button")};this.A=function(){return g("a")};this.LABEL=function(){return g("label")};this.FILE=function(){return h("input","file")}};
function EventEnabledBuilder(h){h.addEventListener=function(g,f){void 0==this._listeners&&(this._listeners={});var d=this._listeners;void 0==d[g]&&(d[g]=[]);-1==d[g].indexOf(f)&&d[g].push(f)};h.hasEventListener=function(g,f){if(void 0==this._listeners)return!1;var d=this._listeners;return void 0!==d[g]&&-1!==d[g].indexOf(f)?!0:!1};h.removeEventListener=function(g,f){void 0!=this._listeners&&(g=this._listeners[g],void 0!==g&&(f=g.indexOf(f),-1!==f&&g.splice(f,1)))};h.dispatchEvent=function(g){if(void 0!=
this._listeners){var f=this._listeners[g.type];if(void 0!==f){g.target=this;var d=[],a,c=f.length;for(a=0;a<c;a++)d[a]=f[a];for(a=0;a<c;a++)d[a].call(this,g)}}}}
var EfficientMovingCycle=function(){function h(){}function g(){m&&(l.removeEventListener("touchend",m),m=void 0)}function f(){k&&(l.removeEventListener("touchmove",k),k=void 0)}function d(){b&&(l.removeEventListener("mouseup",b),b=void 0)}function a(){c&&(l.removeEventListener("mousemove",c),c=void 0)}var c,b,k,m,l=document.documentElement;return function(e){var p=this,t=e.element,x=e.stopPropagation;this.onEnd=this.onMove=this.onStart=h;if(window.isMobile){var r=function(a){a||(a=window.event);p.onEnd(a)||
(g(),f())},n=function(a){a||(a=window.event);p.onMove(a);a.preventDefault&&a.preventDefault()};t.addEventListener("touchstart",function(a){a||(a=window.event);0!=p.onStart(a)&&(f(),g(),l.addEventListener("touchmove",n),k=n,l.addEventListener("touchend",r),m=r)})}else{var u=function(a){x&&(a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault())},q=function(b){b||(b=window.event);p.onEnd(b);d();a();u(b)},w=function(a){a||(a=window.event);p.onMove(a);u(a)};t.addEventListener("mousedown",
function(e){e||(e=window.event);0!=p.onStart(e)&&(a(),d(),l.addEventListener("mousemove",w),c=w,l.addEventListener("mouseup",q),b=q,u(e))})}}}(),DragManager=function(){return function(h){var g,f,d=this,a=h.handle;h=h.stopPropagation;h=new EfficientMovingCycle({element:a.getElement(),stopPropagation:h});var c;h.onStart=function(b){d.onStart&&d.onStart(b);b=a.getAbsolutePosition(b);g=a.getX()-b.left;f=a.getY()-b.top;c=a.getConstraints()};h.onMove=function(b){b={x:b.pageX+g,y:b.pageY+f};b.x>c.maxX?b.x=
c.maxX:b.x<c.minX&&(b.x=c.minX);b.y>c.maxY?b.y=c.maxY:b.y<c.minY&&(b.y=c.minY);a.setPosition(b)};h.onEnd=function(){a.endDrag&&a.endDrag()}}}();function Once(h){function g(){setTimeout(function(){f=!1;h()},0);f=!0}var f=!1;this.trigger=function(){f||g()}}
var VisibilityWatcher=window.VisibilityWatcher=new function(){window.EventEnabledBuilder(this);var h=new Once(function(){console.log(f);g.dispatchEvent({type:"visibilitychange",visible:f})}),g=this,f=!0;this.getIsVisible=function(){return f};visibly.onVisible(function(){f=!0;h.trigger()});visibly.onHidden(function(){f=!1;h.trigger()})};
function Iterator(h){var g=0,f=h.length;this.next=function(){var d=h[g];g++;return d};this.hasNext=function(){return g<f};this.remove=function(){h.splice(g-1,1);g--;f--}}
function ReverseIterator(h){var g=h.length,f=g-1;this.next=function(){var d=h[f];f--;return d};this.previous=function(){f++;return h[f+1]};this.hasNext=function(){return 0<=f};this.hasPrevious=function(){return f+2<g};this.remove=function(){h.splice(f+1,1);g--};this.insert=function(d){h.splice(f+1,0,d);g++};this.insertAfter=function(d){h.splice(f+2,0,d);g++};this.append=function(d){h.push(d);g++}}
var Timer=function(){return function(h){function g(){0<=b&&(k++,k>=b&&d.stop());try{c()}catch(e){console.log(e)}}function f(){l=!1;m&&(clearInterval(m),m=null)}var d=this,a=h.delay,c=h.callback,b=h.nTicks,k=0,m,l=!1;void 0==b&&(b=-1);void 0==a&&(a=1E3);this.stop=f;this.reset=function(){k=0;f()};this.start=function(){l||(l=!0,m=setInterval(g,a))};this.setDelay=function(b){d.reset();a=b;l=!0;m=setInterval(g,a)};this.isRunning=function(){return l}}}(),TemporalCallback=function(){return function(h){function g(){c.stop();
b.stop();k=0;f()}var f=h.callback,d=h.maxNTriggers,a=h.maxTotalDelay;h=h.delay;d||a||(a=3*h);var c=new Timer({callback:g,delay:h,nTicks:1}),b=new Timer({callback:g,delay:a,nTicks:1}),k=0;this.trigger=function(){k++;c.isRunning()?d&&k>d?g():c.reset():(c.start(),b.start())}}}();function Task(h,g){this.run=function(f){setTimeout(function(){try{h()}catch(d){console.error(d)}if(g)try{g()}catch(d){console.error(d)}if(f)try{f()}catch(d){console.error(d)}},0)}}
var TrafficLights=new function(){var h=[];this.isSpam=function(g){for(var f=(new Date).getTime(),d=0,a=0,c;c=h[a];a++){if(c.str&&c.str==g&&3<c.str.length)return"Please don't spam the same message!";2E3>f-c.at&&d++;if(1<d)return"Slow down!"}for(h.splice(0,0,{str:g,at:f});3<h.length;)h.splice(h.length-1,1)}};
(function(){function h(a){function c(){var a=0<t.length?t.substr(1,t.length-1):"";n||b();if(!n)return a+"\u205f";for(;a.length<x;){var c=x-a.length;if(n.getLength()<=u){b();if(!n)return a+"\u205f";n.getLength()}c=n.getTextRange(u,c);u+=c.length;a+=c}return a}function b(){for(var a,b=0,c=r.length;b<c;){if(0>q||q>=r.length)q=0;var e=r[q];if(!e.updateTimeout((new Date).getTime())&&w){a=e;break}b++}u=0;return n=a}function d(a){a=a.movingTextItem;var b=r.indexOf(a);0>b||(b<=q&&(q--,n==a&&(n=null)),r.splice(b,
1),e.dispatchEvent({type:"removed",movingTextItem:a}))}function f(){for(var a=0;a<x;a++)t+="\u205f"}function h(a){e.dispatchEvent({type:"displaystring",str:a})}window.EventEnabledBuilder(this);var e=this,p=a["default"],t=p?p:"",x=a.approximateLength;a=new g({movingText:e,extraTicksBeforeStop:x});a.onTick=function(){var a=c();t=a;h(a)};a.onStopped=function(){console.log("onTimerStopped");console.log(p);p&&(t=p,f(),h(t))};var r=[],n,u=0;f();a=window.VisibilityWatcher;setTimeout(function(){h(t)},0);
var q=0,w=!0;this.append=function(a){0<=r.indexOf(a)||(r.push(a),a.addEventListener("dispose",d),e.dispatchEvent({type:"added",movingTextItem:a}))};this.count=function(){return r.length};a.addEventListener("visibilitychange",function(a){console.log(a);console.log(a.visible);w=a.visible})}function g(a){var c=this,b=a.movingText,d=a.extraTicksBeforeStop,f=!0,g=new window.Timer({delay:1E3/9,callback:function(){var a=c.onTick;e&&0>=h--?(g.stop(),(a=c.onStopped)&&a()):a&&a()}});b.addEventListener("removed",
function(){f||0<b.count()||(f=!0,h=d,e=!0)});b.addEventListener("added",function(){f&&(g.start(),e=f=!1)});var e=!1,h=d}String.prototype.a||(String.prototype.a=function(a,c){return this.replace(new RegExp(a,"g"),c)});var f=window.MovingTextItem=function(a){window.EventEnabledBuilder(this);var c=this,b=a.text,f=a.lifecycle;f||(f=new d["default"]);(function(){for(var a;" "==(a=b.substr(b.length-1,1))||"\u2063"==a;)b=b.substr(0,b.length-1);b+="\u205f\u205f\u205f";b=b.a(" ","\u205f")})();var g=!1;this.getText=
function(a){return a<=b.length?b:b.substr(0,b.length)};this.getTextRange=function(a,c){return c+a<=b.length?b.substr(a,c):b.substr(a,b.length-a)};this.getLength=function(){return b.length};this.updateTimeout=function(a){f.setVisible();(a=f.updateTimeout(a))&&c.dispose();return a};this.dispose=function(){g||(g=!0,c.dispatchEvent({type:"dispose",movingTextItem:c}))};this.getDisposed=function(){return g}},d=window.MovingTextLifecycle=function(){function a(a){var b=a.fromVisible,c=a.duration,d,f;!b&&
c&&(f=(new Date).getTime()+c);this.getVisible=function(){return d?!0:!1};this.setVisible=function(){d||(d=(new Date).getTime(),console.log(d),b&&c&&(f=d+c))};this.getTimeoutAt=function(){return f};this.updateTimeout=function(a){if(f)return a>=f}}a["default"]=function(){return new a({fromVisible:!0,duration:1E4})};return a}();window.Title=function(a){window.EventEnabledBuilder(this);var c=new h({approximateLength:70,"default":a["default"]});this.add=function(a){"string"==typeof a?(a=new f({text:a}),
c.append(a)):c.append(a)};c.addEventListener("displaystring",function(a){document.title="\u2063"+a.str})}})();
var Notifier=new function(){var h=new Title({"default":"x-chat"});this.show=function(g){"string"==typeof g?h.add(g):"object"==typeof g&&g.inTitle&&h.add(g)}},FancyTextTranslator=new function(){function h(d,a){for(var c="",b=0;b<a.length;b++){var f=a[b],g=d[f];c+=void 0==g?f:g}return c}var g={" ":" ","!":"!",'"':'"',"#":"#",$:"$","%":"%","&":"&","'":"'","(":"(",")":")","*":"*","+":"+",",":",","-":"-",".":".","/":"/",0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",":":":",";":";","<":"<",
"=":"=",">":">","?":"?","@":"@",A:"\u1d00",B:"\u0299",C:"\u1d04",D:"\u1d05",E:"\u1d07",F:"\u0493",G:"\u0262",H:"\u029c",I:"\u026a",J:"\u1d0a",K:"\u1d0b",L:"\u029f",M:"\u1d0d",N:"\u0274",O:"\u1d0f",P:"\u1d18",Q:"\u01eb",R:"\u0280",S:"s",T:"\u1d1b",U:"\u1d1c",V:"\u1d20",W:"\u1d21",X:"x",Y:"\u028f",Z:"\u1d22","[":"[","\\":"\\","]":"]","^":"^",_:"_","`":"`",a:"\u1d00",b:"\u0299",c:"\u1d04",d:"\u1d05",e:"\u1d07",f:"\u0493",g:"\u0262",h:"\u029c",i:"\u026a",j:"\u1d0a",k:"\u1d0b",l:"\u029f",m:"\u1d0d",n:"\u0274",
o:"\u1d0f",p:"\u1d18",q:"\u01eb",r:"\u0280",s:"s",t:"\u1d1b",u:"\u1d1c",v:"\u1d20",w:"\u1d21",x:"x",y:"\u028f",z:"\u1d22","{":"{","|":"|","}":"}","~":"~","\u007f":"\u007f"},f={" ":" ","!":"!",'"':'"',"#":"#",$:"$","%":"%","&":"&","'":"'","(":"(",")":")","*":"*","+":"+",",":",","-":"-",".":".","/":"/",0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",":":":",";":";","<":"<","=":"=",">":">","?":"?","@":"@",A:"\u15e9",B:"\u15f7",C:"\u1455",D:"\u15de",E:"\u156e",F:"\u15b4",G:"\u13b6",H:"\u157c",
I:"\u13c6",J:"\u148d",K:"\u13e6",L:"\u14aa",M:"\u15f0",N:"\u144e",O:"\u2d54",P:"\u13e2",Q:"\u2d55",R:"\u13d2",S:"\u1515",T:"\u13a2",U:"\u144c",V:"\u13d9",W:"\u15ef",X:"\u166d",Y:"\u13a9",Z:"\u1614","[":"[","\\":"\\","]":"]","^":"^",_:"_","`":"`",a:"\u15e9",b:"\u15f7",c:"\u1455",d:"\u15de",e:"\u156e",f:"\u15b4",g:"\u13b6",h:"\u157c",i:"\u13c6",j:"\u148d",k:"\u13e6",l:"\u14aa",m:"\u15f0",n:"\u144e",o:"\u2d54",p:"\u13e2",q:"\u2d55",r:"\u13d2",s:"\u1515",t:"\u13a2",u:"\u144c",v:"\u13d9",w:"\u15ef",x:"\u166d",
y:"\u13a9",z:"\u1614","{":"{","|":"|","}":"}","~":"~","\u007f":"\u007f"};this.scifi=function(d){return h(f,d)};this.smallBold=function(d){return h(g,d)}};function getAbsolute(h){h=h.getBoundingClientRect();var g=document.documentElement;return{top:h.top+window.pageYOffset-g.clientTop,left:h.left+window.pageXOffset-g.clientLeft,right:h.right+window.pageYOffset-g.clientTop,bottom:h.bottom+window.pageXOffset-g.clientLeft}}
var ImagePreloader=new function(){function h(c){var b=new f({url:c});return a[c]=b}function g(a){function b(a){a=d.indexOf(a.preloader);0>a||d.splice(a,1);1>d.length&&c&&c()}var c=a.callback,d=[];this.addPreloader=function(a){a.addEventListener("done",b);d.push(a)}}function f(a){function b(){c.dispatchEvent({type:"done",preloader:c})}EventEnabledBuilder(this);var c=this;a=a.url;var d=E.IMG(),f=!1;console.log('preloading "'+a+'"');d.onload=function(a){f=!0;b()};d.onerror=function(a){console.log(a);
b()};d.src=a;this.getSuccessful=function(){return f}}var d={},a={};this.preloadRange=function(c,b){var f;each(c,function(c){if(!d[c]){var k=a[c];f||(f=new g({callback:b}));f.addPreloader(k?k:h(c))}});f||b&&b()}},ClickedOff=new function(){function h(d){d=f.indexOf(d);0>d||f.splice(d,1)}function g(d,a,c){var b=[];this.addAdditionalElement=function(a){0>b.indexOf(a)&&b.push(a)};this.removeAdditionalElement=function(a){a=b.indexOf(a);0>a||b.splice(a,1)};this.getElement=function(){return d};this.hide=
function(){c();a()};this.dispose=c}var f=[];this.register=function(d,a){var c=new g(d,a,h);setTimeout(function(){a:{var a=0;for(var k;k=f[a];a++)if(k.getElement()==d){a=!0;break a}a=!1}a||f.push(c)},0);return c};this.remove=function(d){for(var a=new Iterator(f);a.hasNext();){var c=a.next();if(c.getElement()==d){c.dispose();break}}};document.addEventListener("mousedown",function(d){var a=d.pageX;d=d.pageY;for(var c=f.slice(),b=0,k;k=c[b];b++){var g=k.getElement(),h=getAbsolute(g),e=h.left,p=e+g.offsetWidth;
h=h.top;g=h+g.offsetHeight;(a<e||a>p||d<h||d>g)&&k.hide()}})},Popup=new function(){return function(h){function g(a){f(a.popup)}function f(a){c.removeAdditionalElement(a.getElement());a=b.indexOf(a);0>a||b.splice(a,1)}function d(){k.style.display="none";each(b.slice(),f);a.dispatchEvent({type:"hide",popup:a})}h=h||{};EventEnabledBuilder(this);var a=this,c,b=[],k=E.DIV(),m=!1,l=void 0==h.closeOnClickOff?!0:h.closeOnClickOff;k.classList.add("popup");this.show=function(){l&&(c=ClickedOff.register(k,d));
k.style.display="block";m=!0};this.hide=function(){m=!1;l&&c&&c.dispose();d()};this.setPosition=function(a){a.left&&(k.style.left=String(a.left)+"px");a.top&&(k.style.top=String(a.top)+"px");a.right&&(k.style.right=String(a.right)+"px");a.bottom&&(k.style.bottom=String(a.bottom)+"px")};this.dispose=function(){l&&ClickedOff.dispose();k.parentNode.removeChild(k)};this.addChildPopup=function(a){if(!m)throw Error("Cant add child while popup is not showing. Children should be added when made visible only");
c&&(a.addEventListener("hide",g),c.addAdditionalElement(a.getElement()),b.push(a))};this.getElement=function(){return k}}},Heading=function(){function h(g){var f=E.DIV(),d=E.DIV(),a=E.DIV();f.classList.add("heading");a.classList.add("heading-title");d.classList.add("heading-entries");a.title=a.innerHTML=g.title;f.appendChild(a);f.appendChild(d);this.getElement=function(){return f};this.getEntries=function(){return d}}return function(g){g=new h(g);this.getElement=g.getElement;this.getEntries=g.getEntries}}(),
StandardMenu=new function(){function h(g){var f=g.title;EventEnabledBuilder(this);f=g.title;var d=g.classNames,a=g.popup.getElement(),c=E.DIV(),b=E.DIV();b.classList.add("entries");c.classList.add("standard-menu-inner");d&&each(d,function(b){a.classList.add(b)});d=g.buttonClose;var k=E.DIV();k.innerHTML="&nbsp;"+f;k.classList.add("heading");k.appendChild(d.getElement());a.appendChild(c);c.appendChild(k);c.appendChild(b);a.classList.add("standard-menu");each(g.entries,function(a){b.appendChild(a.getElement())});
document.body.appendChild(a);this.getElement=function(){return a};this.getEntries=function(){return b};this.setVisible=function(a){b.style.display=a?"block":"none"}}return function(g){function f(){c.hide()}var d=g.title,a=g.classNames,c=new Popup({});g=new Button({className:"button-close"});d=new h({popup:c,buttonClose:g,entries:[],title:d,classNames:a});this.getElement=d.getElement;this.getEntries=d.getEntries;this.setVisible=d.setVisible;this.show=function(){console.log("show");c.show()};this.hide=
f;g&&g.addEventListener("click",f)}},StandardSearch=function(){function h(g){var f=g.spinner,d=E.DIV(),a=g.callbackSearch;d.classList.add("standard-search-entries");var c=g.standardMenu;g=g.searchBar;c.getElement().appendChild(f.getElement());c.getEntries().appendChild(g.getElement());c.getEntries().appendChild(d);this.getEntries=function(){return d};g.addEventListener("search",a)}return function(g){EventEnabledBuilder(this);var f=g.callbackSearch,d=g.classNames,a=g.getEntryId,c=g.title;g=new Spinner({});
d=new StandardMenu({title:c,classNames:d});c=new SearchBar({});f=new h({standardMenu:d,searchBar:c,callbackSearch:f,spinner:g});new SortedFilteredEntries({element:f.getEntries(),getEntryId:a});this.show=d.show;this.hide=d.hide;this.getEntries=f.getEntries;this.showSpinner=g.show;this.hideSpinner=g.hide}}();
function Spinner(h){function g(a){c.addEventListener(a,function(a){a||(a=window.event);a.stopPropagation&&a.stopPropagation();a.preventDefault&&a.preventDefault();return!1})}var f=h.preventInterraction,d=this;h=E.DIV();h.classList.add("spinner");for(var a=0;3>a;a++)h.appendChild(E.DIV());if(f){f=E.DIV();f.classList.add("prevent-interraction");document.documentElement.appendChild(f);f.appendChild(h);var c=f}else c=h;c.style.display="none";this.getElement=function(){return c};this.show=function(){d.setVisible(!0)};
this.hide=function(){d.setVisible(!1)};this.setVisible=function(a){c.style.display=a?"inline-block":"none";a&&f&&setTimeout(function(){document.activeElement&&document.activeElement.blur&&document.activeElement.blur()},0)};f&&(g("click"),g("mousedown"),g("mouseup"))}
var Enumerable=function(){var h=function(g,f,d){this.moveNext=g;this.current=f;this.reset=d};h.fromArray=function(g){return new function(f){var d=-1,a=f.length;return new h(function(){d++;return d<a},function(){return f[d]},function(){d=-1})}(g)};return h}();Enumerable.prototype.toList=function(){this.reset();for(var h=[];this.moveNext();)h.push(this.current());return h};Enumerable.prototype.select=function(h){var g=this;return new Enumerable(this.moveNext,function(){return h(g.current())},this.reset)};
Enumerable.prototype.take=function(h){return function(g,f){var d=0;return new Enumerable(function(){return f.moveNext()&&(d++,d<=g)?!0:!1},f.current,f.reset)}(h,this)};Enumerable.prototype.leave=function(h){var g=this,f=0;return new Enumerable(function(){return g.moveNext()&&(f++,f>h)?!0:!1},g.current,g.reset)};Enumerable.prototype.where=function(h){var g=this;return new Enumerable(function(){do if(!g.moveNext())return!1;while(!h(g.current()));return!0},this.current,this.reset)};
Enumerable.prototype.firstOrDefault=function(){this.reset();this.moveNext();return this.current()};Enumerable.prototype.reverse=function(){this.reset();return Enumerable.fromArray(this.toList().reverse())};Enumerable.prototype.sum=function(h){this.reset();for(var g=0;this.moveNext();)g+=h(this.current());return g};Enumerable.prototype.count=function(){this.reset();for(var h=0;this.moveNext();)h++;return h};Enumerable.prototype.each=function(h){for(this.reset();this.moveNext();)h(this.current())};
Array.prototype.select=function(h){return Enumerable.fromArray(this).select(h)};Array.prototype.where=function(h){return Enumerable.fromArray(this).where(h)};Array.prototype.each=function(h){return Enumerable.fromArray(this).each(h)};Array.prototype.take=function(h){return Enumerable.fromArray(this).take(h)};Array.prototype.leave=function(h){return Enumerable.fromArray(this).leave(h)};Array.prototype.sum=function(h){return Enumerable.fromArray(this).sum(h)};
var Ajax=function(){function h(a,c){var b=a.parameters,d=a.callbackSuccessful,f=a.callbackFailed,h=a.callbackTimeout,e=a.contentType?a.contentType:"application/json",p=a.timeout,t=new XMLHttpRequest;t.open(c?"POST":"GET",a.url,!0);p&&(t.timeout=p);t.setRequestHeader("Content-Type",e);if(b){e=!0;for(var x in b)e&&(e=!1)}return new g(t,c?a.data:void 0,d,f,h)}function g(a,c,b,f,g){d++;var k=this,e;a.onload=function(){4===a.readyState&&(200===a.status?(e=!0,k.onDone&&k.onDone(k),b&&b(a.responseText)):
(e=!1,console.log("Request failed.  Returned status of "+a.status),k.onDone&&k.onDone(k),f&&f()))};g&&(a.ontimeout=g);a.onprogress=function(a){k.onProgress&&k.onProgress(a.total?a.loaded/a.total:1)};a.send(c);a.onerror=function(a){console.error(a);f&&f(a)};this.getXhr=function(){return a};this.abort=a.abort;this.getSuccessful=function(){return e}}var f=function(a){var c=a.url;this.post=function(a){a.url=a.url?a.url:c;return f.post(a)};this.get=function(a){a.url=a.url?a.url:c;return f.get(a)}};f.post=
function(a){return h(a,!0)};f.get=function(a){return h(a,!1)};var d=0;return f}(),Longpoll=function(){return function(h){function g(){x.get({url:B+("?t="+t++ +"_"+(new Date).getTime()),callbackSuccessful:b,callbackFailed:c,callbackTimeout:a})}function f(a){console.log(a);a=JSON.parse(a);a.disposed?(q=!0,l.dispose()):n||(n=!0,p=a.id,B=e+"/"+p,m(p),each(w,function(a){l.send(a)}),w=null,g())}function d(a){console.error(a);l.onError&&l.onError(a)}function a(){g()}function c(a){console.error(a);l.onError&&
l.onError(a);r||g()}function b(a){g();a&&(a=JSON.parse(a),a.disposed&&l.dispose(),k(a))}function k(a){a.msgs&&each(a.msgs,function(a){console.log(a);l.onMessage&&l.onMessage(a)})}function m(a){console.log("dispatchGotId");l.onGotId&&l.onGotId(a)}var l=this,e=h.url,p=h.id,t=0,x=new Ajax({url:e}),r=!1,n=!1,u=!1,q=!1,w=[],B;this.send=function(a){r||(n||!u?(u=!0,x.post({data:JSON.stringify({id:p,msg:a}),callbackSuccessful:f,callbackFailed:d})):w.push(a))};this.getDisposedByServer=function(){return q};
this.dispose=function(){r||(r=!0,l.onDispose&&l.onDispose())}}}();
function Spinner(h){function g(b){a.addEventListener(b,function(a){a||(a=window.event);a.stopPropagation&&a.stopPropagation();a.preventDefault&&a.preventDefault();return!1})}var f=h.preventInterraction,d=this;h=E.DIV();var a;h.classList.add("spinner");for(var c=0;3>c;c++)h.appendChild(E.DIV());f?(f=E.DIV(),f.classList.add("prevent-interraction"),document.documentElement.appendChild(f),f.appendChild(h),a=f):a=h;a.style.display="none";this.getElement=function(){return a};this.show=function(){d.setVisible(!0)};
this.hide=function(){d.setVisible(!1)};this.setVisible=function(b){a.style.display=b?"inline-block":"none";b&&f&&setTimeout(function(){document.activeElement&&document.activeElement.blur&&document.activeElement.blur()},0)};f&&(g("click"),g("mousedown"),g("mouseup"))}var Settings=function(){return function(h){this.get=function(g){try{var f=window.localStorage.getItem(h+"_"+g);return null==f||void 0==f?void 0:JSON.parse(f)}catch(d){}};this.set=function(g,f){try{window.localStorage.setItem(h+"_"+g,JSON.stringify(f))}catch(d){console.log(d)}}}}();
function TabPanel(h,g,f){function d(a,b,e){this.div=E.DIV();var d=E.DIV();this.div.style.width=String(l)+"%";this.div.style.left=String(e*l)+"%";this.div.classList.add("tab");d.classList.add("name");this.div.appendChild(d);d.innerHTML=a;this.div.addEventListener("mousedown",function(){c(b)});this.close=function(){};this.setActive=function(){this.div.style.height="18px"};this.setInactive=function(){this.div.style.height="17px"}}function a(){var a=this;this.div=E.DIV();this.div.style.height=g?"auto":
"calc(100% - 3px)";this.div.style.position=g?"relative":"absolute";this.div.classList.add("panel");this.show=function(){a.div.style.display="inline"};this.hide=function(){a.div.style.display="none"};this.close=function(){}}function c(a){for(var c=0;c<b.panels.length;c++){var e=b.panels[c];e.hide();if(a!=e)b.tabs[c].setInactive();else if(b.tabs[c].setActive(),b.onChangeTab)b.onChangeTab(c)}a.show()}var b=this;this.panels=[];this.tabs=[];f=h.length;this.div=E.DIV();var k=E.DIV(),m=E.DIV();m.classList.add("tabs");
this.div.style.height=g?"auto":"100%";this.div.classList.add("tab-panel");var l=100/f;k.style.height=g?"auto":"calc(100% - 20px)";k.style.width="100%";g||(k.style.top="20px");k.style.float="left";k.style.position=g?"relative":"absolute";this.div.appendChild(m);this.div.appendChild(k);for(var e=0;e<f;e++){var p=new a,t=new d(h[e],p,e);b.panels.push(p);b.tabs.push(t);k.appendChild(p.div);m.appendChild(t.div)}c(b.panels[0]);this.close=function(){for(var a=0;a<b.panels.length;a++)b.panels[a].close(),
b.tabs[a].close()}}
var WindowResizeManager=new function(){EventEnabledBuilder(this);var h=this;window.addEventListener("resize",function(){console.log("doing resize");h.dispatchEvent({type:"resized"})})},ResizeManager=new function(){function h(g){function f(){k.trigger()}function d(d){if(h){if(d=h,h=c.getBoundingClientRect(),d.height!=h.height||d.width!=h.width)a.dispatchEvent({type:"resized"}),b&&b()}else h=c.getBoundingClientRect()}EventEnabledBuilder(this);var a=this,c=g.element,b=g.onResized,k=(g=g.staggered)?new TemporalCallback({callback:d,
delay:500,maxTotalDelay:800}):void 0,h;this.manual=function(){d()};window.ResizeObserver?(new window.ResizeObserver(g?f:d)).observe(c):WindowResizeManager.addEventListener("resized",g?f:d)}EventEnabledBuilder(this);this.add=function(g){return new h(g)}},Tickbox=function(){return function(h){function g(){f?a.classList.contains("ticked")||a.classList.add("ticked"):a.classList.contains("ticked")&&a.classList.remove("ticked")}var f=!1,d=E.DIV();d.classList.add("tickbox");var a=E.DIV();a.classList.add("box");
if(h.text){var c=E.DIV();c.classList.add("text");d.appendChild(c);c.innerHTML=h.text}d.appendChild(a);this.getElement=function(){return d};this.setTicked=function(a){f=a;g()};this.getTicked=function(){return f};a.addEventListener("click",function(){f=!f;g()})}}();function Genders(){}
function GenderPicker(){var h=document.createElement("select");h.classList.add("gender");for(var g=0;g<Genders.values.length;g++){var f=Genders.values[g],d=document.createElement("option");d.innerHTML=f.txt;d.value=f.value;h.appendChild(d)}this.getValue=function(){return h.options[h.selectedIndex].value};this.getElement=function(){return h}}
Genders.values=[{value:0,txt:"a man"},{value:1,txt:"a woman"},{value:2,txt:"a couple(man + woman)"},{value:3,txt:"a couple of men"},{value:4,txt:"a couple of women"},{value:5,txt:"a transexual man"},{value:6,txt:"a transexual women"}];
function Birthday(){function h(a,b){var c=document.createElement("option");c.value=a;c.innerHTML=b;return c}var g=E.DIV(),f=E.SELECT(),d=E.SELECT(),a=E.SELECT();g.classList.add("birthday");g.appendChild(f);g.appendChild(d);g.appendChild(a);f.classList.add("not-right");d.classList.add("not-right");var c=1900+(new Date).getYear(),b="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");f.appendChild(h(void 0,"Day"));d.appendChild(h(void 0,"Month"));a.appendChild(h(void 0,"Year"));for(var k=1;32>
k;k++){var m=h(k,String(k));f.appendChild(m)}for(k=1;12>k;k++)m=h(k,b[k]),d.appendChild(m);c-=17;for(k=c-100;k<c;k++)m=h(k,String(k)),a.appendChild(m);this.getElement=function(){return g};this.getValue=function(){var b=f.options[f.selectedIndex].value,c=d.options[d.selectedIndex].value,g=a.options[a.selectedIndex].value;return{day:"undefined"==b?void 0:parseInt(b),month:"undefined"==c?void 0:parseInt(c),year:"undefined"==g?void 0:parseInt(g)}}}
var Authenticate=function(){return function(h){function g(){if(1>C.value.length)k("You must enter an email address!");else if(1>K.value.length)k("You must enter a username!");else if(1>F.value.length)k("You must enter a password!");else if(1>G.value.length)k("You must re-enter your password!");else if(F.value!=G.value)k("The passwords entered do not match!");else{p.show();var a=ia.getValue();a.year?void 0==a.month?k("You must enter a birth month!"):a.day?(a={email:C.value,username:K.value,password:F.value,
gender:V.getValue(),birthday:a,staySignedIn:H.getTicked()},m(a)):k("You must enter a birth day!"):k("You must enter a birth year!")}}function f(){p.show();l({password:A.value,username:q.value,staySignedIn:w.getTicked()})}function d(){p.show();e({username:I.value,staySignedIn:B.getTicked()})}function a(a){a=a||window.event;if(13==a.keyCode)switch(ha){case Y.Guest:d();break;case Y.SignIn:f();break;default:g()}}function c(a,b){a.classList.add("entry");a.placeholder=b;n.appendChild(a)}function b(a,b){a.classList.add("entry");
a.placeholder=b;D.appendChild(a)}function k(a){a?(p.hide(),la.style.display="inline",J.innerHTML=a):la.style.display="none"}var m=h.callbackRegister,l=h.callbackSignIn,e=h.callbackGuest,p=new Spinner({preventInterraction:!0});document.documentElement.appendChild(p.getElement());var t=new Settings("#username",function(){this.set("username")}),x=E.DIV(),r=E.DIV(),n=E.DIV(),u=E.DIV(),q=E.TEXT(),w=new Tickbox({text:"Stay signed in"}),B=new Tickbox({text:"Stay signed in"}),A=E.PASSWORD(),F=E.PASSWORD(),
G=E.PASSWORD(),C=E.TEXT(),K=E.TEXT(),H=new Tickbox({text:"Stay signed in"}),I=E.TEXT();h=new Button({classNames:["button-register"],text:"Enter"});var O=new Button({classNames:["button-register"],text:"Done"}),la=E.DIV(),J=E.TEXTAREA();x.classList.add("authenticate");r.classList.add("div-inner");n.classList.add("div-inputs-sign-in");var D=E.DIV();I.className="form-control";K.className="form-control";C.className="form-control";G.className="form-control";F.className="form-control";A.className="form-control";
q.className="form-control";var ia=new Birthday,V=new GenderPicker;r=new Button({classNames:["button-register"],text:"Done"});b(C,"Email");b(K,"Username");b(F,"Password");b(G,"Re-enter Password");I.onkeydown=a;A.onkeydown=a;C.onkeydown=a;K.onkeydown=a;F.onkeydown=a;G.onkeydown=a;D.appendChild(V.getElement());D.appendChild(ia.getElement());D.appendChild(H.getElement());D.appendChild(r.getElement());D.classList.add("inputs-register");u.appendChild(I);r.addEventListener("click",g);(function(a,b){a.classList.add("entry");
a.placeholder=b;u.appendChild(a)})(I,"Username");c(q,"Username");c(A,"Password");A.type="password";la.classList.add("error");J.classList.add("error-text");J.readOnly=!0;h.innerHTML="Enter";this.setError=k;O.addEventListener("click",d);h.addEventListener("click",f);q.onkeydown=a;q.addEventListener("click",function(){q.focus()});var Y={Guest:0,SignIn:1,Register:2},ha=Y.Guest;r=new TabPanel(["Guest","Sign In","Register"],!0);r.onChangeTab=function(a){k("");switch(a){case 1:ha=Y.SignIn;break;case 2:ha=
Y.Register;break;default:ha=Y.Guest}};x.appendChild(r.div);r.panels[0].div.appendChild(u);r.panels[1].div.appendChild(n);r.panels[2].div.appendChild(D);r.panels[2].div.className="panel";r.div.style.height="auto";r.div.style.position="relative";u.appendChild(B.getElement());u.appendChild(O.getElement());n.appendChild(w.getElement());n.appendChild(h.getElement());x.appendChild(la);la.appendChild(J);document.body.appendChild(x);if(h=t.get("username"))q.value=h;this.show=function(){x.style.display="block"};
this.hide=function(){p.setVisible(!1);x.style.display="none";t.set("username",q.value);F.value="";G.value="";A.value=""}}}(),MappedSets=function(){function h(g){var f=this,d=[g];this.add=function(a){if(f.contains(a))return!1;d.push(a);return!0};this.remove=function(a){a=d.indexOf(a);if(0>a)return!1;d.splice(a,1)};this.contains=function(a){return 0<=d.indexOf(a)};this.getList=function(){return d};this.count=function(){return d.length}}return function(){var g={};this.add=function(f,d){if(!d)return!1;
var a=g[f];return a?a.add(d):(g[f]=new h(d),!0)};this.remove=function(f,d){var a=g[f];if(!a)return!1;if(!d)return delete g[f],!0;if(!a.remove(d))return!1;1>a.count()&&delete g[f];return!0};this.contains=function(f,d){return(f=g[f])?d?f.contains(d):!0:!1};this.getList=function(f){console.log(g);if(f=g[f])return f.getList()}}}(),TabPortal=new function(){function h(d,a){this.receivedMessage=a}var g=new MappedSets,f=new BroadcastChannel("x-chat");f.onmessage=function(d){var a=d.data;a.id&&(d=g.getList(a.id))&&
d.each(function(c){return c.receivedMessage(a.message)})};return function(d){var a=d.id;EventEnabledBuilder(this);var c=this;this.sendMessage=function(b){console.log("send");console.log(b);f.postMessage({id:a,message:b})};this.dispose=function(){g.remove(a,c);c.dispatchEvent({type:"closed"})};g.add(a,new h(c,function(a){c.dispatchEvent({type:"message",message:a})}))}},Ignored=function(){var h=function(g){this.getUsername=function(){return g.username};this.getId=function(){return g.id};this.toJSON=
function(){return g};this.getImage=function(){return g.image}};h.fromUser=function(g){return new h({id:g.getId(),username:g.getUsername(),image:g.getImage()})};h.fromJSON=function(g){return new h(g)};return h}(),IgnoreManager=new function(){return function(h){function g(){l.set("ignores",e.getEntries().select(function(a){return a.toJSON()}).toList())}function f(a,c){b.dispatchEvent({type:"ignored",userId:a,ignored:c})}function d(a,c){b.dispatchEvent({type:"unignored",userId:a,ignored:c})}function a(a){e.add(a)&&
(g(),f(a.getId(),a),c.sendMessage({type:"ignore",ignored:a.toJSON()}))}EventEnabledBuilder(this);var c=new TabPortal({id:"IgnoreManager"}),b=this,k=h.getUserById,m=h.getUserMe,l=new Settings("ignore"),e=new Set({getEntryId:function(a){return a.getId()}});this.ignoreUser=function(b){b=Ignored.fromUser(b);a(b)};this.ignoreUserById=function(c){!b.userIdIsIgnored(c)&&(c=k(c))&&(c=Ignored.fromUser(c),a(c))};this.ignoreUserByIdAndUsername=function(b){b=Ignored.fromJSON(b);a(b)};this.unignoreUser=function(a){b.unignoreUserById(a.getId())};
this.unignoreUserById=function(a){if(a=e.removeById(a))d(a.getId(),a),c.sendMessage({type:"unignore",ignored:a.toJSON()})};this.userIsIgnored=function(a){return b.userIdIsIgnored(a.getId())};this.userIdIsIgnored=function(a){return e.containsId(a)};this.getIgnores=function(){return e.getEntries()};this.clearSave=function(){l.set("ignores",[])};this.load=function(){var a=l.get("ignores");a&&each(a,function(a){e.add(Ignored.fromJSON(a))})};c.addEventListener("message",function(a){var b=Ignored.fromJSON(a.message.ignored);
switch(a.message.type){case "ignore":b.getId()!=m().getId()&&e.add(b)&&(g(),f(b.getId(),b));break;case "unignore":e.remove(b)&&(g(),d(b.getId(),b))}})}},OnlineIndicators=function(){var h={},g=function(d){EventEnabledBuilder(this);var a=this,c=!1;this.setOnline=function(b){b?c||a.dispatchEvent({type:"cameonline"}):c&&a.dispatchEvent({type:"wentoffline"});c=b};this.setHasPm=function(b){b?a.dispatchEvent({type:"haspm"}):a.dispatchEvent({type:"doesnthavepm"})};this.getOnline=function(){return c}},f={get:function(d){var a=
h[d];if(a)return a;a=new g;return h[d]=a},setOnline:function(d,a){f.get(d).setOnline(a)},setHasPm:function(d,a){f.get(d).setHasPm(a)}};return f}();
function OnlineIndicatorUI(h,g){function f(c){a.classList.add("online");a.classList.remove("offline")}function d(c){a.classList.remove("online");a.classList.add("offline")}var a=E.DIV();a.classList.add("online-indicator");this.getElement=function(){return a};h.addEventListener("cameonline",f);h.addEventListener("wentoffline",d);h.addEventListener("haspm",function(c){a.classList.add("pm")});h.addEventListener("doesnthavepm",function(c){a.classList.remove("pm")});(h.getOnline()?f:d)();this.dispose=
function(){h.addEventListener("cameonline",f);h.addEventListener("wentoffline",d)}}
var OverflowManager=new function(){return function(h){var g=h.getMessages,f=h.remove,d=h.maxNMessages;this.trigger=(new TemporalCallback({callback:function(){var a=g().where(function(a){return!a.getIgnored()}).toList(),c=a.length-d;1>c||each(a.take(c).toList(),function(a){f(a)})},maxNDelays:50,maxTotalDelay:6E3})).trigger}},ChannelType={JSONP:"jsonp",LONGPOLL:"longpoll",WEBSOCKET:"websocket"},MysocketChannelAnalysis=new function(){return function(h){EventEnabledBuilder(this);var g=this,f=!1,d=[],
a,c,b=new StopWatch;this.getSuccessfullyOpened=function(){return f};this.getOpenForMilliseconds=b.getMilliseconds;this.getOpenForSeconds=b.getSeconds;this.getOpenedAt=function(){return a};this.getClosedAt=function(){return c};this.getChannelType=function(){return h};this.opened=function(){f=!0;a=(new Date).getTime();b.start()};this.receivedMessage=function(){};this.closed=function(){b.stop();c=(new Date).getTime();g.dispatchEvent({type:"closed",mysocketChannelAnalysis:g})};this.error=function(a){for(d.push(a);30<
d.length;)d.splice(0,1)}}},MysocketChannelManager=function(){return function(h){function g(){console.log("callbackCreateChannel");f();d.dispatchEvent({type:"newchannel",channel:m});l=!1}function f(){console.log("get id is: "+k());return m=MysocketChannelFactory.create({id:k(),urlWebsocket:b,url:c,mysocketAnalysis:a})}EventEnabledBuilder(this);var d=this,a=h.mysocketAnalysis,c=h.url,b=h.urlWebsocket,k=h.getId,m,l=!1;this.wouldLikeNewChannel=function(){if(!l){var b=a.getRecommendedDelayBeforeCreatingChannel();
console.log("Reccomended delay before creating a channel was: "+b.type);console.log(b);switch(b.type){case When.NOW:return f();case When.SECONDS:b=b.seconds,console.log(b),b*=1E3,l=!0,console.log("function createNewChannelAfterDelayMilliseconds(milliseconds){"),(new Timer({delay:b,callback:g,nTicks:1})).start()}}}}}(),MysocketAnalysis=function(){return function(h){function g(){return f().where(function(a){return 5E3>a.getOpenForMilliseconds()}).count()}function f(){return d().where(function(a){return a.getChannelType()==
ChannelType.WEBSOCKET})}function d(){var a=(new Date).getTime(),b=c.length-1,d=[];a-=6E4;for(console.log("channelAnalysiss.length is: "+c.length);0<=b;){var e=c[b];if(a<e.getClosedAt())d.push(e);else break;b--}return d}function a(b){console.log("channelAnalysisClosed");b=b.mysocketChannelAnalysis;b.removeEventListener("closed",a);for(c.push(b);20<c.length;)c.splice(0,1);b.getChannelType()}var c=[],b;this.getRecommendedTypes=function(){var a=g(),b,c=(window.WebSocket?!0:!1)&&!(b=0<a);console.log("nRecentWebsocketsFailedQuickly"+
a);console.log("shouldUseWebsocket"+c);console.log("websocket failed quickly"+b);c&&b&&(console.log("websocket failed quickly"),a=6E4<(new Date).getTime()-b.getOpenedAt(),console.log("shouldAttemptWebsocketAgain"+a),c=a);return c?[ChannelType.WEBSOCKET,ChannelType.LONGPOLL]:[ChannelType.LONGPOLL]};this.getRecommendedDelayBeforeCreatingChannel=function(){console.log(1>c.length);if(1>c.length)return{type:When.NOW};for(var a=0,b=(new Date).getTime()-6E4,d=c.length-1;0<=d;d--)if(c[d].getOpenedAt()>b)a++;
else break;return 3<a?{type:When.SECONDS,seconds:5}:2E3<(new Date).getTime()-c[c.length-1].getClosedAt()?{type:When.NOW}:{type:When.SECONDS,seconds:1}};this.add=function(c){b=c;c.addEventListener("closed",a)};this.clear=function(){b.closed();c=[];b=void 0}}}(),MysocketChannelFactory=new function(){function h(f,d){var a=this,c=new MysocketChannelAnalysis(ChannelType.WEBSOCKET),b=!1;this.send=function(a){g.send(JSON.stringify(a))};this.getAnalysis=function(){return c};this.getChannelType=function(){return ChannelType.WEBSOCKET};
this.isOpen=function(){return g&&g.readyState==g.OPEN};var g=new WebSocket(d+(f?"?mysocketId="+f:""));g.onmessage=function(d){d=JSON.parse(d.data);d.mysocketId&&(f=d.mysocketId);d.disposed?(b=!0,g.close()):(c.receivedMessage(),a.onMessage&&a.onMessage(d))};g.onopen=function(){c.opened();a.onOpen&&a.onOpen()};g.onclose=function(){c.closed();a.onClose&&a.onClose()};g.onerror=function(b){c.error(b);console.log(b);a.onError&&a.onError(b)};this.close=function(){g.close()};this.getDisposedByServer=function(){return b};
window.channel=this}function g(f,d){function a(){b||(b=!0,h.dispose(),g.closed(),c.onClose&&c.onClose())}var c=this,b=!1,g=new MysocketChannelAnalysis(ChannelType.LONGPOLL),h=new Longpoll({url:d,id:f});h.onMessage=function(a){g.receivedMessage();c.onMessage&&c.onMessage(a)};h.onError=function(b){g.error(b);console.log(b);a();c.onError&&c.onError(b)};h.onSent=function(){};h.onDispose=function(){a()};window.channel=this;this.close=a;this.send=h.send;this.getAnalysis=function(){return g};this.getChannelType=
function(){return ChannelType.LONGPOLL};this.getDisposedByServer=h.getDisposedByServer;setTimeout(function(){g.opened();c.onOpen&&c.onOpen()},0);this.isOpen=function(){return!b}}this.create=function(f){var d=f.mysocketAnalysis.getRecommendedTypes();console.log("The recommended channel types was: "+d);switch(d[0]){case Mysocket.WEBSOCKET:return new h(f.id,f.urlWebsocket);default:return new g(f.id,f.url)}}},Mysocket=function(){var h=function(g){function f(){if(l)return l;(l=r.wouldLikeNewChannel())&&
d(l)}function d(e){e.onClose=c;e.onOpen=b;e.onMessage=a;x.add(e.getAnalysis())}function a(a){"mysocket_id"==a.type?e=a.id:(console.log(a),h.dispatchEvent({type:"message",msg:a}))}function c(){var a=l.getDisposedByServer();l=null;a?h.dispatchEvent({type:"disposedbyserver"}):t||setTimeout(f,0)}function b(){if(0<p.length)for(var a=new Iterator(p);a.hasNext();){var b=a.next();try{l&&l.isOpen()&&l.send(b),a.remove()}catch(q){break}}else l&&l.isOpen()&&l.send({type:"hi"});h.dispatchEvent({type:"open"})}
var k=g.url;g=g.urlWebsocket;EventEnabledBuilder(this);var h=this,l,e,p=[],t=!1;this.reset=function(){t=!0;e=null;p=[];l&&l.dispose();l=null;x.clear()};this.send=function(a){t=!1;var b=f();b&&b.isOpen()?b.send(a):p.push(a)};this.getUrl=function(){return k};var x=new MysocketAnalysis({mysocket:this}),r=new MysocketChannelManager({mysocketAnalysis:x,urlWebsocket:g,url:k,getId:function(){return e}});r.addEventListener("newchannel",function(a){l=a.channel;d(l)});f()};h.JSONP="jsonp";h.LONGPOLL="longpoll";
h.WEBSOCKET="websocket";return h}(),SplitPane=function(){function h(a){function b(a){if(a)switch(a.getUnit()){case Dimension.PX:return a.getValue();case Dimension.PERCENT:return a.getValue()*e()/100}}EventEnabledBuilder(this);var c=this,d=a.panels,e=a.getPaneHeight,f=a.minHeight,g=!0;f?f.isDimension||(f=new Dimension(f)):f=Dimension.pixels(20);var h=a.maxHeight;h&&!h.isDimension&&(h=new Dimension(h));var r=a.height;r&&!r.isDimension&&(r=new Dimension(r));var n;this.setAssociatedSlider=function(a){n=
a};this.getAssociatedSlider=function(){return n};this.getTop=function(){return d[0].getTop()};this.setVisible=function(a){g=a;each(d,function(b){b.setVisible(a)});c.dispatchEvent({type:"setvisible",visible:a})};this.getVisible=function(){return g};this.setTop=function(a){each(d,function(b){b.setTop(a)})};this.setBottom=function(a){var b=c.getTop();c.setHeight(a-b)};this.getDesiredHeight=function(){return b(r)};this.getHeight=function(){return d[0].getHeight()};this.setHeight=function(a){each(d,function(b){b.setHeight(a)})};
this.getMinHeight=function(){return b(f)}}function g(a){function b(a){if(a)switch(a.getUnit()){case Dimension.PX:return a.getValue();case Dimension.PERCENT:return a.getValue()*d()/100}}EventEnabledBuilder(this);var c=this,d=a.getPaneWidth,e=a.minWidth,f=!0;e?e.isDimension||(e=new Dimension(e)):e=Dimension.pixels(20);var g=a.maxWidth;g&&!g.isDimension&&(g=new Dimension(g));var h=a.width;h&&!h.isDimension&&(h=new Dimension(h));var r=[],n;this.getFirstPanel=function(){return r[0]};this.setAssociatedSlider=
function(a){n=a};this.getAssociatedSlider=function(){return n};this.setVisible=function(a){f=a;each(r,function(b){b.setVisible(a)});c.dispatchEvent({type:"setvisible",visible:a})};this.getVisible=function(){return f};this.getPanel=function(a){return r[a]};this.setPanelColumnRight=function(a){};this.addNextPanel=function(a){r.push(a)};this.setLeft=function(a){each(r,function(b){b.setLeft(a)})};this.getLeft=function(){return r[0].getLeft()};this.setLeft=function(a){each(r,function(b){b.setLeft(a)})};
this.setRight=function(a){var b=c.getLeft();c.setWidth(a-b)};this.getWidth=function(){return r[0].getWidth()};this.getDesiredWidth=function(){return b(h)};this.setWidth=function(a){each(r,function(b){b.setWidth(a)})};this.getMinWidth=function(){return b(e)}}function f(a){var b=E.DIV();b.classList.add("panel");a.isLeft&&b.classList.add("panel-left");a.isRight&&b.classList.add("panel-right");a.isTop&&b.classList.add("panel-top");a.isBottom&&b.classList.add("panel-bottom");this.setVisible=function(a){b.style.display=
a?"block":"none"};this.getElement=function(){return b};this.setTop=function(a){b.style.top=String(a)+"px"};this.setLeft=function(a){b.style.left=String(a)+"px"};this.setWidth=function(a){b.style.width=String(a)+"px"};this.getWidth=function(){return b.clientWidth};this.getLeft=function(){return b.offsetLeft};this.getTop=function(){return b.offsetTop};this.setHeight=function(a){b.style.height=String(a)+"px"};this.getHeight=function(){return b.clientHeight}}function d(a){function b(){return u.offsetLeft}
var c=this,d=a.leftPanelColumn,e=a.getNextSiblingVisible,f,g,h,r,n,u=E.DIV();u.classList.add("slider");u.classList.add("x");d.setAssociatedSlider(this);this.updateVisibility=function(){if(d.getVisible()){var a=e(d);a&&a.getVisible()?c.setVisible(!0):c.setVisible(!1)}else c.setVisible(!1)};this.setVisible=function(a){u.style.display=a?"block":"none"};this.setLeft=function(a){u.style.left=String(a)+"px";d.setRight(a);var b=e(d);b&&b.setLeft(a+c.getWidth())};this.getWidth=function(){return u.getBoundingClientRect().width};
this.getConstraints=function(){n=e(d);f=d.getWidth();g=n.getWidth();h=n.getLeft();r=b();u.getBoundingClientRect();var a=b(),c=a-(d.getWidth()-d.getMinWidth());a+=n.getWidth()-n.getMinWidth();return{minX:c,maxX:a}};this.getElement=function(){return u};this.getX=b;this.getY=function(){return u.offsetTop};this.setPosition=function(a){a=a.x;var b=a-r;u.style.left=String(a)+"px";d.setWidth(f+b);n.setWidth(g-b);n.setLeft(h+b)};this.endDrag=function(){};this.getAbsolutePosition=function(){return getAbsolute(u)};
new DragManager({handle:this})}function a(a){var b=this,c=a.getNextSiblingVisible,d=a.topPanelRow,e,f,g,h,r,n=E.DIV();n.classList.add("slider");n.classList.add("y");d.setAssociatedSlider(this);this.updateVisibility=function(){if(d.getVisible()){var a=c(d);a&&a.getVisible()?b.setVisible(!0):b.setVisible(!1)}else b.setVisible(!1)};this.setVisible=function(a){n.style.display=a?"block":"none"};this.setTop=function(a){n.style.top=String(a)+"px";d.setBottom(a);var e=c(d);e&&e.setTop(a+b.getHeight())};this.getHeight=
function(){return n.getBoundingClientRect().height};this.getConstraints=function(){g=c(d);h=d.getHeight();e=g.getHeight();f=g.getTop();r=n.offsetTop;n.getBoundingClientRect();var a=n.offsetTop,b=a-(d.getHeight()-d.getMinHeight());a+=g.getHeight()-g.getMinHeight();return{minY:b,maxY:a}};this.getElement=function(){return n};this.getX=function(){return n.offsetLeft};this.getY=function(){return n.offsetTop};this.setPosition=function(a){var b=a.y-r;n.style.top=String(a.y)+"px";d.setHeight(h+b);g.setHeight(e-
b);g.setTop(f+b)};this.endDrag=function(){};this.getAbsolutePosition=function(){return getAbsolute(n)};new DragManager({handle:this})}function c(){var a=[];this.add=function(b){a.push(b)};this.count=function(){return a.length};this.get=function(b){return a[b]};this.updateVisibility=function(){each(a,function(a){a.updateVisibility()})}}return function(b){var k;function m(){B=!0;G.updateVisibility();C.updateVisibility();t(K.getBoundingClientRect().width,1>G.count()?0:G.get(0).getWidth(),function(a){return a.getDesiredWidth()});
p(x(),1>C.count()?0:C.get(0).getHeight());k=K.getBoundingClientRect().width;x()}function l(a){return K.getBoundingClientRect().width/k*a.getWidth()}function e(){var a=[];this.add=function(b){a.push(b)};this.get=function(b){return a[b]};this.getVisible=function(){var b=[];each(a,function(a){a.getVisible()&&b.push(a)});return b};this.count=function(){return a.length};this.getNextSiblingVisible=function(b){for(var c=0;c<a.length;c++)if(a[c]==b){for(b=c+1;b<a.length;b++)if(c=a[b],c.getVisible())return c;
break}}}function p(a,b){var c=a,e=A.getVisible(),d=e.length,f=0;e[0].setTop(0);for(var g=0;g<d;g++){var k=e[g],h=e.slice(g+1),l=h.length;h=h.sum(function(a){return a.getMinHeight()})+l*b;var m=k.getDesiredHeight(),n=g>=d-1;if(!m||n)m=(c-l*b)/(l+1);c-m<h&&(m=c-h);n?k.setBottom(a):k.getAssociatedSlider().setTop(f+m);f=f+m+b;c=a-f}}function t(a,b,c){var e=a,d=F.getVisible(),f=d.length,g=0;d[0].setLeft(0);for(var k=0;k<f;k++){var h=d[k],l=d.slice(k+1),m=l.length;l=l.sum(function(a){return a.getMinWidth()})+
m*b;var n=c(h),q=k>=f-1;if(!n||q)n=(e-m*b)/(m+1);e-n<l&&(n=e-l);q?h.setRight(a):h.getAssociatedSlider().setLeft(g+n);g=g+n+b;e=a-g}}function x(){return K.getBoundingClientRect().height}function r(){m()}var n=b.nPanelsWidth,u=b.nPanelsHeight,q=b.rowProfiles,w=b.columnProfiles,B=!1;EventEnabledBuilder(this);var A=new function(){return new e},F=new function(){return new e},G=new c,C=new c,K=E.DIV();K.classList.add("split-pane");this.getElement=function(){return K};this.getPanelColumns=function(){return F};
this.getPanelRows=function(){return A};this.getPanelRow=A.get;this.getPanelColumn=F.get;this.getPanelXY=function(a,b){return F.get(a).getPanel(b)};(function(){for(var a,b=0;b<n;b++){var c=w?w[b]:void 0;c=new g({panelColumnLeft:F.get(b-1),minWidth:c?c.minWidth:void 0,width:c?c.width:void 0});c.addEventListener("setvisible",r);a&&a.setPanelColumnRight(c);a=c;F.add(c)}})();(function(){for(var a,b=0;b<u;b++){for(var c=[],e=q?q[b]:void 0,d=0;d<n;d++){var g=new f({isLeft:1>d?!0:!1,isRight:d>=n-1?!0:!1,
isTop:1>b?!0:!1,isBottom:b>=u-1?!0:!1});K.appendChild(g.getElement());F.get(d).addNextPanel(g);c.push(g)}c=new h({rowAbove:a,panels:c,minHeight:e?e.minHeight:void 0,height:e?e.height:void 0,getPaneHeight:x});c.addEventListener("setvisible",r);a=c;A.add(c)}})();(function(){for(var b=0;b<n-1;b++){var c=new d({leftPanelColumn:F.get(b),getNextSiblingVisible:F.getNextSiblingVisible});G.add(c);K.appendChild(c.getElement())}for(b=0;b<u-1;b++)c=new a({topPanelRow:A.get(b),getNextSiblingVisible:A.getNextSiblingVisible}),
C.add(c),K.appendChild(c.getElement())})();this.resize=function(){if(!B)return m();G.updateVisibility();C.updateVisibility();t(K.getBoundingClientRect().width,1>G.count()?0:G.get(0).getWidth(),l);p(x(),1>C.count()?0:C.get(0).getHeight());k=K.getBoundingClientRect().width;x()};this.initialize=m}}();
(function(h){"object"===typeof exports&&"undefined"!==typeof module?module.exports=h():"function"===typeof define&&define.amd?define([],h):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).adapter=h()})(function(){return function(){function h(g,f,d){function a(b,m){if(!f[b]){if(!g[b]){var k="function"==typeof require&&require;if(!m&&k)return k(b,!0);if(c)return c(b,!0);m=Error("Cannot find module '"+b+"'");throw m.code="MODULE_NOT_FOUND",m;
}m=f[b]={exports:{}};g[b][0].call(m.exports,function(c){return a(g[b][1][c]||c)},m,m.exports,h,g,f,d)}return f[b].exports}for(var c="function"==typeof require&&require,b=0;b<d.length;b++)a(d[b]);return a}return h}()({1:[function(h,g,f){h=h("./adapter_factory.js");h=(0,h.adapterFactory)({window:window});g.exports=h},{"./adapter_factory.js":2}],2:[function(h,g,f){function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);b.default=
a;return b}Object.defineProperty(f,"__esModule",{value:!0});f.adapterFactory=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).window,d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},f=a.log,g=a.detectBrowser(e),h={browserDetails:g,commonShim:l,extractVersion:a.extractVersion,disableLog:a.disableLog,disableWarnings:a.disableWarnings};switch(g.browser){case "chrome":if(!c||!c.shimPeerConnection||!d.shimChrome){f("Chrome shim is not included in this adapter release.");
break}f("adapter.js shimming chrome.");h.browserShim=c;c.shimGetUserMedia(e);c.shimMediaStream(e);c.shimPeerConnection(e);c.shimOnTrack(e);c.shimAddTrackRemoveTrack(e);c.shimGetSendersWithDtmf(e);c.shimSenderReceiverGetStats(e);c.fixNegotiationNeeded(e);l.shimRTCIceCandidate(e);l.shimConnectionState(e);l.shimMaxMessageSize(e);l.shimSendThrowTypeError(e);l.removeAllowExtmapMixed(e);break;case "firefox":if(!k||!k.shimPeerConnection||!d.shimFirefox){f("Firefox shim is not included in this adapter release.");
break}f("adapter.js shimming firefox.");h.browserShim=k;k.shimGetUserMedia(e);k.shimPeerConnection(e);k.shimOnTrack(e);k.shimRemoveStream(e);k.shimSenderGetStats(e);k.shimReceiverGetStats(e);k.shimRTCDataChannel(e);l.shimRTCIceCandidate(e);l.shimConnectionState(e);l.shimMaxMessageSize(e);l.shimSendThrowTypeError(e);break;case "edge":if(!b||!b.shimPeerConnection||!d.shimEdge){f("MS edge shim is not included in this adapter release.");break}f("adapter.js shimming edge.");h.browserShim=b;b.shimGetUserMedia(e);
b.shimGetDisplayMedia(e);b.shimPeerConnection(e);b.shimReplaceTrack(e);l.shimMaxMessageSize(e);l.shimSendThrowTypeError(e);break;case "safari":if(!m||!d.shimSafari){f("Safari shim is not included in this adapter release.");break}f("adapter.js shimming safari.");h.browserShim=m;m.shimRTCIceServerUrls(e);m.shimCreateOfferLegacy(e);m.shimCallbacksAPI(e);m.shimLocalStreamsAPI(e);m.shimRemoteStreamsAPI(e);m.shimTrackEventTransceiver(e);m.shimGetUserMedia(e);l.shimRTCIceCandidate(e);l.shimMaxMessageSize(e);
l.shimSendThrowTypeError(e);l.removeAllowExtmapMixed(e);break;default:f("Unsupported browser!")}return h};g=h("./utils");var a=d(g);g=h("./chrome/chrome_shim");var c=d(g);g=h("./edge/edge_shim");var b=d(g);g=h("./firefox/firefox_shim");var k=d(g);g=h("./safari/safari_shim");var m=d(g);h=h("./common_shim");var l=d(h)},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(h,g,f){function d(a,b,c){b&&!c.has(b.id)&&
(c.set(b.id,b),Object.keys(b).forEach(function(e){e.endsWith("Id")?d(a,a.get(b[e]),c):e.endsWith("Ids")&&b[e].forEach(function(b){d(a,a.get(b),c)})}))}function a(a,b,c){var e=c?"outbound-rtp":"inbound-rtp",f=new Map;if(null===b)return f;var g=[];a.forEach(function(a){"track"===a.type&&a.trackIdentifier===b.id&&g.push(a)});g.forEach(function(b){a.forEach(function(c){c.type===e&&c.trackId===b.id&&d(a,c,f)})});return f}function c(a){a.RTCPeerConnection.prototype.getLocalStreams=function(){var a=this;
this._shimmedLocalStreams=this._shimmedLocalStreams||{};return Object.keys(this._shimmedLocalStreams).map(function(b){return a._shimmedLocalStreams[b][0]})};var b=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,c){if(!c)return b.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var e=b.apply(this,arguments);this._shimmedLocalStreams[c.id]?-1===this._shimmedLocalStreams[c.id].indexOf(e)&&this._shimmedLocalStreams[c.id].push(e):this._shimmedLocalStreams[c.id]=
[c,e];return e};var c=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){var b=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};a.getTracks().forEach(function(a){if(b.getSenders().find(function(b){return b.track===a}))throw new DOMException("Track already exists.","InvalidAccessError");});var e=this.getSenders();c.apply(this,arguments);var d=this.getSenders().filter(function(a){return-1===e.indexOf(a)});this._shimmedLocalStreams[a.id]=[a].concat(d)};
var e=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{};delete this._shimmedLocalStreams[a.id];return e.apply(this,arguments)};var d=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){var b=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};a&&Object.keys(this._shimmedLocalStreams).forEach(function(c){var e=b._shimmedLocalStreams[c].indexOf(a);
-1!==e&&b._shimmedLocalStreams[c].splice(e,1);1===b._shimmedLocalStreams[c].length&&delete b._shimmedLocalStreams[c]});return d.apply(this,arguments)}}Object.defineProperty(f,"__esModule",{value:!0});f.shimGetDisplayMedia=f.shimGetUserMedia=void 0;$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbolIterator();var b="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbol();return a&&
"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},k=h("./getusermedia");Object.defineProperty(f,"shimGetUserMedia",{enumerable:!0,get:function(){return k.shimGetUserMedia}});var m=h("./getdisplaymedia");Object.defineProperty(f,"shimGetDisplayMedia",{enumerable:!0,get:function(){return m.shimGetDisplayMedia}});f.shimMediaStream=function(a){a.MediaStream=a.MediaStream||a.webkitMediaStream};f.shimOnTrack=function(a){if("object"!==("undefined"===typeof a?"undefined":
b(a))||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype)l.wrapPeerConnectionEvent(a,"track",function(a){a.transceiver||Object.defineProperty(a,"transceiver",{value:{receiver:a.receiver}});return a});else{Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&this.removeEventListener("track",this._ontrack);this.addEventListener("track",this._ontrack=a)},enumerable:!0,configurable:!0});var c=a.RTCPeerConnection.prototype.setRemoteDescription;
a.RTCPeerConnection.prototype.setRemoteDescription=function(){var b=this;this._ontrackpoly||(this._ontrackpoly=function(c){c.stream.addEventListener("addtrack",function(e){var d=void 0;d=a.RTCPeerConnection.prototype.getReceivers?b.getReceivers().find(function(a){return a.track&&a.track.id===e.track.id}):{track:e.track};var f=new Event("track");f.track=e.track;f.receiver=d;f.transceiver={receiver:d};f.streams=[c.stream];b.dispatchEvent(f)});c.stream.getTracks().forEach(function(e){var d=void 0;d=
a.RTCPeerConnection.prototype.getReceivers?b.getReceivers().find(function(a){return a.track&&a.track.id===e.id}):{track:e};var f=new Event("track");f.track=e;f.receiver=d;f.transceiver={receiver:d};f.streams=[c.stream];b.dispatchEvent(f)})},this.addEventListener("addstream",this._ontrackpoly));return c.apply(this,arguments)}}};f.shimGetSendersWithDtmf=function(a){if("object"===("undefined"===typeof a?"undefined":b(a))&&a.RTCPeerConnection&&!("getSenders"in a.RTCPeerConnection.prototype)&&"createDTMFSender"in
a.RTCPeerConnection.prototype){var c=function(a,b){return{track:b,get dtmf(){void 0===this._dtmf&&(this._dtmf="audio"===b.kind?a.createDTMFSender(b):null);return this._dtmf},_pc:a}};if(!a.RTCPeerConnection.prototype.getSenders){a.RTCPeerConnection.prototype.getSenders=function(){this._senders=this._senders||[];return this._senders.slice()};var e=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,b){var d=e.apply(this,arguments);d||(d=c(this,a),this._senders.push(d));
return d};var d=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){d.apply(this,arguments);var b=this._senders.indexOf(a);-1!==b&&this._senders.splice(b,1)}}var f=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){var b=this;this._senders=this._senders||[];f.apply(this,[a]);a.getTracks().forEach(function(a){b._senders.push(c(b,a))})};var g=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=
function(a){var b=this;this._senders=this._senders||[];g.apply(this,[a]);a.getTracks().forEach(function(a){var c=b._senders.find(function(b){return b.track===a});c&&b._senders.splice(b._senders.indexOf(c),1)})}}else if("object"===("undefined"===typeof a?"undefined":b(a))&&a.RTCPeerConnection&&"getSenders"in a.RTCPeerConnection.prototype&&"createDTMFSender"in a.RTCPeerConnection.prototype&&a.RTCRtpSender&&!("dtmf"in a.RTCRtpSender.prototype)){var h=a.RTCPeerConnection.prototype.getSenders;a.RTCPeerConnection.prototype.getSenders=
function(){var a=this,b=h.apply(this,[]);b.forEach(function(b){return b._pc=a});return b};Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get:function(){void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null);return this._dtmf}})}};f.shimSenderReceiverGetStats=function(c){if("object"===("undefined"===typeof c?"undefined":b(c))&&c.RTCPeerConnection&&c.RTCRtpSender&&c.RTCRtpReceiver){if(!("getStats"in c.RTCRtpSender.prototype)){var e=c.RTCPeerConnection.prototype.getSenders;
e&&(c.RTCPeerConnection.prototype.getSenders=function(){var a=this,b=e.apply(this,[]);b.forEach(function(b){return b._pc=a});return b});var d=c.RTCPeerConnection.prototype.addTrack;d&&(c.RTCPeerConnection.prototype.addTrack=function(){var a=d.apply(this,arguments);a._pc=this;return a});c.RTCRtpSender.prototype.getStats=function(){var b=this;return this._pc.getStats().then(function(c){return a(c,b.track,!0)})}}if(!("getStats"in c.RTCRtpReceiver.prototype)){var f=c.RTCPeerConnection.prototype.getReceivers;
f&&(c.RTCPeerConnection.prototype.getReceivers=function(){var a=this,b=f.apply(this,[]);b.forEach(function(b){return b._pc=a});return b});l.wrapPeerConnectionEvent(c,"track",function(a){a.receiver._pc=a.srcElement;return a});c.RTCRtpReceiver.prototype.getStats=function(){var b=this;return this._pc.getStats().then(function(c){return a(c,b.track,!1)})}}if("getStats"in c.RTCRtpSender.prototype&&"getStats"in c.RTCRtpReceiver.prototype){var g=c.RTCPeerConnection.prototype.getStats;c.RTCPeerConnection.prototype.getStats=
function(){if(0<arguments.length&&arguments[0]instanceof c.MediaStreamTrack){var a=arguments[0],b=void 0,e=void 0,d=void 0;this.getSenders().forEach(function(c){c.track===a&&(b?d=!0:b=c)});this.getReceivers().forEach(function(b){b.track===a&&(e?d=!0:e=b);return b.track===a});return d||b&&e?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):b?b.getStats():e?e.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.",
"InvalidAccessError"))}return g.apply(this,arguments)}}}};f.shimAddTrackRemoveTrackWithNative=c;f.shimAddTrackRemoveTrack=function(a){function b(a,b){var c=b.sdp;Object.keys(a._reverseStreams||[]).forEach(function(b){b=a._reverseStreams[b];c=c.replace(new RegExp(a._streams[b.id].id,"g"),b.id)});return new RTCSessionDescription({type:b.type,sdp:c})}function e(a,b){var c=b.sdp;Object.keys(a._reverseStreams||[]).forEach(function(b){b=a._reverseStreams[b];c=c.replace(new RegExp(b.id,"g"),a._streams[b.id].id)});
return new RTCSessionDescription({type:b.type,sdp:c})}if(a.RTCPeerConnection){var d=l.detectBrowser(a);if(a.RTCPeerConnection.prototype.addTrack&&65<=d.version)return c(a);var f=a.RTCPeerConnection.prototype.getLocalStreams;a.RTCPeerConnection.prototype.getLocalStreams=function(){var a=this,b=f.apply(this);this._reverseStreams=this._reverseStreams||{};return b.map(function(b){return a._reverseStreams[b.id]})};var g=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(b){var c=
this;this._streams=this._streams||{};this._reverseStreams=this._reverseStreams||{};b.getTracks().forEach(function(a){if(c.getSenders().find(function(b){return b.track===a}))throw new DOMException("Track already exists.","InvalidAccessError");});if(!this._reverseStreams[b.id]){var e=new a.MediaStream(b.getTracks());this._streams[b.id]=e;this._reverseStreams[e.id]=b;b=e}g.apply(this,[b])};var h=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){this._streams=
this._streams||{};this._reverseStreams=this._reverseStreams||{};h.apply(this,[this._streams[a.id]||a]);delete this._reverseStreams[this._streams[a.id]?this._streams[a.id].id:a.id];delete this._streams[a.id]};a.RTCPeerConnection.prototype.addTrack=function(b,c){var e=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var d=[].slice.call(arguments,1);if(1!==d.length||!d[0].getTracks().find(function(a){return a===b}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.",
"NotSupportedError");if(this.getSenders().find(function(a){return a.track===b}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{};this._reverseStreams=this._reverseStreams||{};(d=this._streams[c.id])?(d.addTrack(b),Promise.resolve().then(function(){e.dispatchEvent(new Event("negotiationneeded"))})):(d=new a.MediaStream([b]),this._streams[c.id]=d,this._reverseStreams[d.id]=c,this.addStream(d));return this.getSenders().find(function(a){return a.track===
b})};["createOffer","createAnswer"].forEach(function(c){var e=a.RTCPeerConnection.prototype[c];a.RTCPeerConnection.prototype[c]=function(){var a=this,c=arguments;return arguments.length&&"function"===typeof arguments[0]?e.apply(this,[function(e){e=b(a,e);c[0].apply(null,[e])},function(a){c[1]&&c[1].apply(null,a)},arguments[2]]):e.apply(this,arguments).then(function(c){return b(a,c)})}});var k=a.RTCPeerConnection.prototype.setLocalDescription;a.RTCPeerConnection.prototype.setLocalDescription=function(){if(!arguments.length||
!arguments[0].type)return k.apply(this,arguments);arguments[0]=e(this,arguments[0]);return k.apply(this,arguments)};var m=Object.getOwnPropertyDescriptor(a.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(a.RTCPeerConnection.prototype,"localDescription",{get:function(){var a=m.get.apply(this);return""===a.type?a:b(this,a)}});a.RTCPeerConnection.prototype.removeTrack=function(a){var b=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.",
"InvalidStateError");if(!a._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(a._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var c=void 0;Object.keys(this._streams).forEach(function(e){b._streams[e].getTracks().find(function(b){return a.track===b})&&(c=b._streams[e])});c&&(1===c.getTracks().length?this.removeStream(this._reverseStreams[c.id]):
c.removeTrack(a.track),this.dispatchEvent(new Event("negotiationneeded")))}}};f.shimPeerConnection=function(a){!a.RTCPeerConnection&&a.webkitRTCPeerConnection&&(a.RTCPeerConnection=a.webkitRTCPeerConnection);if(a.RTCPeerConnection){var b=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(a,c,e){var d=this,f=arguments;if(0<arguments.length&&"function"===typeof a)return b.apply(this,arguments);if(0===b.length&&(0===arguments.length||"function"!==typeof arguments[0]))return b.apply(this,
[]);var g=function(a){var b={};a.result().forEach(function(a){var c={id:a.id,timestamp:a.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[a.type]||a.type};a.names().forEach(function(b){c[b]=a.stat(b)});b[c.id]=c});return b},h=function(a){return new Map(Object.keys(a).map(function(b){return[b,a[b]]}))};return 2<=arguments.length?b.apply(this,[function(a){f[1](h(g(a)))},arguments[0]]):(new Promise(function(a,c){b.apply(d,[function(b){a(h(g(b)))},c])})).then(c,e)};
["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){arguments[0]=new ("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]);return c.apply(this,arguments)}});var c=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?c.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};
f.fixNegotiationNeeded=function(a){l.wrapPeerConnectionEvent(a,"negotiationneeded",function(a){if("stable"===a.target.signalingState)return a})};var l=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);b.default=a;return b}(h("../utils.js"))},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(h,g,f){Object.defineProperty(f,"__esModule",{value:!0});f.shimGetDisplayMedia=function(d,a){d.navigator.mediaDevices&&
"getDisplayMedia"in d.navigator.mediaDevices||!d.navigator.mediaDevices||("function"!==typeof a?console.error("shimGetDisplayMedia: getSourceId argument is not a function"):d.navigator.mediaDevices.getDisplayMedia=function(c){return a(c).then(function(a){var b=c.video&&c.video.width,f=c.video&&c.video.height;c.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:c.video&&c.video.frameRate||3}};b&&(c.video.mandatory.maxWidth=b);f&&(c.video.mandatory.maxHeight=f);return d.navigator.mediaDevices.getUserMedia(c)})})}},
{}],5:[function(h,g,f){Object.defineProperty(f,"__esModule",{value:!0});$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbolIterator();var d="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbol();return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};f.shimGetUserMedia=function(b){var f=b&&b.navigator;if(f.mediaDevices){var g=a.detectBrowser(b),
h=function(a){if("object"!==("undefined"===typeof a?"undefined":d(a))||a.mandatory||a.optional)return a;var b={};Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var e="object"===d(a[c])?a[c]:{ideal:a[c]};void 0!==e.exact&&"number"===typeof e.exact&&(e.min=e.max=e.exact);var f=function(a,b){return a?a+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==e.ideal){b.optional=b.optional||[];var g={};"number"===typeof e.ideal?(g[f("min",
c)]=e.ideal,b.optional.push(g),g={},g[f("max",c)]=e.ideal):g[f("",c)]=e.ideal;b.optional.push(g)}void 0!==e.exact&&"number"!==typeof e.exact?(b.mandatory=b.mandatory||{},b.mandatory[f("",c)]=e.exact):["min","max"].forEach(function(a){void 0!==e[a]&&(b.mandatory=b.mandatory||{},b.mandatory[f(a,c)]=e[a])})}});a.advanced&&(b.optional=(b.optional||[]).concat(a.advanced));return b},e=function(a,b){if(61<=g.version)return b(a);if((a=JSON.parse(JSON.stringify(a)))&&"object"===d(a.audio)){var e=function(a,
b,c){b in a&&!(c in a)&&(a[c]=a[b],delete a[b])};a=JSON.parse(JSON.stringify(a));e(a.audio,"autoGainControl","googAutoGainControl");e(a.audio,"noiseSuppression","googNoiseSuppression");a.audio=h(a.audio)}if(a&&"object"===d(a.video)){var k=a.video.facingMode;k=k&&("object"===("undefined"===typeof k?"undefined":d(k))?k:{ideal:k});e=66>g.version;if(!(!k||"user"!==k.exact&&"environment"!==k.exact&&"user"!==k.ideal&&"environment"!==k.ideal||f.mediaDevices.getSupportedConstraints&&f.mediaDevices.getSupportedConstraints().facingMode&&
!e)){delete a.video.facingMode;var l=void 0;if("environment"===k.exact||"environment"===k.ideal)l=["back","rear"];else if("user"===k.exact||"user"===k.ideal)l=["front"];if(l)return f.mediaDevices.enumerateDevices().then(function(e){e=e.filter(function(a){return"videoinput"===a.kind});var d=e.find(function(a){return l.some(function(b){return a.label.toLowerCase().includes(b)})});!d&&e.length&&l.includes("back")&&(d=e[e.length-1]);d&&(a.video.deviceId=k.exact?{exact:d.deviceId}:{ideal:d.deviceId});
a.video=h(a.video);c("chrome: "+JSON.stringify(a));return b(a)})}a.video=h(a.video)}c("chrome: "+JSON.stringify(a));return b(a)},p=function(a){return 64<=g.version?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",
TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};f.getUserMedia=function(a,b,c){e(a,function(a){f.webkitGetUserMedia(a,b,function(a){c&&c(p(a))})})}.bind(f);var t=f.mediaDevices.getUserMedia.bind(f.mediaDevices);f.mediaDevices.getUserMedia=function(a){return e(a,function(a){return t(a).then(function(b){if(a.audio&&
!b.getAudioTracks().length||a.video&&!b.getVideoTracks().length)throw b.getTracks().forEach(function(a){a.stop()}),new DOMException("","NotFoundError");return b},function(a){return Promise.reject(p(a))})})}}};var a=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);b.default=a;return b}(h("../utils.js")),c=a.log},{"../utils.js":15}],6:[function(h,g,f){Object.defineProperty(f,"__esModule",{value:!0});$jscomp.initSymbol();
$jscomp.initSymbol();$jscomp.initSymbolIterator();var d="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbol();return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};f.shimRTCIceCandidate=function(b){if(b.RTCIceCandidate&&!(b.RTCIceCandidate&&"foundation"in b.RTCIceCandidate.prototype)){var f=b.RTCIceCandidate;b.RTCIceCandidate=function(b){"object"===
("undefined"===typeof b?"undefined":d(b))&&b.candidate&&0===b.candidate.indexOf("a=")&&(b=JSON.parse(JSON.stringify(b)),b.candidate=b.candidate.substr(2));if(b.candidate&&b.candidate.length){var c=new f(b);b=a.default.parseCandidate(b.candidate);var e=Object.assign(c,b);e.toJSON=function(){return{candidate:e.candidate,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex,usernameFragment:e.usernameFragment}};return e}return new f(b)};b.RTCIceCandidate.prototype=f.prototype;c.wrapPeerConnectionEvent(b,"icecandidate",
function(a){a.candidate&&Object.defineProperty(a,"candidate",{value:new b.RTCIceCandidate(a.candidate),writable:"false"});return a})}};f.shimMaxMessageSize=function(b){if(!b.RTCSctpTransport&&b.RTCPeerConnection){var d=c.detectBrowser(b);"sctp"in b.RTCPeerConnection.prototype||Object.defineProperty(b.RTCPeerConnection.prototype,"sctp",{get:function(){return"undefined"===typeof this._sctp?null:this._sctp}});var f=function(b){b=a.default.splitSections(b.sdp);b.shift();return b.some(function(b){return(b=
a.default.parseMLine(b))&&"application"===b.kind&&-1!==b.protocol.indexOf("SCTP")})},g=function(a){a=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===a||2>a.length)return-1;a=parseInt(a[1],10);return a!==a?-1:a},e=function(a){var b=65536;"firefox"===d.browser&&(b=57>d.version?-1===a?16384:2147483637:60>d.version?57===d.version?65535:65536:2147483637);return b},h=function(b,c){var e=65536;"firefox"===d.browser&&57===d.version&&(e=65535);b=a.default.matchPrefix(b.sdp,"a=max-message-size:");
0<b.length?e=parseInt(b[0].substr(19),10):"firefox"===d.browser&&-1!==c&&(e=2147483637);return e},t=b.RTCPeerConnection.prototype.setRemoteDescription;b.RTCPeerConnection.prototype.setRemoteDescription=function(){this._sctp=null;if(f(arguments[0])){var a=g(arguments[0]),b=e(a);a=h(arguments[0],a);var c=void 0;c=0===b&&0===a?Number.POSITIVE_INFINITY:0===b||0===a?Math.max(b,a):Math.min(b,a);b={};Object.defineProperty(b,"maxMessageSize",{get:function(){return c}});this._sctp=b}return t.apply(this,arguments)}}};
f.shimSendThrowTypeError=function(a){function b(a,b){var c=a.send;a.send=function(){var e=arguments[0];e=e.length||e.size||e.byteLength;if("open"===a.readyState&&b.sctp&&e>b.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+b.sctp.maxMessageSize+" bytes)");return c.apply(a,arguments)}}if(a.RTCPeerConnection&&"createDataChannel"in a.RTCPeerConnection.prototype){var d=a.RTCPeerConnection.prototype.createDataChannel;a.RTCPeerConnection.prototype.createDataChannel=function(){var a=
d.apply(this,arguments);b(a,this);return a};c.wrapPeerConnectionEvent(a,"datachannel",function(a){b(a.channel,a.target);return a})}};f.shimConnectionState=function(a){if(a.RTCPeerConnection&&!("connectionState"in a.RTCPeerConnection.prototype)){var b=a.RTCPeerConnection.prototype;Object.defineProperty(b,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0});Object.defineProperty(b,"onconnectionstatechange",
{get:function(){return this._onconnectionstatechange||null},set:function(a){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange);a&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=a)},enumerable:!0,configurable:!0});["setLocalDescription","setRemoteDescription"].forEach(function(a){var c=b[a];b[a]=function(){this._connectionstatechangepoly||(this._connectionstatechangepoly=
function(a){var b=a.target;if(b._lastConnectionState!==b.connectionState){b._lastConnectionState=b.connectionState;var c=new Event("connectionstatechange",a);b.dispatchEvent(c)}return a},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly));return c.apply(this,arguments)}})}};f.removeAllowExtmapMixed=function(a){if(a.RTCPeerConnection){var b=c.detectBrowser(a);if(!("chrome"===b.browser&&71<=b.version)){var d=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=
function(a){a&&a.sdp&&-1!==a.sdp.indexOf("\na=extmap-allow-mixed")&&(a.sdp=a.sdp.split("\n").filter(function(a){return"a=extmap-allow-mixed"!==a.trim()}).join("\n"));return d.apply(this,arguments)}}}};var a=(g=h("sdp"))&&g.__esModule?g:{default:g},c=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);b.default=a;return b}(h("./utils"))},{"./utils":15,sdp:17}],7:[function(h,g,f){Object.defineProperty(f,"__esModule",{value:!0});
f.shimGetDisplayMedia=f.shimGetUserMedia=void 0;var d=h("./getusermedia");Object.defineProperty(f,"shimGetUserMedia",{enumerable:!0,get:function(){return d.shimGetUserMedia}});var a=h("./getdisplaymedia");Object.defineProperty(f,"shimGetDisplayMedia",{enumerable:!0,get:function(){return a.shimGetDisplayMedia}});f.shimPeerConnection=function(a){var d=c.detectBrowser(a);if(a.RTCIceGatherer&&(a.RTCIceCandidate||(a.RTCIceCandidate=function(a){return a}),a.RTCSessionDescription||(a.RTCSessionDescription=
function(a){return a}),15025>d.version)){var e=Object.getOwnPropertyDescriptor(a.MediaStreamTrack.prototype,"enabled");Object.defineProperty(a.MediaStreamTrack.prototype,"enabled",{set:function(a){e.set.call(this,a);var b=new Event("enabled");b.enabled=a;this.dispatchEvent(b)}})}!a.RTCRtpSender||"dtmf"in a.RTCRtpSender.prototype||Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get:function(){void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new a.RTCDtmfSender(this):"video"===this.track.kind&&
(this._dtmf=null));return this._dtmf}});a.RTCDtmfSender&&!a.RTCDTMFSender&&(a.RTCDTMFSender=a.RTCDtmfSender);var f=(0,k.default)(a,d.version);a.RTCPeerConnection=function(a){a&&a.iceServers&&(a.iceServers=(0,b.filterIceServers)(a.iceServers,d.version),c.log("ICE servers after filtering:",a.iceServers));return new f(a)};a.RTCPeerConnection.prototype=f.prototype};f.shimReplaceTrack=function(a){!a.RTCRtpSender||"replaceTrack"in a.RTCRtpSender.prototype||(a.RTCRtpSender.prototype.replaceTrack=a.RTCRtpSender.prototype.setTrack)};
var c=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);b.default=a;return b}(h("../utils")),b=h("./filtericeservers"),k=(h=h("rtcpeerconnection-shim"))&&h.__esModule?h:{default:h}},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(h,g,f){Object.defineProperty(f,"__esModule",{value:!0});f.filterIceServers=function(a,c){var b=!1;a=JSON.parse(JSON.stringify(a));
return a.filter(function(a){if(a&&(a.urls||a.url)){var c=a.urls||a.url;a.url&&!a.urls&&d.deprecated("RTCIceServer.url","RTCIceServer.urls");var f="string"===typeof c;f&&(c=[c]);c=c.filter(function(a){return 0===a.indexOf("stun:")?!1:(a=a.startsWith("turn")&&!a.startsWith("turn:[")&&a.includes("transport=udp"))&&!b?b=!0:a&&!b});delete a.url;a.urls=f?c[0]:c;return!!c.length}})};var d=function(a){if(a&&a.__esModule)return a;var c={};if(null!=a)for(var b in a)Object.prototype.hasOwnProperty.call(a,b)&&
(c[b]=a[b]);c.default=a;return c}(h("../utils"))},{"../utils":15}],9:[function(h,g,f){Object.defineProperty(f,"__esModule",{value:!0});f.shimGetDisplayMedia=function(d){"getDisplayMedia"in d.navigator&&d.navigator.mediaDevices&&!(d.navigator.mediaDevices&&"getDisplayMedia"in d.navigator.mediaDevices)&&(d.navigator.mediaDevices.getDisplayMedia=d.navigator.getDisplayMedia.bind(d.navigator))}},{}],10:[function(h,g,f){Object.defineProperty(f,"__esModule",{value:!0});f.shimGetUserMedia=function(d){d=d&&
d.navigator;var a=function(a){return{name:{PermissionDeniedError:"NotAllowedError"}[a.name]||a.name,message:a.message,constraint:a.constraint,toString:function(){return this.name}}},c=d.mediaDevices.getUserMedia.bind(d.mediaDevices);d.mediaDevices.getUserMedia=function(b){return c(b).catch(function(b){return Promise.reject(a(b))})}}},{}],11:[function(h,g,f){Object.defineProperty(f,"__esModule",{value:!0});f.shimGetDisplayMedia=f.shimGetUserMedia=void 0;$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbolIterator();
var d="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbol();return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},a=h("./getusermedia");Object.defineProperty(f,"shimGetUserMedia",{enumerable:!0,get:function(){return a.shimGetUserMedia}});var c=h("./getdisplaymedia");Object.defineProperty(f,"shimGetDisplayMedia",{enumerable:!0,get:function(){return c.shimGetDisplayMedia}});
f.shimOnTrack=function(a){"object"===("undefined"===typeof a?"undefined":d(a))&&a.RTCTrackEvent&&"receiver"in a.RTCTrackEvent.prototype&&!("transceiver"in a.RTCTrackEvent.prototype)&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})};f.shimPeerConnection=function(a){var c=b.detectBrowser(a);if("object"===("undefined"===typeof a?"undefined":d(a))&&(a.RTCPeerConnection||a.mozRTCPeerConnection)){!a.RTCPeerConnection&&a.mozRTCPeerConnection&&
(a.RTCPeerConnection=a.mozRTCPeerConnection);["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){arguments[0]=new ("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]);return c.apply(this,arguments)}});var f=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?f.apply(this,arguments):(arguments[1]&&
arguments[1].apply(null),Promise.resolve())};var e={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},g=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(a,b,d){return g.apply(this,[a||null]).then(function(a){if(53>c.version&&!b)try{a.forEach(function(a){a.type=e[a.type]||a.type})}catch(u){if("TypeError"!==u.name)throw u;a.forEach(function(b,c){a.set(c,Object.assign({},
b,{type:e[b.type]||b.type}))})}return a}).then(b,d)}}};f.shimSenderGetStats=function(a){if("object"===("undefined"===typeof a?"undefined":d(a))&&a.RTCPeerConnection&&a.RTCRtpSender&&!(a.RTCRtpSender&&"getStats"in a.RTCRtpSender.prototype)){var b=a.RTCPeerConnection.prototype.getSenders;b&&(a.RTCPeerConnection.prototype.getSenders=function(){var a=this,c=b.apply(this,[]);c.forEach(function(b){return b._pc=a});return c});var c=a.RTCPeerConnection.prototype.addTrack;c&&(a.RTCPeerConnection.prototype.addTrack=
function(){var a=c.apply(this,arguments);a._pc=this;return a});a.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}};f.shimReceiverGetStats=function(a){if("object"===("undefined"===typeof a?"undefined":d(a))&&a.RTCPeerConnection&&a.RTCRtpSender&&!(a.RTCRtpSender&&"getStats"in a.RTCRtpReceiver.prototype)){var c=a.RTCPeerConnection.prototype.getReceivers;c&&(a.RTCPeerConnection.prototype.getReceivers=function(){var a=this,b=c.apply(this,
[]);b.forEach(function(b){return b._pc=a});return b});b.wrapPeerConnectionEvent(a,"track",function(a){a.receiver._pc=a.srcElement;return a});a.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}};f.shimRemoveStream=function(a){!a.RTCPeerConnection||"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(a){var c=this;b.deprecated("removeStream","removeTrack");this.getSenders().forEach(function(b){b.track&&a.getTracks().includes(b.track)&&
c.removeTrack(b)})})};f.shimRTCDataChannel=function(a){a.DataChannel&&!a.RTCDataChannel&&(a.RTCDataChannel=a.DataChannel)};var b=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);b.default=a;return b}(h("../utils"))},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(h,g,f){Object.defineProperty(f,"__esModule",{value:!0});f.shimGetDisplayMedia=function(d,a){d.navigator.mediaDevices&&"getDisplayMedia"in
d.navigator.mediaDevices||!d.navigator.mediaDevices||(d.navigator.mediaDevices.getDisplayMedia=function(c){if(!c||!c.video)return c=new DOMException("getDisplayMedia without video constraints is undefined"),c.name="NotFoundError",c.code=8,Promise.reject(c);!0===c.video?c.video={mediaSource:a}:c.video.mediaSource=a;return d.navigator.mediaDevices.getUserMedia(c)})}},{}],13:[function(h,g,f){Object.defineProperty(f,"__esModule",{value:!0});$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbolIterator();
var d="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbol();return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};f.shimGetUserMedia=function(c){var b=a.detectBrowser(c),f=c&&c.navigator;c=c&&c.MediaStreamTrack;f.getUserMedia=function(b,c,e){a.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia");f.mediaDevices.getUserMedia(b).then(c,
e)};if(!(55<b.version&&"autoGainControl"in f.mediaDevices.getSupportedConstraints())){var g=function(a,b,c){b in a&&!(c in a)&&(a[c]=a[b],delete a[b])},h=f.mediaDevices.getUserMedia.bind(f.mediaDevices);f.mediaDevices.getUserMedia=function(a){"object"===("undefined"===typeof a?"undefined":d(a))&&"object"===d(a.audio)&&(a=JSON.parse(JSON.stringify(a)),g(a.audio,"autoGainControl","mozAutoGainControl"),g(a.audio,"noiseSuppression","mozNoiseSuppression"));return h(a)};if(c&&c.prototype.getSettings){var e=
c.prototype.getSettings;c.prototype.getSettings=function(){var a=e.apply(this,arguments);g(a,"mozAutoGainControl","autoGainControl");g(a,"mozNoiseSuppression","noiseSuppression");return a}}if(c&&c.prototype.applyConstraints){var p=c.prototype.applyConstraints;c.prototype.applyConstraints=function(a){"audio"===this.kind&&"object"===("undefined"===typeof a?"undefined":d(a))&&(a=JSON.parse(JSON.stringify(a)),g(a,"autoGainControl","mozAutoGainControl"),g(a,"noiseSuppression","mozNoiseSuppression"));return p.apply(this,
[a])}}}};var a=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);b.default=a;return b}(h("../utils"))},{"../utils":15}],14:[function(h,g,f){function d(a){return a&&void 0!==a.video?Object.assign({},a,{video:c.compactObject(a.video)}):a}Object.defineProperty(f,"__esModule",{value:!0});$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbolIterator();var a="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?
function(a){return typeof a}:function(a){$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbol();return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};f.shimLocalStreamsAPI=function(b){if("object"===("undefined"===typeof b?"undefined":a(b))&&b.RTCPeerConnection){"getLocalStreams"in b.RTCPeerConnection.prototype||(b.RTCPeerConnection.prototype.getLocalStreams=function(){this._localStreams||(this._localStreams=[]);return this._localStreams});if(!("addStream"in
b.RTCPeerConnection.prototype)){var c=b.RTCPeerConnection.prototype.addTrack;b.RTCPeerConnection.prototype.addStream=function(a){var b=this;this._localStreams||(this._localStreams=[]);this._localStreams.includes(a)||this._localStreams.push(a);a.getTracks().forEach(function(e){return c.call(b,e,a)})};b.RTCPeerConnection.prototype.addTrack=function(a,b){b&&(this._localStreams?this._localStreams.includes(b)||this._localStreams.push(b):this._localStreams=[b]);return c.call(this,a,b)}}"removeStream"in
b.RTCPeerConnection.prototype||(b.RTCPeerConnection.prototype.removeStream=function(a){var b=this;this._localStreams||(this._localStreams=[]);var c=this._localStreams.indexOf(a);if(-1!==c){this._localStreams.splice(c,1);var d=a.getTracks();this.getSenders().forEach(function(a){d.includes(a.track)&&b.removeTrack(a)})}})}};f.shimRemoteStreamsAPI=function(b){if("object"===("undefined"===typeof b?"undefined":a(b))&&b.RTCPeerConnection&&("getRemoteStreams"in b.RTCPeerConnection.prototype||(b.RTCPeerConnection.prototype.getRemoteStreams=
function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in b.RTCPeerConnection.prototype))){Object.defineProperty(b.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(a){var b=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly));this.addEventListener("addstream",this._onaddstream=a);this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(function(a){b._remoteStreams||
(b._remoteStreams=[]);if(!b._remoteStreams.includes(a)){b._remoteStreams.push(a);var c=new Event("addstream");c.stream=a;b.dispatchEvent(c)}})})}});var c=b.RTCPeerConnection.prototype.setRemoteDescription;b.RTCPeerConnection.prototype.setRemoteDescription=function(){var a=this;this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(b){b.streams.forEach(function(b){a._remoteStreams||(a._remoteStreams=[]);if(!(0<=a._remoteStreams.indexOf(b))){a._remoteStreams.push(b);var c=
new Event("addstream");c.stream=b;a.dispatchEvent(c)}})});return c.apply(a,arguments)}}};f.shimCallbacksAPI=function(b){if("object"===("undefined"===typeof b?"undefined":a(b))&&b.RTCPeerConnection){b=b.RTCPeerConnection.prototype;var c=b.createOffer,d=b.createAnswer,f=b.setLocalDescription,e=b.setRemoteDescription,g=b.addIceCandidate;b.createOffer=function(a,b){var e=c.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);if(!b)return e;e.then(a,b);return Promise.resolve()};b.createAnswer=function(a,
b){var c=d.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);if(!b)return c;c.then(a,b);return Promise.resolve()};var h=function(a,b,c){a=f.apply(this,[a]);if(!c)return a;a.then(b,c);return Promise.resolve()};b.setLocalDescription=h;h=function(a,b,c){a=e.apply(this,[a]);if(!c)return a;a.then(b,c);return Promise.resolve()};b.setRemoteDescription=h;h=function(a,b,c){a=g.apply(this,[a]);if(!c)return a;a.then(b,c);return Promise.resolve()};b.addIceCandidate=h}};f.shimGetUserMedia=function(a){var b=
a&&a.navigator;if(b.mediaDevices&&b.mediaDevices.getUserMedia){a=b.mediaDevices;var c=a.getUserMedia.bind(a);b.mediaDevices.getUserMedia=function(a){return c(d(a))}}!b.getUserMedia&&b.mediaDevices&&b.mediaDevices.getUserMedia&&(b.getUserMedia=function(a,c,d){b.mediaDevices.getUserMedia(a).then(c,d)}.bind(b))};f.shimConstraints=d;f.shimRTCIceServerUrls=function(a){var b=a.RTCPeerConnection;a.RTCPeerConnection=function(a,d){if(a&&a.iceServers){for(var e=[],f=0;f<a.iceServers.length;f++){var g=a.iceServers[f];
!g.hasOwnProperty("urls")&&g.hasOwnProperty("url")?(c.deprecated("RTCIceServer.url","RTCIceServer.urls"),g=JSON.parse(JSON.stringify(g)),g.urls=g.url,delete g.url,e.push(g)):e.push(a.iceServers[f])}a.iceServers=e}return new b(a,d)};a.RTCPeerConnection.prototype=b.prototype;"generateCertificate"in a.RTCPeerConnection&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return b.generateCertificate}})};f.shimTrackEventTransceiver=function(b){"object"===("undefined"===typeof b?
"undefined":a(b))&&b.RTCPeerConnection&&"receiver"in b.RTCTrackEvent.prototype&&!b.RTCTransceiver&&Object.defineProperty(b.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})};f.shimCreateOfferLegacy=function(a){var b=a.RTCPeerConnection.prototype.createOffer;a.RTCPeerConnection.prototype.createOffer=function(a){if(a){"undefined"!==typeof a.offerToReceiveAudio&&(a.offerToReceiveAudio=!!a.offerToReceiveAudio);var c=this.getTransceivers().find(function(a){return a.sender.track&&
"audio"===a.sender.track.kind});!1===a.offerToReceiveAudio&&c?"sendrecv"===c.direction?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":"recvonly"===c.direction&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):!0!==a.offerToReceiveAudio||c||this.addTransceiver("audio");"undefined"!==typeof a.offerToReceiveVideo&&(a.offerToReceiveVideo=!!a.offerToReceiveVideo);c=this.getTransceivers().find(function(a){return a.sender.track&&"video"===a.sender.track.kind});!1===a.offerToReceiveVideo&&
c?"sendrecv"===c.direction?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":"recvonly"===c.direction&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):!0!==a.offerToReceiveVideo||c||this.addTransceiver("video")}return b.apply(this,arguments)}};var c=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);b.default=a;return b}(h("../utils"))},{"../utils":15}],15:[function(h,g,f){function d(a,
b,c){b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c;return a}function a(a,b,c){return(a=a.match(b))&&a.length>=c&&parseInt(a[c],10)}function c(a){return"object"!==("undefined"===typeof a?"undefined":b(a))?a:Object.keys(a).reduce(function(e,f){var g="object"===b(a[f]),h=g?c(a[f]):a[f];g=g&&!Object.keys(h).length;return void 0===h||g?e:Object.assign(e,d({},f,h))},{})}Object.defineProperty(f,"__esModule",{value:!0});$jscomp.initSymbol();$jscomp.initSymbol();
$jscomp.initSymbolIterator();var b="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbol();return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};f.extractVersion=a;f.wrapPeerConnectionEvent=function(a,b,c){if(a.RTCPeerConnection){a=a.RTCPeerConnection.prototype;var e=a.addEventListener;a.addEventListener=function(a,d){if(a!==b)return e.apply(this,
arguments);var f=function(a){(a=c(a))&&d(a)};this._eventMap=this._eventMap||{};this._eventMap[d]=f;return e.apply(this,[a,f])};var d=a.removeEventListener;a.removeEventListener=function(a,c){if(a!==b||!this._eventMap||!this._eventMap[c])return d.apply(this,arguments);var e=this._eventMap[c];delete this._eventMap[c];return d.apply(this,[a,e])};Object.defineProperty(a,"on"+b,{get:function(){return this["_on"+b]},set:function(a){this["_on"+b]&&(this.removeEventListener(b,this["_on"+b]),delete this["_on"+
b]);a&&this.addEventListener(b,this["_on"+b]=a)},enumerable:!0,configurable:!0})}};f.disableLog=function(a){return"boolean"!==typeof a?Error("Argument type: "+("undefined"===typeof a?"undefined":b(a))+". Please use a boolean."):(k=a)?"adapter.js logging disabled":"adapter.js logging enabled"};f.disableWarnings=function(a){if("boolean"!==typeof a)return Error("Argument type: "+("undefined"===typeof a?"undefined":b(a))+". Please use a boolean.");m=!a;return"adapter.js deprecation warnings "+(a?"disabled":
"enabled")};f.log=function(){"object"!==("undefined"===typeof window?"undefined":b(window))||k||"undefined"!==typeof console&&"function"===typeof console.log&&console.log.apply(console,arguments)};f.deprecated=function(a,b){m&&console.warn(a+" is deprecated, please use "+b+" instead.")};f.detectBrowser=function(b){var c=b.navigator,d={browser:null,version:null};if("undefined"===typeof b||!b.navigator)return d.browser="Not a browser.",d;c.mozGetUserMedia?(d.browser="firefox",d.version=a(c.userAgent,
/Firefox\/(\d+)\./,1)):c.webkitGetUserMedia?(d.browser="chrome",d.version=a(c.userAgent,/Chrom(e|ium)\/(\d+)\./,2)):c.mediaDevices&&c.userAgent.match(/Edge\/(\d+).(\d+)$/)?(d.browser="edge",d.version=a(c.userAgent,/Edge\/(\d+).(\d+)$/,2)):b.RTCPeerConnection&&c.userAgent.match(/AppleWebKit\/(\d+)\./)?(d.browser="safari",d.version=a(c.userAgent,/AppleWebKit\/(\d+)\./,1)):d.browser="Not a supported browser.";return d};f.compactObject=c;var k=!0,m=!0},{}],16:[function(h,g,f){function d(a,b,c,d,f){b=
l.writeRtpDescription(a.kind,b);b+=l.writeIceParameters(a.iceGatherer.getLocalParameters());b+=l.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===c?"actpass":f||"active");b+="a=mid:"+a.mid+"\r\n";b=a.rtpSender&&a.rtpReceiver?b+"a=sendrecv\r\n":a.rtpSender?b+"a=sendonly\r\n":a.rtpReceiver?b+"a=recvonly\r\n":b+"a=inactive\r\n";a.rtpSender&&(c=a.rtpSender._initialTrackId||a.rtpSender.track.id,a.rtpSender._initialTrackId=c,d="msid:"+(d?d.id:"-")+" "+c+"\r\n",b=b+("a="+d)+("a=ssrc:"+
a.sendEncodingParameters[0].ssrc+" "+d),a.sendEncodingParameters[0].rtx&&(b+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+d,b+="a=ssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+"\r\n"));b+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+l.localCName+"\r\n";a.rtpSender&&a.sendEncodingParameters[0].rtx&&(b+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" cname:"+l.localCName+"\r\n");return b}function a(a,b){var c=!1;a=JSON.parse(JSON.stringify(a));
return a.filter(function(a){if(a&&(a.urls||a.url)){var d=a.urls||a.url;a.url&&!a.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var e="string"===typeof d;e&&(d=[d]);d=d.filter(function(a){return 0!==a.indexOf("turn:")||-1===a.indexOf("transport=udp")||-1!==a.indexOf("turn:[")||c?0===a.indexOf("stun:")&&14393<=b&&-1===a.indexOf("?transport=udp"):c=!0});delete a.url;a.urls=e?d[0]:d;return!!d.length}})}function c(a,b){var c={codecs:[],headerExtensions:[],fecMechanisms:[]},d=
function(a,b){a=parseInt(a,10);for(var c=0;c<b.length;c++)if(b[c].payloadType===a||b[c].preferredPayloadType===a)return b[c]},e=function(a,b,c,e){a=d(a.parameters.apt,c);b=d(b.parameters.apt,e);return a&&b&&a.name.toLowerCase()===b.name.toLowerCase()};a.codecs.forEach(function(d){for(var f=0;f<b.codecs.length;f++){var g=b.codecs[f];if(d.name.toLowerCase()===g.name.toLowerCase()&&d.clockRate===g.clockRate&&("rtx"!==d.name.toLowerCase()||!d.parameters||!g.parameters.apt||e(d,g,a.codecs,b.codecs))){g=
JSON.parse(JSON.stringify(g));g.numChannels=Math.min(d.numChannels,g.numChannels);c.codecs.push(g);g.rtcpFeedback=g.rtcpFeedback.filter(function(a){for(var b=0;b<d.rtcpFeedback.length;b++)if(d.rtcpFeedback[b].type===a.type&&d.rtcpFeedback[b].parameter===a.parameter)return!0;return!1});break}}});a.headerExtensions.forEach(function(a){for(var d=0;d<b.headerExtensions.length;d++){var e=b.headerExtensions[d];if(a.uri===e.uri){c.headerExtensions.push(e);break}}});return c}function b(a,b,c){return-1!==
{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[b][a].indexOf(c)}function k(a,b){var c=a.getRemoteCandidates().find(function(a){return b.foundation===a.foundation&&b.ip===a.ip&&b.port===a.port&&b.priority===a.priority&&b.protocol===a.protocol&&b.type===a.type});c||a.addRemoteCandidate(b);return!c}function m(a,
b){b=Error(b);b.name=a;b.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[a];return b}var l=h("sdp");g.exports=function(e,f){function g(a,b){b.addTrack(a);b.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:a}))}function h(a,b){b.removeTrack(a);b.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:a}))}function p(a,b,c,d){var f=new Event("track");f.track=b;f.receiver=c;f.transceiver={receiver:c};f.streams=d;e.setTimeout(function(){a._dispatchEvent("track",
f)})}var n=function(b){var c=this,d=document.createDocumentFragment();["addEventListener","removeEventListener","dispatchEvent"].forEach(function(a){c[a]=d[a].bind(d)});this.canTrickleIceCandidates=null;this.needNegotiation=!1;this.localStreams=[];this.remoteStreams=[];this._remoteDescription=this._localDescription=null;this.signalingState="stable";this.iceGatheringState=this.connectionState=this.iceConnectionState="new";b=JSON.parse(JSON.stringify(b||{}));this.usingBundle="max-bundle"===b.bundlePolicy;
if("negotiate"===b.rtcpMuxPolicy)throw m("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");b.rtcpMuxPolicy||(b.rtcpMuxPolicy="require");switch(b.iceTransportPolicy){case "all":case "relay":break;default:b.iceTransportPolicy="all"}switch(b.bundlePolicy){case "balanced":case "max-compat":case "max-bundle":break;default:b.bundlePolicy="balanced"}b.iceServers=a(b.iceServers||[],f);this._iceGatherers=[];if(b.iceCandidatePoolSize)for(var g=b.iceCandidatePoolSize;0<g;g--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:b.iceServers,
gatherPolicy:b.iceTransportPolicy}));else b.iceCandidatePoolSize=0;this._config=b;this.transceivers=[];this._sdpSessionId=l.generateSessionId();this._sdpSessionVersion=0;this._dtlsRole=void 0;this._isClosed=!1};Object.defineProperty(n.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}});Object.defineProperty(n.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}});n.prototype.onicecandidate=null;n.prototype.onaddstream=
null;n.prototype.ontrack=null;n.prototype.onremovestream=null;n.prototype.onsignalingstatechange=null;n.prototype.oniceconnectionstatechange=null;n.prototype.onconnectionstatechange=null;n.prototype.onicegatheringstatechange=null;n.prototype.onnegotiationneeded=null;n.prototype.ondatachannel=null;n.prototype._dispatchEvent=function(a,b){if(!this._isClosed&&(this.dispatchEvent(b),"function"===typeof this["on"+a]))this["on"+a](b)};n.prototype._emitGatheringStateChange=function(){var a=new Event("icegatheringstatechange");
this._dispatchEvent("icegatheringstatechange",a)};n.prototype.getConfiguration=function(){return this._config};n.prototype.getLocalStreams=function(){return this.localStreams};n.prototype.getRemoteStreams=function(){return this.remoteStreams};n.prototype._createTransceiver=function(a,b){var c=0<this.transceivers.length;a={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:a,mid:null,sendEncodingParameters:null,
recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};this.usingBundle&&c?(a.iceTransport=this.transceivers[0].iceTransport,a.dtlsTransport=this.transceivers[0].dtlsTransport):(c=this._createIceAndDtlsTransports(),a.iceTransport=c.iceTransport,a.dtlsTransport=c.dtlsTransport);b||this.transceivers.push(a);return a};n.prototype.addTrack=function(a,b){if(this._isClosed)throw m("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");if(this.transceivers.find(function(b){return b.track===
a}))throw m("InvalidAccessError","Track already exists.");for(var c,d=0;d<this.transceivers.length;d++)this.transceivers[d].track||this.transceivers[d].kind!==a.kind||(c=this.transceivers[d]);c||(c=this._createTransceiver(a.kind));this._maybeFireNegotiationNeeded();-1===this.localStreams.indexOf(b)&&this.localStreams.push(b);c.track=a;c.stream=b;c.rtpSender=new e.RTCRtpSender(a,c.dtlsTransport);return c.rtpSender};n.prototype.addStream=function(a){var b=this;if(15025<=f)a.getTracks().forEach(function(c){b.addTrack(c,
a)});else{var c=a.clone();a.getTracks().forEach(function(a,b){var d=c.getTracks()[b];a.addEventListener("enabled",function(a){d.enabled=a.enabled})});c.getTracks().forEach(function(a){b.addTrack(a,c)})}};n.prototype.removeTrack=function(a){if(this._isClosed)throw m("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(a instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var b=this.transceivers.find(function(b){return b.rtpSender===
a});if(!b)throw m("InvalidAccessError","Sender was not created by this connection.");var c=b.stream;b.rtpSender.stop();b.rtpSender=null;b.track=null;b.stream=null;-1===this.transceivers.map(function(a){return a.stream}).indexOf(c)&&-1<this.localStreams.indexOf(c)&&this.localStreams.splice(this.localStreams.indexOf(c),1);this._maybeFireNegotiationNeeded()};n.prototype.removeStream=function(a){var b=this;a.getTracks().forEach(function(a){var c=b.getSenders().find(function(b){return b.track===a});c&&
b.removeTrack(c)})};n.prototype.getSenders=function(){return this.transceivers.filter(function(a){return!!a.rtpSender}).map(function(a){return a.rtpSender})};n.prototype.getReceivers=function(){return this.transceivers.filter(function(a){return!!a.rtpReceiver}).map(function(a){return a.rtpReceiver})};n.prototype._createIceGatherer=function(a,b){var c=this;if(b&&0<a)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var d=new e.RTCIceGatherer({iceServers:this._config.iceServers,
gatherPolicy:this._config.iceTransportPolicy});Object.defineProperty(d,"state",{value:"new",writable:!0});this.transceivers[a].bufferedCandidateEvents=[];this.transceivers[a].bufferCandidates=function(b){var e=!b.candidate||0===Object.keys(b.candidate).length;d.state=e?"completed":"gathering";null!==c.transceivers[a].bufferedCandidateEvents&&c.transceivers[a].bufferedCandidateEvents.push(b)};d.addEventListener("localcandidate",this.transceivers[a].bufferCandidates);return d};n.prototype._gather=function(a,
b){var c=this,d=this.transceivers[b].iceGatherer;if(!d.onlocalcandidate){var f=this.transceivers[b].bufferedCandidateEvents;this.transceivers[b].bufferedCandidateEvents=null;d.removeEventListener("localcandidate",this.transceivers[b].bufferCandidates);d.onlocalcandidate=function(e){if(!(c.usingBundle&&0<b)){var f=new Event("icecandidate");f.candidate={sdpMid:a,sdpMLineIndex:b};var g=e.candidate;if(e=!g||0===Object.keys(g).length){if("new"===d.state||"gathering"===d.state)d.state="completed"}else"new"===
d.state&&(d.state="gathering"),g.component=1,g.ufrag=d.getLocalParameters().usernameFragment,g=l.writeCandidate(g),f.candidate=Object.assign(f.candidate,l.parseCandidate(g)),f.candidate.candidate=g,f.candidate.toJSON=function(){return{candidate:f.candidate.candidate,sdpMid:f.candidate.sdpMid,sdpMLineIndex:f.candidate.sdpMLineIndex,usernameFragment:f.candidate.usernameFragment}};g=l.getMediaSections(c._localDescription.sdp);g[f.candidate.sdpMLineIndex]=e?g[f.candidate.sdpMLineIndex]+"a=end-of-candidates\r\n":
g[f.candidate.sdpMLineIndex]+("a="+f.candidate.candidate+"\r\n");c._localDescription.sdp=l.getDescription(c._localDescription.sdp)+g.join("");g=c.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});"gathering"!==c.iceGatheringState&&(c.iceGatheringState="gathering",c._emitGatheringStateChange());e||c._dispatchEvent("icecandidate",f);g&&(c._dispatchEvent("icecandidate",new Event("icecandidate")),c.iceGatheringState="complete",c._emitGatheringStateChange())}};e.setTimeout(function(){f.forEach(function(a){d.onlocalcandidate(a)})},
0)}};n.prototype._createIceAndDtlsTransports=function(){var a=this,b=new e.RTCIceTransport(null);b.onicestatechange=function(){a._updateIceConnectionState();a._updateConnectionState()};var c=new e.RTCDtlsTransport(b);c.ondtlsstatechange=function(){a._updateConnectionState()};c.onerror=function(){Object.defineProperty(c,"state",{value:"failed",writable:!0});a._updateConnectionState()};return{iceTransport:b,dtlsTransport:c}};n.prototype._disposeIceAndDtlsTransports=function(a){var b=this.transceivers[a].iceGatherer;
b&&(delete b.onlocalcandidate,delete this.transceivers[a].iceGatherer);if(b=this.transceivers[a].iceTransport)delete b.onicestatechange,delete this.transceivers[a].iceTransport;if(b=this.transceivers[a].dtlsTransport)delete b.ondtlsstatechange,delete b.onerror,delete this.transceivers[a].dtlsTransport};n.prototype._transceive=function(a,b,d){var e=c(a.localCapabilities,a.remoteCapabilities);b&&a.rtpSender&&(e.encodings=a.sendEncodingParameters,e.rtcp={cname:l.localCName,compound:a.rtcpParameters.compound},
a.recvEncodingParameters.length&&(e.rtcp.ssrc=a.recvEncodingParameters[0].ssrc),a.rtpSender.send(e));d&&a.rtpReceiver&&0<e.codecs.length&&("video"===a.kind&&a.recvEncodingParameters&&15019>f&&a.recvEncodingParameters.forEach(function(a){delete a.rtx}),e.encodings=a.recvEncodingParameters.length?a.recvEncodingParameters:[{}],e.rtcp={compound:a.rtcpParameters.compound},a.rtcpParameters.cname&&(e.rtcp.cname=a.rtcpParameters.cname),a.sendEncodingParameters.length&&(e.rtcp.ssrc=a.sendEncodingParameters[0].ssrc),
a.rtpReceiver.receive(e))};n.prototype.setLocalDescription=function(a){var d=this;if(-1===["offer","answer"].indexOf(a.type))return Promise.reject(m("TypeError",'Unsupported type "'+a.type+'"'));if(!b("setLocalDescription",a.type,d.signalingState)||d._isClosed)return Promise.reject(m("InvalidStateError","Can not set local "+a.type+" in state "+d.signalingState));if("offer"===a.type){var e=l.splitSections(a.sdp);var f=e.shift();e.forEach(function(a,b){a=l.parseRtpParameters(a);d.transceivers[b].localCapabilities=
a});d.transceivers.forEach(function(a,b){d._gather(a.mid,b)})}else if("answer"===a.type){e=l.splitSections(d._remoteDescription.sdp);f=e.shift();var g=0<l.matchPrefix(f,"a=ice-lite").length;e.forEach(function(a,b){var e=d.transceivers[b],h=e.iceGatherer,k=e.iceTransport,m=e.dtlsTransport,n=e.localCapabilities,t=e.remoteCapabilities;if(!(l.isRejected(a)&&0===l.matchPrefix(a,"a=bundle-only").length||e.rejected)){var p=l.getIceParameters(a,f);a=l.getDtlsParameters(a,f);g&&(a.role="server");d.usingBundle&&
0!==b||(d._gather(e.mid,b),"new"===k.state&&k.start(h,p,g?"controlling":"controlled"),"new"===m.state&&m.start(a));b=c(n,t);d._transceive(e,0<b.codecs.length,!1)}})}d._localDescription={type:a.type,sdp:a.sdp};"offer"===a.type?d._updateSignalingState("have-local-offer"):d._updateSignalingState("stable");return Promise.resolve()};n.prototype.setRemoteDescription=function(a){var d=this;if(-1===["offer","answer"].indexOf(a.type))return Promise.reject(m("TypeError",'Unsupported type "'+a.type+'"'));if(!b("setRemoteDescription",
a.type,d.signalingState)||d._isClosed)return Promise.reject(m("InvalidStateError","Can not set remote "+a.type+" in state "+d.signalingState));var n={};d.remoteStreams.forEach(function(a){n[a.id]=a});var t=[],q=l.splitSections(a.sdp),r=q.shift(),x=0<l.matchPrefix(r,"a=ice-lite").length,K=0<l.matchPrefix(r,"a=group:BUNDLE ").length;d.usingBundle=K;var u=l.matchPrefix(r,"a=ice-options:")[0];d.canTrickleIceCandidates=u?0<=u.substr(14).split(" ").indexOf("trickle"):!1;q.forEach(function(b,m){var p=l.splitLines(b),
q=l.getKind(b),w=l.isRejected(b)&&0===l.matchPrefix(b,"a=bundle-only").length,B=p[0].substr(2).split(" ")[2];p=l.getDirection(b,r);var u=l.parseMsid(b),A=l.getMid(b)||l.generateIdentifier();if(w||"application"===q&&("DTLS/SCTP"===B||"UDP/DTLS/SCTP"===B))d.transceivers[m]={mid:A,kind:q,protocol:B,rejected:!0};else{!w&&d.transceivers[m]&&d.transceivers[m].rejected&&(d.transceivers[m]=d._createTransceiver(q,!0));var F=l.parseRtpParameters(b);if(!w){var v=l.getIceParameters(b,r);var G=l.getDtlsParameters(b,
r);G.role="client"}B=l.parseRtpEncodingParameters(b);var C=l.parseRtcpParameters(b),I=0<l.matchPrefix(b,"a=end-of-candidates",r).length,H=l.matchPrefix(b,"a=candidate:").map(function(a){return l.parseCandidate(a)}).filter(function(a){return 1===a.component});("offer"===a.type||"answer"===a.type)&&!w&&K&&0<m&&d.transceivers[m]&&(d._disposeIceAndDtlsTransports(m),d.transceivers[m].iceGatherer=d.transceivers[0].iceGatherer,d.transceivers[m].iceTransport=d.transceivers[0].iceTransport,d.transceivers[m].dtlsTransport=
d.transceivers[0].dtlsTransport,d.transceivers[m].rtpSender&&d.transceivers[m].rtpSender.setTransport(d.transceivers[0].dtlsTransport),d.transceivers[m].rtpReceiver&&d.transceivers[m].rtpReceiver.setTransport(d.transceivers[0].dtlsTransport));if("offer"!==a.type||w)"answer"!==a.type||w||(y=d.transceivers[m],N=y.iceGatherer,q=y.iceTransport,A=y.dtlsTransport,O=y.rtpReceiver,w=y.sendEncodingParameters,b=y.localCapabilities,d.transceivers[m].recvEncodingParameters=B,d.transceivers[m].remoteCapabilities=
F,d.transceivers[m].rtcpParameters=C,H.length&&"new"===q.state&&(!x&&!I||K&&0!==m?H.forEach(function(a){k(y.iceTransport,a)}):q.setRemoteCandidates(H)),K&&0!==m||("new"===q.state&&q.start(N,v,"controlling"),"new"===A.state&&A.start(G)),!c(y.localCapabilities,y.remoteCapabilities).codecs.filter(function(a){return"rtx"===a.name.toLowerCase()}).length&&y.sendEncodingParameters[0].rtx&&delete y.sendEncodingParameters[0].rtx,d._transceive(y,"sendrecv"===p||"recvonly"===p,"sendrecv"===p||"sendonly"===p),
!O||"sendrecv"!==p&&"sendonly"!==p?delete y.rtpReceiver:(p=O.track,u?(n[u.stream]||(n[u.stream]=new e.MediaStream),g(p,n[u.stream]),t.push([p,O,n[u.stream]])):(n.default||(n.default=new e.MediaStream),g(p,n.default),t.push([p,O,n.default]))));else{var y=d.transceivers[m]||d._createTransceiver(q);y.mid=A;y.iceGatherer||(y.iceGatherer=d._createIceGatherer(m,K));H.length&&"new"===y.iceTransport.state&&(!I||K&&0!==m?H.forEach(function(a){k(y.iceTransport,a)}):y.iceTransport.setRemoteCandidates(H));b=
e.RTCRtpReceiver.getCapabilities(q);15019>f&&(b.codecs=b.codecs.filter(function(a){return"rtx"!==a.name}));w=y.sendEncodingParameters||[{ssrc:1001*(2*m+2)}];v=!1;if("sendrecv"===p||"sendonly"===p){v=!y.rtpReceiver;var O=y.rtpReceiver||new e.RTCRtpReceiver(y.dtlsTransport,q);if(v){p=O.track;if(!u||"-"!==u.stream)if(u){n[u.stream]||(n[u.stream]=new e.MediaStream,Object.defineProperty(n[u.stream],"id",{get:function(){return u.stream}}));Object.defineProperty(p,"id",{get:function(){return u.track}});
var N=n[u.stream]}else n.default||(n.default=new e.MediaStream),N=n.default;N&&(g(p,N),y.associatedRemoteMediaStreams.push(N));t.push([p,O,N])}}else y.rtpReceiver&&y.rtpReceiver.track&&(y.associatedRemoteMediaStreams.forEach(function(a){var b=a.getTracks().find(function(a){return a.id===y.rtpReceiver.track.id});b&&h(b,a)}),y.associatedRemoteMediaStreams=[]);y.localCapabilities=b;y.remoteCapabilities=F;y.rtpReceiver=O;y.rtcpParameters=C;y.sendEncodingParameters=w;y.recvEncodingParameters=B;d._transceive(d.transceivers[m],
!1,v)}}});void 0===d._dtlsRole&&(d._dtlsRole="offer"===a.type?"active":"passive");d._remoteDescription={type:a.type,sdp:a.sdp};"offer"===a.type?d._updateSignalingState("have-remote-offer"):d._updateSignalingState("stable");Object.keys(n).forEach(function(a){var b=n[a];if(b.getTracks().length){if(-1===d.remoteStreams.indexOf(b)){d.remoteStreams.push(b);var c=new Event("addstream");c.stream=b;e.setTimeout(function(){d._dispatchEvent("addstream",c)})}t.forEach(function(a){b.id===a[2].id&&p(d,a[0],a[1],
[b])})}});t.forEach(function(a){a[2]||p(d,a[0],a[1],[])});e.setTimeout(function(){d&&d.transceivers&&d.transceivers.forEach(function(a){a.iceTransport&&"new"===a.iceTransport.state&&0<a.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),a.iceTransport.addRemoteCandidate({}))})},4E3);return Promise.resolve()};n.prototype.close=function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop();
a.dtlsTransport&&a.dtlsTransport.stop();a.rtpSender&&a.rtpSender.stop();a.rtpReceiver&&a.rtpReceiver.stop()});this._isClosed=!0;this._updateSignalingState("closed")};n.prototype._updateSignalingState=function(a){this.signalingState=a;a=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",a)};n.prototype._maybeFireNegotiationNeeded=function(){var a=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(a.needNegotiation){a.needNegotiation=
!1;var b=new Event("negotiationneeded");a._dispatchEvent("negotiationneeded",b)}},0))};n.prototype._updateIceConnectionState=function(){var a={"new":0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(b){b.iceTransport&&!b.rejected&&a[b.iceTransport.state]++});var b="new";0<a.failed?b="failed":0<a.checking?b="checking":0<a.disconnected?b="disconnected":0<a.new?b="new":0<a.connected?b="connected":0<a.completed&&(b="completed");b!==this.iceConnectionState&&
(this.iceConnectionState=b,b=new Event("iceconnectionstatechange"),this._dispatchEvent("iceconnectionstatechange",b))};n.prototype._updateConnectionState=function(){var a={"new":0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(b){b.iceTransport&&b.dtlsTransport&&!b.rejected&&(a[b.iceTransport.state]++,a[b.dtlsTransport.state]++)});a.connected+=a.completed;var b="new";0<a.failed?b="failed":0<a.connecting?b="connecting":0<a.disconnected?b="disconnected":
0<a.new?b="new":0<a.connected&&(b="connected");b!==this.connectionState&&(this.connectionState=b,b=new Event("connectionstatechange"),this._dispatchEvent("connectionstatechange",b))};n.prototype.createOffer=function(a){var b=this;if(b._isClosed)return Promise.reject(m("InvalidStateError","Can not call createOffer after close"));var c=b.transceivers.filter(function(a){return"audio"===a.kind}).length,g=b.transceivers.filter(function(a){return"video"===a.kind}).length;if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");
void 0!==a.offerToReceiveAudio&&(c=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio);void 0!==a.offerToReceiveVideo&&(g=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(b.transceivers.forEach(function(a){"audio"===a.kind?(c--,0>c&&(a.wantReceive=!1)):"video"===a.kind&&(g--,0>g&&(a.wantReceive=!1))});0<c||0<g;)0<c&&(b._createTransceiver("audio"),c--),0<g&&(b._createTransceiver("video"),g--);var h=l.writeSessionBoilerplate(b._sdpSessionId,
b._sdpSessionVersion++);b.transceivers.forEach(function(a,c){var d=a.track,g=a.kind,h=a.mid||l.generateIdentifier();a.mid=h;a.iceGatherer||(a.iceGatherer=b._createIceGatherer(c,b.usingBundle));h=e.RTCRtpSender.getCapabilities(g);15019>f&&(h.codecs=h.codecs.filter(function(a){return"rtx"!==a.name}));h.codecs.forEach(function(b){"H264"===b.name&&void 0===b.parameters["level-asymmetry-allowed"]&&(b.parameters["level-asymmetry-allowed"]="1");a.remoteCapabilities&&a.remoteCapabilities.codecs&&a.remoteCapabilities.codecs.forEach(function(a){b.name.toLowerCase()===
a.name.toLowerCase()&&b.clockRate===a.clockRate&&(b.preferredPayloadType=a.payloadType)})});h.headerExtensions.forEach(function(b){(a.remoteCapabilities&&a.remoteCapabilities.headerExtensions||[]).forEach(function(a){b.uri===a.uri&&(b.id=a.id)})});c=a.sendEncodingParameters||[{ssrc:1001*(2*c+1)}];d&&15019<=f&&"video"===g&&!c[0].rtx&&(c[0].rtx={ssrc:c[0].ssrc+1});a.wantReceive&&(a.rtpReceiver=new e.RTCRtpReceiver(a.dtlsTransport,g));a.localCapabilities=h;a.sendEncodingParameters=c});"max-compat"!==
b._config.bundlePolicy&&(h+="a=group:BUNDLE "+b.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n");h+="a=ice-options:trickle\r\n";b.transceivers.forEach(function(a,c){h+=d(a,a.localCapabilities,"offer",a.stream,b._dtlsRole);h+="a=rtcp-rsize\r\n";!a.iceGatherer||"new"===b.iceGatheringState||0!==c&&b.usingBundle||(a.iceGatherer.getLocalCandidates().forEach(function(a){a.component=1;h+="a="+l.writeCandidate(a)+"\r\n"}),"completed"===a.iceGatherer.state&&(h+="a=end-of-candidates\r\n"))});a=
new e.RTCSessionDescription({type:"offer",sdp:h});return Promise.resolve(a)};n.prototype.createAnswer=function(){var a=this;if(a._isClosed)return Promise.reject(m("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==a.signalingState&&"have-local-pranswer"!==a.signalingState)return Promise.reject(m("InvalidStateError","Can not call createAnswer in signalingState "+a.signalingState));var b=l.writeSessionBoilerplate(a._sdpSessionId,a._sdpSessionVersion++);a.usingBundle&&
(b+="a=group:BUNDLE "+a.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n");b+="a=ice-options:trickle\r\n";var g=l.getMediaSections(a._remoteDescription.sdp).length;a.transceivers.forEach(function(e,h){if(!(h+1>g))if(e.rejected)"application"===e.kind?b="DTLS/SCTP"===e.protocol?b+"m=application 0 DTLS/SCTP 5000\r\n":b+("m=application 0 "+e.protocol+" webrtc-datachannel\r\n"):"audio"===e.kind?b+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(b+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),
b+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n";else{if(e.stream){var k;"audio"===e.kind?k=e.stream.getAudioTracks()[0]:"video"===e.kind&&(k=e.stream.getVideoTracks()[0]);k&&15019<=f&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1})}h=c(e.localCapabilities,e.remoteCapabilities);!h.codecs.filter(function(a){return"rtx"===a.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx;
b+=d(e,h,"answer",e.stream,a._dtlsRole);e.rtcpParameters&&e.rtcpParameters.reducedSize&&(b+="a=rtcp-rsize\r\n")}});var h=new e.RTCSessionDescription({type:"answer",sdp:b});return Promise.resolve(h)};n.prototype.addIceCandidate=function(a){var b=this,c;return a&&void 0===a.sdpMLineIndex&&!a.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(d,e){if(b._remoteDescription)if(a&&""!==a.candidate){var f=a.sdpMLineIndex;if(a.sdpMid)for(var g=0;g<b.transceivers.length;g++)if(b.transceivers[g].mid===
a.sdpMid){f=g;break}var h=b.transceivers[f];if(h){if(h.rejected)return d();g=0<Object.keys(a.candidate).length?l.parseCandidate(a.candidate):{};if("tcp"===g.protocol&&(0===g.port||9===g.port)||g.component&&1!==g.component)return d();if((0===f||0<f&&h.iceTransport!==b.transceivers[0].iceTransport)&&!k(h.iceTransport,g))return e(m("OperationError","Can not add ICE candidate"));e=a.candidate.trim();0===e.indexOf("a=")&&(e=e.substr(2));c=l.getMediaSections(b._remoteDescription.sdp);c[f]+="a="+(g.type?
e:"end-of-candidates")+"\r\n";b._remoteDescription.sdp=l.getDescription(b._remoteDescription.sdp)+c.join("")}else return e(m("OperationError","Can not add ICE candidate"))}else for(f=0;f<b.transceivers.length&&(b.transceivers[f].rejected||(b.transceivers[f].iceTransport.addRemoteCandidate({}),c=l.getMediaSections(b._remoteDescription.sdp),c[f]+="a=end-of-candidates\r\n",b._remoteDescription.sdp=l.getDescription(b._remoteDescription.sdp)+c.join(""),!b.usingBundle));f++);else return e(m("InvalidStateError",
"Can not add ICE candidate without a remote description"));d()})};n.prototype.getStats=function(a){if(a&&a instanceof e.MediaStreamTrack){var b=null;this.transceivers.forEach(function(c){c.rtpSender&&c.rtpSender.track===a?b=c.rtpSender:c.rtpReceiver&&c.rtpReceiver.track===a&&(b=c.rtpReceiver)});if(!b)throw m("InvalidAccessError","Invalid selector.");return b.getStats()}var c=[];this.transceivers.forEach(function(a){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(b){a[b]&&
c.push(a[b].getStats())})});return Promise.all(c).then(function(a){var b=new Map;a.forEach(function(a){a.forEach(function(a){b.set(a.id,a)})});return b})};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(a){if((a=e[a])&&a.prototype&&a.prototype.getStats){var b=a.prototype.getStats;a.prototype.getStats=function(){return b.apply(this).then(function(a){var b=new Map;Object.keys(a).forEach(function(c){var d=a[c];a[c].type={inboundrtp:"inbound-rtp",
outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[d.type]||d.type;b.set(c,a[c])});return b})}}});var u=["createOffer","createAnswer"];u.forEach(function(a){var b=n.prototype[a];n.prototype[a]=function(){var a=arguments;return"function"===typeof a[0]||"function"===typeof a[1]?b.apply(this,[arguments[2]]).then(function(b){"function"===typeof a[0]&&a[0].apply(null,[b])},function(b){"function"===typeof a[1]&&a[1].apply(null,
[b])}):b.apply(this,arguments)}});u=["setLocalDescription","setRemoteDescription","addIceCandidate"];u.forEach(function(a){var b=n.prototype[a];n.prototype[a]=function(){var a=arguments;return"function"===typeof a[1]||"function"===typeof a[2]?b.apply(this,arguments).then(function(){"function"===typeof a[1]&&a[1].apply(null)},function(b){"function"===typeof a[2]&&a[2].apply(null,[b])}):b.apply(this,arguments)}});["getStats"].forEach(function(a){var b=n.prototype[a];n.prototype[a]=function(){var a=
arguments;return"function"===typeof a[1]?b.apply(this,arguments).then(function(){"function"===typeof a[1]&&a[1].apply(null)}):b.apply(this,arguments)}});return n}},{sdp:17}],17:[function(h,g,f){var d={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};d.localCName=d.generateIdentifier();d.splitLines=function(a){return a.trim().split("\n").map(function(a){return a.trim()})};d.splitSections=function(a){return a.split("\nm=").map(function(a,b){return(0<b?"m="+a:a).trim()+
"\r\n"})};d.getDescription=function(a){return(a=d.splitSections(a))&&a[0]};d.getMediaSections=function(a){a=d.splitSections(a);a.shift();return a};d.matchPrefix=function(a,c){return d.splitLines(a).filter(function(a){return 0===a.indexOf(c)})};d.parseCandidate=function(a){a=0===a.indexOf("a=candidate:")?a.substring(12).split(" "):a.substring(10).split(" ");for(var c={foundation:a[0],component:parseInt(a[1],10),protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],
10),type:a[7]},b=8;b<a.length;b+=2)switch(a[b]){case "raddr":c.relatedAddress=a[b+1];break;case "rport":c.relatedPort=parseInt(a[b+1],10);break;case "tcptype":c.tcpType=a[b+1];break;case "ufrag":c.ufrag=a[b+1];c.usernameFragment=a[b+1];break;default:c[a[b]]=a[b+1]}return c};d.writeCandidate=function(a){var c=[];c.push(a.foundation);c.push(a.component);c.push(a.protocol.toUpperCase());c.push(a.priority);c.push(a.address||a.ip);c.push(a.port);var b=a.type;c.push("typ");c.push(b);"host"!==b&&a.relatedAddress&&
a.relatedPort&&(c.push("raddr"),c.push(a.relatedAddress),c.push("rport"),c.push(a.relatedPort));a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(c.push("tcptype"),c.push(a.tcpType));if(a.usernameFragment||a.ufrag)c.push("ufrag"),c.push(a.usernameFragment||a.ufrag);return"candidate:"+c.join(" ")};d.parseIceOptions=function(a){return a.substr(14).split(" ")};d.parseRtpMap=function(a){a=a.substr(9).split(" ");var c={payloadType:parseInt(a.shift(),10)};a=a[0].split("/");c.name=a[0];c.clockRate=parseInt(a[1],
10);c.channels=3===a.length?parseInt(a[2],10):1;c.numChannels=c.channels;return c};d.writeRtpMap=function(a){var c=a.payloadType;void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType);var b=a.channels||a.numChannels||1;return"a=rtpmap:"+c+" "+a.name+"/"+a.clockRate+(1!==b?"/"+b:"")+"\r\n"};d.parseExtmap=function(a){a=a.substr(9).split(" ");return{id:parseInt(a[0],10),direction:0<a[0].indexOf("/")?a[0].split("/")[1]:"sendrecv",uri:a[1]}};d.writeExtmap=function(a){return"a=extmap:"+(a.id||a.preferredId)+
(a.direction&&"sendrecv"!==a.direction?"/"+a.direction:"")+" "+a.uri+"\r\n"};d.parseFmtp=function(a){for(var c={},b=a.substr(a.indexOf(" ")+1).split(";"),d=0;d<b.length;d++)a=b[d].trim().split("="),c[a[0].trim()]=a[1];return c};d.writeFmtp=function(a){var c="",b=a.payloadType;void 0!==a.preferredPayloadType&&(b=a.preferredPayloadType);if(a.parameters&&Object.keys(a.parameters).length){var d=[];Object.keys(a.parameters).forEach(function(b){a.parameters[b]?d.push(b+"="+a.parameters[b]):d.push(b)});
c+="a=fmtp:"+b+" "+d.join(";")+"\r\n"}return c};d.parseRtcpFb=function(a){a=a.substr(a.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}};d.writeRtcpFb=function(a){var c="",b=a.payloadType;void 0!==a.preferredPayloadType&&(b=a.preferredPayloadType);a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(function(a){c+="a=rtcp-fb:"+b+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+"\r\n"});return c};d.parseSsrcMedia=function(a){var c=a.indexOf(" "),b={ssrc:parseInt(a.substr(7,
c-7),10)},d=a.indexOf(":",c);-1<d?(b.attribute=a.substr(c+1,d-c-1),b.value=a.substr(d+1)):b.attribute=a.substr(c+1);return b};d.parseSsrcGroup=function(a){a=a.substr(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(function(a){return parseInt(a,10)})}};d.getMid=function(a){if(a=d.matchPrefix(a,"a=mid:")[0])return a.substr(6)};d.parseFingerprint=function(a){a=a.substr(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1]}};d.getDtlsParameters=function(a,c){return{role:"auto",fingerprints:d.matchPrefix(a+
c,"a=fingerprint:").map(d.parseFingerprint)}};d.writeDtlsParameters=function(a,c){var b="a=setup:"+c+"\r\n";a.fingerprints.forEach(function(a){b+="a=fingerprint:"+a.algorithm+" "+a.value+"\r\n"});return b};d.getIceParameters=function(a,c){a=d.splitLines(a);a=a.concat(d.splitLines(c));return{usernameFragment:a.filter(function(a){return 0===a.indexOf("a=ice-ufrag:")})[0].substr(12),password:a.filter(function(a){return 0===a.indexOf("a=ice-pwd:")})[0].substr(10)}};d.writeIceParameters=function(a){return"a=ice-ufrag:"+
a.usernameFragment+"\r\na=ice-pwd:"+a.password+"\r\n"};d.parseRtpParameters=function(a){for(var c={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},b=d.splitLines(a)[0].split(" "),f=3;f<b.length;f++){var g=b[f],h=d.matchPrefix(a,"a=rtpmap:"+g+" ")[0];if(h){h=d.parseRtpMap(h);var e=d.matchPrefix(a,"a=fmtp:"+g+" ");h.parameters=e.length?d.parseFmtp(e[0]):{};h.rtcpFeedback=d.matchPrefix(a,"a=rtcp-fb:"+g+" ").map(d.parseRtcpFb);c.codecs.push(h);switch(h.name.toUpperCase()){case "RED":case "ULPFEC":c.fecMechanisms.push(h.name.toUpperCase())}}}d.matchPrefix(a,
"a=extmap:").forEach(function(a){c.headerExtensions.push(d.parseExtmap(a))});return c};d.writeRtpDescription=function(a,c){var b="";b+="m="+a+" ";b+=0<c.codecs.length?"9":"0";b+=" UDP/TLS/RTP/SAVPF ";b+=c.codecs.map(function(a){return void 0!==a.preferredPayloadType?a.preferredPayloadType:a.payloadType}).join(" ")+"\r\n";b+="c=IN IP4 0.0.0.0\r\n";b+="a=rtcp:9 IN IP4 0.0.0.0\r\n";c.codecs.forEach(function(a){b+=d.writeRtpMap(a);b+=d.writeFmtp(a);b+=d.writeRtcpFb(a)});var f=0;c.codecs.forEach(function(a){a.maxptime>
f&&(f=a.maxptime)});0<f&&(b+="a=maxptime:"+f+"\r\n");b+="a=rtcp-mux\r\n";c.headerExtensions&&c.headerExtensions.forEach(function(a){b+=d.writeExtmap(a)});return b};d.parseRtpEncodingParameters=function(a){var c=[],b=d.parseRtpParameters(a),f=-1!==b.fecMechanisms.indexOf("RED"),g=-1!==b.fecMechanisms.indexOf("ULPFEC"),h=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute}),e=0<h.length&&h[0].ssrc,p;h=d.matchPrefix(a,"a=ssrc-group:FID").map(function(a){return a.substr(17).split(" ").map(function(a){return parseInt(a,
10)})});0<h.length&&1<h[0].length&&h[0][0]===e&&(p=h[0][1]);b.codecs.forEach(function(a){"RTX"===a.name.toUpperCase()&&a.parameters.apt&&(a={ssrc:e,codecPayloadType:parseInt(a.parameters.apt,10)},e&&p&&(a.rtx={ssrc:p}),c.push(a),f&&(a=JSON.parse(JSON.stringify(a)),a.fec={ssrc:e,mechanism:g?"red+ulpfec":"red"},c.push(a)))});0===c.length&&e&&c.push({ssrc:e});var t=d.matchPrefix(a,"b=");t.length&&(t=0===t[0].indexOf("b=TIAS:")?parseInt(t[0].substr(7),10):0===t[0].indexOf("b=AS:")?950*parseInt(t[0].substr(5),
10)-16E3:void 0,c.forEach(function(a){a.maxBitrate=t}));return c};d.parseRtcpParameters=function(a){var c={},b=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute})[0];b&&(c.cname=b.value,c.ssrc=b.ssrc);b=d.matchPrefix(a,"a=rtcp-rsize");c.reducedSize=0<b.length;c.compound=0===b.length;a=d.matchPrefix(a,"a=rtcp-mux");c.mux=0<a.length;return c};d.parseMsid=function(a){var c=d.matchPrefix(a,"a=msid:");if(1===c.length)return a=c[0].substr(7).split(" "),
{stream:a[0],track:a[1]};a=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"msid"===a.attribute});if(0<a.length)return a=a[0].value.split(" "),{stream:a[0],track:a[1]}};d.generateSessionId=function(){return Math.random().toString().substr(2,21)};d.writeSessionBoilerplate=function(a,c,b){c=void 0!==c?c:2;a=a?a:d.generateSessionId();return"v=0\r\no="+(b||"thisisadapterortc")+" "+a+" "+c+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"};d.writeMediaSection=function(a,
c,b,f){c=d.writeRtpDescription(a.kind,c);c+=d.writeIceParameters(a.iceGatherer.getLocalParameters());c+=d.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===b?"actpass":"active");c+="a=mid:"+a.mid+"\r\n";c=a.direction?c+("a="+a.direction+"\r\n"):a.rtpSender&&a.rtpReceiver?c+"a=sendrecv\r\n":a.rtpSender?c+"a=sendonly\r\n":a.rtpReceiver?c+"a=recvonly\r\n":c+"a=inactive\r\n";a.rtpSender&&(b="msid:"+f.id+" "+a.rtpSender.track.id+"\r\n",c=c+("a="+b)+("a=ssrc:"+a.sendEncodingParameters[0].ssrc+
" "+b),a.sendEncodingParameters[0].rtx&&(c+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+b,c+="a=ssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+"\r\n"));c+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+d.localCName+"\r\n";a.rtpSender&&a.sendEncodingParameters[0].rtx&&(c+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" cname:"+d.localCName+"\r\n");return c};d.getDirection=function(a,c){a=d.splitLines(a);for(var b=0;b<a.length;b++)switch(a[b]){case "a=sendrecv":case "a=sendonly":case "a=recvonly":case "a=inactive":return a[b].substr(2)}return c?
d.getDirection(c):"sendrecv"};d.getKind=function(a){return d.splitLines(a)[0].split(" ")[0].substr(2)};d.isRejected=function(a){return"0"===a.split(" ",2)[1]};d.parseMLine=function(a){a=d.splitLines(a)[0].substr(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}};d.parseOLine=function(a){a=d.matchPrefix(a,"o=")[0].substr(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}};d.isValidSDP=
function(a){if("string"!==typeof a||0===a.length)return!1;a=d.splitLines(a);for(var c=0;c<a.length;c++)if(2>a[c].length||"="!==a[c].charAt(1))return!1;return!0};"object"===typeof g&&(g.exports=d)},{}]},{},[1])(1)});
var ClientClientVideoAudio=new function(){return function(h){function g(a){var b=a.getTracks();each(b,function(b){w.addTrack(b,a)});p(a)}function f(){c(function(a){a.successful?q.dispatchEvent({type:"sendaccept",accept:a.answer}):l(a.error)})}function d(){a(function(a){a.successful?q.dispatchEvent({type:"sendoffer",offer:a.offer}):e(a.error)})}function a(a){w.createOffer(function(b){console.log("set offer a");w.setLocalDescription(b,function(){a({successful:!0,offer:b})},function(b){k(a,b)})},function(b){k(a,
b)})}function c(a){w.createAnswer(function(b){console.log("set answer a");w.setLocalDescription(b,function(){a({successful:!0,answer:b})},function(b){k(a,b)})},function(b){k(a,b)})}function b(){w&&w.close();w=new RTCPeerConnection(null);w.ontrack=t;w.onremovestream=x;w.oniceconnectionstatechange=r;w.onicecandidate=n;return w}function k(a,b){m(b);a({successful:!1,error:b})}function m(a){console.error(a.message?a.message:a);console.error(Error().stack)}function l(a){q.dispatchEvent({type:"acceptfailed",
error:a})}function e(a){q.dispatchEvent({type:"offerfailed",error:a})}function p(a){console.log("dispatching local stream");q.dispatchEvent({type:"localstream",stream:a})}function t(a){console.log(a.streams[0]);a=a.streams[0];console.log("dispatchAddRemoteStream");q.dispatchEvent({type:"addremotestream",stream:a})}function x(a){q.dispatchEvent({type:"removeremotestream",stream:a.stream})}function r(a){console.log("ICE state: ",w.iceConnectionState);a=w.iceConnectionState;switch(a){case "failed":case "disconnected":case "closed":q.dispatchEvent({type:"ended",
iceConnectionState:a})}}function n(a){console.log("onicecandidate");console.log(a);a=a.candidate;null!=a?q.dispatchEvent({type:"sendice",candidate:a}):q.dispatchEvent({type:"allicecandidatessent"})}function u(a){navigator.getUserMedia({audio:!1,video:!0},function(b){console.log("GOT USRE MEDIA");a({successful:!0,stream:b})},function(b){k(a,b)})}EventEnabledBuilder(this);var q=this,w;this.createOffer=function(a){u(function(c){c.successful?(b(),g(c.stream),d()):(a&&a(c),e(c.error))})};this.incomingOffer=
function(a){b();console.log("setting remote description b");console.log("set offer b");w.setRemoteDescription(a,function(){},function(a){m(a)})};this.acceptedOffer=function(a){console.log("ClientClientVideoAudio.acceptedOffer");u(function(a){a.successful?(g(a.stream),f()):l(a.error)})};this.incomingIceCandidate=function(a){console.log("incoming ice candidate");w&&w.addIceCandidate(a,function(){q.dispatchEvent({type:"addedicecandidate",candidate:a})},m)};this.incomingAccept=function(a){console.log(a);
console.log("setting remote description a");console.log("set answer b");w.setRemoteDescription(a,function(){console.log("set")},function(){console.error(m)})}}},VideoFeedUI=function(){return function(h){function g(){h.acceptedOffer(b.offer)}function f(){a(VideoOfferRejectedReasons.DECLINED)}function d(a){c.dispatchEvent({type:"showmessagetouser",message:a})}function a(a){console.log(a);c.dispatchEvent({type:"offerrejected",reason:a})}EventEnabledBuilder(this);var c=this,b,k,m=E.DIV(),l=E.DIV(),e=
E.VIDEO();m.classList.add("video-feed");l.classList.add("me");var p=E.VIDEO();p.classList.add("video-them");e.classList.add("video-me");m.appendChild(p);m.appendChild(l);l.appendChild(e);h.addEventListener("gotoffer",function(a){b=a.wrappedOffer;console.log(a.offer);k&&k.dispose();k=Dialog.show({message:b.userFrom.getUsername()+" want's to video chat!",buttons:[{text:"Accept",callback:g},{text:"decline",callback:f}]})});h.addEventListener("setlocalstream",function(a){console.log("setting stream");
var b=a.stream;console.log(a);console.log(a.stream);e.srcObject=b;e.play();c.dispatchEvent({type:"show"})});h.addEventListener("setremotestream",function(a){a=a.stream;console.log(a);console.log(Error().stack);console.log("setting videoThem and calling play");p.srcObject=a;p.play()});h.addEventListener("stopped",function(a){c.dispatchEvent({type:"hide"})});h.addEventListener("offerfailed",function(a){a=a.error?a.error.message:void 0;d(a?"Offer failed with reason: "+a:"Offer failed")});h.addEventListener("acceptfailed",
function(b){b=b.error?b.error.message:void 0;d(b?"Accept failed with reason: "+b:"Accept failed");console.log(b);a(VideoOfferRejectedReasons.ERROR)});this.getElement=function(){return m}}}(),VideoFeed=function(){return function(h){function g(b){a.dispatchEvent({type:"setremotestream",stream:b})}function f(b){a.dispatchEvent({type:"generalfailure",error:b.error})}function d(){e&&e.getTracks().forEach(function(a){a.stop()});e=null}EventEnabledBuilder(this);var a=this,c=h.getOfferTemplate,b=h.getAcceptTemplate,
k=h.getIceCandidateTemplate,m=h.send,l=new ClientClientVideoAudio({}),e;this.start=function(){d();l.createOffer(function(a){})};this.acceptedOffer=l.acceptedOffer;this.incomingOffer=function(b){l.incomingOffer(b.offer);a.dispatchEvent({type:"gotoffer",wrappedOffer:b,offer:b.offer})};this.incomingAccept=l.incomingAccept;this.incomingIceCandidate=l.incomingIceCandidate;this.stop=function(){d();a.dispatchEvent({type:"stopped"})};l.addEventListener("acceptfailed",function(b){console.log(Error().stack);
console.log(b);f(b);a.dispatchEvent({type:"acceptfailed",error:b.error})});l.addEventListener("offerfailed",function(b){f(b);a.dispatchEvent({type:"offerfailed",error:b.error})});l.addEventListener("sendice",function(a){a=a.candidate;var b=k();b.candidate=a;console.log(b);m(b)});l.addEventListener("allicesent",function(){});l.addEventListener("localstream",function(b){a.dispatchEvent({type:"setlocalstream",stream:b.stream})});l.addEventListener("addremotestream",function(a){console.log("onAddRemoteStream");
d();e=a.stream;g(e)});l.addEventListener("remoteremotestream",function(a){d();g()});l.addEventListener("sendoffer",function(a){a=a.offer;var b=c();b.offer=a;console.log(b);m(b)});l.addEventListener("sendaccept",function(a){a=a.accept;var c=b();c.accept=a;console.log(c);m(c)});l.addEventListener("ended",function(b){a.dispatchEvent({type:"stopped"})})}}(),VideoFeedPm=function(){return function(h){var g=h.userTo,f=h.getSessionId;h=new VideoFeed({getOfferTemplate:function(){return{type:"pm_video_offer",
userToId:g.getId(),sessionId:f()}},getAcceptTemplate:function(){return{type:"pm_video_accept",userToId:g.getId(),sessionId:f()}},getIceCandidateTemplate:function(){return{type:"pm_video_ice_candidate",userToId:g.getId(),sessionId:f()}},send:h.send});this.acceptedOffer=h.acceptedOffer;this.incomingAccept=h.incomingAccept;this.iceCandidate=h.iceCandidate;return h}}(),Button=function(){return function(h){function g(){m?(l.classList.remove(b),m=!1):(l.classList.add(b),m=!0)}EventEnabledBuilder(this);
var f=this,d=h.preventPropagation,a=h.className,c=h.classNames,b=h.classNameToggled,k=h.toggle,m=h.toggled?!0:!1;h=h.text;var l=E.BUTTON();h&&(l.innerHTML=h);a&&l.classList.add(a);c&&each(c,function(a){l.classList.add(a)});k&&g();l.addEventListener("click",function(a){d&&(a=a||window.event,a.stopPropagation());f.dispatchEvent({type:"click"});k&&b&&(g(),f.dispatchEvent({type:"toggled",toggled:m}))});this.getElement=function(){return l}}}(),Dialog=function(){var h=function(g){function f(){a&&d()}function d(){b.dispose()}
var a=g.disposeOnHide,c=g.message;c=g.classNames;var b=new Popup({closeOnClickOff:!1}),h=b.getElement();c&&each(c,function(a){h.classList.add(a)});var m=E.DIV();c=E.DIV();h.classList.add("dialog");m.classList.add("inner");c.classList.add("message");c.innerHTML=g.message;document.body.appendChild(b.getElement());b.getElement().appendChild(m);m.appendChild(c);(function(a){each(a.buttons,function(a){var b=new Button({text:a.text,className:"dialog-button"});b.addEventListener("click",a.callback?function(){f();
a.callback()}:f);m.appendChild(b.getElement())})})(g);this.show=function(){h.style.display="block"};this.dispose=d};h.show=function(g){g.disposeOnHide=!0;g=new h(g);g.show();return g};return h}();(function(){var h=new Settings("cookieWarning");h.get("accepted")||Dialog.show({message:"This site uses cookies to remember your username and various settings. By entering you accept this.",buttons:[{text:"That's ok",callback:function(){h.set("accepted",!0)}}],classNames:["cookie-warning"]})})();
var VideoButton=function(){return function(h){EventEnabledBuilder(this);var g=this,f=new Button(h),d=!1;this.setOn=function(a){d!=a&&(a?f.getElement().classList.add("on"):f.getElement().classList.remove("on"),d=a)};this.getElement=f.getElement;f.addEventListener("click",function(){g.dispatchEvent({type:"click"})})}}(),ClickMenu=new function(){function h(f){var d=f.element;d.classList.add("click-menu");this.removeOptionEntry=function(a){d.removeChild(a.getElement())};this.addOptionEntry=function(a){d.appendChild(a.getElement())}}
var g=function(){function f(d){var a=E.DIV();a.classList.add("option-entry");a.innerHTML=d.text;this.getElement=function(){return a}}return function(d){EventEnabledBuilder(this);var a=this,c=new f({text:d.text,tooltip:d.tooltip});this.getElement=c.getElement;c.getElement().addEventListener("click",function(){d.callback();a.dispatchEvent({type:"hide"})})}}();return function(f){function d(a){each(a,function(a){a=new g(a);m.addOptionEntry(a);a.addEventListener("hide",c);b.push(a)})}function a(){each(b,
function(a){m.removeOptionEntry(a)});b=[]}function c(a){k.hide()}EventEnabledBuilder(this);f.options&&d(f.options);console.log(Error().stack);var b=[],k=new Popup;f=k.getElement();document.body.appendChild(f);var m=new h({element:f});this.show=function(b){b.options&&(a(),d(b.options));k.show()};this.setPosition=k.setPosition}},compatabilityCheck=function(h,g){function f(){h()}function d(){g()}(function(){var a=Sniff.browser,c=a.name;a=a.version;console.log(c);console.log(a);switch(c){case "chrome":if("10"<=
a)return!0;break;case "edge":return!0;case "firefox":if("29"<=a)return!0;break;case "opera":if("12.1"<=a)return!0;break;case "operamini":break;case "safari":if("5.1.4"<=a)return!0;break;case "ie":if("11"<=a)return!0;break;default:return!1}})()?h():Dialog.show({message:"Your browser may not be able to run this chat properly. We recommend you upgrade to a new version of Chrome,  Edge, Firefox, Opera or Safar.",buttons:[{text:"Try",callback:f},{text:"Get Recommended Browser",callback:d}]})},MissingUsersManager=
new function(){return function(){this.get=function(h){};this.getRange=function(h){}}},Set=function(){return function(h){var g=this,f=h.getEntryId,d=[],a={};this.add=function(c){if(g.contains(c))return!1;d.push(c);a[f(c)]=c;return!0};this.remove=function(c){if(g.contains(c))return d.splice(d.indexOf(c),1),delete a[f(c)],c};this.removeById=function(c){var b=g.getById(c);if(b)return d.splice(d.indexOf(b),1),delete a[c],b};this.count=function(){return d.length};this.contains=function(c){return a[f(c)]?
!0:!1};this.getByIndex=function(a){return d[a]};this.getById=function(c){return a[c]};this.containsId=function(c){return a[c]?!0:!1};this.getIds=function(){return Object.keys(a)};this.getEntries=function(){return d};this.each=function(a){each(d,a)}}}();function ReferenceCounter(h){var g=[];this.add=function(f){0<=g.indexOf(f)||g.push(f)};this.remove=function(f){f=g.indexOf(f);0>f||(g.splice(f,1),1>g.length&&h())}}
var User=function(){function h(f){EventEnabledBuilder(this);new ReferenceCounter;var d=this;this.getId=function(){return f.id};this.setId=function(a){f.id=a};this.getUsername=function(){return String(f.username)};this.getEmail=function(){return f.email};this.isGuest=function(){return f.isGuest};this.getGender=function(){return f.gender};this.getBirthday=function(){return f.birthday};this.getImage=function(){return f.image};this.setImage=function(a){f.image=a};this.toJSON=function(){return f};this.left=
function(){d.dispatchEvent({type:"left",user:d})}}var g=new Set({getEntryId:function(f){return f.getId()}});return{fromJSON:function(f){var d=g.getById(f.id);if(d)return d;d=new h(f);g.add(d);return d},fromMessage:function(f){var d=g.getById(f.getUserId());if(d)return d;d=new h({id:f.getUserId(),username:f.getUsername(),image:f.getImage()});g.add(d);return d},fromPmNotification:function(f){var d=g.getById(f.getId());if(d)return d;d=new h({id:f.getId(),username:f.getUsername(),image:f.getImage()});
g.add(d);return d},TYPE:"user"}}(),Users=function(){return function(h){function g(c){if(!a.remove(c))return!1;console.log("dispatchingt remove");d.dispatchEvent({type:"remove",user:c})}function f(a){g(a.user)}EventEnabledBuilder(this);var d=this,a=new Set({getEntryId:function(a){return a.getId()}});this.add=function(c){a.add(c)&&(c.addEventListener("left",f),d.dispatchEvent({type:"add",user:c}))};this.contains=a.contains;this.containsId=a.containsId;this.getById=a.getById;this.remove=function(a){a.removeEventListener("left",
f);g(a)};this.clear=function(){var c=a.getEntries().slice();each(c,d.remove)};this.getIds=a.getIds;this.getEntries=a.getEntries}}(),SortedFilteredEntries=new function(){return function(h){function g(a,c,d){var e=c-a;if(5>e){a:{for(;a<=c;a++)if(!f(d,b[a])){c=a;break a}c+=1}return c}e=Math.floor(e/2)+a;return f(d,b[e])?g(e+1,c,d):g(a,e,d)}var f=h.compare,d=h.element,a=h.getEntryId,c=this,b=[],k={};this.containsEntryId=function(a){return k[a]?!0:!1};this.getByEntryId=function(a){return k[a]};this.getEntries=
function(){return b};this.addEntry=function(c){var f=a(c);if(!k[f])if(k[a(c)]=c,1>b.length)b.push(c),d.appendChild(c.getElement());else{f=b.length-1;var e=g(0,f,c);e<=f?(d.insertBefore(c.getElement(),b[e].getElement()),b.splice(e,0,c)):(b.push(c),d.appendChild(c.getElement()))}};this.removeEntry=function(c){var f=b.indexOf(c);0>f||(b.splice(f,1),d.removeChild(c.getElement()),delete k[a(c)])};this.removeEntryById=function(a){(a=c.getByEntryId(a))&&c.removeEntry(a)};this.clear=function(){for(;0<b.length;){var a=
b.splice(0,1)[0];d.removeChild(a.getElement())}k={}}}},OverlappingEntries=new function(){return function(h){function g(a){k.show(a.entry)}function f(a){k.hide(a.entry)}function d(a){m.remove(a);m.add(a);a.bringElementToFront()}function a(a){if(a=c(a))return a.setVisible(!0),a}function c(){return m.getEntries().slice().reverse().where(function(a){return a.getIsSetShow()}).firstOrDefault()}function b(a){var b=!1;a.getVisible()&&(b=!0);this.getId=function(){return a.getId()};this.getIsSetShow=function(){return b};
this.setIsSetShow=function(a){b=a};this.setVisible=function(b){a.setVisible(b)};this.bringElementToFront=function(){var b=a.getElement(),c=b.parentNode;c.removeChild(b);c.appendChild(b)};this.removeElement=function(){var b=a.getElement();b.parentNode.removeChild(b)};this.getString=function(){return(a.getName?a.getName():"")+b};this.getEntry=function(){return a}}var k=this,m=new Set({getEntryId:function(a){return a.getId()}}),l=h.element;this.show=function(a){var b=m.getById(a.getId());b&&(b.setIsSetShow(!0),
m.each(function(a){return a.setVisible(a==b)}),d(b))};this.hide=function(b){b=m.getById(b.getId());b.setVisible(!1);b.setIsSetShow(!1);(b=a(b))&&d(b)};this.add=function(a){if(!m.containsId(a.getId())){a.addEventListener("show",g);a.addEventListener("show",f);var c=new b(a);m.add(c);l.appendChild(a.getElement())}};this.remove=function(b){if(b=m.getById(b.getId()))m.remove(b),b.removeElement(),a(b)};this.getTopEntry=function(){return m.getByIndex(m.count()-1)}}},ConnectedImage=function(){function h(a,
c){if(a=f[a])return a[c]}function g(a,c,b){var d=f[a];d?(a=d[c])?0>a.indexOf(b)&&a.push(b):d[c]=[b]:f[a]={id:[b]}}var f={},d=function(a){console.log(a);var c=a.id,b=a.type,d={connectedImage:this,set:function(a){e.src=a}},m=a.def;a=a.url;var l=E.DIV();l.classList.add("connected-image");var e=E.IMG();l.appendChild(e);var p=0;e.onerror=function(a){2>p++&&(e.src=m)};e.src=a?a:m;this.getElement=function(){return l};this.dispose=function(){var a=h(b,c);if(a){var e=a.indexOf(d);0>e||(a.splice(e,1),0<a.length||
(delete f[b][c],2>Object.keys(f[b]).length&&delete f[b]))}};g(b,c,d)};d.update=function(a,c,b){(a=h(a,c))&&each(a,function(a){a.set(b)})};return d}(),RoomImage=new function(){return function(h){return new ConnectedImage({def:"/images/room-default.gif",type:"room-image",id:h})}};
function PmsOpenHistory(h){function g(){var b=[];each(c.getEntries(),function(a){b.push(a.toJSON())});a.set("listUsers",b)}var f="PmsOpenHistory_"+d,d=h.userMeId,a=new Settings(f),c=new Set({getEntryId:function(a){return a.getId()}});new TabPortal({id:f});this.add=function(a){c.add(a);g()};this.remove=function(a){c.remove(a);g()};this.getUsers=c.getEntries;(function(){var b=a.get("listUsers");b?each(b,function(a){a=User.fromJSON(a);c.add(a)}):b=[]})()}
var Pms=function(){return function(h){function g(a){var b=c(a.getId());l.showRoom({id:b,name:"PM with "+a.getUsername(),isPm:!0,userTo:a});m.dispatchEvent({type:"showingpm",user:a})}function f(a){x.remove(a);a=c(a.getId());(a=l.getById(a))&&a.close()}function d(a){var b=a.message;console.log(a);switch(b.type){case "add":g(User.fromJSON(b.userTo));break;case "remove":f(User.fromJSON(b.userTo))}}function a(a){r&&r.sendMessage({type:"remove",userTo:a.toJSON()})}function c(a){return"pm_"+String(a)}function b(a){m.dispatchEvent({type:"addnotification",
notification:a})}function k(a){m.dispatchEvent({type:"addclosed",userTo:a})}EventEnabledBuilder(this);var m=this,l=h.rooms,e=h.getUserMe,p=h.getUserById,t=h.getOpenRoom,x,r;this.showPmWithUser=function(a){g(a);r&&r.sendMessage({type:"add",userTo:a.toJSON()});OnlineIndicators.setHasPm(a.getId(),!1)};this.closePmWithUser=function(b){f(b);a(b)};this.incomingMessage=function(a){var d=c(a.userId);d=l.getById(d);console.log(a);var f=a.message.userId!=e().getId(),g=!d||d!=t();f&&g&&(OnlineIndicators.setHasPm(a.userId,
!0),Notifier.show("Pm from "+a.message.username));d?d.incomingMessage(a.message):b(Notification.pmNotificationFromJSON(a.message))};this.incomingMessages=function(a){var d=l.getById(c(a.userId));d?d.incomingMessages(a.messages):b(Notification.pmNotificationFromJSON(a.message))};this.videoOfferFail=function(a){var b=l.getById(c(a.userToId));b&&b.videoOfferFail(a)};this.videoOffer=function(a){console.log(a);var b=l.getById(c(a.userFromId));b?(a.userFrom=p(a.userFromId),b.videoOffer(a)):m.dispatchEvent({type:"videoofferrejected",
userToId:a.userFromId,reason:VideoOfferRejectedReasons.PM_NOT_OPEN})};this.videoAcceptFail=function(a){var b=l.getById(c(a.userToId));b&&b.videoAcceptFail(a)};this.videoAccept=function(a){var b=l.getById(c(a.userFromId));b&&b.videoAccept(a.accept)};this.videoIceCandidate=function(a){console.log("video ice candidate");console.log(a);var b=l.getById(c(a.userFromId));console.log("roomId is: ");console.log(c(a.userFromId));console.log(b);b&&(console.log("video ice candidate b"),b.videoIceCandidate(a.candidate))};
this.load=function(a){x=new PmsOpenHistory({userMeId:a});r=new TabPortal({id:"PmsMenu_"+a});r.addEventListener("message",d);a=x.getUsers();each(a,k)};this.videoOfferRejected=function(a){var b=l.getById(c(a.userFromId));b&&b.videoOfferRejected(a)};l.addEventListener("showpm",function(a){console.log("called");m.showPmWithUser(a.user)});l.addEventListener("sendpm",function(a){return m.dispatchEvent(a)});l.addEventListener("getpms",function(a){return m.dispatchEvent(a)});l.addEventListener("createdroom",
function(a){a=a.room;a.isPm()&&(a=a.getUserTo())&&(m.dispatchEvent({type:"add",userTo:a}),x.add(a))});l.addEventListener("destroyedroom",function(b){b=b.room;b.isPm()&&(b=b.getUserTo())&&(m.dispatchEvent({type:"remove",userTo:b}),x.remove(b),a(b))})}}(),PmEntry=new function(){function h(g){EventEnabledBuilder(this);var f=this,d=g.userImage,a=g.buttonClose,c=new OnlineIndicatorUI(OnlineIndicators.get(g.userId)),b=E.DIV();b.classList.add("pm-entry");var h=E.DIV();h.classList.add("inner");b.appendChild(h);
var m=E.DIV();m.classList.add("username");h.appendChild(d.getElement());h.appendChild(m);h.appendChild(a.getElement());h.appendChild(c.getElement());m.innerHTML=g.name;b.title="Open PM with "+g.name;this.getElement=function(){return b};this.dispose=function(){d.dispose();c.dispose()};this.parentWidth=function(a){b.style.width=200>a?"100%":400>=a?"50%":600>=a?"33.3%":"25%"};h.addEventListener("click",function(){f.dispatchEvent({type:"click"})})}return function(g){console.log(g);console.log(Error().stack);
EventEnabledBuilder(this);var f=this,d=g.userTo;g=new Button({className:"button-close",preventPropagation:!0});var a=new UserImage({userId:d.getId(),username:d.getUsername(),image:d.getImage()});a=new h({userImage:a,name:d.getUsername(),buttonClose:g,userId:d.getId()});this.getId=function(){return d.getId()};this.getUsername=function(){return d.getUsername()};this.getElement=a.getElement;this.setVisible=a.setVisible;this.parentWidth=a.parentWidth;this.dispose=a.dispose;a.addEventListener("click",
function(){f.dispatchEvent({type:"showpm",user:d})});g.addEventListener("click",function(){f.dispatchEvent({type:"closepm",user:d,pmEntry:f})})}},PmsMenu=new function(){function h(g){function f(){var a=m.clientWidth;each(h(),function(b){b.parentWidth(a)});b()}var d=g.popup,a=window.isMobile?d.getElement():E.DIV(),c=g.buttonClose,b=g.onResized,h=g.getEntries,m=E.DIV();g=E.DIV();var l=E.DIV();if(window.isMobile){document.body.appendChild(d.getElement());var e=new Heading({title:"&nbsp;Pms "}),p=E.DIV();
p.classList.add("heading-wrapper");e.getEntries().appendChild(c.getElement());p.appendChild(e.getElement());l.appendChild(p)}l.classList.add("pms-menu-inner");a.classList.add("pms-menu");g.classList.add("entries-wrapper");m.classList.add("entries");g.appendChild(m);l.appendChild(g);a.appendChild(l);this.getElement=function(){return a};this.setVisible=function(a){m.style.display=a?"block":"none"};this.getEntries=function(){return m};this.show=function(){d.show();f()};this.checkResized=function(){t.manual(!0)};
var t=ResizeManager.add({element:a,onResized:f,staggered:!0});t.manual(!0);this.resize=f}ImagePreloader.preloadRange(["/images/close.jpg","/images/close-hover.jpg"]);return function(g){function f(b){b=new PmEntry({userTo:b.userTo});b.parentWidth(l.getElement().clientWidth);b.addEventListener("showpm",a);b.addEventListener("closepm",c);p.addEntry(b);l.checkResized()}function d(a){a&&(p.removeEntry(a),l.checkResized(),a.dispose())}function a(a){e.showPmWithUser(a.user);k&&k.hide()}function c(a){p.removeEntry(a.pmEntry);
l.checkResized();e.closePmWithUser(a.user)}EventEnabledBuilder(this);var b=this,k=window.isMobile?new Popup({}):void 0,m=window.isMobile?new Button({className:"button-close"}):void 0,l=new h({popup:k,buttonClose:m,getEntries:function(){return p.getEntries()},onResized:function(){b.dispatchEvent({type:"resized"})}}),e=g.pms,p=new SortedFilteredEntries({getEntryId:function(a){return a.getId()},element:l.getEntries(),compare:function(a,b){return a.getUsername()>b.getUsername()}});this.getElement=l.getElement;
this.setVisible=l.setVisible;this.show=l.show;this.clear=function(){each(p.getEntries().slice(),d)};this.resize=l.resize;e.addEventListener("add",function(a){f(a)});e.addEventListener("remove",function(a){if(a=p.getByEntryId(a.userTo.getId()))a.dispose(),d(a)});e.addEventListener("addclosed",function(a){f(a)});m&&m.addEventListener("click",k.hide)}},RoomEntry=new function(){function h(g){function f(a){b.innerHTML="("+(a?a:0)+")"}var d=E.DIV();d.title=g.name;d.classList.add("room-entry");var a=E.DIV();
a.classList.add("inner");a.appendChild(g.roomImage.getElement());d.appendChild(a);var c=E.DIV();c.classList.add("name");c.innerHTML=g.name;a.appendChild(c);var b=E.DIV();b.classList.add("n-users");c.appendChild(b);f(g.nUsers);this.update=function(a){f(a.nUsers)};this.getElement=function(){return d};this.parentWidth=function(a){d.style.width=200>a?"100%":400>=a?"50%":600>=a?"33.3%":"25%"}}return function(g){EventEnabledBuilder(this);var f=this,d=new RoomImage,a=new h({name:g.name,roomImage:d,nUsers:g.nUsers});
this.getId=function(){return g.id};this.getName=function(){return g.name};this.getElement=a.getElement;this.parentWidth=a.parentWidth;a.getElement().addEventListener("click",function(){f.dispatchEvent({type:"selected",roomInfo:g})});this.dispose=d.dispose;this.update=a.update}},Room=new function(){function h(g){function f(a){p.setOn(!0);C.setVisible(!0)}function d(){p.setOn(!1);C.setVisible(!1)}function a(a){a=Message.error({message:a.message});t(a)}EventEnabledBuilder(this);var c=this,b=!1,h=g.buttonSend,
m=g.buttonExit,l=g.buttonEmoticons,e=g.buttonClose,p=g.buttonVideoPmStart,t=g.addMessage,x=g.videoFeed,r=g.videoPmOfferRejected;g=g.spinner;var n=E.DIV();n.classList.add("room");var u=E.DIV();u.classList.add("top");var q=E.DIV();q.classList.add("bottom");var w=E.DIV();w.classList.add("feed");var B=E.DIV();B.classList.add("menu");var A=E.TEXT();A.classList.add("text");if(x){x=new VideoFeedUI(x);var F=new SplitPane({nPanelsWidth:1,nPanelsHeight:2,rowProfiles:[{height:"200px"}]});var G=F.getPanelXY(0,
0).getElement();var C=F.getPanelRow(0);G.classList.add("video-feed-panel");G.appendChild(x.getElement());u.appendChild(F.getElement());F.getPanelXY(0,1).getElement().appendChild(w);d();(new Task(F.resize)).run();x.addEventListener("show",f);x.addEventListener("hide",d);x.addEventListener("showmessagetouser",a);x.addEventListener("offerrejected",r)}else u.appendChild(w);n.appendChild(u);n.appendChild(q);n.appendChild(g.getElement());q.appendChild(A);q.appendChild(B);B.appendChild(l.getElement());B.appendChild(h.getElement());
B.appendChild(m.getElement());B.appendChild(e.getElement());p&&B.appendChild(p.getElement());A.addEventListener("keypress",function(a){a||(a=window.events);c.dispatchEvent({type:"keypress",keyCode:a.keyCode||a.which})});this.getElement=function(){return n};this.getFeed=function(){return w};this.setVisible=function(a){b=a;n.style.display=a?"block":"none"};this.getVisible=function(){return b};this.getTextValue=function(){return A.value};this.addMessage=function(a){w.appendChild(a.getElement())};this.removeMessage=
function(a){w.removeChild(a.getElement())};this.insertIntoTextAtCurrentIndex=function(a){var b=A.selectionStart;if(a){if(void 0==b)A.value+=a;else{var c=b+a.length;A.value=A.value.splice(b,0,a);A.selectionStart=A.selectionEnd=c}A.focus()}};this.clearText=function(){A.value=""};this.scrollFeedToBottom=function(){w.scrollTop=w.scrollHeight};this.feedIsAtBottom=function(){return w.scrollTop>=w.scrollHeight-w.offsetHeight-10};this.resize=function(){console.log("Room.UI.resize");F&&F.resize()}}return function(g){function f(a){a.emoticonsParser=
n;a.clickMenuUser=G;a.ignoreManager=F;a.getUserMe=e;O.addReceived(Message.fromJSON(a))}function d(a){var b=I.feedIsAtBottom();O.add(a);b&&I.scrollFeedToBottom()}function a(){A.start()}function c(){O.dispose();m.dispatchEvent({type:"dispose",room:m})}function b(){var a=I.getTextValue();if(""!=a){var b=TrafficLights.isSpam(a);b?(d(Message.error({message:b})),I.clearText()):(b=e(),a=Message.fromTypedString({str:a,userId:b.getId(),username:b.getUsername(),uniqueId:O.nextUniqueId(),emoticonsParser:n,pending:!0,
clickMenuUser:G,getUserMe:e,image:b.getImage()}),console.log(a),m.dispatchEvent(m.isPm()?{type:"sendpm",userToId:m.getUserTo().getId(),message:a}:{type:"sendmessage",message:a,roomId:q}),O.addSending(a),I.clearText(),I.scrollFeedToBottom())}}function k(a){I.insertIntoTextAtCurrentIndex(a.getStringRepresentation())}console.log(g);EventEnabledBuilder(this);var m=this,l=g.send,e=g.getUserMe,p=g.getUserById,t=g.getNDevice,x=g.getSessionId,r=g.showUsersSearch,n=g.emoticonsParser,u=g.name,q=g.id,w=g.isPm,
B=g.userTo;if(w){var A=new VideoFeedPm({userTo:B,getSessionId:x,send:l});this.videoOffer=A.incomingOffer;this.videoAccept=A.incomingAccept;this.videoIceCandidate=A.incomingIceCandidate}var F=g.ignoreManager,G=g.clickMenuUser,C=new Users({getUserById:p}),K=new UsersMenu({name:g.isPm?"PM with "+g.userTo.getUsername():u+" Users",users:C,id:q,ignoreManager:F,clickMenu:G,getUserMe:e,showUsersSearch:r});l=new Button({className:"button-send",text:"Send"});p=new Button({className:"button-emoticons"});x=new Button({className:"button-exit"});
r=new Button({className:"button-close"});u=w?new VideoButton({className:"button-video-pm-start"}):void 0;var H=new Spinner({});H.show();var I=new h({buttonSend:l,buttonEmoticons:p,buttonExit:x,buttonClose:r,buttonVideoPmStart:u,spinner:H,videoFeed:A,addMessage:d,videoPmOfferRejected:function(a){console.log(a);m.dispatchEvent({type:"videopmofferrejected",userToId:B.getId(),reason:a.reason})}}),O=new Messages({getUserId:function(){var a=e();if(a)return a.getId()},element:I.getFeed(),maxNMessages:100,
ignoreManager:F,getNDevice:t});C.addEventListener("missingusers",m.dispatchEvent);this.getId=function(){return g.id};this.getName=function(){return g.name};this.getUsersMenu=function(){return K};this.getUserTo=function(){return g.userTo};this.isPm=function(){return w};this.incomingMessage=function(a){var b=I.feedIsAtBottom();f(a);b&&I.scrollFeedToBottom()};this.incomingMessages=function(a){var b=I.feedIsAtBottom();each(a,function(a){f(a)});b&&I.scrollFeedToBottom();H.hide()};O.addEventListener("showpm",
function(a){m.dispatchEvent(a)});this.join=function(a){C.contains(a)||C.add(a)};this.leave=function(a){C.contains(a)&&C.remove(a)};this.close=c;this.getUsers=function(){return C};this.getElement=I.getElement;this.setVisible=function(a){var b=I.getVisible();!b&&a?K.show():b&&!a&&K.hide();I.setVisible(a);a&&(new Task(function(){I.resize();I.scrollFeedToBottom()})).run()};this.getVisible=I.getVisible;this.videoOfferFail=function(a){A.stop();Dialog.show({message:"Starting video chat with "+B.getUsername()+
" failed as they are offline!",buttons:[{text:"OK"}]})};this.videoOfferRejected=function(a){A.stop();Dialog.show({message:a.reason,buttons:[{text:"OK"}]})};this.resize=I.resize;l.addEventListener("click",b);p.addEventListener("click",function(){m.dispatchEvent({type:"showemoticons",picked:k})});r.addEventListener("click",c);x.addEventListener("click",function(){m.dispatchEvent({type:"hide",room:m})});u&&u.addEventListener("click",a);I.addEventListener("keypress",function(a){if("13"==a.keyCode)return b(),
!1});(new Task(function(){m.dispatchEvent(m.isPm()?{type:"getpms",userToId:m.getUserTo().getId()}:{type:"getmessages",roomId:q});m.dispatchEvent({type:"getuserids",roomId:q});m.isPm()&&(C.add(g.userTo),C.add(e()))})).run()}};
window.RoomCreation=function(h){window.EventEnabledBuilder(this);var g=this,f=h.sendMessage,d=h.getSessionId;this.create=function(a){f({type:"create_room",name:a.name,sessionId:d()})};this.incomingCreateRoom=function(a){console.log(a);a.successful?g.dispatchEvent({type:"created",roomInfo:a.room}):g.dispatchEvent({type:"failed",message:a.message})}};
function RoomCreationMenuUI(h){EventEnabledBuilder(this);var g=new window.StandardMenu({title:"Create Room",classNames:["room-creation-menu"]}),f=new window.Spinner({preventInterraction:!0}),d=g.getElement(),a=window.E,c=a.TEXT(),b=a.DIV();a=new window.Button({className:"button-create",text:"Create"});c.placeholder="Name";c.classList.add("name");b.classList.add("error");var k=g.getEntries();k.appendChild(c);k.appendChild(a.getElement());k.appendChild(b);d.appendChild(f.getElement());this.show=g.show;
this.hide=g.hide;a.addEventListener("click",function(a){h.create({name:c.value})});h.addEventListener("created",function(a){g.hide()});h.addEventListener("failed",function(a){a=a.message;b.style.display=a?"block":"none";b.innerHTML=a})}
var SeenNotificationsManager=new function(){return function(h){var g=h.getSessionId,f=h.mysocket,d=new TemporalCallback({delay:4E3,callback:function(){console.log("sending seen notifications");var c=[],b;for(b in a)c.push(a[b]);f.send({type:"seen_notifications",seens:c,sessionId:g()});a={}},maxNTriggers:5,maxTotalDelay:15E3}),a={};this.seen=function(c){c=c.getId();a[c]||(a[c]={userToId:c,seenAt:(new Date).toISOString()});d.trigger()}}},NotificationsButton=function(){function h(g){g=g.button.getElement();
var f=E.DIV(),d=E.DIV();f.appendChild(d);f.classList.add("count");d.classList.add("text");g.appendChild(f);this.setCount=function(a){d.innerHTML=9<a?"!":String(a)}}return function(g){function f(){c.setCount(a.getCount())}var d=new Button({classNames:["button-notifications"]}),a=g.notifications,c=new h({button:d});a.addEventListener("added",f);a.addEventListener("removed",f);f();return d}}(),Notification=function(){var h=function(g){console.log(g);EventEnabledBuilder(this);var f=this;this.getNotificationType=
function(){return g.notificationType};this.getIsPm=function(){return"pm"==f.getNotificationType()};this.getUsername=function(){return g.username};this.getImage=function(){return g.image};this.getId=function(){return g.id};this.seen=function(){f.dispatchEvent({type:"seen",notification:f})}};h.PM="pm";h.pmNotificationFromJSON=function(g){return new h({notificationType:"pm",username:g.username,id:g.userId})};return h}(),Notifications=function(){return function(){function h(d){f.dispatchEvent({type:"removed",
notification:d})}EventEnabledBuilder(this);var g=new Set({getEntryId:function(d){return d.getId()}}),f=this;this.add=function(d){g.add(d)&&f.dispatchEvent({type:"added",notification:d})};this.remove=function(d){g.remove(d)&&h(d)};this.removeById=function(d){if(d=g.getById(d))g.remove(d),h(d)};this.clear=function(){var d=g.getEntries().slice();each(d,f.remove)};this.getById=g.getById;this.getCount=g.count}}(),NotificationEntry=function(){function h(g){EventEnabledBuilder(this);var f=this,d=g.userImage,
a=g.buttonClose,c=g.userId;g=g.text;var b=E.DIV();b.classList.add("notification-entry");var h=E.DIV();h.classList.add("inner");b.appendChild(h);var m=new OnlineIndicatorUI(OnlineIndicators.get(c));c=E.DIV();c.classList.add("username");h.appendChild(d.getElement());h.appendChild(c);h.appendChild(a.getElement());h.appendChild(m.getElement());c.innerHTML=g;this.getElement=function(){return b};this.parentWidth=function(a){b.style.width=200>a?"100%":400>=a?"50%":600>=a?"33.3%":"25%"};this.dispose=function(){d.dispose();
m.dispose()};h.addEventListener("click",function(){f.dispatchEvent({type:"click"})})}return function(g){function f(){d.dispatchEvent({type:"dispose",notification:g,notificationEntry:d})}EventEnabledBuilder(this);var d=this,a=g.getIsPm(),c=new Button({className:"button-close",preventPropagation:!0}),b=new UserImage({userId:g.getId(),username:g.getUsername()});b=new h({userImage:b,buttonClose:c,text:"PM from "+g.getUsername(),isPm:a,userId:a?g.getId():void 0});this.getElement=b.getElement;this.getId=
g.getId;this.parentWidth=b.parentWidth;a&&(b.addEventListener("click",function(){d.dispatchEvent({type:"showpm",user:User.fromPmNotification(g),isNotification:!0});g.seen();f()}),c.addEventListener("click",f),this.dispose=b.dispose)}}(),NotificationsMenu=function(){function h(g){function f(){var a=h.clientWidth;each(b(),function(b){console.log(b);b.parentWidth(a)})}var d=g.popup,a=g.buttonClose,c=d.getElement(),b=g.getEntries;c.classList.add("notifications-menu");var h=E.DIV();g=E.DIV();var m=new Heading({title:"&nbsp;PM Notifications"}),
l=E.DIV(),e=E.DIV();e.classList.add("notifications-menu-inner");h.classList.add("entries");g.classList.add("entries-wrapper");l.classList.add("heading-wrapper");m.getEntries().appendChild(a.getElement());l.appendChild(m.getElement());e.appendChild(l);e.appendChild(g);g.appendChild(h);c.appendChild(e);this.show=function(){d.show();f()};this.hide=d.hide;this.addEntry=function(a){h.appendChild(a.getElement())};this.removeEntry=function(a){h.removeChild(a.getElement())};this.getElement=function(){return c};
this.getEntries=function(){return h};ResizeManager.add({element:c,onResized:f,staggered:!0}).manual(!0)}return function(g){function f(a){c.dispatchEvent(a);l&&l.hide()}function d(a){m.seen(a.notification)}function a(a){a.notificationEntry.dispose();b.remove(a.notification)}EventEnabledBuilder(this);var c=this,b=g.notifications,k=g.pms,m=g.seenNotificationsManager,l=new Popup({});g=new Button({className:"button-close"});var e=new h({popup:l,buttonClose:g,getEntries:function(){return p.getEntries()}}),
p=new SortedFilteredEntries({compare:function(a,b){},getEntryId:function(a){return a.getId()},element:e.getEntries()});this.show=e.show;this.hide=e.hide;this.getElement=e.getElement;g.addEventListener("click",l.hide);b.addEventListener("added",function(b){b=b.notification;b.addEventListener("seen",d);b=new NotificationEntry(b);b.addEventListener("showpm",f);b.addEventListener("dispose",a);p.addEntry(b)});b.addEventListener("removed",function(a){console.log(a);p.removeEntryById(a.notification.getId())});
k.addEventListener("showingpm",function(a){a=a.user.getId();if(a=b.getById(a))b.remove(a),m.seen(a)})}}(),MessageComponents=new function(){this.Text=function(h){this.getString=function(){return h};this.getElement=function(){return document.createTextNode(h)};this.TYPE="text"};this.Text.TYPE="text";this.Emoticon=function(h){this.getElement=function(){if(h.isCharacter())return document.createTextNode(h.getStringRepresentation());var g=E.IMG();g.classList.add("emoticon");g.src=h.getImageSource();return g};
this.TYPE="emoticon"};this.Emoticon.TYPE="emoticon"};
function MessageUI(h){function g(a){a=moment.utc(a).local();var b=moment();moment.duration(b.diff(a));var c=moment().startOf("day");b=a.format("HH:mm:ss");if(0<=a.diff(c,"seconds"))return b;c=c.diff(a,"seconds");if(604800>c)return a=a.format("dddd")+" at "+b,518400>c?a:"last "+a;b=a.isSame(new Date,"year");c=a.format("Do")+" "+a.format("MMMM");return b?c:c+" "+a.year()}EventEnabledBuilder(this);var f=this,d=h.components,a=h.username,c=h.userImage,b=h.sentAt,k=h.messageType,m=E.DIV();m.classList.add("message");
var l=E.DIV();l.classList.add("inner");var e=E.DIV();e.classList.add("username-and-timestamp");var p=E.DIV();p.classList.add("username");if(h.pending){var t=E.DIV();t.classList.add("pending");m.appendChild(t)}e.appendChild(p);h=E.DIV();h.classList.add("timestamp");e.appendChild(h);switch(k){case Message.ERROR:m.classList.add("error");h.innerHTML=" ("+g(new Date)+")";break;default:l.appendChild(c.getElement()),p.innerHTML+=a&&0<a.length?a:"&nbsp;",b&&(h.innerHTML=" ("+g(b)+")")}l.appendChild(e);each(d,
function(a){l.appendChild(a.getElement())});m.appendChild(l);this.getElement=function(){return m};this.getUsername=function(){return e};this.setVisible=function(a){m.style.display=a?"inline-block":"none"};this.hidePending=function(){t&&m.removeChild(t)};p.addEventListener("click",function(a){f.dispatchEvent({type:"showusermenu",left:a.clientX,top:a.clientY})})}
var Message=function(){function h(f,d){d||(d="");var a=f.emoticonsParser,c=[],b=new MessageComponents.Text(d);a?a.pipe(b,function(a){c.push(a)}):c=[b];return new Message({userId:f.userId,username:f.username,uniqueId:f.uniqueId,components:c,content:d,serverAssignedNMessage:f.serverAssignedNMessage,pending:f.pending,clickMenuUser:f.clickMenuUser,ignoreManager:f.ignoreManager,getUserMe:f.getUserMe,image:f.image,sentAt:f.sentAt,messageType:f.messageType})}var g=function(f){function d(){B||(B=new MessageUI({userImage:r,
components:p,username:e,pending:f.pending,sentAt:h.getSentAtUTC(),messageType:q}),B.addEventListener("showusermenu",a));return B}function a(a){l!=u().getId()&&(x.setPosition(a),x.show({options:[{text:"Pm "+e,callback:c},{text:(w?"Unignore ":"Ignore ")+e,callback:w?g:b}]}))}function c(){h.dispatchEvent({type:"showpm",user:User.fromMessage(h)})}function b(){n.ignoreUserByIdAndUsername({id:l,username:e})}function g(){n.unignoreUserById(l)}EventEnabledBuilder(this);var h=this,l=f.userId,e=f.username,
p=f.components,t=f.content,x=f.clickMenuUser,r=new UserImage({userId:l,image:f.image}),n=f.ignoreManager,u=f.getUserMe,q=f.messageType?f.messageType:"user",w=!1,B;this.getElement=function(){return d().getElement()};this.getUniqueId=function(){return f.uniqueId};this.getImage=function(){return f.image};this.getUserId=function(){return f.userId};this.getUsername=function(){return f.username};this.getSentAtUTC=function(){return f.sentAt?moment(f.sentAt):void 0};this.getServerAssignedNMessage=function(){return f.serverAssignedNMessage};
this.getMessageType=function(){return q};this.confirm=function(a){f.serverAssignedNMessage=a.getServerAssignedNMessage();d().hidePending()};this.toJSON=function(){return{content:t,userId:l,uniqueId:f.uniqueId}};this.dispose=function(){r.dispose()};this.setIgnored=function(a){w=a;console.log("updateVisibility"+w);d().setVisible(!w)};this.getIgnored=function(){return w}};g.ERROR="error";g.USER="user";g.fromJSON=function(f){return h(f,f.content)};g.fromTypedString=function(f){f.sentAt=moment().format();
return h(f,f.str)};g.error=function(f){f.messageType="error";return h(f,f.message)};return g}(),Messages=new function(){var h=0;return function(g){function f(b){b.addEventListener("showpm",a);p.push(b);t[b.getUniqueId()]=b;e.appendChild(b.getElement())}function d(b){var c=p.indexOf(b);0>c||(p.splice(c,1),delete t[b.getUniqueId()],e.removeChild(b.getElement()),b.removeEventListener("showpm",a))}function a(a){k.dispatchEvent(a)}function c(a){p.where(function(b){return b.getUserId()==a.userId}).each(function(a){return a.setIgnored(!0)})}
function b(a){p.where(function(b){return b.getUserId()==a.userId}).each(function(a){return a.setIgnored(!1)})}EventEnabledBuilder(this);var k=this,m=g.getNDevice,l=g.ignoreManager,e=g.element,p=[],t={},x=new OverflowManager({getMessages:function(){return p},remove:d,maxNMessages:g.maxNMessages});this.addSending=function(a){f(a);x.trigger()};this.addReceived=function(b){console.log(t);console.log(b.getUniqueId());var c=t[b.getUniqueId()];if(c)c.confirm(b);else a:if(t[b.getUniqueId()]=b,b.addEventListener("showpm",
a),1>p.length)p.push(b),e.appendChild(b.getElement());else{var d=b.getServerAssignedNMessage();for(c=new ReverseIterator(p);c.hasNext();){var f=c.next();console.log("placedMessage.getServerAssignedNMessage() "+f.getServerAssignedNMessage());console.log("serverAssignedNMessage "+d);if(f.getServerAssignedNMessage()<d){console.log("placing");if(c.hasPrevious()&&(console.log("reverseIterator.hasPrevious()"),d=c.previous().getElement().nextSibling)){e.insertBefore(b.getElement(),d);c.insertAfter(b);break a}console.log("element.appendChild(message.getElement());");
e.appendChild(b.getElement());c.append(b);break a}}console.log("element.insertBefore(message.getElement(), messages[0].getElement());");e.insertBefore(b.getElement(),p[0].getElement());c.insert(b)}l.userIdIsIgnored(b.getUserId())&&b.setIgnored(!0);x.trigger()};this.add=function(a){t[a.getUniqueId()]=a;f(a)};this.remove=function(a){d(a)};this.nextUniqueId=function(){return m()+"_"+h++};this.dispose=function(){each(p,function(a){a.dispose()});l.removeEventListener("ignored",c);l.removeEventListener("unignored",
b)};l.addEventListener("ignored",c);l.addEventListener("unignored",b)}},EmoticonsLibrary={defaultFolder:"/emoji/",folders:{folderName:"/path"},emoticons:[{strings:[":)","/smile",":smile:"],file:"smiley.png"},{strings:[":p",":P","/tongue",":tongue:"],file:"stuck_out_tongue.png"},{strings:[":D",":d","/grin",":grin:"],file:"grinning.png"},{strings:["/kiss",":kiss:",":*",":-*"],file:"kissing_heart.png"},{strings:[":cry:",":'",":,("],file:"cry.png"},{strings:["/shocked",":shocked:","anguished,",":O",":O"],
file:"anguished.png"},{strings:["/blush",":blush:"],file:"blush.png"},{strings:"/speachless /shocked :speachless: :shocked: :O :o".split(" "),file:"open_mouth.png"},{strings:["/laugh",":laugh:"],file:"laughing.png"},{strings:["/angry",":angry:"],file:"angry.png"},{strings:["/anguished",":anguished:"],file:"anguished.png"},{strings:["/disappointed",":disappointed:"],file:"disappointed.png"},{strings:["/frowning",":frowning:"],file:"frowning.png"},{strings:["/heart eyes",":heart eyes:"],file:"heart_eyes.png"},
{strings:["/innocent eyes",":innocent:"],file:"innocent.png"},{strings:["/laughing",":laughing:"],file:"laughing.png"},{strings:["/mask",":mask:"],file:"mask.png"},{strings:["/neutral",":neutral:"],file:"neutral_face.png"},{strings:["/imp",":imp:"],file:"smiling_imp.png"},{strings:["/rage",":rage:"],file:"rage.png"},{strings:["/scream",":scream:"],file:"scream.png"},{strings:["/sleeping",":sleeping:"],file:"sleeping.png"},{strings:["/smirk",":smirk:"],file:"smirk.png"},{strings:["/sunglasses",":sunglasses:"],
file:"sunglasses.png"},{strings:["/unamused",":unamused:"],file:"unamused.png"},{strings:["/wink",":wink:"],file:"wink.png"},{strings:["/yum",":yum:"],file:"yum.png"},{strings:[":/","/confused",":confused:"],file:"confused.png"},{strings:["/alien",":alien:"],file:"alien.png"},{strings:["/poop",":poop:","/hankey",":hankey:"],file:"hankey.png"},{strings:["/heart",":heart:"],file:"heart.png"},{strings:["/broken heart",":broken heart:"],file:"broken_heart.png"},{strings:["/dog",":dog:"],file:"dog.png"},
{strings:["/bear",":bear:"],file:"bear.png"},{strings:["/cat",":cat:"],file:"cat.png"},{strings:["/chick",":chick:"],file:"baby_chick.png"},{strings:["/chicken",":chicken:"],file:"chicken.png"},{strings:["/cow",":cow:"],file:"cow.png"},{strings:["/fish",":fish:"],file:"fish.png"},{strings:["/dolphin",":dolphin:"],file:"dolphin.png"},{strings:["/frog",":frog:"],file:"frog.png"},{strings:["/ghost",":ghost:"],file:"ghost.png"},{strings:["/hamster",":hamster:"],file:"hamster.png"},{strings:["/horse",
":horse:"],file:"horse.png"},{strings:["/koala",":koala:"],file:"koala.png"},{strings:["/mouse",":mouse:"],file:"mouse.png"},{strings:["/penguin",":penguin:"],file:"penguin.png"},{strings:["/pig",":pig:"],file:"pig.png"},{strings:["/rabbit",":rabbit:"],file:"rabbit.png"},{strings:["/bear",":bear:"],file:"bear.png"},{strings:["/snake",":snake:"],file:"snake.png"},{strings:["/whale",":whale:"],file:"whale.png"},{strings:["/wolf",":wolf:"],file:"wolf.png"},{strings:["/cookie",":cookie:"],file:"cookie.png"},
{strings:["/coffee",":coffee:"],file:"coffee.png"},{strings:["/banana",":banana:"],file:"banana.png"},{strings:["/bread",":bread:"],file:"bread.png"},{strings:["/cake",":cake:"],file:"cake.png"},{strings:["/chocolate",":chocolate:"],file:"chocolate_bar.png"},{strings:["/fries",":fries:"],file:"fries.png"},{strings:["/apple",":apple:"],file:"apple.png"},{strings:["/hamburger",":hamburger:"],file:"hamburger.png"},{strings:["/icecream",":icecream:"],file:"icecream.png"},{strings:["/lollipop",":lollipop:"],
file:"lollipop.png"},{strings:["/strawberry",":strawberry:"],file:"strawberry.png"},{strings:["/watermelon",":watermelon:"],file:"watermelon.png"},{strings:["/wine",":wine:"],file:"wine_glass.png"},{strings:["/smoking",":smoking:"],file:"smoking.png"},{strings:["/uk",":uk:"],file:"uk.png"},{strings:["/us",":us:"],file:"us.png"},{strings:["/car",":car:"],file:"car.png"},{strings:["/train",":train:"],file:"steam_locomotive.png"},{strings:["/bus",":bus:"],file:"bus.png"},{strings:["/lorry",":lorry:"],
file:"articulated_lorry.png"},{strings:["/taxi",":taxi:"],file:"taxi.png"},{strings:["/bank",":bank:"],file:"bank.png"},{strings:["/church",":church:"],file:"church.png"},{strings:["/hotel",":hotel:"],file:"hotel.png"},{strings:["/hospital",":hospital:"],file:"hospital.png"},{strings:["/convenience",":convenience:"],file:"convenience_store.png"},{strings:["/money",":money:"],file:"dollar.png"},{strings:["/pound",":pound:"],file:"pound.png"},{strings:["/moneybag",":moneybag:"],file:"moneybag.png"}]};
function EmoticonInfo(h){var g=this;this.isCharacter=function(){return g.getCharacter()?!0:!1};this.getCharacter=function(){return h.character};this.getImageSource=function(){return h.imageSource};this.getStringRepresentation=function(){return g.isCharacter()?g.getCharacter():h.strings[0]}}
var EmoticonsParser=function(){return function(h){function g(d,a){if(!(1>d.length)){var c=f;each(d,function(a){var b=c[a];b?c=b:(b={},c=c[a]=b)});c.emoticonInfo=a}}var f={};(function(d){each(d.emoticons,function(a){var c=new EmoticonInfo(a);a.strings&&each(a.strings,function(a){g(a,c)})})})(h.emoticonsLibrary);this.pipe=function(d,a){if(d.TYPE!=MessageComponents.Text.TYPE)a(d);else{d=d.getString();for(var c={value:0},b=d.length,g=0;c.value<b;){var h=f[d[c.value]];if(h){var l=c.value;a:{var e=void 0;
for(var p=c,t=b,x=d;;){p.value++;h.emoticonInfo&&(e=h.emoticonInfo);if(p>=t)break a;h=h[x[p.value]];if(!h)break a}}e&&(l>g&&a(new MessageComponents.Text(d.substring(g,l))),a(new MessageComponents.Emoticon(e)),g=c.value)}else c.value++}c.value>g&&a(new MessageComponents.Text(d.substring(g,c.value)))}}}}(),EmoticonEntry=function(){function h(g){var f=E.IMG();f.src=g.getImageSource();f.addEventListener("error",function(){f.style.display="none"});this.getElement=function(){return f}}return function(g){var f=
this;EventEnabledBuilder(this);var d=E.DIV();d.classList.add("emoticon-entry");var a=g.emoticonInfo;a.isCharacter()?d.innerHTML=a.getCharacter():(g=new h(a),d.appendChild(g.getElement()));d.addEventListener("click",function(){f.dispatchEvent({type:"selected",emoticonInfo:a})});this.getElement=function(){return d}}}(),Emoticons=function(){function h(g){var f=g.popup.getElement();f.classList.add("emoticons");var d=E.DIV();d.classList.add("entries");f.appendChild(d);this.addEntry=function(a){d.appendChild(a.getElement())};
this.getElement=function(){return f};this.setVisible=function(a){f.style.display=a?"block":"none"}}return function(g){function f(c){c=c.emoticonInfo;b&&b(c);a.hide()}var d=g.emoticonsLibrary;EventEnabledBuilder(this);var a=new Popup,c=new h({popup:a}),b;this.show=function(c){b=c.picked;a.show()};this.getElement=c.getElement;this.setVisible=c.setVisible;(function(){var a=d.folders,b=d.defaultFolder;each(d.emoticons,function(d){if(!d.character){var e=d.folder&&a?a[d.folder]:b;e+=d.file;d.imageSource=
e}d=new EmoticonEntry({emoticonInfo:new EmoticonInfo(d)});d.addEventListener("selected",f);c.addEntry(d)})})()}}(),RoomsMenu=new function(){function h(g){var f=g.getEntries,d=g.showRoomsSearch;g=g.showRoomCreationMenu;var a=!1,c=E.DIV();c.classList.add("rooms-menu");var b=new Button({className:"button-search"}),h=new Button({className:"button-create"});c.appendChild(h.getElement());c.appendChild(b.getElement());b.addEventListener("click",d);h.addEventListener("click",g);this.getElement=function(){return c};
this.add=function(a){c.appendChild(a.getElement());a.parentWidth&&a.parentWidth(c.clientWidth)};this.remove=function(a){c.removeChild(a)};this.setVisible=function(b){a=b;c.style.display=b?"block":"none"};this.getVisible=function(){return a};this.resize=function(){var a=c.clientWidth;each(f(),function(b){b.parentWidth&&b.parentWidth(a)})}}return function(g){function f(a){a=new RoomEntry(a);b.addEntry(a);c.add(a);a.addEventListener("selected",d);return a}function d(b){a.dispatchEvent({type:"showroom",
roomInfo:b.roomInfo})}EventEnabledBuilder(this);var a=this,c=new h({getEntries:function(){return b.getEntries()},showRoomsSearch:g.showRoomsSearch,showRoomCreationMenu:g.showRoomCreationMenu}),b=new SortedFilteredEntries({getEntryId:function(a){return a.getId()},compare:function(a,b){},element:c.getElement()}),k=g.usersMenu;new Spinner({});this.getId=function(){return"RoomsMenu"};this.set=function(a){var d=[];each(a,function(a){var c=b.getByEntryId(a.id);c?c.update(a):c=f(a);d.push(c.getId())});each(b.getEntries().slice(),
function(a){a=a.getId();0>d.indexOf(a)&&(a=b.getByEntryId(a))&&(a.dispose(),c.remove(a.getElement()))});c.resize()};this.getName=function(){return"roomsmenu"};this.getElement=c.getElement;this.setVisible=function(a){var b=c.getVisible();!b&&a?k.show():b&&!a&&k.hide();c.setVisible(a)};this.clear=b.clear;this.getVisible=c.getVisible;this.resize=c.resize;this.add=function(a){b.containsEntryId(a.id)||f(a)}}},SearchBar=function(){function h(g){var f=g.callbackSearch,d=new TemporalCallback({callback:function(){f(b.value)},
maxTotalDelay:1200,delay:400}),a=E.DIV();g=E.DIV();var c=E.DIV(),b=E.TEXT(),h=E.BUTTON();a.classList.add("search-bar");g.classList.add("search-bar-text-wrapper");c.classList.add("search-bar-button-wrapper");b.classList.add("search-bar-text");h.classList.add("search-bar-button");a.appendChild(g);a.appendChild(c);g.appendChild(b);c.appendChild(h);this.getElement=function(){return a};b.addEventListener("keydown",function(){d.trigger()})}return function(g){EventEnabledBuilder(this);var f=this;this.getElement=
(new h({callbackSearch:function(d){f.dispatchEvent({type:"search",text:d})}})).getElement}}(),RoomsSearch=function(){return function(){function h(a){var b=[];each(a,function(a){if(!c.getByEntryId(a.id)){var d=new RoomEntry(a);c.addEntry(d);d.addEventListener("selected",f)}b.push(a.id)});each(c.getEntries().slice(),function(a){a=a.getId();0>b.indexOf(a)&&(a=c.getByEntryId(a),c.removeEntry(a))})}function g(a){return a.getId()}function f(b){a.hide();d.dispatchEvent({type:"showroom",roomInfo:b.roomInfo})}
EventEnabledBuilder(this);var d=this,a=new StandardSearch({title:"Rooms Search",getEntryId:g,callbackSearch:function(b){!b.text||1>b.text.length||(a.showSpinner(),d.dispatchEvent({type:"search",text:b.text}))},classNames:["rooms-search"]}),c=new SortedFilteredEntries({element:a.getEntries(),getEntryId:g,compare:function(a,c){return a.getName()>c.getName()}});this.show=a.show;this.hide=a.hide;this.incomingRooms=function(b){h(b);a.hideSpinner()}}}(),UsersSearch=function(){return function(h){function g(a){return a.getId()}
function f(a){var b=[];each(a,function(a){b.push(a.id);k.getById(a.id)||k.add(User.fromJSON(a))});each(k.getEntries().slice(),function(a){0>b.indexOf(a.getId())&&k.remove(a)})}EventEnabledBuilder(this);var d=this,a=h.clickMenu,c=h.ignoreManager,b=h.getUserMe,k=new Users({}),m=new StandardSearch({title:"Users Search",getEntryId:g,callbackSearch:function(a){!a.text||1>a.text.length||(d.dispatchEvent({type:"search",text:a.text}),m.showSpinner())},classNames:["users-search"]}),l=new SortedFilteredEntries({element:m.getEntries(),
getEntryId:g,compare:function(a,b){return a.getUsername()>b.getUsername()}});this.show=m.show;this.hide=m.hide;this.incomingUsers=function(a){f(a);m.hideSpinner()};k.addEventListener("add",function(e){l.getByEntryId(e.user.getId())||(e=new UserEntry({user:e.user,clickMenu:a,ignoreManager:c,getUserMe:b}),l.addEntry(e),e.addEventListener("showpm",function(a){d.dispatchEvent(a);d.hide()}))});k.addEventListener("remove",function(a){a=l.getByEntryId(a.user.getId());a.dispose();l.removeEntry(a)})}}(),UserImage=
new function(){function h(f,d){return f?"/images/uploaded/"+f+"_"+d+".jpeg":void 0}var g=function(f){var d=f.userId,a=f.image;f=(f=f.size)?f:"32_32";d=new ConnectedImage({def:"/images/user-default.jpg",type:User.TYPE+"_"+f,id:d,url:h(a,f)});this.getElement=d.getElement;this.dispose=d.dispose};g.LARGE="128_128";g.SMALL="32_32";g.SIZES=["32_32","128_128"];g.update=function(f,d){each(g.SIZES,function(a){var c=h(d,a);c&&ConnectedImage.update(User.TYPE+"_"+a,f,c)})};return g},UserEntry=function(){function h(f){var d=
f.userImage,a=new OnlineIndicatorUI(OnlineIndicators.get(f.userId)),c=E.DIV();c.classList.add("user-entry");var b=E.DIV();b.classList.add("inner");c.appendChild(b);var g=E.DIV();g.classList.add("username");b.appendChild(d.getElement());b.appendChild(g);b.appendChild(a.getElement());c.title=f.name;g.innerHTML=f.name;this.getElement=function(){return c};this.dispose=function(){d.dispose();a.dispose();console.log("disposed")}}var g=function(f){function d(){b.dispatchEvent({type:"showpm",user:g})}function a(){l.ignoreUser(g)}
function c(){l.unignoreUser(g)}EventEnabledBuilder(this);var b=this,g=f.user,m=f.getUserMe,l=f.ignoreManager,e=f.clickMenu;f=new UserImage({userId:g.getId(),username:g.getUsername(),image:g.getImage()});f=new h({name:g.getUsername(),userImage:f,userId:g.getId()});this.getElement=f.getElement;this.getId=function(){return g.getId()};this.getUsername=g.getUsername;this.dispose=f.dispose;f.getElement().addEventListener("click",function(b){e.setPosition({left:b.clientX,top:b.clientY});if(m()!=g){b=l.userIsIgnored(g);
var f=g.getUsername();e.show({options:[{text:"Pm "+f,callback:d},{text:(b?"Unignore ":"Ignore ")+f,callback:b?c:a}]})}})};g.fromIgnored=function(f){return new g(f)};return g}(),UsersMenu=function(){function h(g){var f=g.buttonClose,d=g.buttonSearch,a=!1,c=E.DIV(),b=E.DIV(),h=E.DIV(),m=E.DIV(),l=E.DIV(),e=E.DIV(),p=E.DIV(),t=new SplitPane({nPanelsWidth:1,nPanelsHeight:2,rowProfiles:[{height:"70%",minHeight:"60px"},{minMeight:"60px"}]}),x=t.getPanelXY(0,0).getElement(),r=t.getPanelXY(0,1).getElement();
g=new Heading({title:"&nbsp;"+g.name});var n=new Heading({title:"&nbsp;Ignored "});c.classList.add("users-menu");b.classList.add("users-menu-entries");l.classList.add("users-menu-entries");m.classList.add("heading-wrapper");h.classList.add("user-menu-entries-wrapper");p.classList.add("heading-wrapper");e.classList.add("user-menu-entries-wrapper");m.appendChild(g.getElement());h.appendChild(b);p.appendChild(n.getElement());e.appendChild(l);c.appendChild(t.getElement());x.appendChild(m);x.appendChild(h);
r.appendChild(p);r.appendChild(e);h=g.getEntries();h.appendChild(d.getElement());f&&h.appendChild(f.getElement());this.getEntries=function(){return b};this.getEntriesIgnored=function(){return l};this.getElement=function(){return c};this.resize=t.resize;this.setVisible=function(b){a=b;c.style.display=b?"block":"none";(new Task(t.resize)).run()};this.getVisible=function(){return a}}return function(g){function f(){b.dispatchEvent({type:"hidepopup"})}function d(a,b){return a.getUsername().toLowerCase()>
b.getUsername().toLowerCase()}function a(a){return a.getId()}function c(a){q.getByEntryId(a.getId())||q.addEntry(UserEntry.fromIgnored({user:a,clickMenu:n,ignoreManager:r,getUserMe:t}))}EventEnabledBuilder(this);var b=this,k=g.id,m=g.showUsersSearch;if(window.isMobile){var l=new Button({className:"button-close"});l.addEventListener("click",f)}var e=new Button({className:"button-search"}),p=new h({name:g.name,buttonClose:l,buttonSearch:e}),t=g.getUserMe,x=g.users,r=g.ignoreManager,n=g.clickMenu,u=
new SortedFilteredEntries({compare:d,getEntryId:a,element:p.getEntries(),buttonClose:l}),q=new SortedFilteredEntries({compare:d,getEntryId:a,element:p.getEntriesIgnored()});this.getElement=p.getElement;this.getId=function(){return k};x.addEventListener("add",function(a){u.getByEntryId(a.user.getId())||(a=new UserEntry({user:a.user,clickMenu:n,ignoreManager:r,getUserMe:t}),u.addEntry(a),a.addEventListener("showpm",function(a){console.log("a");b.dispatchEvent(a)}))});x.addEventListener("remove",function(a){a=
u.getByEntryId(a.user.getId());a.dispose();u.removeEntry(a)});r.addEventListener("ignored",function(a){c(a.ignored)});r.addEventListener("unignored",function(a){q.removeEntryById(a.ignored.getId())});this.getVisible=p.getVisible;this.setVisible=p.setVisible;this.show=function(){b.dispatchEvent({type:"show",entry:b})};this.hide=function(){b.dispatchEvent({type:"hide",entry:b})};this.resize=p.resize;this.dispose=p.dispose;e.addEventListener("click",m);(function(){try{each(r.getIgnores(),function(a){c(a)})}catch(w){console.log(w),
r.clearSave()}})()}}(),UsersMenues=function(){function h(g){var f=g.popupElement,d=g.getTopEntry;f?document.body.appendChild(f):f=E.DIV();f.classList.add("users-menues");this.getElement=function(){return f};this.getEntries=function(){return a};var a=E.DIV();a.classList.add("users-menues-entries");f.appendChild(a);this.setVisible=function(c){a.style.display=c?"block":"none"};this.resize=function(){console.log("a");d().getEntry().resize()}}return function(){function g(){c.hide()}function f(a){k.hide(a.entry)}
function d(a){k.show(a.entry)}EventEnabledBuilder(this);var a=this,c;window.isMobile&&(c=new Popup({}));var b=new h({popupElement:window.isMobile?c.getElement():void 0,getTopEntry:function(){return k.getTopEntry()}}),k=new OverlappingEntries({element:b.getEntries()});this.getElement=b.getElement;this.setVisible=b.setVisible;this.add=function(b){k.add(b);b.addEventListener("showpm",function(b){return a.dispatchEvent(b)});b.addEventListener("show",d);b.addEventListener("hide",f);window.isMobile&&b.addEventListener("hidepopup",
g)};this.remove=function(a){k.remove(a)};this.setUsers=function(a){k.set(a)};this.show=function(){c.show();console.log(k.getTopEntry().getEntry());k.getTopEntry().getEntry().resize()};this.resize=b.resize}}(),FileUploader=function(){function h(g){var f=this,d=g.button;EventEnabledBuilder(this);g=g.accept;console.log(g);var a=E.DIV();a.classList.add("file-uploader");var c=E.FILE();c.accept=g;c.type="file";a.appendChild(d.getElement());d.addEventListener("click",function(){c.click()});this.getElement=
function(){return a};this.setVisible=function(b){a.style.display=b?"block":"none"};c.addEventListener("change",function(a){f.dispatchEvent({type:"filechange",files:c.files})});this.clearFile=function(){c.value=""}}return function(g){function f(a){var b=new FileReader;b.onload=function(){d.dispatchEvent({type:"file",dataUrl:b.result,file:a})};b.readAsDataURL(a);c.clearFile()}EventEnabledBuilder(this);var d=this;g=g.accept;var a=new Button({className:"button"}),c=new h({accept:g,button:a});this.getElement=
c.getElement;this.setVisible=c.setVisible;c.addEventListener("filechange",function(a){console.log(a);a=a.files;1>a.length||f(a[0])})}}(),TwoFingerTouch=function(){return function(h){function g(a){f(a.changedTouches[0],a)}function f(a,c){if(1==a.identifier&&(k=!0,e=a,b.onStartFinger2(a,c),m&&k))b.onStart({touch1:l,touch2:e,e:c})}function d(a){for(var c=a.changedTouches,d=0;d<c.length;d++){var e=c[d];if(0==e.identifier)b.onMoveFinger1(e,a);if(1==e.identifier)b.onMoveFinger2(e,a)}a.preventDefault&&a.preventDefault()}
function a(c){for(var e=c.changedTouches,f=0;f<e.length;f++){var h=e[f];0==h.identifier&&(m=!1,p.removeEventListener("touchstart",g),b.onEndFinger1(h,c));1==h.identifier&&(k=!1,b.onEndFinger2(h,c))}if(m||k)return!0;p.removeEventListener("touchmove",d);p.removeEventListener("touchend",a);b.onEnd(c)}function c(){}var b=this;h=h.element;var k=!1,m=!1,l,e,p=document.documentElement;this.onEnd=this.onEndFinger2=this.onEndFinger1=this.onMoveFinger2=this.onMoveFinger1=this.onStartFinger2=this.onStartFinger1=
this.onStart=c;h.addEventListener("touchstart",function(c){for(var e=c.changedTouches,h=0;h<e.length;h++){var k=e[h];0==k.identifier?(m=!0,(new Task(function(){p.addEventListener("touchstart",g)})).run(),p.addEventListener("touchmove",d),p.addEventListener("touchend",a),l=k,b.onStartFinger1(k,c)):f(k,c)}})}}(),Cropper=function(){return function(h){var g,f,d,a,c,b,k;function m(a){X=a;L(a,Z)}function l(a){R=a;y(a,ja)}function e(a){X=a;L(a)}function p(a){R=a;y(a)}function t(e){ma=Y();ra=ha();a=v.offsetLeft;
c=v.offsetLeft+v.clientWidth/2;b=v.offsetTop;k=v.offsetTop+v.clientHeight/2;g=v.clientWidth;f=v.clientWidth/2;d=v.clientHeight/2}function x(a){t(a);X=a.touch1;R=a.touch2;Ia=n(X,R);ua=ma>ra*V?ra*V/g:ma/g;45>Ia&&(L=w,y=B,q());y=L=la}function r(a){t(a);X=a.touch1;R=a.touch2;da={x:(X.pageX+R.pageX)/2,y:(X.pageY+R.pageY)/2};Z={x:X.pageX-da.x,y:X.pageY-da.y};ja={x:R.pageX-da.x,y:R.pageY-da.y};a=X.pageX>R.pageX;var b=X.pageY>R.pageY,c=a^b,d=45<(b?X.pageY-R.pageY:R.pageY-X.pageY);45<(a?X.pageX-R.pageX:R.pageX-
X.pageX)?d?c?a?(L=G,y=F):(L=F,y=G):a?(L=C,y=A):(L=A,y=C):a?(L=K,y=H):(L=H,y=K):d?b?(L=O,y=I):(L=I,y=O):(L=w,y=B,q())}function n(){return Math.sqrt(Math.pow(X.pageX-R.pageX,2)+Math.pow(X.pageY-R.pageY,2))}function u(a){return{x:v.offsetLeft-a.pageX,y:v.offsetTop-a.pageY}}function q(){na={left:0,top:0,right:Y()-v.clientWidth,bottom:ha()-v.clientHeight}}function w(a,b){b=a.pageX+za.x;a=a.pageY+za.y;b>na.right?b=na.right:b<na.left&&(b=na.left);a>na.bottom?a=na.bottom:a<na.left&&(a=na.left);v.style.left=
String(b)+"px";v.style.top=String(a)+"px"}function B(){}function A(a,b){a=ia(a,b,da);Q=a.x*f;70>Q&&(Q=70);N=a.y*d;70>N&&(N=70);J();D()}function F(a,b){a=ia(a,b,da);Q=a.x*f;70>Q&&(Q=70);W=a.y*d;70>W&&(W=70);J();D()}function G(a,b){a=ia(a,b,da);ea=a.x*f;70>ea&&(ea=70);N=a.y*d;70>N&&(N=70);J();D()}function C(a,b){a=ia(a,b,da);ea=a.x*f;70>ea&&(ea=70);W=a.y*d;70>W&&(W=70);J();D()}function K(a,b){ea=(a.pageX-da.x)/b.x*f;70>ea&&(ea=70);J()}function H(a,b){Q=(a.pageX-da.x)/b.x*f;70>Q&&(Q=70);J()}function I(a,
b){N=(a.pageY-da.y)/b.y*d;70>N&&(N=70);D()}function O(a,b){W=(a.pageY-da.y)/b.y*d;70>W&&(W=70);D()}function la(){var c=n()/Ia;console.log(c);console.log(ua);c>ua&&(c=ua);c*=g;var d=c/V,e=(c-g)/2,f=a-e;e=b-e/V;0>f?f=0:f+c>ma&&(f=ma-c);0>e?e=0:e+d>ra&&(e=ra-d);v.style.width=String(c)+"px";v.style.height=String(d)+"px";v.style.left=String(f)+"px";v.style.top=String(e)+"px"}function J(){var a=c-Q;0>a&&(a=0);var b=ea+c;b>ma&&(b=ma);v.style.left=String(a)+"px";v.style.width=String(b-a)+"px"}function D(){var a=
k-N;0>a&&(a=0);var b=W+k;b>ra&&(b=ra);v.style.top=String(a)+"px";v.style.height=String(b-a)+"px"}function ia(a,b,c){return{x:(a.pageX-c.x)/b.x,y:(a.pageY-c.y)/b.y}}var V=h.aspectRatio,Y=h.getImageWidth,ha=h.getImageHeight;V=h.aspectRatio;var v=E.DIV();v.classList.add("cropper");this.positionDefault=function(a,b){var c=a,d=b;V&&(b*V>a?d=c/V:c=d*V);v.style.left="0px";v.style.top="0px";v.style.width=String(c)+"px";v.style.height=String(d)+"px"};this.onShow=function(){};this.getElement=function(){return v};
this.getPosition=function(a){return{left:v.offsetLeft,top:v.offsetTop}};this.getAbsolutePosition=function(a){return{left:a.pageX,top:a.pageY}};this.getDimensions=function(){return{width:v.clientWidth,height:v.clientHeight}};h=new TwoFingerTouch({element:v});var da,Z,ja,L=B,y=B,Q,N,ea,W,ma,ra,za,na,X,R,ua,Ia;h.onStart=V?x:r;h.onStartFinger1=function(a){q();X=a;za=u(a);L=w};h.onEndFinger1=function(a){q();R?(y=w,za=u(R)):y=B;L=B};h.onEndFinger2=function(a){q();za=u(X);L=w;y=B};h.onMoveFinger1=V?e:m;
h.onMoveFinger2=V?p:l;h.onEnd=function(a){R=X=void 0}}}(),CroppingFrame=new function(){return function(h){function g(a){d.dispatchEvent({type:"error",error:a})}function f(b,c){l.style.width=String(b)+"px";l.style.height=String(c)+"px";var d=a.clientWidth;l.style.marginTop=String((a.clientHeight-c)/2)+"px";l.style.marginLeft=String((d-b)/2)+"px"}EventEnabledBuilder(this);var d=this;h=h.aspectRatio;var a=E.DIV();a.classList.add("cropping-frame");var c,b,k,m,l=E.DIV();l.classList.add("img-wrapper");
var e=new Cropper({getImageWidth:function(){return l.getBoundingClientRect().width},getImageHeight:function(){return l.getBoundingClientRect().height},aspectRatio:h});l.appendChild(e.getElement());a.appendChild(l);this.getElement=function(){return a};this.hide=function(){a.style.display="none"};this.load=function(d){m&&l.removeChild(m);m=void 0;m=E.IMG();m.onload=function(){c=this.width;b=this.height;k=c/b;a.style.display="table-row";e.onShow();if(a.clientWidth/a.clientHeight>k){var d=a.clientHeight;
f(k*d,d)}else d=a.clientWidth,f(d,d/k);l.appendChild(m);e.positionDefault(m.clientWidth,m.clientHeight)};m.onerror=g;m.src=d};this.getCroppedImage=function(a){console.log(a);var d=e.getPosition(),f=e.getDimensions();return ImageProcessing.crop({img:m,imgWidthRaw:c,imgHeightRaw:b,cropperWidth:f.width,cropperHeight:f.height,cropperLeft:d.left,cropperTop:d.top,format:a.format?a.format:"image/jpeg",profile:a.profile})}}},ImageProcessing=new function(){this.crop=function(h){var g=h.img,f=h.imgWidthRaw,
d=h.imgHeightRaw,a=h.cropperWidth,c=h.cropperHeight,b=h.cropperLeft,k=h.cropperTop,m=h.format,l=h.quality,e=h.profile;h=E.CANVAS();var p=h.getContext("2d");if(e.desiredWidth){var t=e.desiredWidth;if(e.aspectRatio)var x=t/e.aspectRatio;else e.finalCroppedHeight&&(x=e.finalCroppedHeight)}else e.finalCroppedHeight&&(x=e.finalCroppedHeight,e.aspectRatio&&(t=x*e.aspectRatio));console.log({width:t,height:x});h.width=t;h.height=x;e=E.CANVAS();var r=e.getContext("2d");e.width=g.width;e.height=g.height;r.drawImage(g,
0,0,f,d,0,0,g.width,g.height);p.drawImage(e,b,k,a,c,0,0,t,x);return h.toDataURL(m,l)}},ProgressBar=function(){return function(h){var g=this,f=!1,d=h.showText,a=h.text,c=E.DIV();c.classList.add("progress-bar");var b=E.DIV();b.classList.add("progress");c.appendChild(b);var k=E.DIV();k.classList.add("text");c.appendChild(k);this.setPercent=function(g){var h=String(g)+"%";b.style.width=h;d&&(k.innerHTML=(a?a:"")+" "+h);100<=g?f||(c.classList.add("progress-bar-done"),f=!0):f&&(c.classList.remove("progress-bar-done"),
f=!1)};this.setProportion=function(a){g.setPrecentage(100*a)};this.getElement=function(){return c}}}(),FileSender=function(){function h(f){function d(){c.dispatchEvent({type:"done",sender:c})}function a(a){console.log("progress");console.log(a);c.onProgress&&c.onProgress(a)}EventEnabledBuilder(this);var c=this,b=f.ajax,g=f.data,h=f.fileName,l;this.send=function(){var e=l=b.post({data:g});e.onDone=d;e.onProgress=a;c.onSending&&c.onSending()};this.abort=function(){l&&l.abort()};this.getSuccessful=function(){return l.getSuccessful()};
this.getFileName=function(){return h}}function g(f){console.log("handle");EventEnabledBuilder(this);var d=this;this.abort=f.abort;f.addEventListener("done",function(){d.dispatchEvent({type:"done",sendingHandle:d,successful:f.getSuccessful()})});f.onProgress=function(a){d.dispatchEvent({type:"progress",sendingHandle:d,percent:a,proportion:a/100})};f.onSending=function(){d.dispatchEvent({type:"sending",handle:d})};this.getFileName=f.getFileName}return function(f){function d(){if(1>e.length)return!1;
e.splice(0,1)[0].addEventListener("done",c);return!0}function a(a){a.sender.removeEventListener("done");b(a.sender);1>e.length&&k.dispatchEvent({type:"done"})}function c(a){a.sender.removeEventListener("done");b(a.sender);d()&&k.dispatchEvent({type:"done"})}function b(a){a=e.indexOf(a);0>a||e.splice(a,1)}EventEnabledBuilder(this);var k=this,m=f.sequentially,l=new Ajax({url:f.url}),e=[];this.queue=function(b){var c=new h({data:b.data,fileName:b.fileName,ajax:l});b=new g(c);m?(e.push(c),2>e.length&&
d()):(new Task(function(){e.push(c);c.addEventListener("done",a);c.send()})).run();k.dispatchEvent({type:"queued",handle:b});return b}}}(),FileSenderUI=function(){function h(g){var f=E.DIV();f.classList.add("sending");var d=new ProgressBar({showText:!0,text:g.getFileName()});d.setPercent(3);f.appendChild(d.getElement());this.getElement=function(){return f};g.addEventListener("sending",function(a){});g.addEventListener("progress",function(a){d.setPercent(a.percent)});g.addEventListener("done",function(a){d.setPercent(100)})}
return function(g){g=g.fileSender;var f=[],d=E.DIV();d.classList.add("file-sender");var a=E.DIV();a.classList.add("entries");d.appendChild(a);this.getElement=function(){return d};this.setVisible=function(a){d.style.display=a?"table-row":"none"};this.clear=function(){each(f,function(c){a.removeChild(c.getElement())});f=[]};g.addEventListener("queued",function(c){c=new h(c.handle);f.push(c);a.appendChild(c.getElement())})}}(),ImageUploader=new function(){function h(g){function f(){var a=E.DIV();a.classList.add("button-wrapper");
return a}var d=g.popup,a=g.buttonClose,c=g.buttonAccept,b=g.buttonReject,h=g.croppingFrame,m=g.fileUploader,l=new FileSenderUI({fileSender:g.fileSender});ImagePreloader.preloadRange(["/images/upload-file.jpg","/images/tick.jpg","/images/cross.jpg","/images/tick-hover.jpg","/images/cross-hover.jpg"]);g=g.popup.getElement();g.classList.add("image-uploader");var e=E.DIV();e.classList.add("inner");var p=E.DIV();p.classList.add("heading");var t=f(),x=f(),r=E.DIV();r.classList.add("cropping-menu");document.body.appendChild(g);
g.appendChild(e);e.appendChild(p);p.appendChild(a.getElement());t.appendChild(c.getElement());x.appendChild(b.getElement());r.appendChild(x);r.appendChild(t);e.appendChild(h.getElement());e.appendChild(m.getElement());e.appendChild(r);e.appendChild(l.getElement());this.show=d.show;this.hide=d.hide;this.setHeading=function(a){p.innerHTML=a};this.setCroppingMenuVisible=function(a){r.style.display=a?"table-row":"none"};this.setFileSenderVisible=l.setVisible;this.clearFileSender=l.clear}return function(g){function f(){t.hide();
d()}function d(){e.setVisible(!0);r.hide();n.setCroppingMenuVisible(!1);n.setFileSenderVisible(!1)}EventEnabledBuilder(this);var a=g.aspectRatio,c=g.profiles,b=g.getSessionId,k=new Button({className:"button-close"}),m=new Button({className:"button-accept"}),l=new Button({className:"button-reject"}),e=new FileUploader({accept:"image/*"}),p=new FileSender({url:g.url}),t=new Popup({}),x,r=new CroppingFrame({aspectRatio:a}),n=new h({popup:t,buttonClose:k,buttonAccept:m,buttonReject:l,croppingFrame:r,
fileUploader:e,fileSender:p});k.addEventListener("click",f);e.addEventListener("file",function(a){x=a.file.name;a=a.dataUrl;e.setVisible(!1);r.load(a);n.setCroppingMenuVisible(!0);n.setFileSenderVisible(!1)});r.addEventListener("error",function(a){console.log(a.error);r.hide();e.setVisible(!1)});p.addEventListener("done",function(){console.log("fileSenderDone");(new Timer({callback:function(){n.clearFileSender();f()},delay:1E3,nTicks:1})).start()});this.show=n.show;this.hide=n.hide;m.addEventListener("click",
function(){var a=[];each(c,function(b){var c=r.getCroppedImage({profile:b});a.push({dataUrl:c,profile:b})});p.queue({data:JSON.stringify({images:a,sessionId:b()}),fileName:x});e.setVisible(!1);r.hide();n.setCroppingMenuVisible(!1);n.setFileSenderVisible(!0)});l.addEventListener("click",d)}},Rooms=new function(){function h(g){var f=g.emoticons,d=g.getTopEntry,a=E.DIV();a.classList.add("rooms");var c=E.DIV();g=E.DIV();g.classList.add("rooms-inner");a.appendChild(g);c.classList.add("entries");g.appendChild(c);
g.appendChild(f.getElement());this.getEntries=function(){return c};this.getElement=function(){return a};this.resize=(new Once(function(){console.log("rooms.resize");var a=d();a&&(a=a.getEntry())&&a.resize&&a.resize()})).trigger}return function(g){function f(f){console.log(f);f=new Room({id:f.id,name:f.name,isPm:f.isPm,getUserMe:p,emoticonsParser:A,userTo:f.userTo,getUserById:t,ignoreManager:n,clickMenuUser:u,getNDevice:x,getSessionId:e,send:l,showUsersSearch:q});B.add(f);var g=f.isPm();C.add(f);f.addEventListener("showemoticons",
b);f.addEventListener("hide",a);f.addEventListener("showpm",function(a){return m.dispatchEvent(a)});g?(f.addEventListener("sendpm",function(a){return m.dispatchEvent(a)}),f.addEventListener("getpms",function(a){m.dispatchEvent(a)}),f.addEventListener("videopmofferrejected",function(a){m.dispatchEvent(a)})):(f.addEventListener("sendmessage",function(a){return m.dispatchEvent(a)}),f.addEventListener("getmessages",function(a){return m.dispatchEvent(a)}));m.dispatchEvent({type:"createdroom",room:f});
f.addEventListener("dispose",d);g?c():f.addEventListener("missingusers",m.dispatchEvent);return f}function d(a){a=a.room;k(a);a.isPm()||c()}function a(a){C.hide(a.room)}function c(){var a=B.getEntries().where(function(a){return!a.isPm()}).select(function(a){return a.getId()}).toList();console.log(a);m.dispatchEvent({type:"roomsinchanged",roomIds:a})}function b(a){G.show({picked:a.picked})}function k(a){B.remove(a);C.remove(a);m.dispatchEvent({type:"destroyedroom",room:a})}EventEnabledBuilder(this);
var m=this,l=g.send,e=g.getSessionId,p=g.getUserMe,t=g.getUserById,x=g.getNDevice,r=g.showRoomsSearch,n=g.ignoreManager,u=g.clickMenu,q=g.showUsersSearch,w=g.showRoomCreationMenu,B=new Set({getEntryId:function(a){return a.getId()}});g=g.usersMenuAll;var A=new EmoticonsParser({emoticonsLibrary:EmoticonsLibrary}),F=new RoomsMenu({usersMenu:g,showRoomsSearch:r,showRoomCreationMenu:w}),G=new Emoticons({emoticonsLibrary:EmoticonsLibrary});r=new h({emoticons:G,getTopEntry:function(){return C.getTopEntry()}});
var C=new OverlappingEntries({element:r.getEntries(),name:"rooms"});F.addEventListener("showroom",function(a){m.showRoom(a.roomInfo)});G.addEventListener("addemoticon",function(a){});C.add(F);C.show(F);this.getElement=r.getElement;this.resize=r.resize;this.showMenu=function(){C.show(F)};this.getById=function(a){return B.getById(a)};this.set=function(a){F.set(a);var b=[];each(a,function(a){b.push(a.id)});each(B.getIds(),function(a){0<=b.indexOf(a)||(a=B.getById(a),a.dispose(),k(a))})};this.incomingMessage=
function(a){var b=B.getById(a.roomId);b&&b.incomingMessage(a.message)};this.incomingMessages=function(a){var b=B.getById(a.roomId);b&&b.incomingMessages(a.messages)};this.showPm=function(a){};this.getOpenRoom=function(){console.log(C.getTopEntry().getEntry());return C.getTopEntry().getEntry()};this.join=function(a,b){b&&(a=B.getById(a.roomId))&&a.join(b)};this.getById=B.getById;this.showRoom=function(a){var b=B.getById(a.id);b||(b=f(a));C.show(b)};this.clear=function(){each(B.getEntries().slice(),
function(a){console.log(a);a.dispose&&a.dispose();k(a)});F.clear()};this.addNew=function(a){F.add(a)}}},AutomaticAuthentication=new function(){return function(h){var g=h.send,f=new Settings("AutomaticAuthentication");this.authenticate=function(){var d=f.get("token");if(!d)return!1;g({type:"automatic_authenticate",token:d});return!0};this.setToken=function(d){f.set("token",d)};this.clear=function(){f.set("token",null)}}},Lobby=function(){function h(g){function f(){F&&F.resize();r.resize();d.resize();
a.resize()}var d=g.rooms,a=g.pmsMenu,c=g.mainMenu,b=g.buttonUsers,h=g.buttonPms,m=g.buttonProfilePicture,l=g.buttonNotifications,e=g.buttonMenu,p=g.notificationsMenu,t=new Spinner({preventInterraction:!0}),x=E.DIV(),r=g.usersMenues,n=new RoomCreationMenuUI(g.roomCreation),u=E.DIV();window.isBrexitChat&&document.body.classList.add("brexit-chat");g=E.DIV();var q=E.DIV();x=E.DIV();u.classList.add("lobby");g.classList.add("right");q.classList.add("right-inner");x.classList.add("button-show-hide-wrapper");
if(window.isMobile)q.appendChild(a.getElement()),q.appendChild(x),q.appendChild(d.getElement()),document.body.appendChild(p.getElement());else{var w=E.DIV();w.classList.add("left");var B=E.DIV();B.classList.add("left-inner");u.appendChild(w);w.appendChild(B);var A=new window.Logo;B.appendChild(A.getElement());B.appendChild(r.getElement());var F=new SplitPane({nPanelsWidth:1,nPanelsHeight:2,rowProfiles:[{height:"120px",minHeight:"60px"},{minHeight:"160px"}]});var G=F.getPanelRow(0);var C=F.getPanelXY(0,
0);B=F.getPanelXY(0,1);C=C.getElement();B=B.getElement();C.appendChild(a.getElement());B.appendChild(x);B.appendChild(d.getElement());q.appendChild(F.getElement());q.appendChild(p.getElement());(new Task(F.resize)).run();A.addEventListener("click",d.showMenu);b.addEventListener("click",f);ResizeManager.add({element:u,onResized:f})}u.appendChild(g);g.appendChild(q);document.documentElement.appendChild(t.getElement());p=E.IMG();p.classList.add("logo-sign-in");p.src=window.isBrexitChat?"/images/logo-brexit-chat-sign-in.gif":
"/images/logo.gif";document.body.appendChild(p);x.appendChild(b.getElement());x.appendChild(h.getElement());x.appendChild(e.getElement());x.appendChild(l.getElement());x.appendChild(m.getElement());this.getElement=function(){return u};this.showMainMenu=function(a){c.show(a);c.setPosition({right:6,top:getAbsolute(m.getElement()).bottom+3})};this.showRoomCreationMenu=n.show;this.setPmsMenuVisible=function(a){G.setVisible(a);f()};this.setLeftVisible=function(a){w.style.display=a?"block":"none";f()};
this.setSpinnerAutomaticAuthenticationVisible=t.setVisible;this.setVisible=function(a){u.style.display=a?"block":"none"};this.resize=f;this.clear=function(){n.hide()}}ImagePreloader.preloadRange("/images/close.jpg /images/tickbox-unticked.gif /images/tickbox-ticked.gif /images/menu.gif /images/menu-hover.gif /images/notifications.gif /images/profile-picture.gif /images/room-default.gif /images/room-exit.gif /images/smiley.gif /images/tick.gif /images/upload-file.gif".split(" "));window.isMobile?ImagePreloader.preloadRange(["/images/pms-mobile.gif",
"/images/users-mobile.gif"]):ImagePreloader.preloadRange("/images/tickbox-unticked-hover.gif /images/tickbox-ticked-hover.gif /images/close-hover.jpg /images/profile-picture-hover.gif /images/notifications-hover.gif /images/pms-hide.gif /images/pms-hide-hover.gif /images/users-hide.gif /images/users-hide-hover.gif /images/users-show.gif /images/users-show-hover.gif /images/pms-show.gif /images/pms-show-hover.gif /images/room-exit-hover.gif /images/smiley-hover.gif /images/tick-hover.gif".split(" "));
0<=location.href.indexOf("brexit")&&(window.isBrexitChat=!0);return function(){function g(){var a=(new Date).getTime()-3E4;F&&F>a?G.show():(F=(new Date).getTime(),D.authenticate()?W.setSpinnerAutomaticAuthenticationVisible(!0):G.show())}function f(){J.send({type:"sign_out",sessionId:w});D.clear();d()}function d(){w=null;v.clear();C.clear();y.clear();Q.hide();ja.clear();W.clear();G.show();da.hide();ha.hide();Y.hide();u(!1)}function a(){Y.show()}function c(a,b){each(b,function(b){var c=C.getById(b);
c?a.join(c):la.get(b)})}function b(a,b){var c=a.getUsers().getEntries().where(function(a){return 0>b.indexOf(a.getId())}).toList();each(c,function(b){a.leave(b)})}function k(a){W.setLeftVisible(a.toggled)}function m(a){W.setPmsMenuVisible(a.toggled)}function l(a){a.pmNotifications&&each(a.pmNotifications,function(a){y.add(Notification.pmNotificationFromJSON(a))})}function e(a){a.where(function(a){return!C.containsId(a)}).each(function(a){return la.get(a)});C.getIds().where(function(b){return 0>a.indexOf(b)}).each(function(a){(a=
C.getById(a))&&a.left()})}function p(a){a.successful?(w=a.sessionId,a.token&&D.setToken(a.token),B=a.nDevice,C.add(User.fromJSON(a.user)),A=C.getById(a.user.id),a.users.select(function(a){return User.fromJSON(a)}).each(function(a){return C.add(a)}),G.hide(),u(!0),J.send({type:"rooms_get",sessionId:w}),Z.load(A.getId()),K.load(A.getId())):G.setError(a.error)}function t(a){return C.getById(a)}function x(){return A}function r(){return w}function n(a){Z.showPmWithUser(a.user)}function u(a){W.setVisible(a);
a&&(new Task(W.resize)).run()}function q(a){J.send({type:"pm_video_offer_rejected",userToId:a.userToId,reason:a.reason,sessionId:w})}var w,B,A,F,G=new Authenticate({callbackRegister:function(a){a.type="register";J.send(a)},callbackSignIn:function(a){a.type="authenticate";J.send(a)},callbackGuest:function(a){a.type="authenticate";a.isGuest=!0;J.send(a)}}),C=new Users({}),K=new IgnoreManager({getUserById:t,getUserMe:x}),H=new ClickMenu({}),I=new ClickMenu({}),O=new UsersMenu({name:"All Users (Lobby)",
users:C,id:"UsersMenuLobby",ignoreManager:K,getUserMe:x,clickMenu:H,showUsersSearch:a}),la=new MissingUsersManager,J=new Mysocket({url:"poll",urlWebsocket:getWebsocketUrl("endpoint")});window.debug&&window.debug.setMysocket(J);var D=new AutomaticAuthentication({send:J.send});(new Task(g)).run();var ia=new SeenNotificationsManager({getSessionId:r,mysocket:J}),V=new UsersMenues({ignoreManager:K});V.add(O);var Y=new UsersSearch({clickMenu:H,ignoreManager:K,getUserMe:x}),ha=new RoomsSearch({clickMenu:H}),
v=new Rooms({getUserMe:x,getUserById:t,ignoreManager:K,clickMenu:H,usersMenuAll:O,getNDevice:function(){return B},getSessionId:r,send:J.send,showUsersSearch:a,showRoomsSearch:function(){ha.show()},showRoomCreationMenu:function(){W.showRoomCreationMenu()}}),da=new ImageUploader({getSessionId:r,aspectRatio:1,profiles:[{desiredWidth:32,aspectRatio:1,name:UserImage.SMALL},{desiredWidth:256,aspectRatio:1,name:UserImage.LARGE}],url:"/image_uploader"}),Z=new Pms({rooms:v,getUserById:C.getById,getUserMe:x,
getOpenRoom:v.getOpenRoom}),ja=new PmsMenu({pms:Z}),L=new RoomCreation({sendMessage:J.send,getSessionId:r}),y=new Notifications({}),Q=new NotificationsMenu({notifications:y,pms:Z,seenNotificationsManager:ia});H=new Button({toggle:!window.isMobile,classNames:["button-users"],classNameToggled:"button-users-hide"});O=new Button({toggle:!window.isMobile,classNames:["button-pms"],classNameToggled:"button-pms-hide"});ia=new Button({classNames:["button-profile-picture"]});var N=new NotificationsButton({notifications:y}),
ea=new Button({classNames:["button-menu"]}),W=new h({rooms:v,buttonUsers:H,buttonPms:O,buttonProfilePicture:ia,buttonNotifications:N,pmsMenu:ja,usersMenues:V,notificationsMenu:Q,buttonMenu:ea,mainMenu:I,roomCreation:L});J.addEventListener("message",function(a){a=a.msg;switch(a.type){case "test":console.log(a);break;case "join":var d=User.fromJSON(a.user);C.contains(d)||C.add(d);(a=a.userIds)&&e(a);break;case "users":C.update(a.users);break;case "authenticate":p(a);l(a);break;case "automatic_authenticate":W.setSpinnerAutomaticAuthenticationVisible(!1);
a.successful?(p(a),l(a)):G.show();break;case "register":p(a);break;case "rooms":v.set(a.rooms);break;case "room_userids":if(d=v.getById(a.roomId))c(d,a.userIds),b(d,a.userIds);break;case "message":v.incomingMessage(a);break;case "pm_message":Z.incomingMessage(a);break;case "messages":v.incomingMessages(a);break;case "pm_messages":Z.incomingMessages(a);break;case "userids":e(a.userIds);break;case "pm_video_offer_fail":Z.videoOfferFail(a);break;case "pm_video_offer_rejected":Z.videoOfferRejected(a);
break;case "pm_video_offer":Z.videoOffer(a);break;case "pm_video_accept_fail":Z.videoAcceptFail(a);break;case "pm_video_accept":Z.videoAccept(a);break;case "pm_video_ice_candidate":Z.videoIceCandidate(a);break;case "create_room":L.incomingCreateRoom(a);break;case "new_room":v.addNew(a.room);break;case "user_image_set":UserImage.update(a.userId,a.image);(d=C.getById(a.userId))&&d.setImage(a.image);break;case "rooms_search":ha.incomingRooms(a.rooms);break;case "users_search":Y.incomingUsers(a.users)}});
J.addEventListener("open",function(){});ia.addEventListener("click",function(){da.show()});N.addEventListener("click",function(){Q.show()});ea.addEventListener("click",function(){W.showMainMenu({options:[{text:"Sign Out ",callback:f}]})});C.addEventListener("add",function(a){OnlineIndicators.setOnline(a.user.getId(),!0)});C.addEventListener("remove",function(a){OnlineIndicators.setOnline(a.user.getId(),!1)});L.addEventListener("created",function(a){v.showRoom(a.roomInfo)});window.isMobile?(O.addEventListener("click",
ja.show),H.addEventListener("click",function(){V.show()})):(O.addEventListener("toggled",m),H.addEventListener("toggled",k));v.addEventListener("sendmessage",function(a){var b=a.message.toJSON();b.roomId=a.roomId;b.type="room_message_send";b.sessionId=w;J.send(b)});v.addEventListener("getmessages",function(a){J.send({type:"room_messages_get",roomId:a.roomId,sessionId:w})});v.addEventListener("getpms",function(a){J.send({type:"pm_messages_get",userToId:a.userToId,sessionId:w})});v.addEventListener("getuserids",
function(a){J.send({type:"room_userids_get",roomId:a.roomId,sessionId:w})});v.addEventListener("createdroom",function(a){a=a.room;V.add(a.getUsersMenu());a.isPm()||J.send({type:"room_join",sessionId:w,roomId:a.getId()})});v.addEventListener("destroyedroom",function(a){var b=a.room;V.remove(a.room.getUsersMenu());b.isPm()||J.send({type:"room_leave",sessionId:w,roomId:b.getId()})});v.addEventListener("roomsinchanged",function(a){J.send({type:"rooms_in_changed",sessionId:w,roomIds:a.roomIds})});v.addEventListener("sendpm",
function(a){var b=a.message.toJSON();b.userToId=a.userToId;b.type="room_pm_send";b.sessionId=w;J.send(b)});v.addEventListener("videopmofferrejected",q);ha.addEventListener("search",function(a){J.send({type:"rooms_search",text:a.text,sessionId:w})});ha.addEventListener("showroom",function(a){v.showRoom(a.roomInfo)});V.addEventListener("showpm",n);Y.addEventListener("search",function(a){J.send({type:"users_search",text:a.text,sessionId:w})});Y.addEventListener("showpm",n);Q.addEventListener("showpm",
n);Z.addEventListener("addnotification",function(a){y.add(a.notification)});Z.addEventListener("videoofferrejected",q);J.addEventListener("disposedbyserver",function(){J.reset();d();g()});Leaving.add(function(){J.send({type:"leaving",sessionId:w})});this.getElement=W.getElement}}(),lobby;compatabilityCheck(function(){lobby=new Lobby;document.body.appendChild(lobby.getElement())},function(){window.location.href="https://www.google.com/chrome/"});